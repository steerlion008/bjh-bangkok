{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport type { NextRequest } from \"next/server\";\r\n// Supported locales\r\nconst locales = [\"th\", \"en\"];\r\nconst defaultLocale = \"th\";\r\nexport function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl;\r\n  // Check authentication for protected routes\r\n  const token = request.cookies.get(\"authToken\")?.value;\r\n\r\n  // Public paths that don't require authentication\r\n  const publicPaths = [\"/login\", \"/register\", \"/forgot-password\", \"/\"];\r\n\r\n  const isPublicPath =\r\n    publicPaths.includes(pathname) ||\r\n    pathname.startsWith(\"/_next\") ||\r\n    pathname.startsWith(\"/api\") ||\r\n    pathname.startsWith(\"/images\") ||\r\n    pathname.startsWith(\"/downloads\") ||\r\n    pathname.startsWith(\"/static\") ||\r\n    pathname.startsWith(\"/share/video\") || // LINE video share pages (public)\r\n    pathname.includes(\".\");\r\n\r\n  // If accessing any path without token (except public paths), redirect to login\r\n  if (!isPublicPath && !token) {\r\n    const loginUrl = new URL(\"/login\", request.url);\r\n    loginUrl.searchParams.set(\"redirect\", pathname);\r\n    return NextResponse.redirect(loginUrl);\r\n  }\r\n\r\n  // If already logged in and trying to access login page, redirect to home\r\n  if (token && pathname === \"/login\") {\r\n    return NextResponse.redirect(new URL(\"/home\", request.url));\r\n  }\r\n  // ตรวจสอบว่า URL มี locale prefix หรือไม่\r\n  const pathnameHasLocale = locales.some(\r\n    (locale) => pathname.startsWith(`/${locale}/`) || pathname === `/${locale}`\r\n  );\r\n  if (pathnameHasLocale) {\r\n    // ถ้ามี locale prefix (เช่น /th/contact-inquiry)\r\n    // ให้ rewrite ไปยัง path จริงโดยไม่มี locale prefix\r\n    const locale = pathname.split(\"/\")[1];\r\n    const pathWithoutLocale = pathname.replace(`/${locale}`, \"\") || \"/\";\r\n    // Rewrite URL\r\n    const url = request.nextUrl.clone();\r\n    url.pathname = pathWithoutLocale;\r\n    // เก็บ locale ไว้ใน header\r\n    const response = NextResponse.rewrite(url);\r\n    response.headers.set(\"x-locale\", locale);\r\n    return response;\r\n  }\r\n  // ถ้าไม่มี locale prefix ให้ทำงานปกติ\r\n  return NextResponse.next();\r\n}\r\nexport const config = {\r\n  // กำหนด path ที่ต้องการให้ middleware ทำงาน\r\n  matcher: [\r\n    // ไม่รวม static files และ API routes\r\n    \"/((?!api|_next/static|_next/image|favicon.ico|images|downloads|TPP.ico).*)\",\r\n  ],\r\n};\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAEA,oBAAoB;AACpB,MAAM,UAAU;IAAC;IAAM;CAAK;AAC5B,MAAM,gBAAgB;AACf,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,4CAA4C;IAC5C,MAAM,QAAQ,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;IAEhD,iDAAiD;IACjD,MAAM,cAAc;QAAC;QAAU;QAAa;QAAoB;KAAI;IAEpE,MAAM,eACJ,YAAY,QAAQ,CAAC,aACrB,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,WACpB,SAAS,UAAU,CAAC,cACpB,SAAS,UAAU,CAAC,iBACpB,SAAS,UAAU,CAAC,cACpB,SAAS,UAAU,CAAC,mBAAmB,kCAAkC;IACzE,SAAS,QAAQ,CAAC;IAEpB,+EAA+E;IAC/E,IAAI,CAAC,gBAAgB,CAAC,OAAO;QAC3B,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;QACtC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,yEAAyE;IACzE,IAAI,SAAS,aAAa,UAAU;QAClC,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,SAAS,QAAQ,GAAG;IAC3D;IACA,0CAA0C;IAC1C,MAAM,oBAAoB,QAAQ,IAAI,CACpC,CAAC,SAAW,SAAS,UAAU,CAAC,CAAC,CAAC,EAAE,OAAO,CAAC,CAAC,KAAK,aAAa,CAAC,CAAC,EAAE,QAAQ;IAE7E,IAAI,mBAAmB;QACrB,iDAAiD;QACjD,oDAAoD;QACpD,MAAM,SAAS,SAAS,KAAK,CAAC,IAAI,CAAC,EAAE;QACrC,MAAM,oBAAoB,SAAS,OAAO,CAAC,CAAC,CAAC,EAAE,QAAQ,EAAE,OAAO;QAChE,cAAc;QACd,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,2BAA2B;QAC3B,MAAM,WAAW,gMAAY,CAAC,OAAO,CAAC;QACtC,SAAS,OAAO,CAAC,GAAG,CAAC,YAAY;QACjC,OAAO;IACT;IACA,sCAAsC;IACtC,OAAO,gMAAY,CAAC,IAAI;AAC1B;AACO,MAAM,SAAS;IACpB,4CAA4C;IAC5C,SAAS;QACP,qCAAqC;QACrC;KACD;AACH"}}]
}