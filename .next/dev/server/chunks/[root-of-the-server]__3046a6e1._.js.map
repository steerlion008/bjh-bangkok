{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nut_z/OneDrive/%E0%B9%80%E0%B8%94%E0%B8%AA%E0%B8%81%E0%B9%8C%E0%B8%97%E0%B9%87%E0%B8%AD%E0%B8%9B/new-bjh/bjh-bangkok/src/app/api/facebook-ads-balance/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nexport async function GET(request: Request) {\r\n  try {\r\n    const ACCESS_TOKEN =\r\n      process.env.FACEBOOK_ACCESS_TOKEN ||\r\n      \"EAAPb1ZBYCiNcBPzNxxSUntCZCTVHyl5AkAZBIiwCmDzrWKMLU4VEHJxRve7oqUDSaMs8om9pdVWFLzUdeTbTvkGPuTeuQ4KvGFizMy3VsSid8vgmjZB8OMoLySRmXxyAUpAwyyhSqOO8tSZAU6IYpxarsXBbZCDzFdy8u279HxSXtyWMpIolRtjJEWLdmfU5SwZCsP5\";\r\n    const ACCOUNT_ID = \"act_454323590676166\";\r\n    const url = `https://graph.facebook.com/v24.0/${ACCOUNT_ID}?fields=account_id,name,account_status,balance,amount_spent,currency,funding_source_details,min_daily_budget,spend_cap&access_token=${ACCESS_TOKEN}`;\r\n    const response = await fetch(url, {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n    });\r\n    if (!response.ok) {\r\n      const errorData = await response.json();\r\n      console.error(\"Facebook API Error:\", errorData);\r\n      return NextResponse.json(\r\n        {\r\n          success: false,\r\n          error: \"ไม่สามารถดึงข้อมูลยอดเงินคงเหลือได้\",\r\n          details: errorData,\r\n        },\r\n        { status: response.status }\r\n      );\r\n    }\r\n    const data = await response.json();\r\n    console.log(\"Facebook Balance API Response:\", data);\r\n    // Extract balance from display_string\r\n    let availableBalance = 0;\r\n    if (data.funding_source_details?.display_string) {\r\n      const displayString = data.funding_source_details.display_string;\r\n      // Extract number from \"ยอดคงเหลือที่ใช้ได้ (฿1,530.04 THB)\"\r\n      const match = displayString.match(/฿([\\d,]+\\.?\\d*)/);\r\n      if (match) {\r\n        // Remove commas and convert to number\r\n        availableBalance = parseFloat(match[1].replace(/,/g, \"\"));\r\n      }\r\n    }\r\n    return NextResponse.json({\r\n      success: true,\r\n      data: {\r\n        account_id: data.account_id,\r\n        account_name: data.name,\r\n        account_status: data.account_status,\r\n        balance: data.balance,\r\n        amount_spent: data.amount_spent,\r\n        currency: data.currency,\r\n        available_balance: availableBalance,\r\n        display_string: data.funding_source_details?.display_string || \"\",\r\n        spend_cap: data.spend_cap,\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error fetching Facebook balance:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: \"เกิดข้อผิดพลาดในการดึงข้อมูล\",\r\n        details: error instanceof Error ? error.message : \"Unknown error\",\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r"],"names":[],"mappings":";;;;AAAA;;AACO,eAAe,IAAI,OAAgB;IACxC,IAAI;QACF,MAAM,eACJ,QAAQ,GAAG,CAAC,qBAAqB,IACjC;QACF,MAAM,aAAa;QACnB,MAAM,MAAM,CAAC,iCAAiC,EAAE,WAAW,oIAAoI,EAAE,cAAc;QAC/M,MAAM,WAAW,MAAM,MAAM,KAAK;YAChC,QAAQ;YACR,SAAS;gBACP,gBAAgB;YAClB;QACF;QACA,IAAI,CAAC,SAAS,EAAE,EAAE;YAChB,MAAM,YAAY,MAAM,SAAS,IAAI;YACrC,QAAQ,KAAK,CAAC,uBAAuB;YACrC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBACE,SAAS;gBACT,OAAO;gBACP,SAAS;YACX,GACA;gBAAE,QAAQ,SAAS,MAAM;YAAC;QAE9B;QACA,MAAM,OAAO,MAAM,SAAS,IAAI;QAChC,QAAQ,GAAG,CAAC,kCAAkC;QAC9C,sCAAsC;QACtC,IAAI,mBAAmB;QACvB,IAAI,KAAK,sBAAsB,EAAE,gBAAgB;YAC/C,MAAM,gBAAgB,KAAK,sBAAsB,CAAC,cAAc;YAChE,4DAA4D;YAC5D,MAAM,QAAQ,cAAc,KAAK,CAAC;YAClC,IAAI,OAAO;gBACT,sCAAsC;gBACtC,mBAAmB,WAAW,KAAK,CAAC,EAAE,CAAC,OAAO,CAAC,MAAM;YACvD;QACF;QACA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,MAAM;gBACJ,YAAY,KAAK,UAAU;gBAC3B,cAAc,KAAK,IAAI;gBACvB,gBAAgB,KAAK,cAAc;gBACnC,SAAS,KAAK,OAAO;gBACrB,cAAc,KAAK,YAAY;gBAC/B,UAAU,KAAK,QAAQ;gBACvB,mBAAmB;gBACnB,gBAAgB,KAAK,sBAAsB,EAAE,kBAAkB;gBAC/D,WAAW,KAAK,SAAS;YAC3B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO;YACP,SAAS,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QACpD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}