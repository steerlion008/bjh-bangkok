{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nut_z/OneDrive/%E0%B9%80%E0%B8%94%E0%B8%AA%E0%B8%81%E0%B9%8C%E0%B8%97%E0%B9%87%E0%B8%AD%E0%B8%9B/new-bjh/bjh-bangkok/src/lib/db.ts"],"sourcesContent":["import { Pool, types } from \"pg\";\r\n\r\n// กำหนดให้ pg ไม่แปลง DATE เป็น JavaScript Date object\r\n// เพื่อหลีกเลี่ยงปัญหา timezone shift\r\ntypes.setTypeParser(types.builtins.DATE, (val) => val); // DATE - return as string\r\ntypes.setTypeParser(types.builtins.TIMESTAMP, (val) => val); // TIMESTAMP - return as string\r\ntypes.setTypeParser(types.builtins.TIMESTAMPTZ, (val) => val); // TIMESTAMPTZ - return as string\r\n\r\n// สร้าง connection pool สำหรับ PostgreSQL (n8n.bjhbangkok.com)\r\nconst pool = new Pool({\r\n  host: process.env.DB_HOST || \"n8n.bjhbangkok.com\",\r\n  port: parseInt(process.env.DB_PORT || \"5432\"),\r\n  user: process.env.DB_USER || \"postgres\",\r\n  password: process.env.DB_PASSWORD || \"Bjh12345!!\",\r\n  database: process.env.DB_NAME || \"postgres\",\r\n  max: 20, // จำนวน connection สูงสุด\r\n  idleTimeoutMillis: 30000,\r\n  connectionTimeoutMillis: 30000, // เพิ่มเป็น 30 วินาที\r\n  statement_timeout: 60000, // Query timeout 60 วินาที\r\n  query_timeout: 60000,\r\n  // n8n ไม่รองรับ SSL\r\n  ssl: false,\r\n});\r\n// ตรวจสอบการเชื่อมต่อ\r\npool.on(\"connect\", () => {\r\n  // Connected to database\r\n});\r\npool.on(\"error\", (err) => {\r\n  // Database error\r\n  // ไม่ exit ใน production เพื่อให้ retry ได้\r\n  if (process.env.NODE_ENV !== \"production\") {\r\n    process.exit(-1);\r\n  }\r\n});\r\nexport default pool;\r\n"],"names":[],"mappings":";;;;AAAA;;;;;;AAEA,uDAAuD;AACvD,sCAAsC;AACtC,6GAAK,CAAC,aAAa,CAAC,6GAAK,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,MAAQ,MAAM,0BAA0B;AAClF,6GAAK,CAAC,aAAa,CAAC,6GAAK,CAAC,QAAQ,CAAC,SAAS,EAAE,CAAC,MAAQ,MAAM,+BAA+B;AAC5F,6GAAK,CAAC,aAAa,CAAC,6GAAK,CAAC,QAAQ,CAAC,WAAW,EAAE,CAAC,MAAQ,MAAM,iCAAiC;AAEhG,+DAA+D;AAC/D,MAAM,OAAO,IAAI,4GAAI,CAAC;IACpB,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IACtC,MAAM,QAAQ,GAAG,CAAC,OAAO,IAAI;IAC7B,UAAU,QAAQ,GAAG,CAAC,WAAW,IAAI;IACrC,UAAU,QAAQ,GAAG,CAAC,OAAO,IAAI;IACjC,KAAK;IACL,mBAAmB;IACnB,yBAAyB;IACzB,mBAAmB;IACnB,eAAe;IACf,oBAAoB;IACpB,KAAK;AACP;AACA,sBAAsB;AACtB,KAAK,EAAE,CAAC,WAAW;AACjB,wBAAwB;AAC1B;AACA,KAAK,EAAE,CAAC,SAAS,CAAC;IAChB,iBAAiB;IACjB,4CAA4C;IAC5C,wCAA2C;QACzC,QAAQ,IAAI,CAAC,CAAC;IAChB;AACF;uCACe"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/nut_z/OneDrive/%E0%B9%80%E0%B8%94%E0%B8%AA%E0%B8%81%E0%B9%8C%E0%B8%97%E0%B9%87%E0%B8%AD%E0%B8%9B/new-bjh/bjh-bangkok/src/app/api/n-staff/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport pool from \"@/lib/db\";\r\n\r\ninterface StaffRow {\r\n  code: string | null;\r\n  nickname: string | null;\r\n}\r\n\r\nexport async function GET() {\r\n  const client = await pool.connect();\r\n\r\n  try {\r\n    const result = await client.query<StaffRow>(\r\n      `SELECT code, nickname\r\n       FROM \"BJH-Server\".n_staff\r\n       WHERE nickname IS NOT NULL AND TRIM(nickname) <> ''\r\n       ORDER BY nickname ASC`\r\n    );\r\n\r\n    const data = result.rows\r\n      .map((row) => ({\r\n        code: row.code ? String(row.code) : \"\",\r\n        nickname: row.nickname ? row.nickname.trim() : \"\",\r\n      }))\r\n      .filter((item) => item.nickname.length > 0);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data,\r\n      total: data.length,\r\n      source: \"PostgreSQL Database (n_staff)\",\r\n    });\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching n_staff nicknames:\", error);\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message || \"Failed to fetch staff nicknames\",\r\n      },\r\n      { status: 500 }\r\n    );\r\n  } finally {\r\n    client.release();\r\n  }\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;;;;;AAOO,eAAe;IACpB,MAAM,SAAS,MAAM,6HAAI,CAAC,OAAO;IAEjC,IAAI;QACF,MAAM,SAAS,MAAM,OAAO,KAAK,CAC/B,CAAC;;;4BAGqB,CAAC;QAGzB,MAAM,OAAO,OAAO,IAAI,CACrB,GAAG,CAAC,CAAC,MAAQ,CAAC;gBACb,MAAM,IAAI,IAAI,GAAG,OAAO,IAAI,IAAI,IAAI;gBACpC,UAAU,IAAI,QAAQ,GAAG,IAAI,QAAQ,CAAC,IAAI,KAAK;YACjD,CAAC,GACA,MAAM,CAAC,CAAC,OAAS,KAAK,QAAQ,CAAC,MAAM,GAAG;QAE3C,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,OAAO,KAAK,MAAM;YAClB,QAAQ;QACV;IACF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,MAAM,OAAO,IAAI;QAC1B,GACA;YAAE,QAAQ;QAAI;IAElB,SAAU;QACR,OAAO,OAAO;IAChB;AACF"}}]
}