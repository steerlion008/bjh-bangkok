(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,943007,e=>{"use strict";var a=e.i(843476),s=e.i(271645),t=e.i(618566);function l({isOpen:e,onClose:s,surgeries:t,date:l,month:r,year:i,contactPerson:n,tableType:c="P"}){return e?(0,a.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h2",{children:"P"===c?"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”":"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”à¸ˆà¸£à¸´à¸‡"}),(0,a.jsx)("button",{className:"close-button",onClick:s,children:"âœ•"})]}),(0,a.jsxs)("div",{className:"modal-info",children:[(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆ:"}),(0,a.jsxs)("span",{className:"info-value",children:[l," ",["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸à¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸à¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸à¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸à¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"][r]," ",i+543]})]}),(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,a.jsx)("span",{className:"info-value",children:n})]}),(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸™à¸±à¸”:"}),(0,a.jsxs)("span",{className:"info-value highlight",children:[t.length," à¸£à¸²à¸¢à¸à¸²à¸£"]})]})]}),(0,a.jsx)("div",{className:"surgeries-list",children:t.map((e,s)=>(0,a.jsxs)("div",{className:"surgery-card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsxs)("span",{className:"card-number",children:["#",s+1]}),(0,a.jsx)("span",{className:"card-name",children:e.à¸Šà¸·à¹ˆà¸­})]}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¨â€âš•ï¸"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸«à¸¡à¸­:"}),(0,a.jsx)("span",{className:"detail-value",children:e.à¸«à¸¡à¸­||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¤"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,a.jsx)("span",{className:"detail-value",children:e.à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ“"}),(0,a.jsx)("span",{className:"detail-label",children:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£:"}),(0,a.jsx)("span",{className:"detail-value",children:e.à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ“…"}),(0,a.jsx)("span",{className:"detail-label",children:"P"===c?"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸™à¸±à¸”:":"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸•à¸±à¸”:"}),(0,a.jsx)("span",{className:"detail-value",children:"P"===c?e.à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”||"-":e.à¸§à¸±à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸•à¸±à¸”||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ•"}),(0,a.jsx)("span",{className:"detail-label",children:"à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸™à¸±à¸”:"}),(0,a.jsx)("span",{className:"detail-value",children:e.à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸™à¸±à¸”||"-"})]}),(0,a.jsxs)("div",{className:"detail-row highlight-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ’°"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸¢à¸­à¸”à¸™à¸³à¹€à¸ªà¸™à¸­:"}),(0,a.jsx)("span",{className:"detail-value amount",children:e.à¸¢à¸­à¸”à¸™à¸³à¹€à¸ªà¸™à¸­?`${(e=>{if(!e)return"-";let a=parseFloat(e.replace(/,/g,""));return isNaN(a)?e:a.toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:0})})(e.à¸¢à¸­à¸”à¸™à¸³à¹€à¸ªà¸™à¸­)} à¸šà¸²à¸—`:"-"})]})]})]},s))}),(0,a.jsx)("div",{className:"modal-footer",children:(0,a.jsx)("button",{className:"close-footer-button",onClick:s,children:"à¸›à¸´à¸”"})})]})}):null}function r({isOpen:e,onClose:s,nClinicData:t,futureData:l,date:r,month:i,year:n,contactPerson:c}){if(!e)return null;let d=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸à¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸à¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸à¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸à¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"],o=e=>e?e.toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:0}):"-",m=e=>{if(!e)return"-";try{let a=new Date(e),s=a.getDate(),t=a.getMonth(),l=a.getFullYear();return`${s} ${d[t]} ${l+543}`}catch{return e}},h=t.reduce((e,a)=>e+(a.income||0),0)+l.reduce((e,a)=>e+(a.proposed_amount||0),0);return(0,a.jsx)("div",{className:"modal-overlay",onClick:s,children:(0,a.jsxs)("div",{className:"modal-content",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"modal-header",children:[(0,a.jsx)("h2",{children:"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸›à¸£à¸°à¸¡à¸²à¸“à¸à¸²à¸£à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,a.jsx)("button",{className:"close-button",onClick:s,children:"âœ•"})]}),(0,a.jsxs)("div",{className:"modal-info",children:[(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆ:"}),(0,a.jsxs)("span",{className:"info-value",children:[r," ",d[i]," ",n+543]})]}),(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,a.jsx)("span",{className:"info-value",children:c})]}),(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£:"}),(0,a.jsxs)("span",{className:"info-value highlight",children:[t.length+l.length," à¸£à¸²à¸¢à¸à¸²à¸£"]})]}),(0,a.jsxs)("div",{className:"info-row",children:[(0,a.jsx)("span",{className:"info-label",children:"à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”:"}),(0,a.jsxs)("span",{className:"info-value highlight amount",children:[o(h)," à¸šà¸²à¸—"]})]})]}),(0,a.jsxs)("div",{className:"surgeries-list",children:[t.length>0&&(0,a.jsxs)("div",{className:"data-section",children:[(0,a.jsxs)("h3",{className:"section-title",children:["ğŸ“Š à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§ (N_Clinic) - ",t.length," à¸£à¸²à¸¢à¸à¸²à¸£"]}),t.map((e,s)=>(0,a.jsxs)("div",{className:"surgery-card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsxs)("span",{className:"card-number",children:["#",s+1]}),(0,a.jsx)("span",{className:"card-name",children:e.income_display_name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"})]}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¤"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²:"}),(0,a.jsx)("span",{className:"detail-value",children:e.income_display_name||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¥"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,a.jsx)("span",{className:"detail-value",children:e.staff_display_name||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ“…"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”:"}),(0,a.jsx)("span",{className:"detail-value",children:m(e.income_date)})]}),(0,a.jsxs)("div",{className:"detail-row highlight-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ’°"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸£à¸²à¸„à¸²à¸—à¸µà¹ˆà¹€à¸ªà¸™à¸­:"}),(0,a.jsxs)("span",{className:"detail-value amount",children:[o(e.income)," à¸šà¸²à¸—"]})]})]})]},`clinic-${s}`))]}),l.length>0&&(0,a.jsxs)("div",{className:"data-section",children:[(0,a.jsxs)("h3",{className:"section-title",children:["ğŸ“… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸±à¸”à¹ƒà¸™à¸­à¸™à¸²à¸„à¸• (Future Revenue) - ",l.length," ","à¸£à¸²à¸¢à¸à¸²à¸£"]}),l.map((e,s)=>(0,a.jsxs)("div",{className:"surgery-card",children:[(0,a.jsxs)("div",{className:"card-header",children:[(0,a.jsxs)("span",{className:"card-number",children:["#",t.length+s+1]}),(0,a.jsx)("span",{className:"card-name",children:e.customer_name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"})]}),(0,a.jsxs)("div",{className:"card-body",children:[(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¤"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²:"}),(0,a.jsx)("span",{className:"detail-value",children:e.customer_name||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¨â€âš•ï¸"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸«à¸¡à¸­:"}),(0,a.jsx)("span",{className:"detail-value",children:e.doctor||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ‘¥"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,a.jsx)("span",{className:"detail-value",children:e.contact_staff||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ“"}),(0,a.jsx)("span",{className:"detail-label",children:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£:"}),(0,a.jsx)("span",{className:"detail-value",children:e.phone||"-"})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ“…"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”:"}),(0,a.jsx)("span",{className:"detail-value",children:m(e.surgery_date)})]}),(0,a.jsxs)("div",{className:"detail-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ•"}),(0,a.jsx)("span",{className:"detail-label",children:"à¹€à¸§à¸¥à¸²à¸™à¸±à¸”:"}),(0,a.jsx)("span",{className:"detail-value",children:e.appointment_time||"-"})]}),(0,a.jsxs)("div",{className:"detail-row highlight-row",children:[(0,a.jsx)("span",{className:"detail-icon",children:"ğŸ’°"}),(0,a.jsx)("span",{className:"detail-label",children:"à¸£à¸²à¸„à¸²à¸—à¸µà¹ˆà¹€à¸ªà¸™à¸­:"}),(0,a.jsxs)("span",{className:"detail-value amount",children:[o(e.proposed_amount)," à¸šà¸²à¸—"]})]})]})]},`future-${s}`))]}),0===t.length&&0===l.length&&(0,a.jsx)("div",{className:"empty-state",children:(0,a.jsx)("p",{children:"à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸²à¸¢à¸£à¸±à¸šà¹ƒà¸™à¸§à¸±à¸™à¸™à¸µà¹‰"})})]}),(0,a.jsx)("div",{className:"modal-footer",children:(0,a.jsx)("button",{className:"close-footer-button",onClick:s,children:"à¸›à¸´à¸”"})})]})})}var i=e.i(247167);i.default.env.NEXT_PUBLIC_GOOGLE_SHEETS_API_KEY,i.default.env.NEXT_PUBLIC_SPREADSHEET_ID;let n={"101-à¸ªà¸²":"à¸ªà¸²","102-à¸à¸´à¸Šà¸Šà¸²":"à¸à¸´à¸Šà¸Šà¸²","103-à¸•à¸±à¹‰à¸‡à¹‚à¸­à¹‹":"à¸•à¸±à¹‰à¸‡à¹‚à¸­à¹‹","104-Test":"Test","105-à¸ˆà¸µà¸™":"à¸ˆà¸µà¸™","106-à¸¡à¸¸à¸":"à¸¡à¸¸à¸","107-à¹€à¸ˆ":"à¹€à¸ˆ","108-à¸§à¹ˆà¸²à¸™":"à¸§à¹ˆà¸²à¸™","109-à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸":"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸","110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡":"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"};async function c(){try{let e=new Date().getTime(),a=await fetch(`/api/surgery-schedule-db?t=${e}`,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!a.ok){let e=await a.json().catch(()=>null);if(e?.error)throw Error(e.error);throw Error(`à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰: ${a.statusText}

à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š:
1. Database connection à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´
2. à¸•à¸²à¸£à¸²à¸‡ surgery_schedule à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
3. Environment variables (DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME) à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡`)}let s=await a.json();if(!s.success)throw Error(s.error||"Database API returned unsuccessful response");return console.log(`âœ… Successfully fetched ${s.total||0} records from Database`),s.data||[]}catch(e){throw console.error("Error fetching from Database:",e),e}}async function d(){try{let e=await fetch("/api/surgery-actual-db",{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(!e.ok)throw Error(`Failed to fetch surgery actual data: ${e.statusText}`);let a=await e.json();if(!a.success)throw Error(a.error||"Failed to fetch surgery actual data");return a.data}catch(e){throw Error(e.message||"Failed to fetch surgery actual data from database")}}async function o(){try{let e=new Date().getTime(),a=await fetch(`/api/revenue-future-db?t=${e}`,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!a.ok){let e=await a.json().catch(()=>null);if(e?.error)throw Error(e.error);throw Error(`à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰: ${a.statusText}

à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š:
1. Database connection à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´
2. à¸•à¸²à¸£à¸²à¸‡ bjh_all_leads à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
3. Environment variables à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡`)}let s=await a.json();if(!s.success)throw Error(s.error||"Database API returned unsuccessful response");return console.log(`âœ… Successfully fetched ${s.total||0} future revenue records from Database`),s.data||[]}catch(e){throw console.error("Error fetching future revenue from Database:",e),e}}async function m(){try{let e=new Date().getTime(),a=await fetch(`/api/n-clinic-db?t=${e}`,{cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache"}});if(!a.ok){let e=await a.json().catch(()=>null);if(e?.error)throw Error(e.error);throw Error(`à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹„à¸”à¹‰: ${a.statusText}

à¸à¸£à¸¸à¸“à¸²à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š:
1. Database connection à¸—à¸³à¸‡à¸²à¸™à¸›à¸à¸•à¸´
2. à¸•à¸²à¸£à¸²à¸‡ n_income, n_customer à¹à¸¥à¸° n_staff à¸¡à¸µà¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥
3. Environment variables à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡`)}let s=await a.json();if(!s.success)throw Error(s.error||"Database API returned unsuccessful response");console.log(`âœ… Successfully fetched ${s.total||0} n_clinic records from Database (n_income)`);let t=(s.data||[]).map(e=>({...e,income:e.income?parseFloat(e.income.toString().replace(/,/g,"")):0}));return console.log("ğŸ” Transformed n_clinic data sample:",{raw:s.data?.[0],transformed:t[0]}),t}catch(e){throw console.error("Error fetching n_clinic from Database:",e),e}}function h(){let e,i,h,u,f,g,x,p,j,N,v,y,_,b,w=(0,t.useRouter)(),D=new Date,[$,S]=(0,s.useState)(D.getMonth()),[E,M]=(0,s.useState)(D.getFullYear()),[k,C]=(0,s.useState)([]),[T,P]=(0,s.useState)([]),[F,R]=(0,s.useState)(!0),[L,I]=(0,s.useState)(null),A=s.default.useRef(null),Y=s.default.useRef(null),z=s.default.useRef(null),[B,O]=(0,s.useState)(new Map),[K,H]=(0,s.useState)(new Map),[W,U]=(0,s.useState)(new Map),[q,G]=(0,s.useState)(new Map),[V,Q]=(0,s.useState)([]),[X,J]=(0,s.useState)([]),[Z,ee]=(0,s.useState)(null),[ea,es]=(0,s.useState)(!1),[et,el]=(0,s.useState)({"105-à¸ˆà¸µà¸™":{kpiMonth:40,kpiToDate:0,actual:5},"107-à¹€à¸ˆ":{kpiMonth:40,kpiToDate:0,actual:0},"108-à¸§à¹ˆà¸²à¸™":{kpiMonth:40,kpiToDate:0,actual:0},"109-à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸":{kpiMonth:0,kpiToDate:0,actual:0},"110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡":{kpiMonth:0,kpiToDate:0,actual:0}}),[er,ei]=(0,s.useState)(!1),[en,ec]=(0,s.useState)([]),[ed,eo]=(0,s.useState)(1),[em,eh]=(0,s.useState)(""),[eu,ef]=(0,s.useState)("P"),[eg,ex]=(0,s.useState)(!1),[ep,ej]=(0,s.useState)([]),[eN,ev]=(0,s.useState)([]),ey=async(e=!1)=>{e?es(!0):R(!0),I(null);try{let e=await c();C(e);let a=await d();P(a),ee(new Date)}catch(e){I(e.message||"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥")}finally{R(!1),es(!1)}},e_=async()=>{try{console.log("ğŸ”„ Starting to load N_Clinic data (n_income + n_customer + n_staff)...");let e=await m();console.log("ğŸ’° N_Clinic Data Loaded:",{totalRecords:e.length,sampleRecords:e.slice(0,5),uniqueStaffDisplayName:[...new Set(e.map(e=>e.staff_display_name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"))],sampleData:e.slice(0,5).map(e=>({staff_display_name:e.staff_display_name,income_date:e.income_date,income:e.income,income_display_name:e.income_display_name}))}),J(e),console.log("âœ… Loaded N_Clinic data from n_income")}catch(e){console.error("âŒ Error loading N_Clinic data:",e),console.error("Error details:",{message:e.message,stack:e.stack}),J([])}},eb=async()=>{try{console.log("ğŸ”„ Starting to load Revenue data (bjh_all_leads - surgery_date >= today)...");let e=await o();console.log("ğŸ’° Revenue Data Loaded (bjh_all_leads - Future only):",{totalRecords:e.length,sampleRecords:e.slice(0,5),uniqueContactStaff:[...new Set(e.map(e=>e.contact_staff||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"))],sampleData:e.slice(0,5).map(e=>({contact_staff:e.contact_staff,surgery_date:e.surgery_date,doctor:e.doctor,customer_name:e.customer_name,phone:e.phone,proposed_amount:e.proposed_amount,appointment_time:e.appointment_time}))}),Q(e),console.log("âœ… Loaded Revenue data (bjh_all_leads - surgery_date >= today)")}catch(e){console.error("âŒ Error loading Revenue data:",e),console.error("Error details:",{message:e.message,stack:e.stack}),Q([])}},ew=()=>{A.current&&sessionStorage.setItem("pTableScrollLeft",A.current.scrollLeft.toString()),Y.current&&sessionStorage.setItem("lTableScrollLeft",Y.current.scrollLeft.toString()),z.current&&sessionStorage.setItem("revenueTableScrollLeft",z.current.scrollLeft.toString())};(0,s.useEffect)(()=>{let e=A.current,a=Y.current,s=z.current;return e&&e.addEventListener("scroll",ew),a&&a.addEventListener("scroll",ew),s&&s.addEventListener("scroll",ew),()=>{e&&e.removeEventListener("scroll",ew),a&&a.removeEventListener("scroll",ew),s&&s.removeEventListener("scroll",ew)}},[]),(0,s.useEffect)(()=>{F||setTimeout(()=>{let e,a,s;e=sessionStorage.getItem("pTableScrollLeft"),a=sessionStorage.getItem("lTableScrollLeft"),s=sessionStorage.getItem("revenueTableScrollLeft"),e&&A.current&&(A.current.scrollLeft=parseInt(e)),a&&Y.current&&(Y.current.scrollLeft=parseInt(a)),s&&z.current&&(z.current.scrollLeft=parseInt(s))},100)},[F,$,E]),(0,s.useEffect)(()=>{(async()=>{await ey()})()},[]),(0,s.useEffect)(()=>{(async()=>{await e_()})()},[$,E]),(0,s.useEffect)(()=>{(async()=>{await eb()})()},[$,E]),(0,s.useEffect)(()=>{let e=setInterval(async()=>{await ey()},3e4);return()=>clearInterval(e)},[]),(0,s.useEffect)(()=>{let e=setInterval(async()=>{await e_()},3e4);return()=>clearInterval(e)},[]),(0,s.useEffect)(()=>{let e=setInterval(async()=>{await eb()},3e4);return()=>clearInterval(e)},[]);let eD=(e,a)=>new Date(a,e+1,0).getDate(),e$=eD($,E),eS=Array.from({length:e$},(e,a)=>a+1),eE=e=>{let a=new Date(E,$,e).getDay();return a>=1&&a<=5},eM=()=>{let e=new Date,a=e.getDate(),s=e.getMonth(),t=e.getFullYear();if(E>t||E===t&&$>s)return 0;if(E<t||E===t&&$<s){let e=0,a=eD($,E);for(let s=1;s<=a;s++)eE(s)&&e++;return e}let l=0;for(let e=1;e<=a;e++)eE(e)&&l++;return l};(0,s.useEffect)(()=>{if(k.length>0){let e,a,s;O((e=new Map,Object.values(n).forEach(a=>{e.set(a,new Map)}),a=0,s=0,k.forEach(t=>{let l=t.date_surgery_scheduled||t.à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”||"";if(l){a++;let r=function(e){if(!e||""===e.trim())return null;let a=e.trim();try{if(/^\d{4}-\d{2}-\d{2}$/.test(a)){let[e,s,t]=a.split("-").map(Number),l=new Date(e,s-1,t,12,0,0,0);if(!isNaN(l.getTime()))return l}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(a)){let[e,s,t]=a.split("/").map(Number);if(s>=1&&s<=12&&e>=1&&e<=31){let a=new Date(t,s-1,e,12,0,0,0);if(a.getFullYear()===t&&a.getMonth()===s-1&&a.getDate()===e)return a}return null}let e=new Date(a);if(!isNaN(e.getTime()))return e;return null}catch(a){return console.error("Error parsing date:",e,a),null}}(l);if(r&&r.getMonth()===$&&r.getFullYear()===E){s++;let a=r.getDate(),l=(t.contact_person||t.à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­||"").trim()||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸";if(e.has(l)){let s=e.get(l);s.has(a)||s.set(a,[]),s.get(a).push(t)}}}}),console.log(`ğŸ“Š Count P table (à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”): Processed ${a} records, matched ${s} for ${E}-${$+1}`),e))}},[k,$,E]),(0,s.useEffect)(()=>{if(console.log("ğŸ”„ Processing N_Clinic RevenueMap (income_date)...",{nClinicDataLength:X.length,selectedMonth:$,selectedYear:E,firstFewRecords:X.slice(0,3).map(e=>({income_date:e.income_date,staff_display_name:e.staff_display_name,income:e.income}))}),X.length>0){let e,a,s,t,l,r,i,n,c=(e=new Map,a=0,s=0,t=0,l=0,r=0,i=0,n=0,console.log(`ğŸ” Starting n_clinic calculation for ${E}-${$+1}:`,{totalDataRecords:X.length,targetMonth:$+1,targetYear:E}),X.forEach((c,d)=>{let o=c.income_date||"";if(!o){l++,d<3&&console.log(`âš ï¸ Record ${d} has no income_date:`,c);return}a++;let m=function(e){if(!e||""===e.trim())return null;let a=e.trim();try{if(/^\d{4}-\d{2}-\d{2}$/.test(a)){let[e,s,t]=a.split("-").map(Number),l=new Date(e,s-1,t,12,0,0,0);if(!isNaN(l.getTime()))return l}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(a)){let[e,s,t]=a.split("/").map(Number);if(s>=1&&s<=12&&e>=1&&e<=31){let a=new Date(t,s-1,e,12,0,0,0);if(a.getFullYear()===t&&a.getMonth()===s-1&&a.getDate()===e)return a}return null}let e=new Date(a);if(!isNaN(e.getTime()))return e;return null}catch(a){return console.error("Error parsing date:",e,a),null}}(o);if(!m){r++,d<3&&console.log(`âš ï¸ Record ${d} has invalid date format:`,{income_date:o,item:c});return}if(m.getMonth()===$&&m.getFullYear()===E){s++;let a=m.getDate(),l=(c.staff_display_name||"").trim()||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸",r="number"==typeof c.income?c.income:c.income?parseFloat(String(c.income).replace(/,/g,"")):0;if(s<=3&&console.log(`ğŸ”¢ N_Clinic amount parsing for record ${d}:`,{raw:c.income,type:typeof c.income,parsed:r,person:l,day:a,income_date:c.income_date}),r>0){e.has(l)||e.set(l,new Map);let i=e.get(l),n=i.get(a)||0;i.set(a,n+r),t+=r,s<=5&&console.log(`âœ… Added n_clinic revenue: ${l} on day ${a}: ${r}`,{staff_display_name:c.staff_display_name,income_date:c.income_date,income:c.income,parsedDate:m.toISOString()})}else n++}else++i<=3&&console.log(`â­ï¸ Skipped (wrong month): ${o}`,{parsedMonth:m.getMonth()+1,parsedYear:m.getFullYear(),targetMonth:$+1,targetYear:E})}),console.log(`ğŸ’° Calculate N_Clinic Revenue: Processed ${a} records, matched ${s} for ${E}-${$+1}, total revenue: ${t.toLocaleString()} à¸šà¸²à¸—`,{skippedNoDate:l,skippedInvalidDate:r,skippedWrongMonth:i,skippedNoAmount:n,finalMapSize:e.size,persons:Array.from(e.keys())}),e);console.log("ğŸ” N_Clinic Revenue Map Debug:",{mapSize:c.size,persons:Array.from(c.keys()),allData:Array.from(c.entries()).map(([e,a])=>({person:e,totalDays:a.size,days:Array.from(a.entries()).slice(0,10),totalRevenue:Array.from(a.values()).reduce((e,a)=>e+a,0)}))}),G(c)}else console.log("âš ï¸ No N_Clinic data to process, clearing map"),G(new Map)},[X,$,E]),(0,s.useEffect)(()=>{if(console.log("ğŸ”„ Processing filmRevenueMap (bjh_all_leads - Future surgeries)...",{futureDataLength:V.length,selectedMonth:$,selectedYear:E,firstFewRecords:V.slice(0,3).map(e=>({surgery_date:e.surgery_date,contact_staff:e.contact_staff,proposed_amount:e.proposed_amount}))}),V.length>0){let e,a,s,t,l=(e=new Map,a=0,s=0,t=0,V.forEach(l=>{let r=l.surgery_date||"";if(r){a++;let i=function(e){if(!e||""===e.trim())return null;let a=e.trim();try{if(/^\d{4}-\d{2}-\d{2}$/.test(a)){let[e,s,t]=a.split("-").map(Number),l=new Date(e,s-1,t,12,0,0,0);if(!isNaN(l.getTime()))return l}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(a)){let[e,s,t]=a.split("/").map(Number);if(s>=1&&s<=12&&e>=1&&e<=31){let a=new Date(t,s-1,e,12,0,0,0);if(a.getFullYear()===t&&a.getMonth()===s-1&&a.getDate()===e)return a}return null}let e=new Date(a);if(!isNaN(e.getTime()))return e;return null}catch(a){return console.error("Error parsing date:",e,a),null}}(r);if(i&&i.getMonth()===$&&i.getFullYear()===E){s++;let a=i.getDate(),r=(l.contact_staff||"").trim()||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸",n=l.proposed_amount||0;if(n>0){e.has(r)||e.set(r,new Map);let s=e.get(r),l=s.get(a)||0;s.set(a,l+n),t+=n}}}}),console.log(`ğŸ’° Calculate Future Revenue (bjh_all_leads >= today): Processed ${a} records, matched ${s} for ${E}-${$+1}, total revenue: ${t.toLocaleString()} à¸šà¸²à¸—`),e);console.log("ğŸ” Film Revenue Map Debug (bjh_all_leads - Future):",{mapSize:l.size,persons:Array.from(l.keys()),allData:Array.from(l.entries()).map(([e,a])=>({person:e,totalDays:a.size,days:Array.from(a.entries()).slice(0,10),totalRevenue:Array.from(a.values()).reduce((e,a)=>e+a,0)}))}),U(l)}else console.log("âš ï¸ No future revenue data to process, clearing map"),U(new Map)},[V,$,E]),(0,s.useEffect)(()=>{if(T.length>0){let e;H((e=new Map,T.forEach(a=>{let s=a.contact_person||a["à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­"]||"",t=a.surgery_date||a["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸•à¸±à¸”"];if(!s||!t)return;let l=function(e){if(!e)return null;try{if(/^\d{4}-\d{2}-\d{2}$/.test(e)){let[a,s,t]=e.split("-").map(Number);return new Date(a,s-1,t)}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(e)){let[a,s,t]=e.split("/").map(Number);return new Date(t,s-1,a)}let a=new Date(e);if(!isNaN(a.getTime()))return a;return null}catch(e){return null}}(t);if(l&&l.getMonth()===$&&l.getFullYear()===E){let t=l.getDate();e.has(s)||e.set(s,new Map);let r=e.get(s);r.has(t)||r.set(t,[]),r.get(t).push(a)}}),e))}},[T,$,E]),(0,s.useEffect)(()=>{let e=eM(),a=eS.filter(e=>eE(e)).length;el(s=>{let t={...s};return Object.keys(t).forEach(s=>{let l=0;eS.forEach(e=>{let a=eP(e,s,"P");l+=a}),t[s].kpiMonth>0?t[s]={...t[s],kpiToDate:Math.round(t[s].kpiMonth/a*e),actual:l}:t[s]={...t[s],actual:l}}),t})},[$,E,eS.length,B]);let ek=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸à¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸à¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸à¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸à¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"],eC=Array.from({length:5},(e,a)=>D.getFullYear()-2+a),eT=(e,a,s)=>{let t=n[a];if(!t)return;let l="P"===s?B:K,r=[];if("105-à¸ˆà¸µà¸™"===a){let a=l.get("à¸ˆà¸µà¸™"),s=l.get("à¸¡à¸¸à¸");r=[...a?.get(e)||[],...s?.get(e)||[]]}else{let a=l.get(t);if(!a)return;r=a.get(e)||[]}if(0===r.length)return;let i=eI.find(e=>e.id===a),c=i?i.name:t;ec(r),eo(e),eh(c),ef(s),ei(!0)},eP=(e,a,s)=>{let t=n[a];if(!t)return 0;let l="P"===s?B:K;if("105-à¸ˆà¸µà¸™"===a){let a=l.get("à¸ˆà¸µà¸™"),s=l.get("à¸¡à¸¸à¸"),t=a?.get(e)||[],r=s?.get(e)||[];return t.length+r.length}let r=l.get(t);if(!r)return 0;let i=r.get(e);return i?i.length:0},eF=(e,a)=>{let s=n[a];if(!s)return console.warn(`âš ï¸ No contact person mapping for rowId: ${a}`),0;let t=0;return 1===e&&console.log(`ğŸ” Debug getCellRevenue for day ${e}, rowId ${a}:`,{rowId:a,contactPerson:s,nClinicMapSize:q.size,futureMapSize:W.size,nClinicMapKeys:Array.from(q.keys()),futureMapKeys:Array.from(W.keys())}),q.size>0&&("105-à¸ˆà¸µà¸™"===a?t+=(q.get("à¸ˆà¸µà¸™")?.get(e)||0)+(q.get("à¸¡à¸¸à¸")?.get(e)||0):t+=q.get(s)?.get(e)||0),W.size>0&&("105-à¸ˆà¸µà¸™"===a?t+=(W.get("à¸ˆà¸µà¸™")?.get(e)||0)+(W.get("à¸¡à¸¸à¸")?.get(e)||0):t+=W.get(s)?.get(e)||0),1===e&&t>0&&console.log(`ğŸ’° Total Revenue for ${a} (${s}) day ${e}:`,{nClinic:"105-à¸ˆà¸µà¸™"===a?(q.get("à¸ˆà¸µà¸™")?.get(e)||0)+(q.get("à¸¡à¸¸à¸")?.get(e)||0):q.get(s)?.get(e)||0,future:"105-à¸ˆà¸µà¸™"===a?(W.get("à¸ˆà¸µà¸™")?.get(e)||0)+(W.get("à¸¡à¸¸à¸")?.get(e)||0):W.get(s)?.get(e)||0,totalRevenue:t}),t},eR=e=>{let a=et[e];if(!a)return 0;let s="105-à¸ˆà¸µà¸™"===e?2*a.kpiToDate:a.kpiToDate;return a.actual-s},eL=e=>0===e?"":e.toLocaleString("th-TH"),eI=[{id:"105-à¸ˆà¸µà¸™",name:"105-à¸ˆà¸µà¸™ & à¸¡à¸¸à¸"},{id:"107-à¹€à¸ˆ",name:"107-à¹€à¸ˆ"},{id:"108-à¸§à¹ˆà¸²à¸™",name:"108-à¸§à¹ˆà¸²à¸™"}],eA=[{id:"105-à¸ˆà¸µà¸™",name:"105-à¸ˆà¸µà¸™ & à¸¡à¸¸à¸"},{id:"107-à¹€à¸ˆ",name:"107-à¹€à¸ˆ"},{id:"108-à¸§à¹ˆà¸²à¸™",name:"108-à¸§à¹ˆà¸²à¸™"},{id:"110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡",name:"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"}];return(0,a.jsxs)("div",{className:"surgery-schedule-container",children:[(0,a.jsxs)("div",{className:"schedule-header",children:[(0,a.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"16px"},children:(0,a.jsx)("button",{onClick:()=>w.push("/home"),className:"back-button",style:{padding:"8px 16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px",transition:"background-color 0.2s"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#45a049",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#4CAF50",children:"â† à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸"})}),(0,a.jsx)("h1",{style:{textAlign:"center",margin:"16px 0"},children:"Performance - à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,a.jsxs)("div",{className:"calendar-controls",children:[(0,a.jsx)("button",{onClick:()=>{0===$?(S(11),M(E-1)):S($-1)},className:"nav-button",children:"â—€ à¹€à¸”à¸·à¸­à¸™à¸à¹ˆà¸­à¸™"}),(0,a.jsxs)("div",{className:"date-selectors",children:[(0,a.jsx)("select",{value:$,onChange:e=>{S(parseInt(e.target.value))},className:"month-select",children:ek.map((e,s)=>(0,a.jsx)("option",{value:s,children:e},s))}),(0,a.jsx)("select",{value:E,onChange:e=>{M(parseInt(e.target.value))},className:"year-select",children:eC.map(e=>(0,a.jsxs)("option",{value:e,children:[e+543," "]},e))})]}),(0,a.jsx)("button",{onClick:()=>{11===$?(S(0),M(E+1)):S($+1)},className:"nav-button",children:"à¹€à¸”à¸·à¸­à¸™à¸–à¸±à¸”à¹„à¸› â–¶"})]}),(0,a.jsxs)("div",{className:"selected-month-display",children:[(0,a.jsxs)("strong",{children:["à¹€à¸”à¸·à¸­à¸™ ",ek[$]," ",E+543]}),(0,a.jsxs)("span",{className:"days-count",children:[" (",e$," à¸§à¸±à¸™)"]}),eM()>0&&(0,a.jsxs)("span",{className:"weekdays-count",children:[" ","| ğŸ—“ï¸ à¸§à¸±à¸™à¸—à¸³à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸™à¸¡à¸²: ",eM()," à¸§à¸±à¸™"]})]})]}),!F&&!L&&(0,a.jsxs)("div",{className:"team-summary-dashboard",children:[eI.map((e,s)=>{let t=et[e.id]?.actual||0,l=eR(e.id),r=et[e.id]?.kpiToDate||0,i=0;eS.forEach(a=>{i+=eP(a,e.id,"L")});let n=0;eS.forEach(a=>{n+=eF(a,e.id)});let c="105-à¸ˆà¸µà¸™"===e.id?2*r*25e3:25e3*r,d=n-c;return(0,a.jsxs)("div",{className:`team-summary-card ${["team-color-1","team-color-2","team-color-3"][s]}`,children:[(0,a.jsx)("div",{className:"team-summary-header",children:(0,a.jsx)("h3",{children:e.name})}),(0,a.jsxs)("div",{className:"team-summary-body",children:[(0,a.jsxs)("div",{className:"summary-metric",children:[(0,a.jsx)("div",{className:"metric-label",children:"à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,a.jsxs)("div",{className:"metric-row",children:[(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,a.jsx)("div",{className:"metric-value",children:eL(c)})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Actual"}),(0,a.jsx)("div",{className:"metric-value",children:eL(n)})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Diff"}),(0,a.jsxs)("div",{className:`metric-value ${d>=0?"positive":"negative"}`,children:[d>=0?"+":"âˆ’",eL(Math.abs(d))]})]})]})]}),(0,a.jsxs)("div",{className:"summary-metric",children:[(0,a.jsx)("div",{className:"metric-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,a.jsxs)("div",{className:"metric-row",children:[(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,a.jsx)("div",{className:"metric-value",children:"105-à¸ˆà¸µà¸™"===e.id?2*r:r})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Actual"}),(0,a.jsx)("div",{className:"metric-value",children:t})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Diff"}),(0,a.jsxs)("div",{className:`metric-value ${l>=0?"positive":"negative"}`,children:[l>=0?"+":"âˆ’",Math.abs(l)]})]})]})]})]})]},e.id)}),(e="110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡",i=et[e]?.actual||0,h=eR(e),u=et[e]?.kpiToDate||0,f=0,eS.forEach(a=>{f+=eF(a,e)}),x=f-(g=25e3*u),(0,a.jsxs)("div",{className:"team-summary-card team-color-4",children:[(0,a.jsx)("div",{className:"team-summary-header",children:(0,a.jsx)("h3",{children:"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"})}),(0,a.jsxs)("div",{className:"team-summary-body",children:[(0,a.jsxs)("div",{className:"summary-metric",children:[(0,a.jsx)("div",{className:"metric-label",children:"à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,a.jsxs)("div",{className:"metric-row",children:[(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,a.jsx)("div",{className:"metric-value",children:eL(g)})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Actual"}),(0,a.jsx)("div",{className:"metric-value",children:eL(f)})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Diff"}),(0,a.jsxs)("div",{className:`metric-value ${x>=0?"positive":"negative"}`,children:[x>=0?"+":"âˆ’",eL(Math.abs(x))]})]})]})]}),(0,a.jsxs)("div",{className:"summary-metric",children:[(0,a.jsx)("div",{className:"metric-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,a.jsxs)("div",{className:"metric-row",children:[(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,a.jsx)("div",{className:"metric-value",children:u})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Actual"}),(0,a.jsx)("div",{className:"metric-value",children:i})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Diff"}),(0,a.jsxs)("div",{className:`metric-value ${h>=0?"positive":"negative"}`,children:[h>=0?"+":"âˆ’",Math.abs(h)]})]})]})]})]})]},e)),(p=[...eI,{id:"110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡",name:"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"}],j=0,p.forEach(e=>{eS.forEach(a=>{j+=eF(a,e.id)})}),N=0,p.forEach(e=>{let a=et[e.id]?.kpiToDate||0,s="105-à¸ˆà¸µà¸™"===e.id?2:1;N+=a*s*25e3}),v=j-N,y=0,p.forEach(e=>{y+=et[e.id]?.actual||0}),_=0,p.forEach(e=>{let a=et[e.id]?.kpiToDate||0,s="105-à¸ˆà¸µà¸™"===e.id?2:1;_+=a*s}),b=y-_,(0,a.jsxs)("div",{className:"team-summary-card team-color-pink",children:[(0,a.jsx)("div",{className:"team-summary-header",children:(0,a.jsx)("h3",{children:"à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"})}),(0,a.jsxs)("div",{className:"team-summary-body",children:[(0,a.jsxs)("div",{className:"summary-metric",children:[(0,a.jsx)("div",{className:"metric-label",children:"à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,a.jsxs)("div",{className:"metric-row",children:[(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,a.jsx)("div",{className:"metric-value",children:eL(N)})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Actual"}),(0,a.jsx)("div",{className:"metric-value",children:eL(j)})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Diff"}),(0,a.jsxs)("div",{className:`metric-value ${v>=0?"positive":"negative"}`,children:[v>=0?"+":"âˆ’",eL(Math.abs(v))]})]})]})]}),(0,a.jsxs)("div",{className:"summary-metric",children:[(0,a.jsx)("div",{className:"metric-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,a.jsxs)("div",{className:"metric-row",children:[(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,a.jsx)("div",{className:"metric-value",children:_})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Actual"}),(0,a.jsx)("div",{className:"metric-value",children:y})]}),(0,a.jsxs)("div",{className:"metric-item",children:[(0,a.jsx)("div",{className:"metric-title",children:"Diff"}),(0,a.jsxs)("div",{className:`metric-value ${b>=0?"positive":"negative"}`,children:[b>=0?"+":"âˆ’",Math.abs(b)]})]})]})]})]})]},"total"))]}),F&&(0,a.jsxs)("div",{className:"loading-indicator",children:[(0,a.jsx)("div",{className:"spinner"}),(0,a.jsx)("p",{children:"à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥..."})]}),L&&(0,a.jsxs)("div",{className:"error-display",children:[(0,a.jsx)("div",{className:"error-icon",children:"âš ï¸"}),(0,a.jsxs)("div",{className:"error-content",children:[(0,a.jsx)("h3",{children:"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”"}),(0,a.jsx)("p",{children:L}),(0,a.jsxs)("div",{className:"error-help",children:[(0,a.jsx)("strong",{children:"à¹à¸™à¸°à¸™à¸³à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚:"}),(0,a.jsxs)("ol",{children:[(0,a.jsx)("li",{children:"à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² PostgreSQL Database à¸à¸³à¸¥à¸±à¸‡à¸—à¸³à¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆ"}),(0,a.jsxs)("li",{children:["à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Environment Variables (Settings â†’ Environment Variables):",(0,a.jsx)("br",{}),"- ",(0,a.jsx)("code",{children:"DB_HOST"}),(0,a.jsx)("br",{}),"- ",(0,a.jsx)("code",{children:"DB_PORT"}),(0,a.jsx)("br",{}),"- ",(0,a.jsx)("code",{children:"DB_USER"}),(0,a.jsx)("br",{}),"- ",(0,a.jsx)("code",{children:"DB_PASSWORD"}),(0,a.jsx)("br",{}),"- ",(0,a.jsx)("code",{children:"DB_NAME"})]}),(0,a.jsxs)("li",{children:["à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸•à¸²à¸£à¸²à¸‡ ",(0,a.jsx)("code",{children:"surgery_schedule"})," à¹à¸¥à¸°"," ",(0,a.jsx)("code",{children:"sale_incentive"})," à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"]}),(0,a.jsxs)("li",{children:["à¸£à¸±à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡ SQL schema: ",(0,a.jsx)("code",{children:"surgery-schedule-schema.sql"})]}),(0,a.jsx)("li",{children:"à¸¥à¸­à¸‡ Redeploy Vercel à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"})]})]}),(0,a.jsx)("button",{onClick:async()=>{await ey(),await e_(),await eb()},className:"retry-button",children:"à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"})]})]}),(0,a.jsx)("div",{className:"table-section ",children:(0,a.jsx)("div",{className:"table-wrapper",ref:A,children:(0,a.jsxs)("table",{className:"schedule-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"header-cell name-header",rowSpan:2,children:"à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”"}),eS.map(e=>(0,a.jsx)("th",{className:`header-cell day-header  ${eE(e)?"weekday-header":""}`,style:{width:"62px"},children:e},`p-day-${e}`))]})}),(0,a.jsx)("tbody",{children:eI.map((e,s)=>(0,a.jsxs)("tr",{className:s%2==0?"even-row":"odd-row",children:[(0,a.jsx)("td",{className:"name-cell",children:e.name}),eS.map(s=>{let t=eP(s,e.id,"P");return(0,a.jsx)("td",{className:`data-cell ${t>0?"has-data":""}`,onClick:()=>t>0&&eT(s,e.id,"P"),title:t>0?`à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” (${t} à¸£à¸²à¸¢à¸à¸²à¸£)`:"",children:t>0&&(0,a.jsx)("span",{className:"count-badge",children:t})},`p-cell-${e.id}-${s}`)})]},`p-row-${e.id}`))})]})})}),(0,a.jsx)("div",{className:"table-section",children:(0,a.jsx)("div",{className:"table-wrapper",ref:Y,children:(0,a.jsxs)("table",{className:"schedule-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"header-cell name-header",rowSpan:2,children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸” L"}),eS.map(e=>(0,a.jsx)("th",{className:`header-cell day-header ${eE(e)?"weekday-header":""}`,style:{width:"62px"},children:e},`l-day-${e}`))]})}),(0,a.jsxs)("tbody",{children:[eA.map((e,s)=>(0,a.jsxs)("tr",{className:s%2==0?"even-row":"odd-row",children:[(0,a.jsx)("td",{className:"name-cell",children:e.name}),eS.map(s=>{let t=n[e.id],l=e=>{if(!e)return null;try{return new Date(e)}catch{return null}},r=0;X.forEach(a=>{let i=l(a.income_date);if(!i)return;let n=i.getDate(),c=i.getMonth(),d=i.getFullYear();c===$&&d===E&&n===s&&("105-à¸ˆà¸µà¸™"===e.id?("à¸ˆà¸µà¸™"===a.staff_display_name||"à¸¡à¸¸à¸"===a.staff_display_name)&&r++:a.staff_display_name===t&&r++)});let i=0;V.forEach(a=>{let r=l(a.surgery_date);if(!r)return;let n=r.getDate(),c=r.getMonth(),d=r.getFullYear();c===$&&d===E&&n===s&&("105-à¸ˆà¸µà¸™"===e.id?("à¸ˆà¸µà¸™"===a.contact_staff||"à¸¡à¸¸à¸"===a.contact_staff)&&i++:a.contact_staff===t&&i++)});let c=r+i;return(0,a.jsx)("td",{className:`data-cell ${c>0?"has-data revenue-cell":""}`,onClick:()=>c>0&&eT(s,e.id,"L"),title:c>0?`à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
N_Clinic: ${r} à¸£à¸²à¸¢à¸à¸²à¸£
Future: ${i} à¸£à¸²à¸¢à¸à¸²à¸£
à¸¢à¸­à¸”à¸£à¸§à¸¡: ${c} à¸£à¸²à¸¢à¸à¸²à¸£`:"",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:[r>0&&(0,a.jsx)("span",{className:"count-badge revenue-badge-blue",children:r}),i>0&&(0,a.jsx)("span",{className:"count-badge revenue-badge-green",children:i})]})},`l-cell-${e.id}-${s}`)})]},`l-row-${e.id}`)),(0,a.jsxs)("tr",{className:"total-row",children:[(0,a.jsx)("td",{className:"name-cell",style:{fontWeight:"bold"},children:"à¸¢à¸­à¸”à¸£à¸§à¸¡"}),eS.map(e=>{let s=e=>{if(!e)return null;try{return new Date(e)}catch{return null}},t=0;return eA.forEach(a=>{let l=n[a.id];X.forEach(r=>{let i=s(r.income_date);if(!i)return;let n=i.getDate(),c=i.getMonth(),d=i.getFullYear();c===$&&d===E&&n===e&&("105-à¸ˆà¸µà¸™"===a.id?("à¸ˆà¸µà¸™"===r.staff_display_name||"à¸¡à¸¸à¸"===r.staff_display_name)&&t++:r.staff_display_name===l&&t++)}),V.forEach(r=>{let i=s(r.surgery_date);if(!i)return;let n=i.getDate(),c=i.getMonth(),d=i.getFullYear();c===$&&d===E&&n===e&&("105-à¸ˆà¸µà¸™"===a.id?("à¸ˆà¸µà¸™"===r.contact_staff||"à¸¡à¸¸à¸"===r.contact_staff)&&t++:r.contact_staff===l&&t++)})}),(0,a.jsx)("td",{className:`data-cell ${t>0?"has-data":""}`,style:{fontWeight:"bold"},title:t>0?`à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${t} à¸£à¸²à¸¢à¸à¸²à¸£`:"",children:t>0&&(0,a.jsx)("span",{className:"count-badge",children:t})},`total-l-cell-${e}`)})]})]})]})})}),(0,a.jsx)("div",{className:"table-section",children:(0,a.jsx)("div",{className:"table-wrapper",ref:z,children:(0,a.jsxs)("table",{className:"schedule-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"header-cell name-header",rowSpan:2,children:"à¸›à¸£à¸°à¸¡à¸²à¸“à¸à¸²à¸£à¸£à¸²à¸¢à¸£à¸±à¸š"}),eS.map(e=>(0,a.jsx)("th",{className:`header-cell day-header ${eE(e)?"weekday-header":""}`,style:{width:"62px"},children:e},`revenue-day-${e}`))]})}),(0,a.jsxs)("tbody",{children:[eA.map((e,s)=>(0,a.jsxs)("tr",{className:s%2==0?"even-row":"odd-row",children:[(0,a.jsx)("td",{className:"name-cell",children:e.name}),eS.map(s=>{let t=n[e.id],l=0;q.size>0&&(l="105-à¸ˆà¸µà¸™"===e.id?(q.get("à¸ˆà¸µà¸™")?.get(s)||0)+(q.get("à¸¡à¸¸à¸")?.get(s)||0):q.get(t)?.get(s)||0);let r=0;W.size>0&&(r="105-à¸ˆà¸µà¸™"===e.id?(W.get("à¸ˆà¸µà¸™")?.get(s)||0)+(W.get("à¸¡à¸¸à¸")?.get(s)||0):W.get(t)?.get(s)||0);let i=l+r;return(0,a.jsx)("td",{className:`data-cell ${i>0?"has-data revenue-cell":""}`,onClick:()=>i>0&&((e,a)=>{let s=n[a];if(!s)return;let t=e=>{if(!e)return null;try{return new Date(e)}catch{return null}},l=X.filter(l=>{let r=t(l.income_date);if(!r)return!1;let i=r.getDate(),n=r.getMonth(),c=r.getFullYear();return n===$&&c===E&&i===e&&("105-à¸ˆà¸µà¸™"===a?"à¸ˆà¸µà¸™"===l.staff_display_name||"à¸¡à¸¸à¸"===l.staff_display_name:l.staff_display_name===s)}),r=V.filter(l=>{let r=t(l.surgery_date);if(!r)return!1;let i=r.getDate(),n=r.getMonth(),c=r.getFullYear();return n===$&&c===E&&i===e&&("105-à¸ˆà¸µà¸™"===a?"à¸ˆà¸µà¸™"===l.contact_staff||"à¸¡à¸¸à¸"===l.contact_staff:l.contact_staff===s)});if(0===l.length&&0===r.length)return;let i=eI.find(e=>e.id===a),c=i?i.name:s;ej(l),ev(r),eo(e),eh(c),ex(!0)})(s,e.id),title:i>0?`à¸„à¸¥à¸´à¸à¹€à¸à¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
N_Clinic: ${eL(l)} à¸šà¸²à¸—
Future: ${eL(r)} à¸šà¸²à¸—
à¸¢à¸­à¸”à¸£à¸§à¸¡: ${eL(i)} à¸šà¸²à¸—`:"",children:(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:[l>0&&(0,a.jsx)("span",{className:"revenue-badge revenue-badge-blue",children:eL(l)}),r>0&&(0,a.jsx)("span",{className:"revenue-badge revenue-badge-green",children:eL(r)})]})},`revenue-cell-${e.id}-${s}`)})]},`revenue-row-${e.id}`)),(0,a.jsxs)("tr",{className:"total-row",children:[(0,a.jsx)("td",{className:"name-cell",style:{fontWeight:"bold"},children:"à¸¢à¸­à¸”à¸£à¸§à¸¡"}),eS.map(e=>{let s=0;return eA.forEach(a=>{let t=n[a.id],l=0;q.size>0&&(l="105-à¸ˆà¸µà¸™"===a.id?(q.get("à¸ˆà¸µà¸™")?.get(e)||0)+(q.get("à¸¡à¸¸à¸")?.get(e)||0):q.get(t)?.get(e)||0);let r=0;W.size>0&&(r="105-à¸ˆà¸µà¸™"===a.id?(W.get("à¸ˆà¸µà¸™")?.get(e)||0)+(W.get("à¸¡à¸¸à¸")?.get(e)||0):W.get(t)?.get(e)||0),s+=l+r}),(0,a.jsx)("td",{className:`data-cell ${s>0?"has-data revenue-cell":""}`,style:{fontWeight:"bold"},title:s>0?`à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${eL(s)} à¸šà¸²à¸—`:"",children:s>0&&(0,a.jsx)("span",{className:"revenue-badge",children:eL(s)})},`total-cell-${e}`)})]})]})]})})}),(0,a.jsx)(l,{isOpen:er,onClose:()=>ei(!1),surgeries:en,date:ed,month:$,year:E,contactPerson:em,tableType:eu}),(0,a.jsx)(r,{isOpen:eg,onClose:()=>ex(!1),nClinicData:ep,futureData:eN,date:ed,month:$,year:E,contactPerson:em})]})}e.s(["default",()=>h],943007)}]);