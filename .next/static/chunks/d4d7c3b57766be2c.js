(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,126293,e=>{"use strict";var s=e.i(843476),a=e.i(271645);let t=[{vendorId:1423,productId:38208},{classCode:11}],l=[{usagePage:11}],r=e=>null!=e?`0x${e.toString(16).padStart(4,"0").toUpperCase()}`:"n/a",n=e=>({id:`${e.vendorId??0}-${e.productId??0}-${e.serialNumber??"0"}`,label:e.productName??"เครื่องอ่าน USB",kind:"USB",info:`VID ${r(e.vendorId)} \xb7 PID ${r(e.productId)}${e.manufacturerName?` \xb7 ${e.manufacturerName}`:""}`}),i=e=>{let s=e.collections?.[0]?.usagePage;return{id:`${e.vendorId??0}-${e.productId??0}-${s??0}-${e.productName??"HID"}`,label:e.productName??"HID เครื่องอ่าน",kind:"HID",info:`VID ${r(e.vendorId)} \xb7 PID ${r(e.productId)}${s?` \xb7 usage ${s}`:""}`}},c=e=>Array.from(e).map(e=>e.toString(16).padStart(2,"0")).join(" "),d=e=>{if("ok"!==e.status||!e.data)throw Error(`การอ่านข้อมูลล้มเหลว (status: ${e.status})`);let s=e.data,a=s.getUint32(3,!0),t=s.byteOffset+10,l=Math.max(0,s.byteLength-10),r=new Uint8Array(s.buffer,t,Math.min(a,l));return{messageType:s.getUint8(0),slot:s.getUint8(1),sequence:s.getUint8(2),payload:r}};function m(){let[e,r]=(0,a.useState)([]),[m,o]=(0,a.useState)("รอการตรวจสอบอุปกรณ์"),[u,h]=(0,a.useState)([]),[x,b]=(0,a.useState)({usb:!1,hid:!1}),[p,f]=(0,a.useState)(!1),[j,N]=(0,a.useState)(null),[g,v]=(0,a.useState)(null),[y,w]=(0,a.useState)(null),[S,C]=(0,a.useState)(null),[D,I]=(0,a.useState)(!1),[U,$]=(0,a.useState)(null),[A,E]=(0,a.useState)([]),[k,P]=(0,a.useState)("00A4040007A000000054480001"),[T,B]=(0,a.useState)({idNumber:"",fullName:"",fullNameEn:"",sex:"",birthDate:"",age:"",issueDate:"",expiryDate:"",address:"",cardStatus:"",statusCode:"",readerName:""}),H=(0,a.useRef)(0),W=(0,a.useCallback)(e=>{h(s=>[e,...s].slice(0,6))},[]),L=(0,a.useCallback)(e=>{E(s=>[e,...s].slice(0,6)),W(e)},[W]),O=(0,a.useCallback)(async()=>{if("undefined"==typeof navigator)return;let e=navigator.usb,s=navigator.hid,a=[];if(e)try{let s=await e.getDevices();a.push(...s.map(n))}catch(e){W(`ไม่สามารถอ่านอุปกรณ์ USB: ${e instanceof Error?e.message:"ไม่รู้จัก"}`)}if(s)try{let e=await s.getDevices();a.push(...e.map(i))}catch(e){W(`ไม่สามารถอ่านอุปกรณ์ HID: ${e instanceof Error?e.message:"ไม่รู้จัก"}`)}r(a);let t=new Date().toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",second:"2-digit"});o(a.length?`พบ ${a.length} อุปกรณ์ \xb7 อัปเดตล่าสุด ${t}`:"ยังไม่พบเครื่องอ่านบัตรที่เชื่อมต่อ")},[W]),R=(0,a.useCallback)(async()=>{if(j){try{null!==g&&await j.releaseInterface(g)}catch{}try{await j.close()}catch{}N(null),v(null),w(null),C(null),H.current=0,$(null)}},[g,j]);(0,a.useEffect)(()=>()=>{R()},[R]);let M=(0,a.useCallback)(async e=>{if(await R(),e.opened||await e.open(),!e.configuration){let s=e.configurations?.[0]?.configurationValue??1;await e.selectConfiguration(s)}let s=e.configuration;if(!s)throw Error("ไม่พบ configuration ของเครื่องอ่าน");let a=s.interfaces.find(e=>e.alternates.some(e=>11===e.interfaceClass)),t=a?.alternates.find(e=>11===e.interfaceClass),l=t?.endpoints?.find(e=>"out"===e.direction&&"bulk"===e.type),r=t?.endpoints?.find(e=>"in"===e.direction&&"bulk"===e.type);if(!a||!l||!r)throw console.error("CCID interfaces:",s.interfaces),Error("ไม่พบ interface/endpoint ที่รองรับ CCID");await e.claimInterface(a.interfaceNumber),N(e),v(a.interfaceNumber),w(l.endpointNumber),C(r.endpointNumber),o("อุปกรณ์พร้อมอ่านบัตร"),H.current=0,$(null),E([]),W(`เตรียมอุปกรณ์เรียบร้อย (iface=${a.interfaceNumber}, OUT=${l.endpointNumber}, IN=${r.endpointNumber})`)},[R,W]);(0,a.useEffect)(()=>{if("undefined"==typeof navigator)return;let e=navigator;b({usb:!!e.usb,hid:!!e.hid}),O();let s=()=>O();return e.usb?.addEventListener("connect",s),e.usb?.addEventListener("disconnect",s),e.hid?.addEventListener("connect",s),e.hid?.addEventListener("disconnect",s),()=>{e.usb?.removeEventListener("connect",s),e.usb?.removeEventListener("disconnect",s),e.hid?.removeEventListener("connect",s),e.hid?.removeEventListener("disconnect",s)}},[O]),(0,a.useEffect)(()=>{"undefined"==typeof navigator||f(/Mobi|Android|iPhone|iPad|Tablet/i.test(navigator.userAgent))},[]);let q=(0,a.useCallback)(async()=>{if(!j||null===y||null===S)return void L("ยังไม่มีเครื่องอ่าน USB ที่พร้อมอ่านบัตร");I(!0);try{let e,s=H.current,a=((e=new Uint8Array(10))[0]=98,e[6]=255&s,e);H.current=s+1&255;let t=await j.transferOut(y,a);if("ok"!==t.status)throw Error(`ส่งคำสั่ง Power On ล้มเหลว (status=${t.status})`);let l=await j.transferIn(S,512),r=d(l);if(128!==r.messageType)throw Error(`ไม่พบ ATR (messageType=${r.messageType})`);let n=c(r.payload);$(n),L(`ATR: ${n}`)}catch(e){L(`อ่าน ATR ไม่สำเร็จ: ${e instanceof Error?e.message:"ไม่รู้จัก"}`)}finally{I(!1)}},[S,L,y,j]),V=(0,a.useCallback)(async()=>{if(!j||null===y||null===S)return void L("เลือกเครื่องอ่านแล้ว Power On ก่อนส่งคำสั่ง APDU");I(!0);try{let e,s,a=(e=>{let s=e.replace(/[^0-9a-f]/gi,"");if(!s)return new Uint8Array;if(s.length%2)throw Error("ค่าที่ได้รับต้องมีจำนวนคู่ของตัวอักษร HEX");let a=new Uint8Array(s.length/2);for(let e=0;e<s.length;e+=2)a[e/2]=parseInt(s.slice(e,e+2),16);return a})(k),t=H.current,l=((e=new Uint8Array(10+a.length))[0]=111,s=2,e[s++]=255&a.length,e[s++]=a.length>>8&255,e[s++]=a.length>>16&255,e[s++]=a.length>>24&255,e[6]=255&t,e[7]=0,e[8]=0,e[9]=0,e.set(a,10),e);H.current=t+1&255;let r=await j.transferOut(y,l);if("ok"!==r.status)throw Error(`ส่งคำสั่ง APDU ล้มเหลว (status=${r.status})`);let n=await j.transferIn(S,512),i=d(n),m=c(i.payload);L(`APDU → ${m}`)}catch(e){L(`APDU ผิดพลาด: ${e instanceof Error?e.message:"ไม่รู้จัก"}`)}finally{I(!1)}},[k,S,L,y,j]),K=(0,a.useCallback)(async()=>{if("undefined"==typeof navigator||!x.usb){let e="เบราว์เซอร์นี้ไม่รองรับ WebUSB";o(e),W(e);return}I(!0);try{let e=navigator.usb;if(!e){let e="WebUSB ยังไม่พร้อมใช้งาน";o(e),W(e);return}let s=await e.requestDevice({filters:t});W(`เลือก USB: ${s.productName??"ไม่ระบุชื่อ"}`),o("อุปกรณ์พร้อมอ่านบัตร"),await O(),await M(s)}catch(s){let e=s instanceof Error?s.message:"ยกเลิกการเลือกอุปกรณ์";W(`WebUSB: ${e}`),o(e.includes("cancel")?"การสแกนถูกยกเลิก":"ไม่พบอุปกรณ์")}finally{I(!1)}},[W,M,x.usb,O]),X=(0,a.useCallback)(async()=>{if("undefined"==typeof navigator||!x.hid){let e="เบราว์เซอร์นี้ไม่รองรับ WebHID";o(e),W(e);return}try{let e=await navigator.hid?.requestDevice({filters:l});e&&e.length&&(W(`เลือก HID: ${e[0].productName??"ไม่ระบุชื่อ"}`),o("อุปกรณ์ HID พร้อมใช้งาน")),await O()}catch(s){let e=s instanceof Error?s.message:"ยกเลิกการเลือกอุปกรณ์";W(`WebHID: ${e}`),o(e.includes("cancel")?"การสแกนถูกยกเลิก":"ไม่พบอุปกรณ์")}},[W,x.hid,O]),F=!j||null===y||null===S||D||!x.usb;return(0,s.jsx)("main",{className:"container py-5",children:(0,s.jsx)("div",{className:"row justify-content-center",children:(0,s.jsx)("div",{className:"col-12 col-xl-10",children:(0,s.jsxs)("div",{className:"rounded-4 border bg-white shadow-sm p-4 p-lg-5",children:[(0,s.jsxs)("div",{className:"text-center mb-5",children:[(0,s.jsx)("p",{className:"text-uppercase fw-semibold text-secondary mb-1",children:"Test"}),(0,s.jsx)("h1",{className:"h2 fw-bold",children:"ทดสอบเครื่องอ่านบัตรประชาชน"}),(0,s.jsx)("p",{className:"text-muted mb-0",children:"หน้าเดียวกันนี้ตรวจสอบ WebUSB/WebHID และส่งคำสั่ง CCID เพื่อให้สามารถต่อยอดการอ่านบัตรได้ทั้งบน PC และอุปกรณ์มือถือ"})]}),(0,s.jsxs)("div",{className:"row g-4",children:[(0,s.jsx)("div",{className:"col-lg-5",children:(0,s.jsx)("div",{className:"card border-0 shadow-sm h-100",children:(0,s.jsxs)("div",{className:"card-body",children:[(0,s.jsx)("h2",{className:"h5",children:"สถานะการเชื่อมต่อ"}),(0,s.jsx)("p",{className:"fs-5 fw-semibold text-primary mb-2",children:m}),(0,s.jsxs)("div",{className:"mb-3",children:[(0,s.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,s.jsx)("span",{className:"fw-semibold",children:"WebUSB (PC)"}),(0,s.jsx)("span",{className:x.usb?"text-success":"text-secondary",children:x.usb?"รองรับ":"ไม่รองรับ"})]}),(0,s.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,s.jsx)("span",{className:"fw-semibold",children:"WebHID (มือถือ/บางเบราว์เซอร์)"}),(0,s.jsx)("span",{className:x.hid?"text-success":"text-secondary",children:x.hid?"รองรับ":"ไม่รองรับ"})]})]}),(0,s.jsxs)("div",{className:"d-grid gap-2 mb-3",children:[(0,s.jsx)("button",{type:"button",className:"btn btn-primary",onClick:K,disabled:!x.usb||D,children:"สแกนเครื่องอ่าน USB (PC)"}),(0,s.jsx)("button",{type:"button",className:"btn btn-outline-primary",onClick:X,disabled:!x.hid,children:"สแกนเครื่องอ่าน HID (Android/เบราว์เซอร์ที่รองรับ)"})]}),(0,s.jsx)("div",{className:"small text-muted mb-3",children:x.usb||x.hid?"หากไม่มีเครื่องอ่านให้เสียบสาย USB แล้วแตะปุ่มสแกนอีกครั้ง":"แนะนำให้เปิดด้วย Chrome/Edge บนพีซี หรือ Chrome บน Android เพื่อใช้งาน"}),(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h3",{className:"h6 text-uppercase text-muted",children:"กิจกรรมล่าสุด"}),(0,s.jsx)("ul",{className:"list-unstyled mb-0 small",children:u.length?u.map((e,a)=>(0,s.jsx)("li",{className:"py-1 border-bottom border-secondary border-opacity-25",children:e},e+a)):(0,s.jsx)("li",{className:"text-muted",children:"รอการดำเนินการจากผู้ใช้"})})]})]})})}),(0,s.jsx)("div",{className:"col-lg-7",children:(0,s.jsxs)("div",{className:"border rounded-4 shadow-sm h-100 p-4",children:[(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-baseline mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"h5 mb-2",children:"อุปกรณ์ที่ระบบสามารถมองเห็น"}),(0,s.jsx)("p",{className:"text-muted small mb-0",children:"รีเฟรชรายการหากต่อเครื่องอ่านใหม่ หรือรู้สึกว่ายังไม่มีอุปกรณ์แสดง"})]}),(0,s.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:O,children:"รีเฟรช"})]}),e.length?(0,s.jsx)("div",{className:"list-group list-group-flush",children:e.map(e=>(0,s.jsxs)("div",{className:"list-group-item bg-transparent border-0 px-0 py-3",children:[(0,s.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,s.jsx)("span",{className:"fw-semibold",children:e.label}),(0,s.jsx)("span",{className:"badge bg-secondary bg-opacity-10 text-dark",children:e.kind})]}),(0,s.jsx)("p",{className:"mb-0 small text-muted",children:e.info})]},e.id))}):(0,s.jsx)("p",{className:"text-muted mb-0",children:"ยังไม่พบเครื่องอ่านที่เชื่อมต่อ อย่าลืมเสียบสายและแตะปุ่มสแกนด้านซ้าย"})]})})]}),(0,s.jsx)("div",{className:"mt-4",children:(0,s.jsxs)("div",{className:"border rounded-4 shadow-sm p-4",children:[(0,s.jsxs)("div",{className:"row g-4",children:[(0,s.jsxs)("div",{className:"col-lg-8",children:[(0,s.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-uppercase small fw-semibold text-muted mb-1",children:"เลขประจำตัวประชาชน"}),(0,s.jsx)("h1",{className:"h3 mb-0",children:T.idNumber})]}),(0,s.jsx)("span",{className:"badge bg-success bg-opacity-15 text-success",children:T.cardStatus})]}),(0,s.jsxs)("div",{className:"d-flex gap-4 flex-wrap mb-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"ชื่อ-นามสกุล"}),(0,s.jsx)("p",{className:"fw-semibold mb-0",children:T.fullName}),(0,s.jsx)("p",{className:"text-muted small mb-0",children:T.fullNameEn})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"เพศ"}),(0,s.jsx)("p",{className:"mb-0",children:T.sex})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"วันเกิด"}),(0,s.jsxs)("p",{className:"mb-0",children:[T.birthDate," · ",T.age]})]})]}),(0,s.jsxs)("div",{className:"row row-cols-1 row-cols-md-2 g-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"วันที่ออกบัตร"}),(0,s.jsx)("p",{className:"mb-0 fw-semibold",children:T.issueDate})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"วันหมดอายุ"}),(0,s.jsx)("p",{className:"mb-0 fw-semibold",children:T.expiryDate})]})]}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"ที่อยู่ตามบัตร"}),(0,s.jsx)("p",{className:"mb-0",children:T.address})]})]}),(0,s.jsx)("div",{className:"col-lg-4",children:(0,s.jsxs)("div",{className:"border rounded-4 p-3 h-100 d-flex flex-column justify-content-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"ratio ratio-1x1 rounded mb-2",style:{backgroundColor:"#f5f5f5"},children:(0,s.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100 text-muted",children:"ภาพถ่าย"})}),(0,s.jsx)("p",{className:"text-uppercase small text-muted mb-1",children:"เลขที่บัตรประชาชน"}),(0,s.jsx)("p",{className:"fs-5 fw-semibold mb-1",children:T.statusCode}),(0,s.jsx)("p",{className:"small text-muted mb-0",children:T.readerName})]}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"ระบบบันทึก"}),(0,s.jsx)("div",{className:"bg-dark text-white rounded-3 px-3 py-2 small",children:"FAST ID STATUS"})]})]})})]}),(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsx)("div",{className:"small text-uppercase text-muted mb-2",children:"System Logs"}),(0,s.jsx)("div",{className:"bg-light border rounded-3 p-3",style:{minHeight:140},children:A.length?(0,s.jsx)("ul",{className:"list-unstyled mb-0 small",children:A.map((e,a)=>(0,s.jsx)("li",{className:"pb-2 border-bottom border-secondary border-opacity-25",children:e},e+a))}):(0,s.jsx)("p",{className:"small text-muted mb-0",children:"ยังไม่พบข้อมูลบันทึก"})})]})]})}),(0,s.jsx)("div",{className:"mt-5",children:(0,s.jsx)("div",{className:"border rounded-4 shadow-sm p-4",children:(0,s.jsxs)("div",{className:"d-flex flex-column flex-lg-row gap-3 align-items-start",children:[(0,s.jsxs)("div",{className:"flex-fill",children:[(0,s.jsx)("h2",{className:"h5",children:"อ่านบัตรประชาชน"}),(0,s.jsx)("p",{className:"text-muted small mb-2",children:"ส่งคำสั่ง CCID โดยตรงผ่าน WebUSB เพื่อดึง ATR และส่ง APDU (อ่านข้อมูลบัตรต่อจากนี้ได้ง่ายขึ้น)"}),(0,s.jsxs)("div",{className:"d-flex gap-2 flex-wrap mb-3",children:[(0,s.jsx)("button",{className:"btn btn-outline-success",onClick:q,disabled:F,children:"เปิดบัตร (Power On)"}),(0,s.jsx)("button",{className:"btn btn-success",onClick:V,disabled:F,children:"ส่ง APDU"})]}),(0,s.jsxs)("div",{className:"mb-2",children:[(0,s.jsx)("label",{className:"form-label small text-muted mb-1",children:"คำสั่ง APDU (HEX)"}),(0,s.jsx)("input",{className:"form-control form-control-sm",value:k,onChange:e=>P(e.target.value),placeholder:"ตัวอย่าง: 00A4040007A000000054480001"})]}),(0,s.jsxs)("div",{className:"d-flex gap-2 flex-wrap",children:[(0,s.jsx)("span",{className:"badge bg-info bg-opacity-10 text-info",children:"ATR"}),(0,s.jsx)("p",{className:"mb-0 small",children:U??"ยังไม่อ่าน"})]})]}),(0,s.jsxs)("div",{className:"flex-fill",children:[(0,s.jsx)("h3",{className:"h6 text-uppercase text-muted",children:"ขั้นตอนอัตโนมัติ"}),(0,s.jsx)("div",{className:"bg-dark text-white rounded-3 p-3",style:{minHeight:160},children:(0,s.jsxs)("ul",{className:"list-unstyled mb-0 small",children:[(0,s.jsx)("li",{children:"Card Disconnected."}),(0,s.jsx)("li",{children:"Step 1 Card Connected."}),(0,s.jsx)("li",{children:"Step 2 Read card information."}),(0,s.jsx)("li",{children:"Step 3 Read the picture."})]})})]})]})})}),(0,s.jsxs)("div",{className:"mt-5",children:[(0,s.jsx)("h2",{className:"h4",children:"คำแนะนำเพิ่มเติม"}),(0,s.jsxs)("div",{className:"row row-cols-1 row-cols-md-2 g-3 mt-3",children:[(0,s.jsx)("div",{className:"col",children:(0,s.jsxs)("div",{className:"p-3 border rounded-3 h-100",children:[(0,s.jsx)("h3",{className:"h6",children:"บน PC"}),(0,s.jsxs)("ul",{className:"ps-3 mb-0",children:[(0,s.jsx)("li",{children:"ใช้ Chrome หรือ Edge บน Windows 10/11 เพื่อรับรอง WebUSB"}),(0,s.jsx)("li",{children:'หากไม่เห็นเครื่องอ่านให้ตรวจสอบ Device Manager ว่าไดรเว์อร์ "Alcorlink" ถูกติดตั้ง'}),(0,s.jsx)("li",{children:'เปิดหน้านี้แล้วแตะ "สแกนเครื่องอ่าน USB" เพื่อให้อุปกรณ์ถามสิทธิ์'})]})]})}),(0,s.jsx)("div",{className:"col",children:(0,s.jsxs)("div",{className:"p-3 border rounded-3 h-100",children:[(0,s.jsx)("h3",{className:"h6",children:"บนมือถือ"}),(0,s.jsxs)("ul",{className:"ps-3 mb-0",children:[(0,s.jsx)("li",{children:"Android (Chrome/Edge) รองรับ WebHID; iOS/Safari ยังไม่รองรับ"}),(0,s.jsx)("li",{children:'เปิดหน้าเว็บนี้จากเบราว์เซอร์ที่รองรับ และแตะ "สแกนเครื่องอ่าน HID"'}),(0,s.jsx)("li",{children:"หากยังไม่มีการตอบกลับ ลองสลับสาย USB หรือใช้ฐาน OTG ในกล้อง"})]}),p&&(0,s.jsx)("p",{className:"small text-muted mb-0",children:"อยู่ระหว่างเรียกดูจากอุปกรณ์โมบายล์ เลือกปุ่ม HID หากต้องการใช้งานผ่าน USB-C"})]})})]})]})]})})})})}e.s(["default",()=>m])}]);