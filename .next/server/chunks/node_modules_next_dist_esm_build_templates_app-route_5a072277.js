module.exports=[796776,e=>{"use strict";var t=e.i(747909),a=e.i(174017),o=e.i(996250),n=e.i(759756),s=e.i(561916),r=e.i(114444),l=e.i(837092),i=e.i(869741),d=e.i(316795),c=e.i(487718),u=e.i(995169),p=e.i(47587),g=e.i(666012),h=e.i(570101),R=e.i(626937),w=e.i(10372),f=e.i(193695);e.i(52474);var E=e.i(600220),m=e.i(89171),S=e.i(800314);async function v(e){try{let t=e.nextUrl.searchParams,a=t.get("date_preset")||"today",o=t.get("time_range"),n="true"===t.get("daily");if(!process.env.GOOGLE_SA_CLIENT_EMAIL||!process.env.GOOGLE_SA_PRIVATE_KEY||!process.env.GOOGLE_SHEET_ID)return m.NextResponse.json({success:!1,error:"Missing Google Sheets credentials in environment variables"},{status:500});let s=new S.google.auth.GoogleAuth({credentials:{client_email:process.env.GOOGLE_SA_CLIENT_EMAIL,private_key:process.env.GOOGLE_SA_PRIVATE_KEY.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets.readonly"]}),r=S.google.sheets({version:"v4",auth:s}),l=(await r.spreadsheets.values.get({spreadsheetId:process.env.GOOGLE_SHEET_ID,range:"เคสได้ชื่อเบอร์!A:Z"})).data.values;if(!l||0===l.length)return m.NextResponse.json({success:!0,total:0,data:[]});let i=l[0],d=l.slice(1);console.log("=== HEADERS ANALYSIS ==="),console.log("Total columns:",i.length),console.log("All headers with index:"),i.forEach((e,t)=>{console.log(`  [${t}]: "${e}"`)}),console.log("\n=== SAMPLE DATA (first 3 rows) ==="),d.slice(0,3).forEach((e,t)=>{console.log(`Row ${t+2}:`,e.slice(0,5))}),console.log("\n=== COLUMN DETECTION RESULT ==="),console.log("Using column A (index 0) for both date filtering and counting"),console.log(`Column header: "${i[0]}"`),console.log(`Sample data: "${d[0]?.[0]}"`);let c=d,u=null,p=null;if(o)try{let e=JSON.parse(o);u=new Date(e.since),(p=new Date(e.until)).setHours(23,59,59,999)}catch(e){console.error("Invalid time_range format:",e)}else{let e=new Date;switch(e.setHours(0,0,0,0),a){case"today":u=e,(p=new Date(e)).setHours(23,59,59,999);break;case"yesterday":(u=new Date(e)).setDate(e.getDate()-1),(p=new Date(u)).setHours(23,59,59,999);break;case"last_7d":(u=new Date(e)).setDate(e.getDate()-7),(p=new Date(e)).setHours(23,59,59,999);break;case"last_30d":(u=new Date(e)).setDate(e.getDate()-30),(p=new Date(e)).setHours(23,59,59,999);break;case"this_month":u=new Date(e.getFullYear(),e.getMonth(),1),(p=new Date(e)).setHours(23,59,59,999);break;case"last_month":u=new Date(e.getFullYear(),e.getMonth()-1,1),(p=new Date(e.getFullYear(),e.getMonth(),0)).setHours(23,59,59,999)}}if(u&&p){console.log("=== DATE FILTERING START ==="),console.log("Date range:",{start:u.toISOString(),end:p.toISOString(),startLocal:u.toLocaleDateString("th-TH"),endLocal:p.toLocaleDateString("th-TH")});let e=0,t=0;c=d.filter((a,o)=>{let n=a[0],s=a[0];if(!n)return console.log(`Row ${o+2}: No date value`),t++,!1;let r=null,l=n.toString().trim();if(/^\d{4}-\d{1,2}-\d{1,2}/.test(l))r=new Date(l);else if(/^\d{1,2}\/\d{1,2}\/\d{4}/.test(l)){let e=l.split("/"),t=parseInt(e[0]),a=parseInt(e[1])-1,o=parseInt(e[2]);r=new Date(o,a,t)}else if(/^\d{1,2}-\d{1,2}-\d{4}/.test(l)){let e=l.split("-"),t=parseInt(e[0]),a=parseInt(e[1])-1,o=parseInt(e[2]);r=new Date(o,a,t)}else if(/^\d{4}\/\d{1,2}\/\d{1,2}/.test(l)){let e=l.split("/"),t=parseInt(e[0]),a=parseInt(e[1])-1,o=parseInt(e[2]);r=new Date(t,a,o)}else if(/^\d{1,2}\/\d{1,2}\/\d{4}\s+\d{1,2}:\d{1,2}/.test(l)){let[e]=l.split(" "),t=e.split("/"),a=parseInt(t[0]),o=parseInt(t[1])-1,n=parseInt(t[2]);r=new Date(n,o,a)}else r=new Date(l);if(!r||isNaN(r.getTime()))return console.log(`Row ${o+2}: Failed to parse date: "${n}"`),t++,!1;r.setHours(0,0,0,0);let i=r>=u&&r<=p;return i?(e++,console.log(`Row ${o+2}: ✓ MATCH - Date: ${l} => ${r.toLocaleDateString("th-TH")}, Value: "${s||"(empty)"}"`)):(console.log(`Row ${o+2}: ✗ OUT OF RANGE - Date: ${l} => ${r.toLocaleDateString("th-TH")}`),t++),i}),console.log("=== DATE FILTERING RESULT ==="),console.log(`Total rows: ${d.length}`),console.log(`Matched: ${e}`),console.log(`Skipped: ${t}`),console.log(`Filtered result: ${c.length} rows`)}else console.log("No date filtering applied (using all rows)"),u&&p||console.log("Reason: Date range not specified");console.log("=== COUNTING VALID DATA ==="),console.log("Checking column index: 0");let g=c.filter((e,t)=>{let a=e[0],o=a&&""!==a.toString().trim();return o?console.log(`✓ Row has data: "${a}"`):console.log(`✗ Row empty or invalid: "${a}"`),o}),h=g.length;if(console.log("=== FINAL COUNT ==="),console.log(`Valid rows with data in "ได้ชื่อได้เบอร์" column: ${h}`),n&&1){console.log("=== GROUPING BY DATE ===");let e=new Map;g.forEach(t=>{let a=t[0];if(!a)return;let o="",n=a.toString().trim();if(/^\d{4}-\d{1,2}-\d{1,2}/.test(n))o=n.split(" ")[0];else if(/^\d{1,2}\/\d{1,2}\/\d{4}/.test(n)){let e=n.split(" ")[0].split("/"),t=e[0].padStart(2,"0"),a=e[1].padStart(2,"0"),s=e[2];o=`${s}-${a}-${t}`}else if(/^\d{1,2}-\d{1,2}-\d{4}/.test(n)){let e=n.split(" ")[0].split("-"),t=e[0].padStart(2,"0"),a=e[1].padStart(2,"0"),s=e[2];o=`${s}-${a}-${t}`}else if(/^\d{4}\/\d{1,2}\/\d{1,2}/.test(n)){let e=n.split(" ")[0].split("/"),t=e[0],a=e[1].padStart(2,"0"),s=e[2].padStart(2,"0");o=`${t}-${a}-${s}`}if(o){let t=e.get(o)||0;e.set(o,t+1)}});let t=Array.from(e.entries()).map(([e,t])=>({date:e,count:t})).sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime());return console.log(`✅ Daily breakdown: ${t.length} days`),t.forEach(e=>{console.log(`  ${e.date}: ${e.count} records`)}),m.NextResponse.json({success:!0,dailyData:t,total:h,dateRange:{start:u?.toISOString().split("T")[0],end:p?.toISOString().split("T")[0]}})}return m.NextResponse.json({success:!0,total:h,dateRange:{start:u?.toISOString().split("T")[0],end:p?.toISOString().split("T")[0]},dateColIndex:0,hasDateColumn:!0,totalRowsBeforeFilter:d.length,rowsAfterDateFilter:c.length,data:g.slice(0,10).map(e=>({date:e[0],namePhone:e[0]}))})}catch(e){return console.error("Error fetching Google Sheets data:",e),m.NextResponse.json({success:!1,error:e.message||"Failed to fetch data from Google Sheets",details:e},{status:500})}}e.s(["GET",()=>v],867352);var D=e.i(867352);let T=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/google-sheets-data/route",pathname:"/api/google-sheets-data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/google-sheets-data/route.ts",nextConfigOutput:"",userland:D}),{workAsyncStorage:A,workUnitAsyncStorage:I,serverHooks:O}=T;function C(){return(0,o.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:I})}async function N(e,t,o){T.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let m="/api/google-sheets-data/route";m=m.replace(/\/index$/,"")||"/";let S=await T.prepare(e,t,{srcPage:m,multiZoneDraftMode:!1});if(!S)return t.statusCode=400,t.end("Bad Request"),null==o.waitUntil||o.waitUntil.call(o,Promise.resolve()),null;let{buildId:v,params:D,nextConfig:A,parsedUrl:I,isDraftMode:O,prerenderManifest:C,routerServerContext:N,isOnDemandRevalidate:_,revalidateOnlyGenerated:$,resolvedPathname:y,clientReferenceManifest:x,serverActionsManifest:H}=S,L=(0,i.normalizeAppPath)(m),b=!!(C.dynamicRoutes[L]||C.routes[y]),P=async()=>((null==N?void 0:N.render404)?await N.render404(e,t,I,!1):t.end("This page could not be found"),null);if(b&&!O){let e=!!C.routes[y],t=C.dynamicRoutes[L];if(t&&!1===t.fallback&&!e){if(A.experimental.adapterPath)return await P();throw new f.NoFallbackError}}let M=null;!b||T.isDev||O||(M="/index"===(M=y)?"/":M);let G=!0===T.isDev||!b,U=b&&!G;H&&x&&(0,r.setReferenceManifestsSingleton)({page:m,clientReferenceManifest:x,serverActionsManifest:H,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:H})});let k=e.method||"GET",F=(0,s.getTracer)(),q=F.getActiveScopeSpan(),j={params:D,prerenderManifest:C,renderOpts:{experimental:{authInterrupts:!!A.experimental.authInterrupts},cacheComponents:!!A.cacheComponents,supportsDynamicResponse:G,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:A.cacheLife,waitUntil:o.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,o)=>T.onRequestError(e,t,o,N)},sharedContext:{buildId:v}},K=new d.NodeNextRequest(e),V=new d.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let r=async e=>T.handle(B,j).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=F.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==u.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let o=a.get("next.route");if(o){let t=`${k} ${o}`;e.setAttributes({"next.route":o,"http.route":o,"next.span_name":t}),e.updateName(t)}else e.updateName(`${k} ${m}`)}),l=!!(0,n.getRequestMeta)(e,"minimalMode"),i=async n=>{var s,i;let d=async({previousCacheEntry:a})=>{try{if(!l&&_&&$&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let s=await r(n);e.fetchMetrics=j.renderOpts.fetchMetrics;let i=j.renderOpts.pendingWaitUntil;i&&o.waitUntil&&(o.waitUntil(i),i=void 0);let d=j.renderOpts.collectedTags;if(!b)return await (0,g.sendResponse)(K,V,s,j.renderOpts.pendingWaitUntil),null;{let e=await s.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(s.headers);d&&(t[w.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==j.renderOpts.collectedRevalidate&&!(j.renderOpts.collectedRevalidate>=w.INFINITE_CACHE)&&j.renderOpts.collectedRevalidate,o=void 0===j.renderOpts.collectedExpire||j.renderOpts.collectedExpire>=w.INFINITE_CACHE?void 0:j.renderOpts.collectedExpire;return{value:{kind:E.CachedRouteKind.APP_ROUTE,status:s.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:o}}}}catch(t){throw(null==a?void 0:a.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:m,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:_})},N),t}},c=await T.handleResponse({req:e,nextConfig:A,cacheKey:M,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:C,isRoutePPREnabled:!1,isOnDemandRevalidate:_,revalidateOnlyGenerated:$,responseGenerator:d,waitUntil:o.waitUntil,isMinimalMode:l});if(!b)return null;if((null==c||null==(s=c.value)?void 0:s.kind)!==E.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(i=c.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",_?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),O&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let u=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&b||u.delete(w.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||u.get("Cache-Control")||u.set("Cache-Control",(0,R.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(K,V,new Response(c.value.body,{headers:u,status:c.value.status||200})),null};q?await i(q):await F.withPropagatedContext(e.headers,()=>F.trace(u.BaseServerSpan.handleRequest,{spanName:`${k} ${m}`,kind:s.SpanKind.SERVER,attributes:{"http.method":k,"http.target":e.url}},i))}catch(t){if(t instanceof f.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:L,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:U,isOnDemandRevalidate:_})}),b)throw t;return await (0,g.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>N,"patchFetch",()=>C,"routeModule",()=>T,"serverHooks",()=>O,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>I],796776)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_5a072277.js.map