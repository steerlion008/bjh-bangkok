{"version":3,"sources":["../../../../src/app/%28fullscreen%29/crm-advanced/page.tsx","../../../../src/app/%28fullscreen%29/crm-advanced/CustomerRegistrationModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, useCallback, useMemo } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Appointment } from \"@/types/appointment\";\r\nimport CustomerRegistrationModal, {\r\n  CustomerFormData,\r\n  LeadSummary,\r\n  StaffOption,\r\n} from \"./CustomerRegistrationModal\";\r\n\r\n// Helper function สำหรับสร้างวันที่แบบ local time (YYYY-MM-DD)\r\nconst getLocalDateString = (date: Date = new Date()): string => {\r\n  const year = date.getFullYear();\r\n  const month = String(date.getMonth() + 1).padStart(2, \"0\");\r\n  const day = String(date.getDate()).padStart(2, \"0\");\r\n  return `${year}-${month}-${day}`;\r\n};\r\n\r\n// Helper function สำหรับแปลงเวลาเป็นรูปแบบ \"HH:MM น.\"\r\nconst formatTimeDisplay = (time: string | undefined | null): string => {\r\n  if (!time || time === \"\" || time === \"null\" || time === \"undefined\")\r\n    return \"-\";\r\n\r\n  // ถ้าเป็นรูปแบบ HH:MM:SS หรือ HH:MM:SS+07 หรือ HH:MM\r\n  const timeStr = String(time).trim();\r\n\r\n  // ลองแยกเวลาด้วย :\r\n  const parts = timeStr.split(\":\");\r\n  if (parts.length >= 2) {\r\n    const hours = parts[0].padStart(2, \"0\");\r\n    const minutes = parts[1].substring(0, 2).padStart(2, \"0\");\r\n    return `${hours}:${minutes} น.`;\r\n  }\r\n\r\n  // ถ้าไม่ใช่รูปแบบที่รู้จัก ให้ตัดเอา 5 ตัวแรก\r\n  return timeStr.slice(0, 5) + \" น.\";\r\n};\r\n\r\n// Helper สำหรับย่อหมายเหตุให้แสดงเพียงไม่กี่ประโยค\r\nconst COMPANY_NAME_LABEL = \"บริษัท โรงพยาบาล บีเจเอช จำกัด\";\r\nconst FOLLOW_NOTE_LABEL = \"ลูกค้า Follow อ่านหมายเหตุ\";\r\n\r\nconst getNotePreview = (\r\n  raw: string | null | undefined,\r\n  maxSentences = 2\r\n): string => {\r\n  if (!raw) {\r\n    return \"-\";\r\n  }\r\n\r\n  const normalized = String(raw)\r\n    .replace(/\\r?\\n+/g, \" \")\r\n    .replace(/\\s+/g, \" \")\r\n    .trim();\r\n\r\n  if (!normalized || normalized.toLowerCase() === \"null\" || normalized.toLowerCase() === \"undefined\") {\r\n    return \"-\";\r\n  }\r\n\r\n  const sentences = normalized.match(/[^.!?]+[.!?]?/g);\r\n\r\n  if (!sentences || sentences.length <= maxSentences) {\r\n    return normalized.length > 160 ? `${normalized.slice(0, 160).trim()} …` : normalized;\r\n  }\r\n\r\n  return `${sentences.slice(0, maxSentences).join(\" \").trim()} …`;\r\n};\r\n\r\nconst getLegacyCustomerName = (appointment: Appointment): string => {\r\n  if (appointment.display_name && appointment.display_name.trim()) {\r\n    return appointment.display_name.trim();\r\n  }\r\n\r\n  const parts = [appointment.prefix, appointment.name, appointment.surname]\r\n    .filter((value): value is string => Boolean(value && value.trim()))\r\n    .map((value) => value.trim());\r\n\r\n  if (parts.length > 0) {\r\n    return parts.join(\" \");\r\n  }\r\n\r\n  if (appointment.nickname && appointment.nickname.trim()) {\r\n    return appointment.nickname.trim();\r\n  }\r\n\r\n  return \"-\";\r\n};\r\n\r\nconst getLegacyDateParts = (dateTime: string | null | undefined) => {\r\n  if (!dateTime) {\r\n    return { dateLabel: \"-\", timeLabel: \"-\" };\r\n  }\r\n\r\n  const parsed = new Date(dateTime);\r\n  if (!Number.isNaN(parsed.getTime())) {\r\n    return {\r\n      dateLabel: parsed.toLocaleDateString(\"th-TH\", {\r\n        day: \"2-digit\",\r\n        month: \"short\",\r\n      }),\r\n      timeLabel: `${parsed.toLocaleTimeString(\"th-TH\", {\r\n        hour: \"2-digit\",\r\n        minute: \"2-digit\",\r\n      })} น.`,\r\n    };\r\n  }\r\n\r\n  const [datePart, timePart] = dateTime.split(/[T\\s]/);\r\n  return {\r\n    dateLabel: datePart || \"-\",\r\n    timeLabel: timePart ? formatTimeDisplay(timePart.slice(0, 5)) : \"-\",\r\n  };\r\n};\r\n\r\nconst formatLegacyPhoneNumber = (phone: string | null | undefined): string => {\r\n  if (!phone) {\r\n    return \"-\";\r\n  }\r\n\r\n  const digitsOnly = phone.replace(/\\D/g, \"\");\r\n  if (digitsOnly.length === 10) {\r\n    return `${digitsOnly.slice(0, 3)}-${digitsOnly.slice(3, 6)}-${digitsOnly.slice(6)}`;\r\n  }\r\n\r\n  return phone.trim();\r\n};\r\n\r\nconst sanitizeProductName = (product: string | null | undefined): string => {\r\n  if (!product) {\r\n    return \"-\";\r\n  }\r\n  const trimmed = product.trim();\r\n  if (!trimmed || trimmed.toLowerCase() === \"null\" || trimmed.toLowerCase() === \"undefined\") {\r\n    return \"-\";\r\n  }\r\n  return trimmed;\r\n};\r\n\r\ninterface CRMRecord {\r\n  id: number;\r\n  appointmentTime: string;\r\n  status: string;\r\n  appointmentDate: string;\r\n  interestedProduct: string;\r\n  customer_name: string;\r\n  doctor: string;\r\n  contact_staff: string;\r\n  interested_product: string;\r\n  country: string;\r\n  phone: string;\r\n  name: string;\r\n  phoneNumber: string;\r\n  proposed_amount: number;\r\n  proposedAmount: number;\r\n  star_flag: string;\r\n  note: string | null;\r\n  hasCustomerProfile?: boolean;\r\n  customerIdAll?: string;\r\n  surgery_date?: string;\r\n  consult_date?: string;\r\n  displayDate?: string;\r\n}\r\n\r\ninterface ItemGroup {\r\n  groupcode: string;\r\n  groupname: string;\r\n}\r\n\r\ninterface ItemService {\r\n  itemcode: string;\r\n  itemname: string;\r\n}\r\n\r\ninterface HREmployee {\r\n  id?: number;\r\n  full_name: string;\r\n  role: string;\r\n  yearly_leave_quota: number;\r\n  leave_remaining: number;\r\n  work_start_time: string;\r\n  work_end_time: string;\r\n  is_active: boolean;\r\n}\r\n\r\ninterface HRAttendance {\r\n  id?: number;\r\n  employee_id: number;\r\n  employee_name?: string;\r\n  status_rank?: string;\r\n  work_date: string;\r\n  time_in: string;\r\n  time_out: string;\r\n  status: string;\r\n  work_hours: number;\r\n  overtime_hours: number;\r\n  note: string;\r\n}\r\n\r\ntype CustomerSegment = \"new\" | \"old\";\r\n\r\ninterface CombinedTableRow {\r\n  kind: CustomerSegment;\r\n  id: string;\r\n  sortKey: number;\r\n  timeLabel: string;\r\n  dateLabel?: string;\r\n  status: string;\r\n  customerName: string;\r\n  phone: string;\r\n  product: string;\r\n  doctor: string;\r\n  contact: string;\r\n  amountValue?: number;\r\n  appointmentCode?: string;\r\n  star: boolean;\r\n  country: string;\r\n  notePreview: string;\r\n  rawRecord?: CRMRecord;\r\n  rawLegacy?: Appointment;\r\n}\r\n\r\nexport default function CRMAdvancedPage() {\r\n  const router = useRouter();\r\n  const [records, setRecords] = useState<CRMRecord[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [selectedDate, setSelectedDate] = useState<string>(\"\");\r\n  const [startDate, setStartDate] = useState<string>(\"\");\r\n  const [viewMode, setViewMode] = useState<\"table\" | \"calendar\" | \"calendar2\">(\r\n    \"table\"\r\n  );\r\n  const [currentMonth, setCurrentMonth] = useState<Date>(new Date());\r\n  const [currentMonth2, setCurrentMonth2] = useState<Date>(new Date());\r\n  const [customerSegment, setCustomerSegment] = useState<\"new\" | \"old\">(\"new\");\r\n  const [selectedDateRecords, setSelectedDateRecords] = useState<CRMRecord[]>(\r\n    []\r\n  );\r\n  const [selectedDateStr, setSelectedDateStr] = useState<string>(\"\");\r\n  const [showPopup, setShowPopup] = useState(false);\r\n  const [showEmployeeForm, setShowEmployeeForm] = useState(false);\r\n  const [employeeForm, setEmployeeForm] = useState<HREmployee>({\r\n    full_name: \"\",\r\n    role: \"\",\r\n    yearly_leave_quota: 10,\r\n    leave_remaining: 10,\r\n    work_start_time: \"08:00\",\r\n    work_end_time: \"19:00\",\r\n    is_active: true,\r\n  });\r\n  const [showAttendanceForm, setShowAttendanceForm] = useState(false);\r\n  const [employees, setEmployees] = useState<HREmployee[]>([]);\r\n  const [attendances, setAttendances] = useState<HRAttendance[]>([]);\r\n  const [attendanceForm, setAttendanceForm] = useState<HRAttendance>({\r\n    employee_id: 0,\r\n    work_date: \"\",\r\n    time_in: \"08:00\",\r\n    time_out: \"17:00\",\r\n    status: \"PRESENT\",\r\n    work_hours: 8.0,\r\n    overtime_hours: 0,\r\n    note: \"\",\r\n  });\r\n  const [showAttendancePopup, setShowAttendancePopup] = useState(false);\r\n  const [selectedDateAttendances, setSelectedDateAttendances] = useState<\r\n    HRAttendance[]\r\n  >([]);\r\n  const [selectedAttendanceDateStr, setSelectedAttendanceDateStr] =\r\n    useState<string>(\"\");\r\n  const [editingAttendance, setEditingAttendance] =\r\n    useState<HRAttendance | null>(null);\r\n  const [noteModalRecord, setNoteModalRecord] = useState<CRMRecord | null>(null);\r\n  const [itemGroups, setItemGroups] = useState<ItemGroup[]>([]);\r\n  const [groupsLoading, setGroupsLoading] = useState(false);\r\n  const [groupsError, setGroupsError] = useState<string | null>(null);\r\n  const [selectedGroupForServices, setSelectedGroupForServices] =\r\n    useState<ItemGroup | null>(null);\r\n  const [groupServiceItems, setGroupServiceItems] = useState<ItemService[]>([]);\r\n  const [serviceModalVisible, setServiceModalVisible] = useState(false);\r\n  const [servicesLoading, setServicesLoading] = useState(false);\r\n  const [serviceError, setServiceError] = useState<string | null>(null);\r\n\r\n  const [showCustomerModal, setShowCustomerModal] = useState(false);\r\n  const [customerForm, setCustomerForm] = useState<CustomerFormData | null>(\r\n    null\r\n  );\r\n  const [customerLoading, setCustomerLoading] = useState(false);\r\n  const [customerSaving, setCustomerSaving] = useState(false);\r\n  const [customerExists, setCustomerExists] = useState(false);\r\n  const [customerMessage, setCustomerMessage] = useState<string | null>(null);\r\n  const [customerError, setCustomerError] = useState<string | null>(null);\r\n  const [selectedLeadSummary, setSelectedLeadSummary] =\r\n    useState<LeadSummary | null>(null);\r\n  const [staffOptions, setStaffOptions] = useState<StaffOption[]>([]);\r\n  const [staffLoading, setStaffLoading] = useState(false);\r\n  const [staffError, setStaffError] = useState<string | null>(null);\r\n  const [legacyRecords, setLegacyRecords] = useState<Appointment[]>([]);\r\n  const [legacyLoading, setLegacyLoading] = useState(false);\r\n  const [legacyError, setLegacyError] = useState<string | null>(null);\r\n  const [expandedRowId, setExpandedRowId] = useState<number | null>(null);\r\n\r\n  const dateFieldKeys: Array<keyof CustomerFormData> = [\r\n    \"birthdate\",\r\n    \"registerdate\",\r\n    \"binddate\",\r\n    \"idcardIssueDate\",\r\n    \"idcardExpireDate\",\r\n  ];\r\n\r\n  const getNameParts = (fullName: string) => {\r\n    if (!fullName) {\r\n      return { firstName: \"\", lastName: \"\" };\r\n    }\r\n    const parts = fullName.trim().split(/\\s+/);\r\n    if (parts.length === 1) {\r\n      return { firstName: parts[0], lastName: \"\" };\r\n    }\r\n    const [first, ...rest] = parts;\r\n    return { firstName: first, lastName: rest.join(\" \") };\r\n  };\r\n\r\n  const buildLeadSummary = (record: CRMRecord): LeadSummary => ({\r\n    id: record.id,\r\n    name: record.customer_name || \"\",\r\n    phone: record.phone || \"\",\r\n    status: record.status || \"\",\r\n    interestedProduct: record.interested_product || record.interestedProduct || \"\",\r\n  });\r\n\r\n  const normalizeDateValue = (value: unknown) => {\r\n    if (!value) {\r\n      return \"\";\r\n    }\r\n    const str = String(value);\r\n    if (str.length >= 10) {\r\n      return str.slice(0, 10);\r\n    }\r\n    return str;\r\n  };\r\n\r\n  const buildBaseCustomerForm = (record: CRMRecord): CustomerFormData => {\r\n    const today = getLocalDateString();\r\n    const { firstName, lastName } = getNameParts(record.customer_name || \"\");\r\n\r\n    return {\r\n      recordno: \"\",\r\n      code: \"\",\r\n      cn: String(record.id),\r\n      prefix: \"\",\r\n      name: firstName,\r\n      surname: lastName,\r\n      nickname: \"\",\r\n      gender: \"\",\r\n      idcard: \"\",\r\n      birthdate: \"\",\r\n      registerdate: today,\r\n      member: \"\",\r\n      cusgroup: \"\",\r\n      mobilephone: record.phone || \"\",\r\n      email: \"\",\r\n      lineid: \"\",\r\n      facebook: \"\",\r\n      medianame: \"\",\r\n      disease: \"\",\r\n      allergic: \"\",\r\n      displayname: record.customer_name || \"\",\r\n      locno: \"\",\r\n      soi: \"\",\r\n      road: \"\",\r\n      moo: \"\",\r\n      tumbon: \"\",\r\n      amphur: \"\",\r\n      province: \"\",\r\n      zipcode: \"\",\r\n      country: \"Thailand\",\r\n      address: \"\",\r\n      ownercode: \"\",\r\n      ownername: record.contact_staff || \"\",\r\n      binddate: today,\r\n      idcardLaserCode: \"\",\r\n      idcardIssueDate: \"\",\r\n      idcardExpireDate: \"\",\r\n      idcardProvinceNative: \"\",\r\n      idcardDistrictNative: \"\",\r\n      idcardSubdistrictNative: \"\",\r\n      idcardFrontImage: \"\",\r\n      idcardBackImage: \"\",\r\n    };\r\n  };\r\n\r\n  const mapDbRecordToForm = (\r\n    dbRecord: Record<string, unknown>,\r\n    fallback: CustomerFormData\r\n  ): CustomerFormData => {\r\n    const next: CustomerFormData = { ...fallback };\r\n\r\n    (Object.keys(dbRecord) as Array<keyof CustomerFormData>).forEach((key) => {\r\n      if (key === \"cn\") {\r\n        return;\r\n      }\r\n\r\n      const rawValue = dbRecord[key];\r\n\r\n      if (key === \"recordno\") {\r\n        next.recordno = rawValue === undefined || rawValue === null ? \"\" : String(rawValue);\r\n        return;\r\n      }\r\n\r\n      if (dateFieldKeys.includes(key)) {\r\n        next[key] = normalizeDateValue(rawValue);\r\n        return;\r\n      }\r\n\r\n      next[key] = rawValue === undefined || rawValue === null ? \"\" : String(rawValue);\r\n    });\r\n\r\n    if (!next.displayname) {\r\n      const composed = [next.prefix, next.name, next.surname]\r\n        .filter(Boolean)\r\n        .join(\" \")\r\n        .trim();\r\n      next.displayname = composed;\r\n    }\r\n\r\n    return next;\r\n  };\r\n\r\n  const ensureStaffOptions = useCallback(async () => {\r\n    if (staffLoading) {\r\n      return;\r\n    }\r\n\r\n    if (staffOptions.length > 0 && !staffError) {\r\n      return;\r\n    }\r\n\r\n    setStaffLoading(true);\r\n    setStaffError(null);\r\n\r\n    try {\r\n      const response = await fetch(\"/api/n-staff\");\r\n      const result = await response.json();\r\n\r\n      if (!response.ok || result.success === false) {\r\n        throw new Error(result?.error || \"ไม่สามารถโหลดรายชื่อผู้ดูแลได้\");\r\n      }\r\n\r\n      const data: StaffOption[] = Array.isArray(result.data) ? result.data : [];\r\n      setStaffOptions(data);\r\n    } catch (err: any) {\r\n      setStaffError(err?.message || \"ไม่สามารถโหลดรายชื่อผู้ดูแลได้\");\r\n    } finally {\r\n      setStaffLoading(false);\r\n    }\r\n  }, [staffLoading, staffOptions.length, staffError]);\r\n\r\n  const openCustomerModal = async (record: CRMRecord) => {\r\n    ensureStaffOptions();\r\n\r\n    const baseForm = buildBaseCustomerForm(record);\r\n    setSelectedLeadSummary(buildLeadSummary(record));\r\n    setCustomerForm(baseForm);\r\n    setShowCustomerModal(true);\r\n    setCustomerExists(false);\r\n    setCustomerLoading(true);\r\n    setCustomerSaving(false);\r\n    setCustomerMessage(null);\r\n    setCustomerError(null);\r\n\r\n    try {\r\n      const response = await fetch(`/api/n-customer?cn=${record.id}`);\r\n      const result = await response.json();\r\n\r\n      if (!response.ok || result.success === false) {\r\n        if (result?.error) {\r\n          setCustomerError(result.error);\r\n        }\r\n        return;\r\n      }\r\n\r\n      if (result.exists && result.data) {\r\n        setCustomerForm(mapDbRecordToForm(result.data, baseForm));\r\n        setCustomerExists(true);\r\n      }\r\n    } catch (err: any) {\r\n      setCustomerError(err?.message || \"ไม่สามารถโหลดข้อมูลลูกค้าได้\");\r\n    } finally {\r\n      setCustomerLoading(false);\r\n    }\r\n  };\r\n\r\n  const closeCustomerModal = () => {\r\n    setShowCustomerModal(false);\r\n    setCustomerForm(null);\r\n    setCustomerError(null);\r\n    setCustomerMessage(null);\r\n    setCustomerExists(false);\r\n    setCustomerLoading(false);\r\n    setCustomerSaving(false);\r\n    setSelectedLeadSummary(null);\r\n  };\r\n\r\n  const handleCustomerFormChange = (\r\n    field: keyof CustomerFormData,\r\n    value: string\r\n  ) => {\r\n    setCustomerForm((prev) => {\r\n      if (!prev) {\r\n        return prev;\r\n      }\r\n\r\n      if (field === \"prefix\" || field === \"name\" || field === \"surname\") {\r\n        const currentComposite = [prev.prefix, prev.name, prev.surname]\r\n          .filter(Boolean)\r\n          .join(\" \")\r\n          .trim();\r\n        const nextState = { ...prev, [field]: value } as CustomerFormData;\r\n        const nextComposite = [nextState.prefix, nextState.name, nextState.surname]\r\n          .filter(Boolean)\r\n          .join(\" \")\r\n          .trim();\r\n\r\n        if (!prev.displayname || prev.displayname.trim() === currentComposite) {\r\n          nextState.displayname = nextComposite;\r\n        }\r\n\r\n        return nextState;\r\n      }\r\n\r\n      return { ...prev, [field]: value } as CustomerFormData;\r\n    });\r\n  };\r\n\r\n  const handleCustomerSubmit = async () => {\r\n    if (!customerForm) {\r\n      return;\r\n    }\r\n\r\n    setCustomerSaving(true);\r\n    setCustomerError(null);\r\n    setCustomerMessage(null);\r\n\r\n    try {\r\n      const {\r\n        idcardFrontImage,\r\n        idcardBackImage,\r\n        ...rest\r\n      } = customerForm;\r\n\r\n      const payload: Partial<CustomerFormData> = {\r\n        ...rest,\r\n        cn: customerForm.cn,\r\n      };\r\n\r\n      if (!payload.recordno || !payload.recordno.trim()) {\r\n        delete payload.recordno;\r\n      }\r\n\r\n      const response = await fetch(\"/api/n-customer\", {\r\n        method: customerExists ? \"PUT\" : \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      const result = await response.json();\r\n\r\n      if (!response.ok || result.success === false) {\r\n        throw new Error(result?.error || \"บันทึกข้อมูลลูกค้าไม่สำเร็จ\");\r\n      }\r\n\r\n      if (result.data) {\r\n        setCustomerForm(mapDbRecordToForm(result.data, customerForm));\r\n      }\r\n\r\n      setCustomerExists(true);\r\n      setCustomerMessage(\"บันทึกข้อมูลลูกค้าสำเร็จ\");\r\n    } catch (err: any) {\r\n      setCustomerError(err?.message || \"บันทึกข้อมูลลูกค้าไม่สำเร็จ\");\r\n    } finally {\r\n      setCustomerSaving(false);\r\n    }\r\n  };\r\n\r\n  // ดึงข้อมูลจาก API - เริ่มต้นด้วยวันนี้\r\n  useEffect(() => {\r\n    const today = getLocalDateString();\r\n    setStartDate(today);\r\n    fetchRecords(today, today);\r\n  }, []);\r\n\r\n  // ค้นหาอัตโนมัติเมื่อเปลี่ยนวันที่\r\n  useEffect(() => {\r\n    if (startDate && viewMode === \"table\") {\r\n      fetchRecords(startDate, startDate);\r\n    }\r\n  }, [startDate]);\r\n\r\n  // โหลดข้อมูลตามเดือนที่เลือกในปฏิทิน\r\n  useEffect(() => {\r\n    if (viewMode === \"calendar\") {\r\n      fetchRecordsByMonth(currentMonth);\r\n    }\r\n  }, [currentMonth, viewMode]);\r\n\r\n  // โหลดข้อมูลตามเดือนที่เลือกในปฏิทิน 2\r\n  useEffect(() => {\r\n    if (viewMode === \"calendar2\") {\r\n      fetchRecordsByMonth(currentMonth2);\r\n      fetchEmployees();\r\n      fetchAttendances(currentMonth2);\r\n    }\r\n  }, [currentMonth2, viewMode]);\r\n\r\n  useEffect(() => {\r\n    if (showCustomerModal) {\r\n      ensureStaffOptions();\r\n    }\r\n  }, [showCustomerModal, ensureStaffOptions]);\r\n\r\n  // โหลดรายชื่อพนักงาน\r\n  const fetchEmployees = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/hr-employees\");\r\n      const data = await response.json();\r\n      if (data.success) {\r\n        setEmployees(data.data.filter((emp: HREmployee) => emp.is_active));\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching employees:\", error);\r\n    }\r\n  };\r\n\r\n  // โหลดข้อมูลการเข้างานตามเดือน\r\n  const fetchAttendances = async (date: Date) => {\r\n    try {\r\n      const month = (date.getMonth() + 1).toString();\r\n      const year = date.getFullYear().toString();\r\n\r\n      console.log(\"Fetching attendances for:\", { month, year });\r\n\r\n      const response = await fetch(\r\n        `/api/hr-attendance?month=${month}&year=${year}`\r\n      );\r\n      const data = await response.json();\r\n      console.log(\"Attendance API response:\", data);\r\n\r\n      if (data.success) {\r\n        setAttendances(data.data);\r\n        console.log(\"Set attendances:\", data.data);\r\n      } else {\r\n        console.error(\"API Error:\", data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error fetching attendances:\", error);\r\n    }\r\n  };\r\n\r\n  const fetchLegacyAppointments = useCallback(async (dateStr?: string) => {\r\n    const effectiveDate = dateStr && dateStr.trim() ? dateStr : getLocalDateString();\r\n\r\n    try {\r\n      setLegacyLoading(true);\r\n      setLegacyError(null);\r\n\r\n      const params = new URLSearchParams();\r\n      params.append(\"from\", effectiveDate);\r\n      params.append(\"to\", effectiveDate);\r\n\r\n      const response = await fetch(`/api/appointments?${params.toString()}`);\r\n      const data = await response.json();\r\n\r\n      if (!response.ok || data.success === false) {\r\n        throw new Error(data?.error || \"ไม่สามารถโหลดข้อมูลลูกค้าเก่าได้\");\r\n      }\r\n\r\n      setLegacyRecords(Array.isArray(data.data) ? data.data : []);\r\n    } catch (error: any) {\r\n      console.error(\"Error fetching legacy appointments:\", error);\r\n      setLegacyRecords([]);\r\n      setLegacyError(error?.message || \"ไม่สามารถโหลดข้อมูลลูกค้าเก่าได้\");\r\n    } finally {\r\n      setLegacyLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (viewMode !== \"table\" || customerSegment !== \"old\") {\r\n      return;\r\n    }\r\n\r\n    const targetDate = startDate && startDate.trim() ? startDate : getLocalDateString();\r\n    fetchLegacyAppointments(targetDate);\r\n  }, [customerSegment, fetchLegacyAppointments, startDate, viewMode]);\r\n\r\n  const fetchRecords = async (start?: string, end?: string) => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      let url = \"/api/crm-advanced\";\r\n      const params = new URLSearchParams();\r\n\r\n      if (start) params.append(\"startDate\", start);\r\n      if (end) params.append(\"endDate\", end);\r\n\r\n      if (params.toString()) url += `?${params.toString()}`;\r\n\r\n      const response = await fetch(url);\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        setRecords(data.data);\r\n      } else {\r\n        setError(data.error || \"Failed to fetch data\");\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || \"Failed to fetch records\");\r\n      console.error(\"Error fetching records:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchRecordsByMonth = async (date: Date) => {\r\n    try {\r\n      setLoading(true);\r\n      setError(null);\r\n\r\n      const month = (date.getMonth() + 1).toString();\r\n      const year = date.getFullYear().toString();\r\n\r\n      const url = `/api/crm-advanced?month=${month}&year=${year}`;\r\n      const response = await fetch(url);\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        setRecords(data.data);\r\n      } else {\r\n        setError(data.error || \"Failed to fetch data\");\r\n      }\r\n    } catch (err: any) {\r\n      setError(err.message || \"Failed to fetch records\");\r\n      console.error(\"Error fetching records:\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDateFilter = () => {\r\n    if (startDate) {\r\n      fetchRecords(startDate, startDate);\r\n    } else {\r\n      // ถ้าไม่กรอกวันที่ ให้ใช้วันนี้\r\n      const today = getLocalDateString();\r\n      fetchRecords(today, today);\r\n    }\r\n  };\r\n\r\n  const handleResetFilter = () => {\r\n    const today = getLocalDateString();\r\n    setStartDate(today);\r\n    setSelectedDate(\"\");\r\n    if (viewMode === \"calendar\") {\r\n      // ถ้าอยู่ในโหมดปฏิทิน ให้โหลดข้อมูลของเดือนปัจจุบัน\r\n      fetchRecordsByMonth(currentMonth);\r\n    } else if (viewMode === \"calendar2\") {\r\n      // ถ้าอยู่ในโหมดปฏิทิน 2 ให้โหลดข้อมูลของเดือนปัจจุบัน\r\n      fetchRecordsByMonth(currentMonth2);\r\n    } else {\r\n      // ถ้าอยู่ในโหมดตาราง ให้โหลดข้อมูลวันนี้\r\n      fetchRecords(today, today);\r\n      if (customerSegment === \"old\") {\r\n        fetchLegacyAppointments(today);\r\n      }\r\n    }\r\n  };\r\n\r\n  const deleteRecord = async (id: number) => {\r\n    if (!confirm(\"คุณต้องการลบข้อมูลนี้หรือไม่?\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/crm-advanced?id=${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        alert(\"ลบข้อมูลสำเร็จ!\");\r\n        setRecords(records.filter((record) => record.id !== id));\r\n        setSelectedDateRecords(\r\n          selectedDateRecords.filter((record) => record.id !== id)\r\n        );\r\n\r\n        // Close popup if no records left\r\n        if (selectedDateRecords.length <= 1) {\r\n          setShowPopup(false);\r\n        }\r\n      } else {\r\n        alert(\"เกิดข้อผิดพลาด: \" + data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting record:\", error);\r\n      alert(\"เกิดข้อผิดพลาดในการลบข้อมูล\");\r\n    }\r\n  };\r\n\r\n  // Calendar Helper Functions\r\n  const getDaysInMonth = (date: Date) => {\r\n    const year = date.getFullYear();\r\n    const month = date.getMonth();\r\n    const firstDay = new Date(year, month, 1);\r\n    const lastDay = new Date(year, month + 1, 0);\r\n    const daysInMonth = lastDay.getDate();\r\n    const startingDayOfWeek = firstDay.getDay();\r\n\r\n    return { daysInMonth, startingDayOfWeek, year, month };\r\n  };\r\n\r\n  const getRecordsForDate = (dateStr: string) => {\r\n    return records.filter((record) => {\r\n      // ใช้ .split(\"T\")[0] โดยตรง ไม่ผ่าน new Date() เพื่อหลีกเลี่ยงปัญหา timezone\r\n      const surgeryDate = record.surgery_date\r\n        ? record.surgery_date.split(\"T\")[0]\r\n        : null;\r\n      const consultDate = record.consult_date\r\n        ? record.consult_date.split(\"T\")[0]\r\n        : null;\r\n      return surgeryDate === dateStr || consultDate === dateStr;\r\n    });\r\n  };\r\n\r\n  const handlePrevMonth = () => {\r\n    setCurrentMonth(\r\n      new Date(currentMonth.getFullYear(), currentMonth.getMonth() - 1)\r\n    );\r\n  };\r\n\r\n  const handleNextMonth = () => {\r\n    setCurrentMonth(\r\n      new Date(currentMonth.getFullYear(), currentMonth.getMonth() + 1)\r\n    );\r\n  };\r\n\r\n  const handlePrevMonth2 = () => {\r\n    setCurrentMonth2(\r\n      new Date(currentMonth2.getFullYear(), currentMonth2.getMonth() - 1)\r\n    );\r\n  };\r\n\r\n  const handleNextMonth2 = () => {\r\n    setCurrentMonth2(\r\n      new Date(currentMonth2.getFullYear(), currentMonth2.getMonth() + 1)\r\n    );\r\n  };\r\n\r\n  const handleDateClick = (dateStr: string) => {\r\n    setSelectedDate(dateStr);\r\n    setStartDate(dateStr);\r\n    const dayRecords = getRecordsForDate(dateStr);\r\n    if (dayRecords.length > 0) {\r\n      setSelectedDateRecords(dayRecords);\r\n      setSelectedDateStr(dateStr);\r\n      setShowPopup(true);\r\n    } else {\r\n      // ถ้าไม่มีข้อมูล ให้เรียก API เพื่อดึงข้อมูลของวันนั้น\r\n      fetchRecords(dateStr, dateStr);\r\n    }\r\n  };\r\n\r\n  const closePopup = () => {\r\n    setShowPopup(false);\r\n    setSelectedDateRecords([]);\r\n    setSelectedDateStr(\"\");\r\n  };\r\n\r\n  const needsItemGroupSection =\r\n    showPopup && selectedDateRecords.some((record) => record.hasCustomerProfile);\r\n\r\n  const fetchItemGroups = async () => {\r\n    setGroupsLoading(true);\r\n    setGroupsError(null);\r\n    try {\r\n      const response = await fetch(\"/api/b-item-groups\");\r\n      const result = await response.json();\r\n      if (!response.ok || result.success === false) {\r\n        throw new Error(result.error || \"ไม่พบกลุ่มบริการ\");\r\n      }\r\n      setItemGroups(Array.isArray(result.data) ? result.data : []);\r\n    } catch (error: any) {\r\n      console.error(\"Error loading item groups:\", error);\r\n      setGroupsError(error?.message || \"ไม่สามารถโหลดกลุ่มบริการได้\");\r\n    } finally {\r\n      setGroupsLoading(false);\r\n    }\r\n  };\r\n\r\n  const openGroupServiceModal = async (group: ItemGroup) => {\r\n    setSelectedGroupForServices(group);\r\n    setGroupServiceItems([]);\r\n    setServiceError(null);\r\n    setServiceModalVisible(true);\r\n    setServicesLoading(true);\r\n    try {\r\n      const response = await fetch(\r\n        `/api/b-item-services?groupCode=${encodeURIComponent(group.groupcode)}`\r\n      );\r\n      const result = await response.json();\r\n      if (!response.ok || result.success === false) {\r\n        throw new Error(result.error || \"ไม่พบรายการบริการ\");\r\n      }\r\n      setGroupServiceItems(Array.isArray(result.data) ? result.data : []);\r\n    } catch (error: any) {\r\n      console.error(\"Error loading item services:\", error);\r\n      setServiceError(error?.message || \"ไม่สามารถโหลดรายการบริการได้\");\r\n    } finally {\r\n      setServicesLoading(false);\r\n    }\r\n  };\r\n\r\n  const closeServiceModal = () => {\r\n    setServiceModalVisible(false);\r\n    setServicesLoading(false);\r\n    setGroupServiceItems([]);\r\n    setSelectedGroupForServices(null);\r\n    setServiceError(null);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!needsItemGroupSection) {\r\n      return;\r\n    }\r\n    if (itemGroups.length > 0 || groupsLoading) {\r\n      return;\r\n    }\r\n    fetchItemGroups();\r\n  }, [needsItemGroupSection, itemGroups.length, groupsLoading]);\r\n\r\n  const openNoteModal = (record: CRMRecord) => {\r\n    const noteValue = record.note?.trim();\r\n    if (!noteValue) {\r\n      return;\r\n    }\r\n    setNoteModalRecord(record);\r\n  };\r\n\r\n  const closeNoteModal = () => setNoteModalRecord(null);\r\n\r\n  const handleEmployeeFormChange = (\r\n    field: keyof HREmployee,\r\n    value: string | number | boolean\r\n  ) => {\r\n    setEmployeeForm((prev) => ({\r\n      ...prev,\r\n      [field]: value,\r\n    }));\r\n  };\r\n\r\n  const handleSaveEmployee = async () => {\r\n    try {\r\n      const response = await fetch(\"/api/hr-employees\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(employeeForm),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        alert(\"บันทึกข้อมูลพนักงานสำเร็จ!\");\r\n        setShowEmployeeForm(false);\r\n        fetchEmployees();\r\n        // Reset form\r\n        setEmployeeForm({\r\n          full_name: \"\",\r\n          role: \"\",\r\n          yearly_leave_quota: 10,\r\n          leave_remaining: 10,\r\n          work_start_time: \"08:00\",\r\n          work_end_time: \"19:00\",\r\n          is_active: true,\r\n        });\r\n      } else {\r\n        alert(\"เกิดข้อผิดพลาด: \" + data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving employee:\", error);\r\n      alert(\"เกิดข้อผิดพลาดในการบันทึกข้อมูล\");\r\n    }\r\n  };\r\n\r\n  const handleAttendanceFormChange = (\r\n    field: keyof HRAttendance,\r\n    value: string | number\r\n  ) => {\r\n    setAttendanceForm((prev) => {\r\n      const updated = {\r\n        ...prev,\r\n        [field]: value,\r\n      };\r\n\r\n      // คำนวณชั่วโมงทำงานอัตโนมัติ\r\n      if (field === \"time_in\" || field === \"time_out\") {\r\n        if (updated.time_in && updated.time_out) {\r\n          const timeIn = new Date(`2000-01-01T${updated.time_in}`);\r\n          const timeOut = new Date(`2000-01-01T${updated.time_out}`);\r\n          const diffMs = timeOut.getTime() - timeIn.getTime();\r\n          const hours = diffMs / (1000 * 60 * 60);\r\n          updated.work_hours = Math.max(0, parseFloat(hours.toFixed(2)));\r\n\r\n          // คำนวณ OT (เกิน 8 ชั่วโมง)\r\n          updated.overtime_hours = Math.max(\r\n            0,\r\n            parseFloat((hours - 8).toFixed(2))\r\n          );\r\n        }\r\n      }\r\n\r\n      return updated;\r\n    });\r\n  };\r\n\r\n  const handleDeleteAttendance = async (id: number) => {\r\n    if (!confirm(\"คุณต้องการลบข้อมูลการเข้างานนี้หรือไม่?\")) {\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const response = await fetch(`/api/hr-attendance?id=${id}`, {\r\n        method: \"DELETE\",\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        alert(\"ลบข้อมูลการเข้างานสำเร็จ!\");\r\n\r\n        // Refresh attendance data\r\n        await fetchAttendances(currentMonth2);\r\n\r\n        // Update popup if it's open\r\n        if (showAttendancePopup && selectedAttendanceDateStr) {\r\n          const updatedAttendances = attendances.filter((att) => att.id !== id);\r\n          const filtered = updatedAttendances.filter((att) => {\r\n            const attDateStr = att.work_date.split(\"T\")[0];\r\n            return attDateStr === selectedAttendanceDateStr;\r\n          });\r\n          setSelectedDateAttendances(filtered);\r\n\r\n          // Close popup if no records left\r\n          if (filtered.length === 0) {\r\n            setShowAttendancePopup(false);\r\n          }\r\n        }\r\n      } else {\r\n        alert(\"เกิดข้อผิดพลาด: \" + data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error deleting attendance:\", error);\r\n      alert(\"เกิดข้อผิดพลาดในการลบข้อมูล\");\r\n    }\r\n  };\r\n\r\n  const handleSaveAttendance = async () => {\r\n    try {\r\n      // Validate required fields\r\n      if (!attendanceForm.employee_id || attendanceForm.employee_id === 0) {\r\n        alert(\"กรุณาเลือกพนักงาน\");\r\n        return;\r\n      }\r\n\r\n      if (!attendanceForm.work_date) {\r\n        alert(\"กรุณาเลือกวันที่\");\r\n        return;\r\n      }\r\n\r\n      // Normalize work_date to YYYY-MM-DD format for comparison\r\n      const normalizedWorkDate = attendanceForm.work_date.split(\"T\")[0];\r\n\r\n      const method = \"POST\";\r\n      const url = editingAttendance\r\n        ? `/api/hr-attendance?id=${editingAttendance.id}`\r\n        : \"/api/hr-attendance\";\r\n\r\n      // When editing, send updated data (allow changing date)\r\n      const bodyData = editingAttendance\r\n        ? {\r\n          employee_id: attendanceForm.employee_id,\r\n          work_date: normalizedWorkDate,\r\n          time_in: attendanceForm.time_in,\r\n          time_out: attendanceForm.time_out,\r\n          status: attendanceForm.status,\r\n          work_hours: Number(attendanceForm.work_hours),\r\n          overtime_hours: Number(attendanceForm.overtime_hours),\r\n          note: attendanceForm.note,\r\n        }\r\n        : {\r\n          ...attendanceForm,\r\n          work_date: normalizedWorkDate,\r\n          work_hours: Number(attendanceForm.work_hours),\r\n          overtime_hours: Number(attendanceForm.overtime_hours),\r\n        };\r\n\r\n      const response = await fetch(url, {\r\n        method,\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify(bodyData),\r\n      });\r\n\r\n      const data = await response.json();\r\n\r\n      if (data.success) {\r\n        alert(\r\n          editingAttendance\r\n            ? \"แก้ไขข้อมูลการเข้างานสำเร็จ!\"\r\n            : \"บันทึกข้อมูลการเข้างานสำเร็จ!\"\r\n        );\r\n        setShowAttendanceForm(false);\r\n        setEditingAttendance(null);\r\n\r\n        // Fetch updated data\r\n        await fetchAttendances(currentMonth2);\r\n\r\n        // Update popup if it's open\r\n        if (showAttendancePopup && selectedAttendanceDateStr) {\r\n          const updatedAttendances = await fetch(\r\n            `/api/hr-attendance?month=${currentMonth2.getMonth() + 1\r\n            }&year=${currentMonth2.getFullYear()}`\r\n          ).then((res) => res.json());\r\n\r\n          if (updatedAttendances.success) {\r\n            const filtered = updatedAttendances.data.filter(\r\n              (att: HRAttendance) => {\r\n                const attDateStr = att.work_date.split(\"T\")[0];\r\n                return attDateStr === selectedAttendanceDateStr;\r\n              }\r\n            );\r\n            setSelectedDateAttendances(filtered);\r\n          }\r\n        }\r\n\r\n        // Reset form\r\n        setAttendanceForm({\r\n          employee_id: 0,\r\n          work_date: \"\",\r\n          time_in: \"08:00\",\r\n          time_out: \"17:00\",\r\n          status: \"PRESENT\",\r\n          work_hours: 8.0,\r\n          overtime_hours: 0,\r\n          note: \"\",\r\n        });\r\n      } else {\r\n        alert(\"เกิดข้อผิดพลาด: \" + data.error);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Error saving attendance:\", error);\r\n      alert(\"เกิดข้อผิดพลาดในการบันทึกข้อมูล\");\r\n    }\r\n  };\r\n\r\n  const parseAppointmentTimeValue = (value: string): number => {\r\n    const match = value.match(/(\\d{1,2}):(\\d{2})/);\r\n    if (!match) {\r\n      return Number.MAX_SAFE_INTEGER;\r\n    }\r\n    const hours = parseInt(match[1], 10);\r\n    const minutes = parseInt(match[2], 10);\r\n    return hours * 60 + minutes;\r\n  };\r\n\r\n  const parseLegacyDateValue = (value: string | null | undefined): number => {\r\n    if (!value) {\r\n      return Number.MAX_SAFE_INTEGER;\r\n    }\r\n\r\n    const timestamp = Date.parse(value);\r\n    if (!Number.isNaN(timestamp)) {\r\n      return timestamp;\r\n    }\r\n\r\n    const timeMatch = value.match(/(\\d{1,2}):(\\d{2})/);\r\n    if (timeMatch) {\r\n      return parseAppointmentTimeValue(`${timeMatch[1]}:${timeMatch[2]}`);\r\n    }\r\n\r\n    return Number.MAX_SAFE_INTEGER;\r\n  };\r\n\r\n  const sortedByAppointment = [...records].sort((a, b) =>\r\n    parseAppointmentTimeValue(a.appointmentTime) -\r\n    parseAppointmentTimeValue(b.appointmentTime)\r\n  );\r\n\r\n  const legacyRecordsSorted = [...legacyRecords].sort(\r\n    (a, b) => parseLegacyDateValue(a.start_date) - parseLegacyDateValue(b.start_date)\r\n  );\r\n\r\n  const legacySelectedDate = startDate && startDate.trim() ? startDate : getLocalDateString();\r\n  const legacySelectedDateLabel = (() => {\r\n    if (!legacySelectedDate) {\r\n      return \"\";\r\n    }\r\n\r\n    const [year, month, day] = legacySelectedDate.split(\"-\").map(Number);\r\n    if (!year || !month || !day) {\r\n      return legacySelectedDate;\r\n    }\r\n\r\n    const parsed = new Date(year, month - 1, day);\r\n    if (Number.isNaN(parsed.getTime())) {\r\n      return legacySelectedDate;\r\n    }\r\n\r\n    return parsed.toLocaleDateString(\"th-TH\", {\r\n      day: \"numeric\",\r\n      month: \"long\",\r\n      year: \"numeric\",\r\n    });\r\n  })();\r\n\r\n  // ดึงข้อมูลการเข้างานของวันที่เลือก\r\n  const getAttendancesForDate = (dateStr: string) => {\r\n    const filtered = attendances.filter((att) => {\r\n      // แปลง work_date ให้เป็นรูปแบบ YYYY-MM-DD โดยใช้ UTC\r\n      const workDateStr = att.work_date.split(\"T\")[0];\r\n      return workDateStr === dateStr;\r\n    });\r\n    console.log(`Attendances for ${dateStr}:`, filtered);\r\n    return filtered;\r\n  };\r\n\r\n  const getDayColor = (dateStr: string) => {\r\n    // สร้าง Date object แบบ local time เพื่อหลีกเลี่ยงปัญหา timezone\r\n    const [year, month, day] = dateStr.split(\"-\").map(Number);\r\n    const date = new Date(year, month - 1, day);\r\n    const dayOfWeek = date.getDay();\r\n\r\n    // สีประจำวัน (ตามความเชื่อไทย)\r\n    const dayColors = {\r\n      0: {\r\n        bg: \"bg-red-400/30\",\r\n        border: \"border-red-400\",\r\n        text: \"text-red-200\",\r\n      }, // อาทิตย์ - แดง\r\n      1: {\r\n        bg: \"bg-yellow-400/30\",\r\n        border: \"border-yellow-400\",\r\n        text: \"text-yellow-200\",\r\n      }, // จันทร์ - เหลือง\r\n      2: {\r\n        bg: \"bg-pink-400/30\",\r\n        border: \"border-pink-400\",\r\n        text: \"text-pink-200\",\r\n      }, // อังคาร - ชมพู\r\n      3: {\r\n        bg: \"bg-green-400/30\",\r\n        border: \"border-green-400\",\r\n        text: \"text-green-200\",\r\n      }, // พุธ - เขียว\r\n      4: {\r\n        bg: \"bg-orange-400/30\",\r\n        border: \"border-orange-400\",\r\n        text: \"text-orange-200\",\r\n      }, // พฤหัสบดี - ส้ม\r\n      5: {\r\n        bg: \"bg-blue-400/30\",\r\n        border: \"border-blue-400\",\r\n        text: \"text-blue-200\",\r\n      }, // ศุกร์ - ฟ้า\r\n      6: {\r\n        bg: \"bg-purple-400/30\",\r\n        border: \"border-purple-400\",\r\n        text: \"text-purple-200\",\r\n      }, // เสาร์ - ม่วง\r\n    };\r\n\r\n    return dayColors[dayOfWeek as keyof typeof dayColors];\r\n  };\r\n\r\n  const renderCalendar = () => {\r\n    const { daysInMonth, startingDayOfWeek, year, month } =\r\n      getDaysInMonth(currentMonth);\r\n    const days = [];\r\n    const today = getLocalDateString();\r\n\r\n    // Empty cells for days before the first day of the month\r\n    for (let i = 0; i < startingDayOfWeek; i++) {\r\n      days.push(<div key={`empty-${i}`} className=\"min-h-[80px] sm:min-h-[100px] border-b border-r border-gray-700\"></div>);\r\n    }\r\n\r\n    // Days of the month\r\n    for (let day = 1; day <= daysInMonth; day++) {\r\n      const dateStr = `${year}-${String(month + 1).padStart(2, \"0\")}-${String(\r\n        day\r\n      ).padStart(2, \"0\")}`;\r\n      const dayRecords = getRecordsForDate(dateStr);\r\n      const isToday = dateStr === today;\r\n      const isSelected = dateStr === selectedDate;\r\n      const hasRecords = dayRecords.length > 0;\r\n      const dayOfWeek = new Date(year, month, day).getDay();\r\n      const isSunday = dayOfWeek === 0;\r\n      const hasStarredRecords = dayRecords.some(r => r.star_flag);\r\n\r\n      days.push(\r\n        <div\r\n          key={day}\r\n          onClick={() => handleDateClick(dateStr)}\r\n          className={`\r\n            min-h-[80px] sm:min-h-[100px] p-1 border-b border-r border-gray-700 cursor-pointer transition-all\r\n            ${isToday ? \"bg-gray-800\" : \"\"}\r\n            ${isSelected ? \"bg-blue-900/50\" : \"\"}\r\n            hover:bg-gray-800/50\r\n          `}\r\n        >\r\n          <div className=\"flex items-center justify-between mb-1\">\r\n            <div className={`text-xs sm:text-sm font-medium ${isSunday ? \"text-red-400\" : \"text-gray-300\"} ${isToday ? \"bg-white text-black rounded-full w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center\" : \"\"}`}>\r\n              {day}\r\n            </div>\r\n            {hasStarredRecords && (\r\n              <svg className=\"w-3 h-3 sm:w-4 sm:h-4 text-yellow-400 fill-current\" viewBox=\"0 0 24 24\">\r\n                <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" />\r\n              </svg>\r\n            )}\r\n          </div>\r\n          {hasRecords && (\r\n            <div className=\"space-y-0.5\">\r\n              {dayRecords.slice(0, 3).map((record) => (\r\n                <button\r\n                  key={record.id}\r\n                  type=\"button\"\r\n                  onClick={(event) => {\r\n                    event.stopPropagation();\r\n                    openCustomerModal(record);\r\n                  }}\r\n                  className=\"w-full flex items-center gap-0.5 truncate rounded-sm bg-emerald-600 px-1 py-0.5 text-left text-[8px] sm:text-[10px] text-white font-medium hover:bg-emerald-500 transition\"\r\n                  title={`${record.customer_name} - ${record.status}`}\r\n                >\r\n                  {record.star_flag && (\r\n                    <svg className=\"w-2 h-2 sm:w-2.5 sm:h-2.5 text-yellow-300 fill-current flex-shrink-0\" viewBox=\"0 0 24 24\">\r\n                      <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" />\r\n                    </svg>\r\n                  )}\r\n                  <span className=\"truncate\">{record.customer_name}</span>\r\n                </button>\r\n              ))}\r\n              {dayRecords.length > 3 && (\r\n                <div className=\"text-[8px] sm:text-[10px] text-gray-400 pl-1\">\r\n                  +{dayRecords.length - 3} เพิ่มเติม\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return days;\r\n  };\r\n\r\n  // Render Calendar 2 (สำหรับตารางเข้างาน)\r\n  const renderCalendar2 = () => {\r\n    const year = currentMonth2.getFullYear();\r\n    const month = currentMonth2.getMonth(); // 0-11\r\n\r\n    // คำนวณจำนวนวันในเดือน\r\n    const firstDay = new Date(year, month, 1);\r\n    const lastDay = new Date(year, month + 1, 0);\r\n    const daysInMonth = lastDay.getDate();\r\n    const startingDayOfWeek = firstDay.getDay(); // 0 = Sunday\r\n\r\n    const days = [];\r\n    const today = getLocalDateString();\r\n\r\n    // Empty cells for days before the first day of the month\r\n    for (let i = 0; i < startingDayOfWeek; i++) {\r\n      days.push(<div key={`empty-${i}`} className=\"min-h-[80px] sm:min-h-[100px] border-b border-r border-gray-700\"></div>);\r\n    }\r\n\r\n    // Days of the month\r\n    for (let day = 1; day <= daysInMonth; day++) {\r\n      const dateStr = `${year}-${String(month + 1).padStart(2, \"0\")}-${String(\r\n        day\r\n      ).padStart(2, \"0\")}`;\r\n      const dayAttendances = getAttendancesForDate(dateStr);\r\n      const isToday = dateStr === today;\r\n      const isSelected = dateStr === selectedDate;\r\n      const hasAttendances = dayAttendances.length > 0;\r\n      const dayOfWeek = new Date(year, month, day).getDay();\r\n      const isSunday = dayOfWeek === 0;\r\n\r\n      days.push(\r\n        <div\r\n          key={day}\r\n          onClick={() => {\r\n            setSelectedDate(dateStr);\r\n            if (hasAttendances) {\r\n              setSelectedDateAttendances(dayAttendances);\r\n              setSelectedAttendanceDateStr(dateStr);\r\n              setShowAttendancePopup(true);\r\n            } else {\r\n              // Open form to add new attendance\r\n              setEditingAttendance(null);\r\n              setAttendanceForm({\r\n                employee_id: 0,\r\n                work_date: dateStr,\r\n                time_in: \"08:00\",\r\n                time_out: \"17:00\",\r\n                status: \"PRESENT\",\r\n                work_hours: 8.0,\r\n                overtime_hours: 0,\r\n                note: \"\",\r\n              });\r\n              setShowAttendanceForm(true);\r\n            }\r\n          }}\r\n          className={`\r\n            min-h-[80px] sm:min-h-[100px] p-1 border-b border-r border-gray-700 cursor-pointer transition-all\r\n            ${isToday ? \"bg-gray-800\" : \"\"}\r\n            ${isSelected ? \"bg-teal-900/50\" : \"\"}\r\n            hover:bg-gray-800/50\r\n          `}\r\n        >\r\n          <div className={`text-xs sm:text-sm font-medium mb-1 ${isSunday ? \"text-red-400\" : \"text-gray-300\"} ${isToday ? \"bg-white text-black rounded-full w-5 h-5 sm:w-6 sm:h-6 flex items-center justify-center\" : \"\"}`}>\r\n            {day}\r\n          </div>\r\n          {hasAttendances ? (\r\n            <div className=\"space-y-0.5\">\r\n              <div className=\"text-[8px] sm:text-[10px] bg-teal-500 text-white px-1 py-0.5 rounded-sm font-bold text-center\">\r\n                {dayAttendances.length} คน\r\n              </div>\r\n              {dayAttendances.slice(0, 2).map((att) => {\r\n                const statusColors: Record<string, string> = {\r\n                  PRESENT: \"bg-green-500\",\r\n                  LATE: \"bg-yellow-500\",\r\n                  LEAVE: \"bg-blue-500\",\r\n                  ABSENT: \"bg-red-500\",\r\n                  WFH: \"bg-purple-500\",\r\n                };\r\n                return (\r\n                  <div\r\n                    key={att.id}\r\n                    className={`${statusColors[att.status] || \"bg-gray-500\"} rounded-sm px-1 py-0.5 text-[8px] sm:text-[10px] text-white font-medium truncate`}\r\n                    title={`${att.employee_name} - ${att.status}`}\r\n                  >\r\n                    {att.employee_name}\r\n                  </div>\r\n                );\r\n              })}\r\n              {dayAttendances.length > 2 && (\r\n                <div className=\"text-[8px] sm:text-[10px] text-gray-400 pl-1\">\r\n                  +{dayAttendances.length - 2} คน\r\n                </div>\r\n              )}\r\n            </div>\r\n          ) : (\r\n            <div className=\"text-[8px] sm:text-[10px] text-gray-500 text-center mt-2\">\r\n              คลิกเพื่อเพิ่มข้อมูล\r\n            </div>\r\n          )}\r\n        </div>\r\n      );\r\n    }\r\n\r\n    return days;\r\n  };\r\n\r\n  return (\r\n    <div className=\"min-h-screen h-full w-full bg-gradient-to-br from-blue-500 via-blue-600 to-indigo-700 p-0 m-0\">\r\n      {/* Top Bar - Back Button and View Mode Toggle */}\r\n      <div className=\"px-3 sm:px-8 py-3 sm:py-4\">\r\n        <div className=\"flex items-center justify-between gap-2\">\r\n          {/* Left Side - Back Button */}\r\n          <button\r\n            onClick={() => router.push(\"/home\")}\r\n            className=\"flex items-center justify-center w-10 h-10 sm:w-12 sm:h-12 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-lg transition-all shadow-lg hover:shadow-xl\"\r\n            aria-label=\"กลับไปหน้าหลัก\"\r\n          >\r\n            <svg\r\n              className=\"w-5 h-5 sm:w-6 sm:h-6\"\r\n              fill=\"none\"\r\n              stroke=\"currentColor\"\r\n              viewBox=\"0 0 24 24\"\r\n            >\r\n              <path\r\n                strokeLinecap=\"round\"\r\n                strokeLinejoin=\"round\"\r\n                strokeWidth={2}\r\n                d=\"M10 19l-7-7m0 0l7-7m-7 7h18\"\r\n              />\r\n            </svg>\r\n          </button>\r\n\r\n          {/* Right Side - View Mode Toggle */}\r\n          <div className=\"flex gap-1 sm:gap-2\">\r\n            <button\r\n              onClick={() => setViewMode(\"table\")}\r\n              className={`px-2 sm:px-4 py-2 rounded-lg transition-all shadow-lg font-medium flex flex-col sm:flex-row items-center gap-0.5 sm:gap-2 text-[10px] sm:text-sm ${viewMode === \"table\"\r\n                ? \"bg-gradient-to-r from-blue-500 to-indigo-600 text-white\"\r\n                : \"bg-white/20 text-white hover:bg-white/30\"\r\n                }`}\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4 sm:w-5 sm:h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M3 10h18M3 14h18m-9-4v8m-7 0h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">ตาราง</span>\r\n            </button>\r\n            <button\r\n              onClick={() => setViewMode(\"calendar\")}\r\n              className={`px-2 sm:px-4 py-2 rounded-lg transition-all shadow-lg font-medium flex flex-col sm:flex-row items-center gap-0.5 sm:gap-2 text-[10px] sm:text-sm ${viewMode === \"calendar\"\r\n                ? \"bg-gradient-to-r from-purple-500 to-pink-600 text-white\"\r\n                : \"bg-white/20 text-white hover:bg-white/30\"\r\n                }`}\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4 sm:w-5 sm:h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">ปฏิทิน</span>\r\n            </button>\r\n            <button\r\n              onClick={() => setViewMode(\"calendar2\")}\r\n              className={`px-2 sm:px-4 py-2 rounded-lg transition-all shadow-lg font-medium flex flex-col sm:flex-row items-center gap-0.5 sm:gap-2 text-[10px] sm:text-sm ${viewMode === \"calendar2\"\r\n                ? \"bg-gradient-to-r from-emerald-500 to-teal-600 text-white\"\r\n                : \"bg-white/20 text-white hover:bg-white/30\"\r\n                }`}\r\n            >\r\n              <svg\r\n                className=\"w-4 h-4 sm:w-5 sm:h-5\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n                />\r\n              </svg>\r\n              <span className=\"hidden sm:inline\">เข้างาน</span>\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      {/* Loading and Error States */}\r\n      {loading && (\r\n        <div className=\"flex justify-center items-center py-12\">\r\n          <div className=\"bg-white/20 backdrop-blur-md rounded-2xl p-8 shadow-2xl\">\r\n            <div className=\"flex items-center gap-4\">\r\n              <svg\r\n                className=\"animate-spin h-8 w-8 text-white\"\r\n                xmlns=\"http://www.w3.org/2000/svg\"\r\n                fill=\"none\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <circle\r\n                  className=\"opacity-25\"\r\n                  cx=\"12\"\r\n                  cy=\"12\"\r\n                  r=\"10\"\r\n                  stroke=\"currentColor\"\r\n                  strokeWidth=\"4\"\r\n                ></circle>\r\n                <path\r\n                  className=\"opacity-75\"\r\n                  fill=\"currentColor\"\r\n                  d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n                ></path>\r\n              </svg>\r\n              <span className=\"text-white font-bold text-lg\">\r\n                กำลังโหลดข้อมูล...\r\n              </span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {error && (\r\n        <div className=\"px-8 pb-4\">\r\n          <div className=\"bg-red-500/20 backdrop-blur-md border-2 border-red-400 rounded-2xl p-6 shadow-2xl\">\r\n            <div className=\"flex items-center gap-3\">\r\n              <svg\r\n                className=\"w-8 h-8 text-red-300\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                />\r\n              </svg>\r\n              <div>\r\n                <h4 className=\"text-white font-bold text-lg\">เกิดข้อผิดพลาด</h4>\r\n                <p className=\"text-red-100\">{error}</p>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Info Cards */}\r\n      {/* <div className=\"grid grid-cols-1 md:grid-cols-3 gap-8 mt-0 mb-0 px-6 py-8\">\r\n        <div className=\"bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl shadow-2xl p-8 transform hover:scale-105 transition-all duration-300 hover:shadow-3xl\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h3 className=\"text-xl font-bold text-white\">📅 นัดหมายวันนี้</h3>\r\n            <div className=\"bg-white/20 backdrop-blur-sm p-3 rounded-xl\">\r\n              <svg\r\n                className=\"w-8 h-8 text-white\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n          <p className=\"text-5xl font-extrabold text-white mb-2\">\r\n            {records.length}\r\n          </p>\r\n          <p className=\"text-blue-100 font-medium\">รายการทั้งหมด</p>\r\n        </div>\r\n\r\n        <div className=\"bg-gradient-to-br from-emerald-500 to-teal-600 rounded-2xl shadow-2xl p-8 transform hover:scale-105 transition-all duration-300 hover:shadow-3xl\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h3 className=\"text-xl font-bold text-white\">✅ สถานะดำเนินการ</h3>\r\n            <div className=\"bg-white/20 backdrop-blur-sm p-3 rounded-xl\">\r\n              <svg\r\n                className=\"w-8 h-8 text-white\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\"\r\n                />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n          <p className=\"text-5xl font-extrabold text-white mb-2\">\r\n            {records.filter((r) => r.status).length}\r\n          </p>\r\n          <p className=\"text-emerald-100 font-medium\">รายการที่มีสถานะ</p>\r\n        </div>\r\n\r\n        <div className=\"bg-gradient-to-br from-purple-500 to-pink-600 rounded-2xl shadow-2xl p-8 transform hover:scale-105 transition-all duration-300 hover:shadow-3xl\">\r\n          <div className=\"flex items-center justify-between mb-4\">\r\n            <h3 className=\"text-xl font-bold text-white\">🔔 ต้องติดตาม</h3>\r\n            <div className=\"bg-white/20 backdrop-blur-sm p-3 rounded-xl\">\r\n              <svg\r\n                className=\"w-8 h-8 text-white\"\r\n                fill=\"none\"\r\n                stroke=\"currentColor\"\r\n                viewBox=\"0 0 24 24\"\r\n              >\r\n                <path\r\n                  strokeLinecap=\"round\"\r\n                  strokeLinejoin=\"round\"\r\n                  strokeWidth={2}\r\n                  d=\"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9\"\r\n                />\r\n              </svg>\r\n            </div>\r\n          </div>\r\n          <p className=\"text-5xl font-extrabold text-white mb-2\">\r\n            {records.filter((r) => r.star_flag).length}\r\n          </p>\r\n          <p className=\"text-purple-100 font-medium\">รายการที่ต้องติดตาม</p>\r\n        </div>\r\n      </div> */}\r\n      {/* Main Content */}\r\n      <div className=\"w-full h-full m-0 p-0\">\r\n        <div className=\"w-full overflow-hidden\">\r\n          {/* Calendar View */}\r\n          {viewMode === \"calendar\" && (\r\n            <div className=\"px-2 sm:px-8 pb-8\">\r\n              <div className=\"bg-black/90 backdrop-blur-md rounded-lg sm:rounded-2xl overflow-hidden shadow-2xl\">\r\n                {/* Calendar Header */}\r\n                <div className=\"flex items-center justify-between px-3 sm:px-6 py-3 sm:py-4 border-b border-gray-700\">\r\n                  <button\r\n                    onClick={handlePrevMonth}\r\n                    className=\"p-1 sm:p-2 hover:bg-gray-800 rounded-full transition-all\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-300\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M15 19l-7-7 7-7\"\r\n                      />\r\n                    </svg>\r\n                  </button>\r\n                  <div className=\"text-center\">\r\n                    <h2 className=\"text-lg sm:text-2xl font-bold text-white\">\r\n                      {currentMonth.toLocaleDateString(\"th-TH\", {\r\n                        year: \"numeric\",\r\n                        month: \"short\",\r\n                      }).replace(\" \", \".\")}\r\n                    </h2>\r\n                  </div>\r\n                  <button\r\n                    onClick={handleNextMonth}\r\n                    className=\"p-1 sm:p-2 hover:bg-gray-800 rounded-full transition-all\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-300\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M9 5l7 7-7 7\"\r\n                      />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Calendar Grid */}\r\n                <div className=\"grid grid-cols-7\">\r\n                  {/* Day Headers */}\r\n                  {[\"อา.\", \"จ.\", \"อ.\", \"พ.\", \"พฤ.\", \"ศ.\", \"ส.\"].map((day, index) => (\r\n                    <div\r\n                      key={day}\r\n                      className={`text-center text-[10px] sm:text-xs font-medium py-2 border-b border-r border-gray-700 ${index === 0 ? \"text-red-400\" : \"text-gray-400\"}`}\r\n                    >\r\n                      {day}\r\n                    </div>\r\n                  ))}\r\n\r\n                  {/* Calendar Days */}\r\n                  {renderCalendar()}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {/* Calendar View 2 */}\r\n          {viewMode === \"calendar2\" && (\r\n            <div className=\"px-2 sm:px-8 pb-8\">\r\n              {/* ปุ่มเพิ่มพนักงานและบันทึกการเข้างาน */}\r\n              <div className=\"mb-4 flex justify-end gap-3\">\r\n                <button\r\n                  onClick={() => {\r\n                    setEditingAttendance(null);\r\n                    // ใช้ local time สำหรับวันที่ปัจจุบัน\r\n                    const now = new Date();\r\n                    const todayStr = `${now.getFullYear()}-${String(\r\n                      now.getMonth() + 1\r\n                    ).padStart(2, \"0\")}-${String(now.getDate()).padStart(\r\n                      2,\r\n                      \"0\"\r\n                    )}`;\r\n                    const newForm = {\r\n                      employee_id: 0,\r\n                      work_date: todayStr,\r\n                      time_in: \"08:00\",\r\n                      time_out: \"17:00\",\r\n                      status: \"PRESENT\",\r\n                      work_hours: 8.0,\r\n                      overtime_hours: 0,\r\n                      note: \"\",\r\n                    };\r\n                    setAttendanceForm(newForm);\r\n                    setShowAttendanceForm(true);\r\n                  }}\r\n                  className=\"px-4 sm:px-6 py-2 sm:py-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg transition-all shadow-lg font-bold flex items-center gap-2 text-xs sm:text-sm\"\r\n                >\r\n                  <svg\r\n                    className=\"w-4 h-4 sm:w-5 sm:h-5\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4\"\r\n                    />\r\n                  </svg>\r\n                  บันทึกการเข้างาน\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"bg-black/90 backdrop-blur-md rounded-lg sm:rounded-2xl overflow-hidden shadow-2xl\">\r\n                {/* Calendar Header */}\r\n                <div className=\"flex items-center justify-between px-3 sm:px-6 py-3 sm:py-4 border-b border-gray-700\">\r\n                  <button\r\n                    onClick={handlePrevMonth2}\r\n                    className=\"p-1 sm:p-2 hover:bg-gray-800 rounded-full transition-all\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-300\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M15 19l-7-7 7-7\"\r\n                      />\r\n                    </svg>\r\n                  </button>\r\n                  <div className=\"text-center\">\r\n                    <h2 className=\"text-lg sm:text-2xl font-bold text-white\">\r\n                      {currentMonth2.toLocaleDateString(\"th-TH\", {\r\n                        year: \"numeric\",\r\n                        month: \"short\",\r\n                      }).replace(\" \", \".\")}\r\n                    </h2>\r\n                  </div>\r\n                  <button\r\n                    onClick={handleNextMonth2}\r\n                    className=\"p-1 sm:p-2 hover:bg-gray-800 rounded-full transition-all\"\r\n                  >\r\n                    <svg\r\n                      className=\"w-5 h-5 sm:w-6 sm:h-6 text-gray-300\"\r\n                      fill=\"none\"\r\n                      stroke=\"currentColor\"\r\n                      viewBox=\"0 0 24 24\"\r\n                    >\r\n                      <path\r\n                        strokeLinecap=\"round\"\r\n                        strokeLinejoin=\"round\"\r\n                        strokeWidth={2}\r\n                        d=\"M9 5l7 7-7 7\"\r\n                      />\r\n                    </svg>\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Calendar Grid */}\r\n                <div className=\"grid grid-cols-7\">\r\n                  {/* Day Headers */}\r\n                  {[\"อา.\", \"จ.\", \"อ.\", \"พ.\", \"พฤ.\", \"ศ.\", \"ส.\"].map((day, index) => (\r\n                    <div\r\n                      key={day}\r\n                      className={`text-center text-[10px] sm:text-xs font-medium py-2 border-b border-r border-gray-700 ${index === 0 ? \"text-red-400\" : \"text-gray-400\"}`}\r\n                    >\r\n                      {day}\r\n                    </div>\r\n                  ))}\r\n\r\n                  {/* Calendar Days */}\r\n                  {renderCalendar2()}\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {/* Table Container */}\r\n          {viewMode === \"table\" && (\r\n            <div className=\"space-y-3 sm:space-y-5 px-2 sm:px-0\">\r\n              {/* Date Filter Row */}\r\n              <div className=\"flex justify-center\">\r\n                <div className=\"relative\">\r\n                  <input\r\n                    type=\"date\"\r\n                    value={startDate}\r\n                    onChange={(e) => setStartDate(e.target.value)}\r\n                    className=\"absolute inset-0 w-full h-full opacity-0 cursor-pointer\"\r\n                  />\r\n                  <div className=\"px-3 sm:px-4 py-2 rounded-lg bg-white/90 text-gray-800 font-medium text-sm sm:text-base flex items-center gap-2 pointer-events-none\">\r\n                    <span>\r\n                      {startDate ? (() => {\r\n                        const [year, month, day] = startDate.split(\"-\");\r\n                        return `${day}/${month}/${year}`;\r\n                      })() : \"เลือกวันที่\"}\r\n                    </span>\r\n                    <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-600\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\" />\r\n                    </svg>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Customer Segment Buttons Row */}\r\n              <div className=\"flex gap-2 sm:gap-3 justify-center\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setCustomerSegment(\"new\")}\r\n                  className={`rounded-full px-4 sm:px-6 py-2 text-xs sm:text-sm font-semibold uppercase tracking-wide transition ${customerSegment === \"new\"\r\n                    ? \"bg-white text-blue-700 shadow-lg\"\r\n                    : \"bg-white/40 text-white border border-white/40\"\r\n                    }`}\r\n                >\r\n                  ลูกค้าใหม่\r\n                </button>\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={() => setCustomerSegment(\"old\")}\r\n                  className={`rounded-full px-4 sm:px-6 py-2 text-xs sm:text-sm font-semibold uppercase tracking-wide transition ${customerSegment === \"old\"\r\n                    ? \"bg-slate-50 text-slate-900 shadow-lg\"\r\n                    : \"bg-white/20 text-white border border-white/30\"\r\n                    }`}\r\n                >\r\n                  ลูกค้าเก่า\r\n                </button>\r\n              </div>\r\n              {customerSegment === \"new\" ? (\r\n                <div className=\"overflow-x-auto w-full rounded-2xl sm:rounded-3xl border border-white/30 shadow-2xl transition bg-white\">\r\n                  {!loading && sortedByAppointment.length === 0 ? (\r\n                    <div className=\"flex justify-center items-center py-8 sm:py-12\">\r\n                      <div className=\"bg-white/20 backdrop-blur-md rounded-2xl p-4 sm:p-8 shadow-2xl text-center\">\r\n                        <svg\r\n                          className=\"w-12 h-12 sm:w-16 sm:h-16 text-white/50 mx-auto mb-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4\"\r\n                          />\r\n                        </svg>\r\n                        <h3 className=\"text-white font-bold text-lg sm:text-xl mb-2\">\r\n                          ไม่พบข้อมูล\r\n                        </h3>\r\n                        <p className=\"text-white/80 text-sm sm:text-base\">\r\n                          ไม่มีรายการนัดหมายในช่วงเวลาที่เลือก\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <div className=\"divide-y divide-gray-200\">\r\n                      {/* Table Header */}\r\n                      <div className=\"bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 grid grid-cols-7 sm:grid-cols-11 gap-0\">\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          เวลา\r\n                        </div>\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          สถานะ\r\n                        </div>\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          ชื่อ\r\n                        </div>\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          เบอร์โทร\r\n                        </div>\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          ผลิตภัณฑ์\r\n                        </div>\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          หมอ\r\n                        </div>\r\n                        <div className=\"hidden sm:block px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          ผู้ติดต่อ\r\n                        </div>\r\n                        <div className=\"px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20 sm:border-r\">\r\n                          ยอด\r\n                        </div>\r\n                        <div className=\"hidden sm:block px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          ดาว\r\n                        </div>\r\n                        <div className=\"hidden sm:block px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white border-r border-white/20\">\r\n                          ประเทศ\r\n                        </div>\r\n                        <div className=\"hidden sm:block px-1 py-2 sm:py-3 text-center text-[8px] sm:text-xs font-bold text-white\">\r\n                          หมายเหตุ\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Table Rows */}\r\n                      {sortedByAppointment.map((record, index) => (\r\n                        <div key={record.id}>\r\n                          {/* Main Row - Clickable */}\r\n                          <div\r\n                            onClick={() => setExpandedRowId(expandedRowId === record.id ? null : record.id)}\r\n                            className={`grid grid-cols-7 sm:grid-cols-11 gap-0 cursor-pointer ${index % 2 === 0\r\n                              ? \"bg-gradient-to-r from-slate-50 to-blue-50\"\r\n                              : \"bg-gradient-to-r from-blue-100 to-indigo-100\"\r\n                              } hover:bg-gradient-to-r hover:from-blue-200 hover:to-indigo-200 transition-all duration-200`}\r\n                          >\r\n                            <div className=\"px-1 py-2 sm:py-3 text-[8px] sm:text-sm text-gray-800 border-r border-gray-200 text-center flex items-center justify-center\">\r\n                              {formatTimeDisplay(record.appointmentTime)}\r\n                            </div>\r\n                            <div className=\"px-0.5 py-1 sm:py-2 text-[8px] sm:text-sm text-gray-800 border-r border-gray-200 text-center flex flex-col items-center justify-center\">\r\n                              <span className=\"inline-block px-0.5 sm:px-2 py-0.5 sm:py-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-full text-[6px] sm:text-xs font-bold shadow\">\r\n                                {record.status}\r\n                              </span>\r\n                              {record.status.trim() === \"นัดพร้อมทำ\" && record.hasCustomerProfile && (\r\n                                <span className=\"mt-0.5 inline-block rounded-full bg-emerald-500/90 text-white text-[5px] sm:text-[10px] font-semibold px-0.5 sm:px-2 py-0.5\">\r\n                                  OPD\r\n                                </span>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"px-0.5 py-2 sm:py-3 text-[8px] sm:text-sm text-gray-800 border-r border-gray-200 text-center flex items-center justify-center\">\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={(e) => { e.stopPropagation(); openCustomerModal(record); }}\r\n                                className=\"font-semibold text-blue-600 hover:underline text-[8px] sm:text-sm truncate max-w-full\"\r\n                              >\r\n                                {record.customer_name}\r\n                              </button>\r\n                            </div>\r\n                            <div className=\"px-0.5 py-2 sm:py-3 text-[7px] sm:text-sm text-gray-800 border-r border-gray-200 text-center flex items-center justify-center\">\r\n                              {record.phone}\r\n                            </div>\r\n                            <div className=\"px-0.5 py-2 sm:py-3 text-[7px] sm:text-sm text-gray-800 border-r border-gray-200 text-center flex items-center justify-center truncate\">\r\n                              {record.interested_product}\r\n                            </div>\r\n                            <div className=\"px-0.5 py-2 sm:py-3 text-[7px] sm:text-sm text-gray-800 border-r border-gray-200 font-medium text-center flex items-center justify-center truncate\">\r\n                              {record.doctor}\r\n                            </div>\r\n                            <div className=\"hidden sm:flex px-0.5 py-2 sm:py-3 text-[7px] sm:text-sm text-gray-800 border-r border-gray-200 text-center items-center justify-center truncate\">\r\n                              {record.contact_staff}\r\n                            </div>\r\n                            <div className=\"px-0.5 py-2 sm:py-3 text-[7px] sm:text-sm text-gray-800 border-r border-gray-200 sm:border-r text-center flex items-center justify-center\">\r\n                              {record.proposed_amount.toLocaleString()}\r\n                            </div>\r\n                            <div className=\"hidden sm:flex px-1 py-2 sm:py-3 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center items-center justify-center\">\r\n                              {record.star_flag ? (\r\n                                <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-yellow-500 fill-current\" viewBox=\"0 0 24 24\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" /></svg>\r\n                              ) : (\r\n                                <svg className=\"w-4 h-4 sm:w-5 sm:h-5 text-gray-300\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\" /></svg>\r\n                              )}\r\n                            </div>\r\n                            <div className=\"hidden sm:flex px-1 py-2 sm:py-3 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center items-center justify-center\">\r\n                              {record.country || \"-\"}\r\n                            </div>\r\n                            <div className=\"hidden sm:flex px-1 py-2 sm:py-3 text-xs sm:text-sm text-gray-800 text-center items-center justify-center\">\r\n                              {record.note ? (\r\n                                <button\r\n                                  type=\"button\"\r\n                                  onClick={(e) => { e.stopPropagation(); openNoteModal(record); }}\r\n                                  className=\"text-blue-600 hover:underline text-xs truncate max-w-[80px]\"\r\n                                >\r\n                                  ดูหมายเหตุ\r\n                                </button>\r\n                              ) : \"-\"}\r\n                            </div>\r\n                          </div>\r\n\r\n                          {/* Expanded Details - Mobile Only */}\r\n                          {expandedRowId === record.id && (\r\n                            <div className=\"sm:hidden bg-gradient-to-r from-indigo-50 to-purple-50 px-3 py-3 border-t border-indigo-200\">\r\n                              <div className=\"grid grid-cols-4 gap-2 text-xs\">\r\n                                <div>\r\n                                  <span className=\"font-semibold text-gray-600\">ผู้ติดต่อ:</span>\r\n                                  <p className=\"text-gray-800 truncate\">{record.contact_staff || \"-\"}</p>\r\n                                </div>\r\n                                <div>\r\n                                  <span className=\"font-semibold text-gray-600\">ติดดาว:</span>\r\n                                  <p className=\"text-gray-800 flex items-center gap-1\">\r\n                                    {record.star_flag ? (\r\n                                      <><svg className=\"w-4 h-4 text-yellow-500 fill-current\" viewBox=\"0 0 24 24\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" /></svg> ใช่</>\r\n                                    ) : \"ไม่\"}\r\n                                  </p>\r\n                                </div>\r\n                                <div>\r\n                                  <span className=\"font-semibold text-gray-600\">ประเทศ:</span>\r\n                                  <p className=\"text-gray-800\">{record.country || \"-\"}</p>\r\n                                </div>\r\n                                <div>\r\n                                  <span className=\"font-semibold text-gray-600\">หมายเหตุ:</span>\r\n                                  <p className=\"text-gray-800\">\r\n                                    {record.note ? (\r\n                                      <button\r\n                                        type=\"button\"\r\n                                        onClick={(e) => { e.stopPropagation(); openNoteModal(record); }}\r\n                                        className=\"text-blue-600 hover:underline text-left\"\r\n                                      >\r\n                                        {getNotePreview(record.note)}\r\n                                      </button>\r\n                                    ) : \"-\"}\r\n                                  </p>\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ) : (\r\n                <div className=\"overflow-x-auto w-full rounded-2xl sm:rounded-3xl border border-white/30 shadow-2xl transition bg-slate-50\">\r\n                  <div className=\"flex flex-wrap items-center justify-between gap-2 sm:gap-4 px-3 sm:px-6 pt-4 sm:pt-6 pb-2 text-slate-700\">\r\n                    <div className=\"font-semibold text-xs sm:text-base\">\r\n                      ข้อมูลลูกค้าเก่าวันที่ {legacySelectedDateLabel || legacySelectedDate}\r\n                    </div>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => fetchLegacyAppointments(legacySelectedDate)}\r\n                      className=\"inline-flex items-center gap-1 sm:gap-2 px-2 sm:px-4 py-1 sm:py-2 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-lg shadow hover:from-purple-600 hover:to-indigo-600 transition text-xs sm:text-sm\"\r\n                    >\r\n                      <svg\r\n                        className=\"w-3 h-3 sm:w-4 sm:h-4\"\r\n                        fill=\"none\"\r\n                        stroke=\"currentColor\"\r\n                        viewBox=\"0 0 24 24\"\r\n                      >\r\n                        <path\r\n                          strokeLinecap=\"round\"\r\n                          strokeLinejoin=\"round\"\r\n                          strokeWidth={2}\r\n                          d=\"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15\"\r\n                        />\r\n                      </svg>\r\n                      รีโหลด\r\n                    </button>\r\n                  </div>\r\n\r\n                  {legacyError && (\r\n                    <div className=\"bg-red-500/10 border border-red-200 text-red-700 rounded-xl sm:rounded-2xl px-3 sm:px-6 py-3 sm:py-4 m-3 sm:m-6 flex flex-wrap items-center justify-between gap-2 sm:gap-4\">\r\n                      <span className=\"font-medium text-xs sm:text-sm\">{legacyError}</span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => fetchLegacyAppointments(legacySelectedDate)}\r\n                        className=\"px-3 sm:px-4 py-1 sm:py-2 bg-red-500 text-white rounded-lg shadow hover:bg-red-600 transition text-xs sm:text-sm\"\r\n                      >\r\n                        ลองอีกครั้ง\r\n                      </button>\r\n                    </div>\r\n                  )}\r\n\r\n                  {legacyLoading ? (\r\n                    <div className=\"flex justify-center items-center py-8 sm:py-12\">\r\n                      <div className=\"bg-white/60 rounded-2xl p-4 sm:p-8 shadow-2xl\">\r\n                        <div className=\"flex items-center gap-3 sm:gap-4\">\r\n                          <svg\r\n                            className=\"animate-spin h-8 w-8 text-indigo-500\"\r\n                            xmlns=\"http://www.w3.org/2000/svg\"\r\n                            fill=\"none\"\r\n                            viewBox=\"0 0 24 24\"\r\n                          >\r\n                            <circle\r\n                              className=\"opacity-25\"\r\n                              cx=\"12\"\r\n                              cy=\"12\"\r\n                              r=\"10\"\r\n                              stroke=\"currentColor\"\r\n                              strokeWidth=\"4\"\r\n                            ></circle>\r\n                            <path\r\n                              className=\"opacity-75\"\r\n                              fill=\"currentColor\"\r\n                              d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\r\n                            ></path>\r\n                          </svg>\r\n                          <span className=\"text-indigo-700 font-semibold text-lg\">\r\n                            กำลังโหลดข้อมูลลูกค้าเก่า...\r\n                          </span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  ) : legacyRecordsSorted.length === 0 ? (\r\n                    <div className=\"flex justify-center items-center py-8 sm:py-12\">\r\n                      <div className=\"bg-white/70 rounded-2xl p-4 sm:p-8 shadow-2xl text-center\">\r\n                        <svg\r\n                          className=\"w-12 h-12 sm:w-16 sm:h-16 text-indigo-300 mx-auto mb-4\"\r\n                          fill=\"none\"\r\n                          stroke=\"currentColor\"\r\n                          viewBox=\"0 0 24 24\"\r\n                        >\r\n                          <path\r\n                            strokeLinecap=\"round\"\r\n                            strokeLinejoin=\"round\"\r\n                            strokeWidth={2}\r\n                            d=\"M9 17v-2a2 2 0 012-2h2a2 2 0 012 2v2m-6 0h6m-3-9h.01M4 6h16M4 10h16M4 14h16\"\r\n                          />\r\n                        </svg>\r\n                        <h3 className=\"text-indigo-700 font-bold text-lg sm:text-xl mb-2\">\r\n                          ไม่มีรายการลูกค้าเก่า\r\n                        </h3>\r\n                        <p className=\"text-indigo-500 text-sm sm:text-base\">\r\n                          ไม่พบข้อมูลในวันที่เลือก ลองเปลี่ยนวันที่หรือรีโหลดอีกครั้ง\r\n                        </p>\r\n                      </div>\r\n                    </div>\r\n                  ) : (\r\n                    <table className=\"w-full border-collapse min-w-[700px]\">\r\n                      <thead>\r\n                        <tr className=\"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500\">\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            เวลาที่นัด\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            สถานะ\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            ชื่อลูกค้า\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            เบอร์โทร\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            หัตถการ / บริการ\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            แพทย์\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            ผู้ดูแล\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            รหัสนัด\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white border-r border-white/20 tracking-wide whitespace-nowrap\">\r\n                            ติดดาว\r\n                          </th>\r\n                          <th className=\"px-2 sm:px-4 py-3 sm:py-5 text-center text-xs sm:text-sm font-bold text-white tracking-wide whitespace-nowrap\">\r\n                            หมายเหตุ\r\n                          </th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {legacyRecordsSorted.map((appointment, index) => {\r\n                          const { dateLabel, timeLabel } = getLegacyDateParts(appointment.start_date);\r\n                          const productName = appointment.dest_name || appointment.activity || \"-\";\r\n                          const statusLabel = appointment.activity || \"รอติดต่อ\";\r\n                          const contactName = appointment.organize || appointment.bind_code || \"-\";\r\n                          const notePreview = getNotePreview(appointment.note);\r\n                          const visitLinked = Boolean(appointment.vn && appointment.vn.trim());\r\n                          const appointmentKey = appointment.appoint_code || `${appointment.code}-${index}`;\r\n\r\n                          return (\r\n                            <tr\r\n                              key={appointmentKey}\r\n                              className={`${index % 2 === 0\r\n                                ? \"bg-gradient-to-r from-white via-indigo-50 to-purple-50\"\r\n                                : \"bg-gradient-to-r from-purple-50 via-pink-50 to-rose-50\"\r\n                                } hover:bg-gradient-to-r hover:from-purple-100 hover:to-pink-100 transition-all duration-200`}\r\n                            >\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                <div className=\"font-semibold text-indigo-700 text-sm sm:text-base\">\r\n                                  {timeLabel}\r\n                                </div>\r\n                                <div className=\"text-[10px] sm:text-xs text-gray-500\">{dateLabel}</div>\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                <span className=\"inline-block px-2 sm:px-4 py-1 sm:py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full text-[10px] sm:text-xs font-bold shadow\">\r\n                                  {statusLabel}\r\n                                </span>\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                {getLegacyCustomerName(appointment)}\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center whitespace-nowrap\">\r\n                                {formatLegacyPhoneNumber(appointment.mobilephone)}\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                {productName}\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                {appointment.doctor_name || \"-\"}\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                {contactName}\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 text-center\">\r\n                                {appointment.appoint_code || appointment.code || \"-\"}\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 border-r border-gray-200 bg-gradient-to-r from-amber-100 to-yellow-100 text-center\">\r\n                                <div className=\"flex items-center justify-center\">\r\n                                  {visitLinked ? (\r\n                                    <svg\r\n                                      className=\"w-6 h-6 text-yellow-500 fill-current\"\r\n                                      viewBox=\"0 0 24 24\"\r\n                                    >\r\n                                      <path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" />\r\n                                    </svg>\r\n                                  ) : (\r\n                                    <svg\r\n                                      className=\"w-6 h-6 text-gray-400\"\r\n                                      fill=\"none\"\r\n                                      stroke=\"currentColor\"\r\n                                      viewBox=\"0 0 24 24\"\r\n                                    >\r\n                                      <path\r\n                                        strokeLinecap=\"round\"\r\n                                        strokeLinejoin=\"round\"\r\n                                        strokeWidth={2}\r\n                                        d=\"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z\"\r\n                                      />\r\n                                    </svg>\r\n                                  )}\r\n                                </div>\r\n                              </td>\r\n                              <td className=\"px-2 sm:px-4 py-2 sm:py-4 text-xs sm:text-sm text-gray-800 text-left\">\r\n                                <div\r\n                                  className=\"text-xs sm:text-sm text-gray-700\"\r\n                                  title={appointment.note || undefined}\r\n                                  style={{\r\n                                    display: \"-webkit-box\",\r\n                                    WebkitLineClamp: 2,\r\n                                    WebkitBoxOrient: \"vertical\",\r\n                                    overflow: \"hidden\",\r\n                                  }}\r\n                                >\r\n                                  {notePreview}\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          );\r\n                        })}\r\n                      </tbody>\r\n                    </table>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n          {/* Footer Summary */}\r\n          {viewMode === \"table\" && customerSegment === \"new\" && (\r\n            <div className=\"bg-gradient-to-r from-blue-500 via-indigo-500 to-purple-500 px-3 sm:px-8 py-3 sm:py-6 border-t-4 border-indigo-600\">\r\n              <div className=\"flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-4\">\r\n                <div className=\"text-xs sm:text-base text-white flex items-center gap-1 sm:gap-2\">\r\n                  <span className=\"bg-white/20 px-2 sm:px-4 py-1 sm:py-2 rounded-lg backdrop-blur-sm font-bold\">\r\n                    📊 ทั้งหมด:\r\n                  </span>\r\n                  <span className=\"bg-white text-blue-600 px-2 sm:px-4 py-1 sm:py-2 rounded-lg font-bold shadow-lg\">\r\n                    {records.length} รายการ\r\n                  </span>\r\n                </div>\r\n                <div className=\"text-xs sm:text-base text-white flex items-center gap-1 sm:gap-2\">\r\n                  <span className=\"bg-white/20 px-2 sm:px-4 py-1 sm:py-2 rounded-lg backdrop-blur-sm font-bold\">\r\n                    💎 รวมยอด:\r\n                  </span>\r\n                  <span className=\"bg-white text-purple-600 px-2 sm:px-4 py-1 sm:py-2 rounded-lg font-bold shadow-lg\">\r\n                    {records\r\n                      .reduce((sum, r) => sum + r.proposedAmount, 0)\r\n                      .toLocaleString()}{\" \"}\r\n                    บาท\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n          {viewMode === \"table\" && customerSegment === \"old\" && (\r\n            <div className=\"bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 px-3 sm:px-8 py-3 sm:py-6 border-t-4 border-purple-600\">\r\n              <div className=\"flex flex-col sm:flex-row justify-between items-center gap-2 sm:gap-4 text-white\">\r\n                <div className=\"flex items-center gap-2 sm:gap-3 text-xs sm:text-base\">\r\n                  <span className=\"bg-white/20 px-2 sm:px-4 py-1 sm:py-2 rounded-lg backdrop-blur-sm font-bold\">\r\n                    📁 ลูกค้าเก่า:\r\n                  </span>\r\n                  <span className=\"bg-white text-purple-600 px-2 sm:px-4 py-1 sm:py-2 rounded-lg font-bold shadow-lg\">\r\n                    {legacyRecordsSorted.length} รายการ\r\n                  </span>\r\n                </div>\r\n                <div className=\"flex items-center gap-2 sm:gap-3 text-xs sm:text-base\">\r\n                  <span className=\"bg-white/20 px-2 sm:px-4 py-1 sm:py-2 rounded-lg backdrop-blur-sm font-bold\">\r\n                    ⭐ เชื่อมต่อ VN:\r\n                  </span>\r\n                  <span className=\"bg-white text-pink-600 px-2 sm:px-4 py-1 sm:py-2 rounded-lg font-bold shadow-lg\">\r\n                    {legacyRecordsSorted.filter((item) => item.vn && item.vn.trim()).length} รายการ\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Popup Modal */}\r\n      {showPopup && selectedDateRecords.length > 0 && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-end justify-center z-50\"\r\n          onClick={closePopup}\r\n        >\r\n          <div\r\n            className=\"bg-gradient-to-br from-white to-blue-50 rounded-t-3xl shadow-2xl w-full max-w-4xl max-h-[85vh] overflow-hidden animate-slide-up\"\r\n            onClick={(e) => e.stopPropagation()}\r\n            style={{\r\n              animation: 'slideUp 0.3s ease-out'\r\n            }}\r\n          >\r\n            <style jsx>{`\r\n              @keyframes slideUp {\r\n                from {\r\n                  transform: translateY(100%);\r\n                  opacity: 0;\r\n                }\r\n                to {\r\n                  transform: translateY(0);\r\n                  opacity: 1;\r\n                }\r\n              }\r\n            `}</style>\r\n            {/* Popup Header */}\r\n            <div className=\"bg-gradient-to-r from-blue-500 to-indigo-600 px-4 sm:px-6 py-4 flex justify-between items-center\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"bg-white/20 backdrop-blur-sm p-2 rounded-lg\">\r\n                  <svg\r\n                    className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <div>\r\n                  <h2 className=\"text-lg sm:text-2xl font-bold text-white\">\r\n                    นัดหมายวันที่{\" \"}\r\n                    {(() => {\r\n                      const [year, month, day] = selectedDateStr\r\n                        .split(\"-\")\r\n                        .map(Number);\r\n                      const date = new Date(year, month - 1, day);\r\n                      return date.toLocaleDateString(\"th-TH\", {\r\n                        year: \"numeric\",\r\n                        month: \"long\",\r\n                        day: \"numeric\",\r\n                      });\r\n                    })()}\r\n                  </h2>\r\n                  <p className=\"text-blue-100 text-xs sm:text-sm\">\r\n                    ทั้งหมด {selectedDateRecords.length} รายการ\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={closePopup}\r\n                className=\"bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-all\"\r\n              >\r\n                <svg\r\n                  className=\"w-5 h-5 sm:w-6 sm:h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M6 18L18 6M6 6l12 12\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Popup Content */}\r\n            <div className=\"p-4 sm:p-6 space-y-4 max-h-[calc(85vh-140px)] overflow-y-auto\">\r\n              {selectedDateRecords.map((record, index) => (\r\n                <div\r\n                  key={record.id}\r\n                  className=\"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden\"\r\n                >\r\n                  {/* Card Header */}\r\n                  <div className=\"px-4 py-3 border-b border-gray-100 flex items-center justify-between\">\r\n                    <div className=\"flex items-center gap-2\">\r\n                      <span className=\"bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-2.5 py-0.5 rounded-full text-xs font-bold\">\r\n                        #{index + 1}\r\n                      </span>\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => openCustomerModal(record)}\r\n                        className=\"text-lg sm:text-xl font-bold text-blue-600 hover:underline\"\r\n                      >\r\n                        {record.customer_name}\r\n                      </button>\r\n                      <span className=\"text-gray-500 text-sm\">{record.phone}</span>\r\n                    </div>\r\n                    <span className=\"px-3 py-1 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-full text-xs font-bold\">\r\n                      {record.status}\r\n                    </span>\r\n                  </div>\r\n\r\n                  {/* Delete Button */}\r\n                  <div className=\"px-4 py-2\">\r\n                    <button\r\n                      onClick={() => deleteRecord(record.id)}\r\n                      className=\"w-full px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-bold shadow transition-all flex items-center justify-center gap-2\"\r\n                    >\r\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\r\n                      </svg>\r\n                      ลบข้อมูล\r\n                    </button>\r\n                  </div>\r\n\r\n                  {/* Details Grid - 2 columns layout */}\r\n                  <div className=\"px-4 py-3 grid grid-cols-2 gap-x-6 gap-y-3\">\r\n                    {/* Row 1 */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span className=\"text-red-500\">⏰</span> เวลานัดหมาย\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base\">\r\n                        {formatTimeDisplay(record.appointmentTime)}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>👨‍⚕️</span> แพทย์\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base\">\r\n                        {record.doctor}\r\n                      </p>\r\n                    </div>\r\n\r\n                    {/* Row 2 */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>💊</span> ผลิตภัณฑ์\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base\">\r\n                        {sanitizeProductName(record.interested_product || record.interestedProduct)}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>🌍</span> ประเทศ\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base\">\r\n                        {record.country || \"-\"}\r\n                      </p>\r\n                    </div>\r\n\r\n                    {/* Row 3 */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>👤</span> ผู้ติดต่อ\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base\">\r\n                        {record.contact_staff || \"-\"}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>💰</span> ยอดเสนอ\r\n                      </div>\r\n                      <p className=\"text-purple-600 font-bold text-lg sm:text-xl\">\r\n                        {record.proposed_amount.toLocaleString()} ฿\r\n                      </p>\r\n                    </div>\r\n\r\n                    {/* Row 4 - Star and OPD status */}\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>⭐</span> ติดดาว\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base flex items-center gap-1\">\r\n                        {record.star_flag ? (\r\n                          <><svg className=\"w-5 h-5 text-yellow-500 fill-current\" viewBox=\"0 0 24 24\"><path d=\"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z\" /></svg> ใช่</>\r\n                        ) : \"ไม่\"}\r\n                      </p>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"flex items-center gap-1.5 text-gray-500 text-xs mb-0.5\">\r\n                        <span>🏥</span> OPD\r\n                      </div>\r\n                      <p className=\"text-gray-900 font-bold text-sm sm:text-base\">\r\n                        {record.status.trim() === \"นัดพร้อมทำ\" && record.hasCustomerProfile ? (\r\n                          <span className=\"text-emerald-600\">เปิด OPD แล้ว</span>\r\n                        ) : \"-\"}\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Note Section */}\r\n                  {record.note && (\r\n                    <div className=\"mx-4 mb-3 bg-yellow-50 p-3 rounded-lg border border-yellow-200\">\r\n                      <p className=\"text-xs text-gray-600 font-medium mb-1\">\r\n                        📝 หมายเหตุ\r\n                      </p>\r\n                      <p className=\"text-sm text-gray-800\">{record.note}</p>\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Surgery/Consult Dates */}\r\n                  {(record.surgery_date || record.consult_date) && (\r\n                    <div className=\"px-4 pb-3 flex flex-wrap gap-2\">\r\n                      {record.surgery_date && (\r\n                        <div className=\"bg-red-100 px-3 py-1 rounded-full\">\r\n                          <span className=\"text-red-700 font-bold text-xs\">\r\n                            🏥 ผ่าตัด:{\" \"}\r\n                            {(() => {\r\n                              const [year, month, day] = record.surgery_date!.split(\"-\").map(Number);\r\n                              const date = new Date(year, month - 1, day);\r\n                              return date.toLocaleDateString(\"th-TH\");\r\n                            })()}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                      {record.consult_date && (\r\n                        <div className=\"bg-blue-100 px-3 py-1 rounded-full\">\r\n                          <span className=\"text-blue-700 font-bold text-xs\">\r\n                            📅 ปรึกษา:{\" \"}\r\n                            {(() => {\r\n                              const [year, month, day] = record.consult_date!.split(\"-\").map(Number);\r\n                              const date = new Date(year, month - 1, day);\r\n                              return date.toLocaleDateString(\"th-TH\");\r\n                            })()}\r\n                          </span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Popup Footer */}\r\n            <div className=\"bg-gray-100 px-4 sm:px-6 py-3 flex justify-end border-t\">\r\n              <button\r\n                onClick={closePopup}\r\n                className=\"px-6 py-2.5 bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white rounded-lg font-bold shadow-lg transition-all\"\r\n              >\r\n                ปิด\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Employee Form Modal */}\r\n      {showEmployeeForm && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowEmployeeForm(false)}\r\n        >\r\n          <div\r\n            className=\"bg-gradient-to-br from-white to-emerald-50 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Form Header */}\r\n            <div className=\"bg-gradient-to-r from-emerald-500 to-teal-600 p-6 rounded-t-2xl flex justify-between items-center\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"bg-white/20 backdrop-blur-sm p-2 rounded-lg\">\r\n                  <svg\r\n                    className=\"w-6 h-6 text-white\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <div>\r\n                  <h2 className=\"text-2xl font-bold text-white\">\r\n                    เพิ่มข้อมูลพนักงาน\r\n                  </h2>\r\n                  <p className=\"text-emerald-100 text-sm mt-1\">\r\n                    กรอกข้อมูลพนักงานใหม่\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowEmployeeForm(false)}\r\n                className=\"bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-all\"\r\n              >\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M6 18L18 6M6 6l12 12\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Form Content */}\r\n            <div className=\"p-6 space-y-4\">\r\n              {/* ชื่อ-นามสกุล */}\r\n              <div>\r\n                <label className=\"block text-gray-700 font-bold mb-2\">\r\n                  ชื่อ-นามสกุล <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={employeeForm.full_name}\r\n                  onChange={(e) =>\r\n                    handleEmployeeFormChange(\"full_name\", e.target.value)\r\n                  }\r\n                  className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:outline-none text-gray-800\"\r\n                  placeholder=\"กรอกชื่อ-นามสกุล\"\r\n                />\r\n              </div>\r\n\r\n              {/* ตำแหน่ง */}\r\n              <div>\r\n                <label className=\"block text-gray-700 font-bold mb-2\">\r\n                  ตำแหน่ง\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={employeeForm.role}\r\n                  onChange={(e) =>\r\n                    handleEmployeeFormChange(\"role\", e.target.value)\r\n                  }\r\n                  className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:outline-none text-gray-800\"\r\n                  placeholder=\"เช่น พนักงานขาย, ผู้จัดการ\"\r\n                />\r\n              </div>\r\n\r\n              {/* วันลาต่อปี */}\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-gray-700 font-bold mb-2\">\r\n                    วันลาต่อปี\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={employeeForm.yearly_leave_quota}\r\n                    onChange={(e) =>\r\n                      handleEmployeeFormChange(\r\n                        \"yearly_leave_quota\",\r\n                        parseInt(e.target.value)\r\n                      )\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:outline-none text-gray-800\"\r\n                    min=\"0\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-gray-700 font-bold mb-2\">\r\n                    วันลาคงเหลือ\r\n                  </label>\r\n                  <input\r\n                    type=\"number\"\r\n                    value={employeeForm.leave_remaining}\r\n                    onChange={(e) =>\r\n                      handleEmployeeFormChange(\r\n                        \"leave_remaining\",\r\n                        parseInt(e.target.value)\r\n                      )\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:outline-none text-gray-800\"\r\n                    min=\"0\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* เวลาทำงาน */}\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-gray-700 font-bold mb-2\">\r\n                    เวลาเข้างาน\r\n                  </label>\r\n                  <input\r\n                    type=\"time\"\r\n                    value={employeeForm.work_start_time}\r\n                    onChange={(e) =>\r\n                      handleEmployeeFormChange(\r\n                        \"work_start_time\",\r\n                        e.target.value\r\n                      )\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:outline-none text-gray-800\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-gray-700 font-bold mb-2\">\r\n                    เวลาเลิกงาน\r\n                  </label>\r\n                  <input\r\n                    type=\"time\"\r\n                    value={employeeForm.work_end_time}\r\n                    onChange={(e) =>\r\n                      handleEmployeeFormChange(\"work_end_time\", e.target.value)\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-emerald-500 focus:outline-none text-gray-800\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              {/* สถานะ */}\r\n              <div className=\"flex items-center gap-3\">\r\n                <input\r\n                  type=\"checkbox\"\r\n                  id=\"is_active\"\r\n                  checked={employeeForm.is_active}\r\n                  onChange={(e) =>\r\n                    handleEmployeeFormChange(\"is_active\", e.target.checked)\r\n                  }\r\n                  className=\"w-5 h-5 rounded border-2 border-gray-300 text-emerald-600 focus:ring-emerald-500\"\r\n                />\r\n                <label htmlFor=\"is_active\" className=\"text-gray-700 font-bold\">\r\n                  พนักงานปฏิบัติงานอยู่\r\n                </label>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Footer */}\r\n            <div className=\"bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3\">\r\n              <button\r\n                onClick={() => setShowEmployeeForm(false)}\r\n                className=\"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-bold shadow-lg transition-all\"\r\n              >\r\n                ยกเลิก\r\n              </button>\r\n              <button\r\n                onClick={handleSaveEmployee}\r\n                className=\"px-6 py-3 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg font-bold shadow-lg transition-all\"\r\n              >\r\n                บันทึก\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Attendance Form Modal */}\r\n      {showAttendanceForm && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowAttendanceForm(false)}\r\n        >\r\n          <div\r\n            className=\"bg-gradient-to-br from-white to-teal-50 rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Form Header */}\r\n            <div className=\"bg-gradient-to-r from-teal-500 to-cyan-600 p-6 rounded-t-2xl flex justify-between items-center\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"bg-white/20 backdrop-blur-sm p-2 rounded-lg\">\r\n                  <svg\r\n                    className=\"w-6 h-6 text-white\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <div>\r\n                  <h2 className=\"text-2xl font-bold text-white\">\r\n                    {editingAttendance ? \"แก้ไข\" : \"บันทึก\"}การเข้างาน\r\n                  </h2>\r\n                  <p className=\"text-teal-100 text-sm mt-1\">\r\n                    {editingAttendance\r\n                      ? \"แก้ไขข้อมูลการเข้า-ออกงานของพนักงาน\"\r\n                      : \"กรอกข้อมูลการเข้า-ออกงานของพนักงาน\"}\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowAttendanceForm(false)}\r\n                className=\"bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-all\"\r\n              >\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M6 18L18 6M6 6l12 12\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Form Content */}\r\n            <div className=\"p-6 space-y-4\">\r\n              {/* เลือกพนักงาน */}\r\n              <div>\r\n                <label className=\"block text-gray-700 font-bold mb-2\">\r\n                  พนักงาน <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                {editingAttendance ? (\r\n                  // แสดงชื่อพนักงานเมื่อแก้ไข (ไม่ให้เปลี่ยน)\r\n                  <div className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 bg-gray-100 text-gray-800 font-bold\">\r\n                    {editingAttendance.employee_name ||\r\n                      `ID: ${editingAttendance.employee_id}`}\r\n                  </div>\r\n                ) : (\r\n                  <select\r\n                    value={attendanceForm.employee_id}\r\n                    onChange={(e) =>\r\n                      handleAttendanceFormChange(\r\n                        \"employee_id\",\r\n                        parseInt(e.target.value)\r\n                      )\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-teal-500 focus:outline-none text-gray-800\"\r\n                  >\r\n                    <option value={0}>เลือกพนักงาน</option>\r\n                    {employees\r\n                      .filter((emp) => {\r\n                        // When creating new, filter out employees who already have attendance on this date\r\n                        if (attendanceForm.work_date) {\r\n                          // Normalize both dates to YYYY-MM-DD format\r\n                          const formDate =\r\n                            attendanceForm.work_date.split(\"T\")[0];\r\n                          const hasAttendance = attendances.some((att) => {\r\n                            const attDateStr = att.work_date.split(\"T\")[0];\r\n                            // Convert both to numbers to ensure type consistency\r\n                            return (\r\n                              Number(att.employee_id) === Number(emp.id) &&\r\n                              attDateStr === formDate\r\n                            );\r\n                          });\r\n                          return !hasAttendance;\r\n                        }\r\n                        return true;\r\n                      })\r\n                      .map((emp) => (\r\n                        <option key={emp.id} value={emp.id}>\r\n                          {emp.full_name} - {emp.role}\r\n                        </option>\r\n                      ))}\r\n                  </select>\r\n                )}\r\n              </div>\r\n\r\n              {/* วันที่ */}\r\n              <div>\r\n                <label className=\"block text-gray-700 font-bold mb-2\">\r\n                  วันที่ <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"date\"\r\n                  value={attendanceForm.work_date}\r\n                  onChange={(e) =>\r\n                    handleAttendanceFormChange(\"work_date\", e.target.value)\r\n                  }\r\n                  className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-teal-500 focus:outline-none text-gray-800\"\r\n                />\r\n              </div>\r\n\r\n              {/* เวลาเข้า-ออก */}\r\n              <div className=\"grid grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label className=\"block text-gray-700 font-bold mb-2\">\r\n                    เวลาเข้างาน\r\n                  </label>\r\n                  <input\r\n                    type=\"time\"\r\n                    value={attendanceForm.time_in}\r\n                    onChange={(e) =>\r\n                      handleAttendanceFormChange(\"time_in\", e.target.value)\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-teal-500 focus:outline-none text-gray-800\"\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className=\"block text-gray-700 font-bold mb-2\">\r\n                    เวลาออกงาน\r\n                  </label>\r\n                  <input\r\n                    type=\"time\"\r\n                    value={attendanceForm.time_out}\r\n                    onChange={(e) =>\r\n                      handleAttendanceFormChange(\"time_out\", e.target.value)\r\n                    }\r\n                    className=\"w-full px-4 py-3 rounded-lg border-2 border-gray-300 focus:border-teal-500 focus:outline-none text-gray-800\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Form Footer */}\r\n            <div className=\"bg-gray-100 p-4 rounded-b-2xl flex justify-end gap-3\">\r\n              <button\r\n                onClick={() => {\r\n                  setShowAttendanceForm(false);\r\n                  setEditingAttendance(null);\r\n                }}\r\n                className=\"px-6 py-3 bg-gray-500 hover:bg-gray-600 text-white rounded-lg font-bold shadow-lg transition-all\"\r\n              >\r\n                ยกเลิก\r\n              </button>\r\n              <button\r\n                onClick={handleSaveAttendance}\r\n                className=\"px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white rounded-lg font-bold shadow-lg transition-all\"\r\n              >\r\n                {editingAttendance ? \"บันทึกการแก้ไข\" : \"บันทึก\"}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {/* Attendance Details Popup */}\r\n      {showAttendancePopup && selectedDateAttendances.length > 0 && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\"\r\n          onClick={() => setShowAttendancePopup(false)}\r\n        >\r\n          <div\r\n            className=\"bg-gradient-to-br from-white to-teal-50 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Popup Header */}\r\n            <div className=\"bg-gradient-to-r from-teal-500 to-cyan-600 p-6 rounded-t-2xl flex justify-between items-center\">\r\n              <div className=\"flex items-center gap-3\">\r\n                <div className=\"bg-white/20 backdrop-blur-sm p-2 rounded-lg\">\r\n                  <svg\r\n                    className=\"w-6 h-6 text-white\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4\"\r\n                    />\r\n                  </svg>\r\n                </div>\r\n                <div>\r\n                  <h2 className=\"text-2xl font-bold text-white\">\r\n                    การเข้างานวันที่{\" \"}\r\n                    {(() => {\r\n                      const [year, month, day] = selectedAttendanceDateStr\r\n                        .split(\"-\")\r\n                        .map(Number);\r\n                      const date = new Date(year, month - 1, day);\r\n                      return date.toLocaleDateString(\"th-TH\", {\r\n                        year: \"numeric\",\r\n                        month: \"long\",\r\n                        day: \"numeric\",\r\n                        weekday: \"long\",\r\n                      });\r\n                    })()}\r\n                  </h2>\r\n                  <p className=\"text-teal-100 text-sm mt-1\">\r\n                    ทั้งหมด {selectedDateAttendances.length} คน\r\n                  </p>\r\n                </div>\r\n              </div>\r\n              <button\r\n                onClick={() => setShowAttendancePopup(false)}\r\n                className=\"bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-all\"\r\n              >\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M6 18L18 6M6 6l12 12\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Popup Content */}\r\n            <div className=\"p-6\">\r\n              {/* Add Staff Button */}\r\n              <div className=\"mb-4 flex justify-end\">\r\n                <button\r\n                  onClick={() => {\r\n                    setShowAttendancePopup(false);\r\n                    setEditingAttendance(null);\r\n                    setTimeout(() => {\r\n                      setAttendanceForm({\r\n                        employee_id: 0,\r\n                        work_date: selectedAttendanceDateStr,\r\n                        time_in: \"08:00\",\r\n                        time_out: \"17:00\",\r\n                        status: \"PRESENT\",\r\n                        work_hours: 8.0,\r\n                        overtime_hours: 0,\r\n                        note: \"\",\r\n                      });\r\n                      setShowAttendanceForm(true);\r\n                    }, 100);\r\n                  }}\r\n                  className=\"px-4 py-2 bg-gradient-to-r from-emerald-500 to-teal-600 hover:from-emerald-600 hover:to-teal-700 text-white rounded-lg transition-all shadow-lg font-bold flex items-center gap-2\"\r\n                >\r\n                  <svg\r\n                    className=\"w-5 h-5\"\r\n                    fill=\"none\"\r\n                    stroke=\"currentColor\"\r\n                    viewBox=\"0 0 24 24\"\r\n                  >\r\n                    <path\r\n                      strokeLinecap=\"round\"\r\n                      strokeLinejoin=\"round\"\r\n                      strokeWidth={2}\r\n                      d=\"M12 4v16m8-8H4\"\r\n                    />\r\n                  </svg>\r\n                  เพิ่มพนักงาน\r\n                </button>\r\n              </div>\r\n\r\n              <div className=\"space-y-4\">\r\n                {selectedDateAttendances.map((att, index) => {\r\n                  const statusColors: Record<string, string> = {\r\n                    PRESENT: \"bg-green-100 text-green-800 border-green-300\",\r\n                    LATE: \"bg-yellow-100 text-yellow-800 border-yellow-300\",\r\n                    LEAVE: \"bg-blue-100 text-blue-800 border-blue-300\",\r\n                    ABSENT: \"bg-red-100 text-red-800 border-red-300\",\r\n                    WFH: \"bg-purple-100 text-purple-800 border-purple-300\",\r\n                  };\r\n\r\n                  const statusLabels: Record<string, string> = {\r\n                    PRESENT: \"มาทำงาน\",\r\n                    LATE: \"มาสาย\",\r\n                    LEAVE: \"ลา\",\r\n                    ABSENT: \"ขาดงาน\",\r\n                    WFH: \"WFH\",\r\n                  };\r\n\r\n                  return (\r\n                    <div\r\n                      key={att.id || index}\r\n                      className=\"bg-gradient-to-br from-white to-teal-50 rounded-xl p-4 border-2 border-teal-200 shadow-lg hover:shadow-xl transition-all\"\r\n                    >\r\n                      {/* Name */}\r\n                      <div className=\"mb-3 flex items-center gap-3\">\r\n                        <div className=\"bg-gradient-to-br from-teal-400 to-cyan-500 text-white w-12 h-12 rounded-full flex items-center justify-center font-bold text-lg\">\r\n                          {att.employee_name?.charAt(0) || \"?\"}\r\n                        </div>\r\n                        <div>\r\n                          <div className=\"text-xs text-teal-600 font-medium\">\r\n                            ชื่อพนักงาน\r\n                          </div>\r\n                          <div className=\"font-bold text-gray-800 text-lg\">\r\n                            {att.employee_name || `ID: ${att.employee_id}`}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Status Rank */}\r\n                      <div className=\"mb-3\">\r\n                        <div className=\"text-xs text-teal-600 font-medium mb-1\">\r\n                          สถานะ\r\n                        </div>\r\n                        <span\r\n                          className={`inline-block px-4 py-2 rounded-lg font-bold border-2 text-sm ${statusColors[att.status] ||\r\n                            \"bg-gray-100 text-gray-800 border-gray-300\"\r\n                            }`}\r\n                        >\r\n                          {statusLabels[att.status] || att.status}\r\n                        </span>\r\n                      </div>\r\n\r\n                      {/* Time Section */}\r\n                      <div className=\"grid grid-cols-2 gap-3\">\r\n                        <div>\r\n                          <div className=\"text-xs text-teal-600 font-medium mb-1\">\r\n                            เวลาเข้า\r\n                          </div>\r\n                          <div className=\"bg-blue-100 text-blue-800 rounded-lg px-3 py-2 font-bold text-center\">\r\n                            {formatTimeDisplay(att.time_in)}\r\n                          </div>\r\n                        </div>\r\n                        <div>\r\n                          <div className=\"text-xs text-teal-600 font-medium mb-1\">\r\n                            เวลาออก\r\n                          </div>\r\n                          <div className=\"bg-orange-100 text-orange-800 rounded-lg px-3 py-2 font-bold text-center\">\r\n                            {formatTimeDisplay(att.time_out)}\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n\r\n                      {/* Action Buttons */}\r\n                      <div className=\"mt-3 flex gap-2\">\r\n                        <button\r\n                          onClick={() => {\r\n                            // Set editing attendance พร้อมกับ form\r\n                            setEditingAttendance(att);\r\n                            setAttendanceForm({\r\n                              employee_id: att.employee_id,\r\n                              work_date: att.work_date.split(\"T\")[0], // Normalize date\r\n                              time_in: att.time_in,\r\n                              time_out: att.time_out,\r\n                              status: att.status,\r\n                              work_hours: att.work_hours,\r\n                              overtime_hours: att.overtime_hours,\r\n                              note: att.note,\r\n                            });\r\n                            setShowAttendancePopup(false);\r\n                            setShowAttendanceForm(true);\r\n                          }}\r\n                          className=\"flex-1 px-3 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg font-bold shadow transition-all flex items-center justify-center gap-2\"\r\n                        >\r\n                          <svg\r\n                            className=\"w-4 h-4\"\r\n                            fill=\"none\"\r\n                            stroke=\"currentColor\"\r\n                            viewBox=\"0 0 24 24\"\r\n                          >\r\n                            <path\r\n                              strokeLinecap=\"round\"\r\n                              strokeLinejoin=\"round\"\r\n                              strokeWidth={2}\r\n                              d=\"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z\"\r\n                            />\r\n                          </svg>\r\n                          แก้ไข\r\n                        </button>\r\n                        <button\r\n                          onClick={() =>\r\n                            att.id && handleDeleteAttendance(att.id)\r\n                          }\r\n                          className=\"flex-1 px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg font-bold shadow transition-all flex items-center justify-center gap-2\"\r\n                        >\r\n                          <svg\r\n                            className=\"w-4 h-4\"\r\n                            fill=\"none\"\r\n                            stroke=\"currentColor\"\r\n                            viewBox=\"0 0 24 24\"\r\n                          >\r\n                            <path\r\n                              strokeLinecap=\"round\"\r\n                              strokeLinejoin=\"round\"\r\n                              strokeWidth={2}\r\n                              d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\"\r\n                            />\r\n                          </svg>\r\n                          ลบ\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Popup Footer */}\r\n            <div className=\"bg-gray-100 p-4 rounded-b-2xl flex justify-end\">\r\n              <button\r\n                onClick={() => setShowAttendancePopup(false)}\r\n                className=\"px-6 py-3 bg-gradient-to-r from-teal-500 to-cyan-600 hover:from-teal-600 hover:to-cyan-700 text-white rounded-lg font-bold shadow-lg transition-all\"\r\n              >\r\n                ปิด\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {serviceModalVisible && selectedGroupForServices && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\"\r\n          onClick={closeServiceModal}\r\n        >\r\n          <div\r\n            className=\"bg-gradient-to-br from-white to-indigo-50 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            <div className=\"bg-gradient-to-r from-blue-500 to-indigo-600 p-6 rounded-t-2xl flex justify-between items-center text-white\">\r\n              <div>\r\n                <h2 className=\"text-2xl font-bold\">\r\n                  บริการในกลุ่ม {selectedGroupForServices.groupname}\r\n                </h2>\r\n                <p className=\"text-xs text-white/80 mt-1\">\r\n                  ข้อมูลจาก b_itemservice (groupcode = {selectedGroupForServices.groupcode})\r\n                </p>\r\n              </div>\r\n              <button\r\n                onClick={closeServiceModal}\r\n                className=\"bg-white/20 hover:bg-white/30 p-2 rounded-lg transition-all\"\r\n              >\r\n                <svg\r\n                  className=\"w-6 h-6 text-white\"\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M6 18L18 6M6 6l12 12\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"p-6 space-y-4\">\r\n              {servicesLoading && (\r\n                <p className=\"text-sm text-slate-500\">กำลังโหลดรายการ...</p>\r\n              )}\r\n              {serviceError && (\r\n                <p className=\"text-sm text-red-600\">{serviceError}</p>\r\n              )}\r\n              {!servicesLoading && !serviceError && groupServiceItems.length === 0 && (\r\n                <p className=\"text-sm text-gray-500\">ไม่พบรายการบริการในกลุ่มนี้</p>\r\n              )}\r\n              {!servicesLoading && groupServiceItems.length > 0 && (\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\r\n                  {groupServiceItems.map((item) => (\r\n                    <div\r\n                      key={item.itemcode}\r\n                      className=\"border border-gray-200 rounded-xl p-3 bg-white shadow-sm\"\r\n                    >\r\n                      <p className=\"text-xs text-gray-500\">{item.itemcode}</p>\r\n                      <p className=\"text-sm font-semibold text-gray-800\">\r\n                        {item.itemname}\r\n                      </p>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              )}\r\n            </div>\r\n            <div className=\"bg-gray-100 p-4 rounded-b-2xl flex justify-end\">\r\n              <button\r\n                onClick={closeServiceModal}\r\n                className=\"px-6 py-2 bg-gradient-to-r from-blue-500 to-indigo-600 text-white rounded-lg font-semibold shadow-lg transition-all\"\r\n              >\r\n                ปิด\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {noteModalRecord && (\r\n        <div\r\n          className=\"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4\"\r\n          onClick={closeNoteModal}\r\n        >\r\n          <div\r\n            className=\"w-full max-w-2xl bg-white rounded-2xl shadow-2xl p-8\"\r\n            onClick={(event) => event.stopPropagation()}\r\n          >\r\n            <div className=\"flex justify-between items-start mb-6\">\r\n              <div>\r\n                <h3 className=\"text-xl font-bold text-gray-900\">\r\n                  หมายเหตุทั้งหมด\r\n                </h3>\r\n                <p className=\"text-sm text-gray-600 mt-1\">\r\n                  {noteModalRecord.customer_name || \"ไม่ระบุชื่อลูกค้า\"}\r\n                </p>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                onClick={closeNoteModal}\r\n                className=\"text-gray-500 hover:text-gray-800 transition\"\r\n                aria-label=\"ปิดหน้าต่างหมายเหตุ\"\r\n              >\r\n                <svg className=\"w-6 h-6\" fill=\"none\" viewBox=\"0 0 24 24\">\r\n                  <path\r\n                    stroke=\"currentColor\"\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth=\"2\"\r\n                    d=\"M6 6l12 12M6 18L18 6\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n            <div className=\"bg-gray-100 rounded-xl p-6 text-left max-h-[60vh] overflow-y-auto\">\r\n              <p className=\"text-gray-800 leading-relaxed whitespace-pre-wrap\">\r\n                {noteModalRecord.note ?? \"-\"}\r\n              </p>\r\n            </div>\r\n            <div className=\"mt-6 flex justify-end\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={closeNoteModal}\r\n                className=\"px-6 py-2 bg-gradient-to-r from-blue-500 to-indigo-500 text-white rounded-lg shadow-md hover:from-blue-600 hover:to-indigo-600 transition\"\r\n              >\r\n                ปิด\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      <CustomerRegistrationModal\r\n        visible={showCustomerModal}\r\n        loading={customerLoading}\r\n        saving={customerSaving}\r\n        exists={customerExists}\r\n        form={customerForm}\r\n        error={customerError}\r\n        message={customerMessage}\r\n        lead={selectedLeadSummary}\r\n        staffOptions={staffOptions}\r\n        staffLoading={staffLoading}\r\n        staffError={staffError}\r\n        onClose={closeCustomerModal}\r\n        onChange={handleCustomerFormChange}\r\n        onSubmit={handleCustomerSubmit}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","\"use client\";\r\n\r\nimport { useEffect, useMemo, useRef, useState, type RefObject } from \"react\";\r\n\r\nexport interface CustomerFormData {\r\n  recordno?: string;\r\n  code: string;\r\n  cn: string;\r\n  prefix: string;\r\n  name: string;\r\n  surname: string;\r\n  nickname: string;\r\n  gender: string;\r\n  idcard: string;\r\n  birthdate: string;\r\n  registerdate: string;\r\n  member: string;\r\n  cusgroup: string;\r\n  mobilephone: string;\r\n  email: string;\r\n  lineid: string;\r\n  facebook: string;\r\n  medianame: string;\r\n  disease: string;\r\n  allergic: string;\r\n  displayname: string;\r\n  locno: string;\r\n  soi: string;\r\n  road: string;\r\n  moo: string;\r\n  tumbon: string;\r\n  amphur: string;\r\n  province: string;\r\n  zipcode: string;\r\n  country: string;\r\n  address: string;\r\n  ownercode: string;\r\n  ownername: string;\r\n  binddate: string;\r\n  idcardLaserCode?: string;\r\n  idcardIssueDate?: string;\r\n  idcardExpireDate?: string;\r\n  idcardProvinceNative?: string;\r\n  idcardDistrictNative?: string;\r\n  idcardSubdistrictNative?: string;\r\n  idcardFrontImage?: string;\r\n  idcardBackImage?: string;\r\n}\r\n\r\nexport interface LeadSummary {\r\n  id: number;\r\n  name: string;\r\n  phone: string;\r\n  status: string;\r\n  interestedProduct: string;\r\n}\r\n\r\nexport interface StaffOption {\r\n  code: string;\r\n  nickname: string;\r\n}\r\n\r\ninterface CustomerRegistrationModalProps {\r\n  visible: boolean;\r\n  loading: boolean;\r\n  saving: boolean;\r\n  exists: boolean;\r\n  form: CustomerFormData | null;\r\n  error: string | null;\r\n  message: string | null;\r\n  lead: LeadSummary | null;\r\n  staffOptions: StaffOption[];\r\n  staffLoading: boolean;\r\n  staffError: string | null;\r\n  onClose: () => void;\r\n  onChange: (field: keyof CustomerFormData, value: string) => void;\r\n  onSubmit: () => void;\r\n}\r\n\r\ntype SectionStatus = {\r\n  label: string;\r\n  className: string;\r\n};\r\n\r\ntype SectionNavItem = {\r\n  id: string;\r\n  label: string;\r\n  ref: RefObject<HTMLDivElement | null>;\r\n  status: SectionStatus;\r\n  requiresAdvanced?: boolean;\r\n};\r\n\r\ninterface OPDServiceGroup {\r\n  groupcode: string;\r\n  groupname: string;\r\n}\r\n\r\ninterface OPDServiceItem {\r\n  itemcode: string;\r\n  itemname: string;\r\n  saleprice: number;\r\n}\r\n\r\nconst inputClass =\r\n  \"w-full rounded-lg border border-gray-300 bg-white px-3 py-2 text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500\";\r\n\r\nconst compactInputClass =\r\n  \"w-full rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500\";\r\n\r\nconst labelClass = \"block text-sm font-semibold text-gray-700\";\r\n\r\nconst genderOptions = [\r\n  { label: \"เลือกเพศ\", value: \"\" },\r\n  { label: \"ชาย\", value: \"M\" },\r\n  { label: \"หญิง\", value: \"F\" },\r\n  { label: \"ไม่ระบุ\", value: \"X\" },\r\n];\r\n\r\ninterface ThaiProvince {\r\n  id: number;\r\n  name_th: string;\r\n  name_en: string;\r\n}\r\n\r\ninterface ThaiDistrict {\r\n  id: number;\r\n  province_id: number;\r\n  name_th: string;\r\n  name_en: string;\r\n}\r\n\r\ninterface ThaiSubDistrict {\r\n  id: number;\r\n  district_id: number;\r\n  name_th: string;\r\n  name_en: string;\r\n  zip_code: number | string | null;\r\n}\r\n\r\ninterface ThaiAdministrativeData {\r\n  provinces: ThaiProvince[];\r\n  districts: ThaiDistrict[];\r\n  subdistricts: ThaiSubDistrict[];\r\n}\r\n\r\nconst THAI_DATA_BASE_URL =\r\n  \"https://raw.githubusercontent.com/kongvut/thai-province-data/refs/heads/master/api/latest\";\r\n\r\nlet thaiAdministrativeCache: ThaiAdministrativeData | null = null;\r\nlet thaiAdministrativePromise: Promise<ThaiAdministrativeData> | null = null;\r\n\r\nasync function fetchThaiAdministrativeData(): Promise<ThaiAdministrativeData> {\r\n  if (thaiAdministrativeCache) {\r\n    return thaiAdministrativeCache;\r\n  }\r\n\r\n  if (!thaiAdministrativePromise) {\r\n    thaiAdministrativePromise = Promise.all([\r\n      fetch(`${THAI_DATA_BASE_URL}/province.json`).then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"ไม่สามารถโหลดข้อมูลจังหวัดได้\");\r\n        }\r\n        return response.json() as Promise<ThaiProvince[]>;\r\n      }),\r\n      fetch(`${THAI_DATA_BASE_URL}/district.json`).then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"ไม่สามารถโหลดข้อมูลอำเภอได้\");\r\n        }\r\n        return response.json() as Promise<ThaiDistrict[]>;\r\n      }),\r\n      fetch(`${THAI_DATA_BASE_URL}/sub_district.json`).then((response) => {\r\n        if (!response.ok) {\r\n          throw new Error(\"ไม่สามารถโหลดข้อมูลตำบลได้\");\r\n        }\r\n        return response.json() as Promise<ThaiSubDistrict[]>;\r\n      }),\r\n    ]).then(([provinces, districts, subdistricts]) => {\r\n      const payload: ThaiAdministrativeData = {\r\n        provinces,\r\n        districts,\r\n        subdistricts,\r\n      };\r\n      thaiAdministrativeCache = payload;\r\n      return payload;\r\n    });\r\n  }\r\n\r\n  return thaiAdministrativePromise;\r\n}\r\n\r\nconst provinceLegacyOptionValue = \"__province_legacy__\";\r\nconst districtLegacyOptionValue = \"__district_legacy__\";\r\nconst subdistrictLegacyOptionValue = \"__subdistrict_legacy__\";\r\n\r\nfunction normalizeName(value: string | null | undefined) {\r\n  return value ? value.trim().toLowerCase() : \"\";\r\n}\r\n\r\nfunction matchesAdministrativeName(\r\n  candidate: { name_th: string; name_en: string },\r\n  target: string\r\n) {\r\n  const normalizedTarget = normalizeName(target);\r\n  if (!normalizedTarget) {\r\n    return false;\r\n  }\r\n  return (\r\n    normalizeName(candidate.name_th) === normalizedTarget ||\r\n    normalizeName(candidate.name_en) === normalizedTarget\r\n  );\r\n}\r\n\r\ninterface SelectedServiceEntry {\r\n  id: string;\r\n  itemcode: string;\r\n  itemname: string;\r\n  salesprice: number;\r\n  chargePrice: string;\r\n  chargePercent: string;\r\n  discountPrice: string;\r\n  discountPercent: string;\r\n}\r\n\r\nconst currencyFormatter = new Intl.NumberFormat(\"th-TH\", {\r\n  minimumFractionDigits: 2,\r\n  maximumFractionDigits: 2,\r\n});\r\n\r\nconst formatCurrencyDisplay = (value: number) =>\r\n  Number.isFinite(value) ? currencyFormatter.format(value) : \"0.00\";\r\n\r\nconst formatDecimalInputValue = (value: number) =>\r\n  Number.isFinite(value) ? value.toFixed(2) : \"\";\r\n\r\nconst parseMonetaryInputValue = (value: string) => {\r\n  const trimmed = value.trim();\r\n  if (!trimmed) {\r\n    return 0;\r\n  }\r\n  const numeric = Number(trimmed);\r\n  return Number.isFinite(numeric) ? numeric : 0;\r\n};\r\n\r\nconst normalizeSalepriceValue = (value: number | string | null | undefined) => {\r\n  if (value === null || value === undefined) {\r\n    return 0;\r\n  }\r\n  const numeric = typeof value === \"number\" ? value : Number(value);\r\n  return Number.isFinite(numeric) ? numeric : 0;\r\n};\r\n\r\nconst calculateServiceEntryTotal = (entry: SelectedServiceEntry) => {\r\n  const baseAmount = Number.isFinite(entry.salesprice) ? entry.salesprice : 0;\r\n  const chargeAmount = parseMonetaryInputValue(entry.chargePrice);\r\n  const discountAmount = parseMonetaryInputValue(entry.discountPrice);\r\n  return baseAmount + chargeAmount - discountAmount;\r\n};\r\n\r\nexport default function CustomerRegistrationModal({\r\n  visible,\r\n  loading,\r\n  saving,\r\n  exists,\r\n  form,\r\n  error,\r\n  message,\r\n  lead,\r\n  staffOptions,\r\n  staffLoading,\r\n  staffError,\r\n  onClose,\r\n  onChange,\r\n  onSubmit,\r\n}: CustomerRegistrationModalProps) {\r\n  const [showAdvanced, setShowAdvanced] = useState(false);\r\n  const [frontPreview, setFrontPreview] = useState<string>(\"\");\r\n  const [backPreview, setBackPreview] = useState<string>(\"\");\r\n  const [addressDataLoading, setAddressDataLoading] = useState(false);\r\n  const [addressDataError, setAddressDataError] = useState<string | null>(null);\r\n  const [thaiProvinces, setThaiProvinces] = useState<ThaiProvince[]>([]);\r\n  const [thaiDistricts, setThaiDistricts] = useState<ThaiDistrict[]>([]);\r\n  const [thaiSubdistricts, setThaiSubdistricts] = useState<ThaiSubDistrict[]>([]);\r\n  const [selectedProvinceId, setSelectedProvinceId] = useState<number | null>(null);\r\n  const [selectedDistrictId, setSelectedDistrictId] = useState<number | null>(null);\r\n  const [selectedSubdistrictId, setSelectedSubdistrictId] = useState<number | null>(null);\r\n  const [baselineForm, setBaselineForm] = useState<CustomerFormData | null>(null);\r\n  const previousFormIdentityRef = useRef<string | null>(null);\r\n  const [opdGroups, setOpdGroups] = useState<OPDServiceGroup[]>([]);\r\n  const [groupsLoading, setGroupsLoading] = useState(false);\r\n  const [groupsError, setGroupsError] = useState<string | null>(null);\r\n  const [selectedOpdGroupCode, setSelectedOpdGroupCode] = useState<string>(\"\");\r\n  const [groupServiceItems, setGroupServiceItems] = useState<OPDServiceItem[]>([]);\r\n  const [serviceDrawerVisible, setServiceDrawerVisible] = useState(false);\r\n  const [servicesLoading, setServicesLoading] = useState(false);\r\n  const [serviceError, setServiceError] = useState<string | null>(null);\r\n  const [serviceSearchTerm, setServiceSearchTerm] = useState(\"\");\r\n  const [selectedServices, setSelectedServices] = useState<SelectedServiceEntry[]>([]);\r\n  const latestServiceFetchGroupRef = useRef<string | null>(null);\r\n\r\n  const basicSectionRef = useRef<HTMLDivElement | null>(null);\r\n  const documentsSectionRef = useRef<HTMLDivElement | null>(null);\r\n  const addressSectionRef = useRef<HTMLDivElement | null>(null);\r\n  const advancedSectionRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    setFrontPreview(form?.idcardFrontImage || \"\");\r\n    setBackPreview(form?.idcardBackImage || \"\");\r\n  }, [form?.idcardFrontImage, form?.idcardBackImage]);\r\n\r\n  useEffect(() => {\r\n    let cancelled = false;\r\n    const fetchGroups = async () => {\r\n      setGroupsLoading(true);\r\n      setGroupsError(null);\r\n      try {\r\n        const response = await fetch(\"/api/b-item-groups\");\r\n        const result = await response.json();\r\n        if (!response.ok || result.success === false) {\r\n          throw new Error(result.error || \"ไม่พบกลุ่มขาย OPD\");\r\n        }\r\n        if (cancelled) {\r\n          return;\r\n        }\r\n        setOpdGroups(Array.isArray(result.data) ? result.data : []);\r\n      } catch (error: any) {\r\n        if (cancelled) {\r\n          return;\r\n        }\r\n        setGroupsError(error?.message || \"ไม่สามารถโหลดกลุ่มขาย OPD ได้\");\r\n      } finally {\r\n        if (cancelled) {\r\n          return;\r\n        }\r\n        setGroupsLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchGroups();\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, []);\r\n\r\n  const loadServicesForGroup = async (groupCode: string) => {\r\n    if (!groupCode) {\r\n      setGroupServiceItems([]);\r\n      return;\r\n    }\r\n    latestServiceFetchGroupRef.current = groupCode;\r\n    setServicesLoading(true);\r\n    setServiceError(null);\r\n    setGroupServiceItems([]);\r\n    try {\r\n      const response = await fetch(\r\n        `/api/b-item-services?groupCode=${encodeURIComponent(groupCode)}`\r\n      );\r\n      const result = await response.json();\r\n      if (!response.ok || result.success === false) {\r\n        throw new Error(result.error || \"ไม่พบรายการบริการ\");\r\n      }\r\n      if (latestServiceFetchGroupRef.current !== groupCode) {\r\n        return;\r\n      }\r\n      const normalizedItems = Array.isArray(result.data)\r\n        ? result.data.map((item: OPDServiceItem) => ({\r\n          ...item,\r\n          saleprice: normalizeSalepriceValue(item.saleprice),\r\n        }))\r\n        : [];\r\n      setGroupServiceItems(normalizedItems as OPDServiceItem[]);\r\n    } catch (error: any) {\r\n      if (latestServiceFetchGroupRef.current !== groupCode) {\r\n        return;\r\n      }\r\n      setServiceError(error?.message || \"ไม่สามารถโหลดรายการบริการได้\");\r\n    } finally {\r\n      if (latestServiceFetchGroupRef.current === groupCode) {\r\n        setServicesLoading(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleGroupSelect = (groupCode: string) => {\r\n    setSelectedOpdGroupCode(groupCode);\r\n    setServiceSearchTerm(\"\");\r\n    setServiceError(null);\r\n    if (!groupCode) {\r\n      setGroupServiceItems([]);\r\n      setServiceDrawerVisible(false);\r\n      return;\r\n    }\r\n    loadServicesForGroup(groupCode);\r\n    setServiceDrawerVisible(true);\r\n  };\r\n\r\n  const handleOpenServiceDrawer = () => {\r\n    setServiceDrawerVisible(true);\r\n    setServiceError(null);\r\n    if (selectedOpdGroupCode) {\r\n      loadServicesForGroup(selectedOpdGroupCode);\r\n    }\r\n  };\r\n\r\n  const handleCloseServiceDrawer = () => {\r\n    setServiceDrawerVisible(false);\r\n    setServiceSearchTerm(\"\");\r\n    setServiceError(null);\r\n  };\r\n\r\n  const updateSelectedServiceEntry = (\r\n    id: string,\r\n    updater: (entry: SelectedServiceEntry) => SelectedServiceEntry\r\n  ) => {\r\n    setSelectedServices((current) =>\r\n      current.map((entry) => (entry.id === id ? updater(entry) : entry))\r\n    );\r\n  };\r\n\r\n  const handleChargePriceChange = (id: string, value: string) => {\r\n    updateSelectedServiceEntry(id, (entry) => {\r\n      const trimmed = value.trim();\r\n      const numeric = Number(trimmed);\r\n      const hasValue = trimmed.length > 0 && Number.isFinite(numeric);\r\n      const nextPercent =\r\n        hasValue && entry.salesprice > 0\r\n          ? formatDecimalInputValue((numeric / entry.salesprice) * 100)\r\n          : \"\";\r\n      return {\r\n        ...entry,\r\n        chargePrice: value,\r\n        chargePercent: nextPercent,\r\n      };\r\n    });\r\n  };\r\n\r\n  const handleChargePercentChange = (id: string, value: string) => {\r\n    updateSelectedServiceEntry(id, (entry) => {\r\n      const trimmed = value.trim();\r\n      const numeric = Number(trimmed);\r\n      const hasValue = trimmed.length > 0 && Number.isFinite(numeric);\r\n      const nextPrice =\r\n        hasValue && entry.salesprice > 0\r\n          ? formatDecimalInputValue((entry.salesprice * numeric) / 100)\r\n          : \"\";\r\n      return {\r\n        ...entry,\r\n        chargePrice: nextPrice,\r\n        chargePercent: value,\r\n      };\r\n    });\r\n  };\r\n\r\n  const handleDiscountPriceChange = (id: string, value: string) => {\r\n    updateSelectedServiceEntry(id, (entry) => {\r\n      const trimmed = value.trim();\r\n      const numeric = Number(trimmed);\r\n      const hasValue = trimmed.length > 0 && Number.isFinite(numeric);\r\n      const nextPercent =\r\n        hasValue && entry.salesprice > 0\r\n          ? formatDecimalInputValue((numeric / entry.salesprice) * 100)\r\n          : \"\";\r\n      return {\r\n        ...entry,\r\n        discountPrice: value,\r\n        discountPercent: nextPercent,\r\n      };\r\n    });\r\n  };\r\n\r\n  const handleDiscountPercentChange = (id: string, value: string) => {\r\n    updateSelectedServiceEntry(id, (entry) => {\r\n      const trimmed = value.trim();\r\n      const numeric = Number(trimmed);\r\n      const hasValue = trimmed.length > 0 && Number.isFinite(numeric);\r\n      const nextPrice =\r\n        hasValue && entry.salesprice > 0\r\n          ? formatDecimalInputValue((entry.salesprice * numeric) / 100)\r\n          : \"\";\r\n      return {\r\n        ...entry,\r\n        discountPrice: nextPrice,\r\n        discountPercent: value,\r\n      };\r\n    });\r\n  };\r\n\r\n  const handleAddService = (item: OPDServiceItem) => {\r\n    setSelectedServices((current) => {\r\n      if (current.some((entry) => entry.itemcode === item.itemcode)) {\r\n        return current;\r\n      }\r\n      return [\r\n        ...current,\r\n        {\r\n          id: `${item.itemcode}-${Date.now()}`,\r\n          itemcode: item.itemcode,\r\n          itemname: item.itemname,\r\n          salesprice: normalizeSalepriceValue(item.saleprice),\r\n          chargePrice: \"\",\r\n          chargePercent: \"\",\r\n          discountPrice: \"\",\r\n          discountPercent: \"\",\r\n        },\r\n      ];\r\n    });\r\n  };\r\n\r\n  const handleRemoveServiceEntry = (id: string) => {\r\n    setSelectedServices((current) => current.filter((entry) => entry.id !== id));\r\n  };\r\n\r\n  const selectedOpdGroup = useMemo(\r\n    () => opdGroups.find((group) => group.groupcode === selectedOpdGroupCode) ?? null,\r\n    [opdGroups, selectedOpdGroupCode]\r\n  );\r\n\r\n  const selectedServicesTotals = useMemo(\r\n    () =>\r\n      selectedServices.reduce(\r\n        (acc, entry) => {\r\n          const baseAmount = Number.isFinite(entry.salesprice) ? entry.salesprice : 0;\r\n          const chargeAmount = parseMonetaryInputValue(entry.chargePrice);\r\n          const discountAmount = parseMonetaryInputValue(entry.discountPrice);\r\n          const netAmount = baseAmount + chargeAmount - discountAmount;\r\n          acc.baseTotal += baseAmount;\r\n          acc.chargeTotal += chargeAmount;\r\n          acc.discountTotal += discountAmount;\r\n          acc.netTotal += netAmount;\r\n          return acc;\r\n        },\r\n        { baseTotal: 0, chargeTotal: 0, discountTotal: 0, netTotal: 0 }\r\n      ),\r\n    [selectedServices]\r\n  );\r\n\r\n  const filteredServiceItems = useMemo(() => {\r\n    if (!serviceSearchTerm.trim()) {\r\n      return groupServiceItems;\r\n    }\r\n    const lowerTerm = serviceSearchTerm.trim().toLowerCase();\r\n    return groupServiceItems.filter(\r\n      (item) =>\r\n        item.itemname.toLowerCase().includes(lowerTerm) ||\r\n        item.itemcode.toLowerCase().includes(lowerTerm)\r\n    );\r\n  }, [groupServiceItems, serviceSearchTerm]);\r\n\r\n  const formIdentity = useMemo(\r\n    () => `${form?.cn ?? \"\"}::${form?.code ?? \"\"}`,\r\n    [form?.cn, form?.code]\r\n  );\r\n\r\n  useEffect(() => {\r\n    if (!visible) {\r\n      previousFormIdentityRef.current = null;\r\n      setBaselineForm(null);\r\n      return;\r\n    }\r\n\r\n    if (!form) {\r\n      return;\r\n    }\r\n\r\n    if (previousFormIdentityRef.current !== formIdentity || !baselineForm) {\r\n      setBaselineForm({ ...form });\r\n      previousFormIdentityRef.current = formIdentity;\r\n    }\r\n  }, [visible, form, formIdentity, baselineForm]);\r\n\r\n  const normalizedCountryValue = normalizeName(form?.country ?? \"Thailand\");\r\n  const treatAsThailand =\r\n    !form?.country ||\r\n    normalizedCountryValue === \"thailand\" ||\r\n    normalizedCountryValue === \"ไทย\" ||\r\n    normalizedCountryValue === \"th\";\r\n\r\n  useEffect(() => {\r\n    if (!visible || !treatAsThailand) {\r\n      return;\r\n    }\r\n\r\n    if (thaiProvinces.length && thaiDistricts.length && thaiSubdistricts.length) {\r\n      return;\r\n    }\r\n\r\n    let cancelled = false;\r\n    setAddressDataLoading(true);\r\n\r\n    fetchThaiAdministrativeData()\r\n      .then((data) => {\r\n        if (cancelled) {\r\n          return;\r\n        }\r\n        setThaiProvinces(data.provinces);\r\n        setThaiDistricts(data.districts);\r\n        setThaiSubdistricts(data.subdistricts);\r\n        setAddressDataError(null);\r\n      })\r\n      .catch((error: any) => {\r\n        if (cancelled) {\r\n          return;\r\n        }\r\n        setAddressDataError(error?.message || \"ไม่สามารถโหลดข้อมูลที่อยู่ประเทศไทยได้\");\r\n      })\r\n      .finally(() => {\r\n        if (cancelled) {\r\n          return;\r\n        }\r\n        setAddressDataLoading(false);\r\n      });\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [visible, treatAsThailand, thaiProvinces.length, thaiDistricts.length, thaiSubdistricts.length]);\r\n\r\n  useEffect(() => {\r\n    if (!treatAsThailand) {\r\n      setSelectedProvinceId(null);\r\n      setSelectedDistrictId(null);\r\n      setSelectedSubdistrictId(null);\r\n    }\r\n  }, [treatAsThailand]);\r\n\r\n  useEffect(() => {\r\n    if (!treatAsThailand || !thaiProvinces.length || !form?.province) {\r\n      if (!form?.province) {\r\n        setSelectedProvinceId(null);\r\n      }\r\n      return;\r\n    }\r\n\r\n    const match = thaiProvinces.find((province) =>\r\n      matchesAdministrativeName(province, form.province)\r\n    );\r\n\r\n    setSelectedProvinceId(match ? match.id : null);\r\n  }, [form?.province, treatAsThailand, thaiProvinces]);\r\n\r\n  useEffect(() => {\r\n    if (!treatAsThailand || !thaiDistricts.length) {\r\n      return;\r\n    }\r\n\r\n    if (!selectedProvinceId) {\r\n      setSelectedDistrictId(null);\r\n      return;\r\n    }\r\n\r\n    if (!form?.amphur) {\r\n      setSelectedDistrictId(null);\r\n      return;\r\n    }\r\n\r\n    const match = thaiDistricts.find(\r\n      (district) =>\r\n        district.province_id === selectedProvinceId &&\r\n        matchesAdministrativeName(district, form.amphur)\r\n    );\r\n\r\n    setSelectedDistrictId(match ? match.id : null);\r\n  }, [form?.amphur, treatAsThailand, thaiDistricts, selectedProvinceId]);\r\n\r\n  useEffect(() => {\r\n    if (!treatAsThailand || !thaiSubdistricts.length) {\r\n      return;\r\n    }\r\n\r\n    if (!selectedDistrictId) {\r\n      setSelectedSubdistrictId(null);\r\n      return;\r\n    }\r\n\r\n    if (!form?.tumbon) {\r\n      setSelectedSubdistrictId(null);\r\n      return;\r\n    }\r\n\r\n    const match = thaiSubdistricts.find(\r\n      (subdistrict) =>\r\n        subdistrict.district_id === selectedDistrictId &&\r\n        matchesAdministrativeName(subdistrict, form.tumbon)\r\n    );\r\n\r\n    setSelectedSubdistrictId(match ? match.id : null);\r\n  }, [form?.tumbon, treatAsThailand, thaiSubdistricts, selectedDistrictId]);\r\n\r\n  const provinceOptions = useMemo(() => {\r\n    return thaiProvinces.map((province) => ({\r\n      id: province.id,\r\n      label: `${province.name_th} (${province.name_en})`,\r\n    }));\r\n  }, [thaiProvinces]);\r\n\r\n  const districtOptions = useMemo(() => {\r\n    if (!selectedProvinceId) {\r\n      return [] as Array<{ id: number; label: string }>;\r\n    }\r\n\r\n    return thaiDistricts\r\n      .filter((district) => district.province_id === selectedProvinceId)\r\n      .map((district) => ({\r\n        id: district.id,\r\n        label: `${district.name_th} (${district.name_en})`,\r\n      }));\r\n  }, [thaiDistricts, selectedProvinceId]);\r\n\r\n  const subdistrictOptions = useMemo(() => {\r\n    if (!selectedDistrictId) {\r\n      return [] as Array<{ id: number; label: string }>;\r\n    }\r\n\r\n    return thaiSubdistricts\r\n      .filter((subdistrict) => subdistrict.district_id === selectedDistrictId)\r\n      .map((subdistrict) => ({\r\n        id: subdistrict.id,\r\n        label: `${subdistrict.name_th} (${subdistrict.name_en})`,\r\n      }));\r\n  }, [thaiSubdistricts, selectedDistrictId]);\r\n\r\n  const handleProvinceSelect = (provinceIdValue: string) => {\r\n    if (provinceIdValue === provinceLegacyOptionValue) {\r\n      return;\r\n    }\r\n\r\n    if (!provinceIdValue) {\r\n      setSelectedProvinceId(null);\r\n      setSelectedDistrictId(null);\r\n      setSelectedSubdistrictId(null);\r\n      onChange(\"province\", \"\");\r\n      onChange(\"amphur\", \"\");\r\n      onChange(\"tumbon\", \"\");\r\n      onChange(\"zipcode\", \"\");\r\n      return;\r\n    }\r\n\r\n    const numericId = Number(provinceIdValue);\r\n\r\n    if (!Number.isFinite(numericId)) {\r\n      return;\r\n    }\r\n\r\n    const province = thaiProvinces.find((item) => item.id === numericId);\r\n\r\n    setSelectedProvinceId(numericId);\r\n    setSelectedDistrictId(null);\r\n    setSelectedSubdistrictId(null);\r\n    onChange(\"province\", province?.name_th || \"\");\r\n    onChange(\"amphur\", \"\");\r\n    onChange(\"tumbon\", \"\");\r\n    onChange(\"zipcode\", \"\");\r\n  };\r\n\r\n  const handleDistrictSelect = (districtIdValue: string) => {\r\n    if (districtIdValue === districtLegacyOptionValue) {\r\n      return;\r\n    }\r\n\r\n    if (!districtIdValue) {\r\n      setSelectedDistrictId(null);\r\n      setSelectedSubdistrictId(null);\r\n      onChange(\"amphur\", \"\");\r\n      onChange(\"tumbon\", \"\");\r\n      onChange(\"zipcode\", \"\");\r\n      return;\r\n    }\r\n\r\n    const numericId = Number(districtIdValue);\r\n\r\n    if (!Number.isFinite(numericId)) {\r\n      return;\r\n    }\r\n\r\n    const district = thaiDistricts.find((item) => item.id === numericId);\r\n\r\n    setSelectedDistrictId(numericId);\r\n    setSelectedSubdistrictId(null);\r\n    onChange(\"amphur\", district?.name_th || \"\");\r\n    onChange(\"tumbon\", \"\");\r\n    onChange(\"zipcode\", \"\");\r\n  };\r\n\r\n  const handleSubdistrictSelect = (subdistrictIdValue: string) => {\r\n    if (subdistrictIdValue === subdistrictLegacyOptionValue) {\r\n      return;\r\n    }\r\n\r\n    if (!subdistrictIdValue) {\r\n      setSelectedSubdistrictId(null);\r\n      onChange(\"tumbon\", \"\");\r\n      onChange(\"zipcode\", \"\");\r\n      return;\r\n    }\r\n\r\n    const numericId = Number(subdistrictIdValue);\r\n\r\n    if (!Number.isFinite(numericId)) {\r\n      return;\r\n    }\r\n\r\n    const subdistrict = thaiSubdistricts.find((item) => item.id === numericId);\r\n\r\n    setSelectedSubdistrictId(numericId);\r\n    onChange(\"tumbon\", subdistrict?.name_th || \"\");\r\n\r\n    if (subdistrict?.zip_code !== null && subdistrict?.zip_code !== undefined) {\r\n      const zipValue = String(subdistrict.zip_code).trim();\r\n      if (zipValue) {\r\n        onChange(\"zipcode\", zipValue);\r\n      }\r\n    }\r\n  };\r\n\r\n  const shouldUseThaiDropdowns =\r\n    treatAsThailand &&\r\n    thaiProvinces.length > 0 &&\r\n    thaiDistricts.length > 0 &&\r\n    thaiSubdistricts.length > 0 &&\r\n    !addressDataError;\r\n\r\n  const ownernameValue = form?.ownername?.trim() || \"\";\r\n  const ownercodeValue = form?.ownercode?.trim() || \"\";\r\n\r\n  useEffect(() => {\r\n    if (!visible || !ownernameValue || ownercodeValue) {\r\n      return;\r\n    }\r\n\r\n    const match = staffOptions.find((option) => option.nickname === ownernameValue);\r\n    if (match) {\r\n      onChange(\"ownercode\", match.code);\r\n      if (match.nickname !== ownernameValue) {\r\n        onChange(\"ownername\", match.nickname);\r\n      }\r\n    }\r\n  }, [visible, ownernameValue, ownercodeValue, staffOptions, onChange]);\r\n\r\n  const handleIdCardImageChange = (side: \"front\" | \"back\", file?: File) => {\r\n    if (!file) {\r\n      if (side === \"front\") {\r\n        setFrontPreview(\"\");\r\n        onChange(\"idcardFrontImage\", \"\");\r\n      } else {\r\n        setBackPreview(\"\");\r\n        onChange(\"idcardBackImage\", \"\");\r\n      }\r\n      return;\r\n    }\r\n\r\n    const reader = new FileReader();\r\n    reader.onload = () => {\r\n      const result = typeof reader.result === \"string\" ? reader.result : \"\";\r\n      if (side === \"front\") {\r\n        setFrontPreview(result);\r\n        onChange(\"idcardFrontImage\", result);\r\n      } else {\r\n        setBackPreview(result);\r\n        onChange(\"idcardBackImage\", result);\r\n      }\r\n    };\r\n    reader.readAsDataURL(file);\r\n  };\r\n\r\n  const updateFields = (payload: Partial<CustomerFormData>) => {\r\n    Object.entries(payload).forEach(([field, value]) => {\r\n      onChange(field as keyof CustomerFormData, typeof value === \"string\" ? value : \"\");\r\n    });\r\n  };\r\n\r\n  if (!visible || !form) {\r\n    return null;\r\n  }\r\n\r\n  const getFieldValue = (data: CustomerFormData | null, field: keyof CustomerFormData) =>\r\n    data && typeof data[field] === \"string\" ? (data[field] as string) : \"\";\r\n\r\n  const isFieldDirty = (field: keyof CustomerFormData) => {\r\n    if (!baselineForm) {\r\n      return Boolean(getFieldValue(form, field));\r\n    }\r\n    return getFieldValue(baselineForm, field) !== getFieldValue(form, field);\r\n  };\r\n\r\n  const buildSectionStatus = (fields: Array<keyof CustomerFormData>): SectionStatus => {\r\n    if (!baselineForm) {\r\n      const hasAnyValue = fields.some((field) => Boolean(getFieldValue(form, field)));\r\n      return hasAnyValue\r\n        ? { label: \"กำลังกำหนด\", className: \"bg-sky-100 text-sky-700\" }\r\n        : { label: \"รอกรอก\", className: \"bg-gray-200 text-gray-700\" };\r\n    }\r\n\r\n    const dirty = fields.some((field) => isFieldDirty(field));\r\n    return dirty\r\n      ? { label: \"ข้อมูลใหม่\", className: \"bg-emerald-100 text-emerald-700\" }\r\n      : { label: \"ตรงกับฐานข้อมูล\", className: \"bg-gray-100 text-gray-600\" };\r\n  };\r\n\r\n  const statusBadgeBaseClass =\r\n    \"inline-flex items-center gap-1 rounded-full px-3 py-1 text-xs font-semibold shadow-sm\";\r\n\r\n  const basicFields: Array<keyof CustomerFormData> = [\r\n    \"cn\",\r\n    \"registerdate\",\r\n    \"prefix\",\r\n    \"name\",\r\n    \"surname\",\r\n    \"nickname\",\r\n    \"gender\",\r\n    \"birthdate\",\r\n    \"mobilephone\",\r\n    \"email\",\r\n    \"lineid\",\r\n    \"facebook\",\r\n    \"medianame\",\r\n    \"displayname\",\r\n    \"ownercode\",\r\n    \"ownername\",\r\n  ];\r\n\r\n  const documentsFields: Array<keyof CustomerFormData> = [\r\n    \"country\",\r\n    \"idcardFrontImage\",\r\n    \"idcardBackImage\",\r\n  ];\r\n\r\n  const addressFields: Array<keyof CustomerFormData> = [\r\n    \"province\",\r\n    \"amphur\",\r\n    \"tumbon\",\r\n    \"zipcode\",\r\n  ];\r\n\r\n  const advancedMemberFields: Array<keyof CustomerFormData> = [\r\n    \"recordno\",\r\n    \"idcard\",\r\n    \"binddate\",\r\n    \"cusgroup\",\r\n    \"member\",\r\n  ];\r\n\r\n  const advancedHealthFields: Array<keyof CustomerFormData> = [\"disease\", \"allergic\"];\r\n\r\n  const advancedHomeFields: Array<keyof CustomerFormData> = [\"locno\", \"moo\", \"soi\", \"road\"];\r\n\r\n  const advancedCardFields: Array<keyof CustomerFormData> = [\r\n    \"idcardLaserCode\",\r\n    \"idcardIssueDate\",\r\n    \"idcardExpireDate\",\r\n  ];\r\n\r\n  const advancedNativeFields: Array<keyof CustomerFormData> = [\r\n    \"idcardProvinceNative\",\r\n    \"idcardDistrictNative\",\r\n    \"idcardSubdistrictNative\",\r\n  ];\r\n\r\n  const basicStatus = buildSectionStatus(basicFields);\r\n  const documentsStatus = buildSectionStatus(documentsFields);\r\n  const addressStatus = buildSectionStatus(addressFields);\r\n  const memberStatus = buildSectionStatus(advancedMemberFields);\r\n  const healthStatus = buildSectionStatus(advancedHealthFields);\r\n  const homeStatus = buildSectionStatus(advancedHomeFields);\r\n  const cardStatus = buildSectionStatus(advancedCardFields);\r\n  const nativeStatus = buildSectionStatus(advancedNativeFields);\r\n  const advancedStatus = buildSectionStatus([\r\n    ...advancedMemberFields,\r\n    ...advancedHealthFields,\r\n    ...advancedHomeFields,\r\n    ...advancedCardFields,\r\n    ...advancedNativeFields,\r\n  ]);\r\n\r\n  const sectionNavItems: SectionNavItem[] = [\r\n    { id: \"basic\", label: \"ข้อมูลลูกค้า\", ref: basicSectionRef, status: basicStatus },\r\n    {\r\n      id: \"documents\",\r\n      label: \"เอกสาร / ทั่วไป\",\r\n      ref: documentsSectionRef,\r\n      status: documentsStatus,\r\n    },\r\n    { id: \"address\", label: \"ที่อยู่ปัจจุบัน\", ref: addressSectionRef, status: addressStatus },\r\n    {\r\n      id: \"advanced\",\r\n      label: \"รายละเอียดเพิ่มเติม\",\r\n      ref: advancedSectionRef,\r\n      status: advancedStatus,\r\n      requiresAdvanced: true,\r\n    },\r\n  ];\r\n\r\n  const scrollToSection = (target: RefObject<HTMLDivElement | null>) => {\r\n    const element = target.current;\r\n    if (!element) {\r\n      return;\r\n    }\r\n    element.scrollIntoView({ behavior: \"smooth\", block: \"start\" });\r\n  };\r\n\r\n  const handleSectionNavClick = (item: SectionNavItem) => {\r\n    if (item.requiresAdvanced && !showAdvanced) {\r\n      setShowAdvanced(true);\r\n      setTimeout(() => scrollToSection(item.ref), 160);\r\n      return;\r\n    }\r\n    scrollToSection(item.ref);\r\n  };\r\n\r\n  const setIfEmpty = (field: keyof CustomerFormData, value: string | undefined | null) => {\r\n    if (!value) {\r\n      return;\r\n    }\r\n    if (getFieldValue(form, field)) {\r\n      return;\r\n    }\r\n    onChange(field, value);\r\n  };\r\n\r\n  const handleAutoFillFromLead = () => {\r\n    if (!lead) {\r\n      return;\r\n    }\r\n\r\n    const trimmedName = lead.name?.trim();\r\n    if (trimmedName) {\r\n      const prefixMatch = trimmedName.match(/^(คุณ|นาย|นาง|นส\\.|นพ\\.|พญ\\.|ดช\\.|ดญ\\.)/);\r\n      let remainingName = trimmedName;\r\n      if (prefixMatch) {\r\n        setIfEmpty(\"prefix\", prefixMatch[0]);\r\n        remainingName = remainingName.replace(prefixMatch[0], \"\").trim();\r\n      }\r\n\r\n      const nameParts = remainingName.split(/\\s+/).filter(Boolean);\r\n      if (nameParts.length === 1) {\r\n        setIfEmpty(\"name\", nameParts[0]);\r\n      } else if (nameParts.length > 1) {\r\n        setIfEmpty(\"name\", nameParts[0]);\r\n        setIfEmpty(\"surname\", nameParts.slice(1).join(\" \"));\r\n      }\r\n      setIfEmpty(\"nickname\", nameParts[0]);\r\n      setIfEmpty(\"displayname\", trimmedName);\r\n    }\r\n\r\n    setIfEmpty(\"mobilephone\", lead.phone);\r\n    setIfEmpty(\"cusgroup\", lead.status);\r\n    setIfEmpty(\"medianame\", lead.interestedProduct);\r\n    setIfEmpty(\"country\", \"Thailand\");\r\n  };\r\n\r\n  const handleResetToDefault = () => {\r\n    if (!baselineForm) {\r\n      return;\r\n    }\r\n    updateFields({ ...baselineForm });\r\n  };\r\n\r\n  const autoFillDisabled = !lead;\r\n  const resetDisabled = !baselineForm;\r\n\r\n  const hasMatchingOwnercode = Boolean(\r\n    ownercodeValue && staffOptions.some((option) => option.code === ownercodeValue)\r\n  );\r\n  const legacyOwnerOptionValue = \"__legacy__\";\r\n  const ownerSelectValue = hasMatchingOwnercode\r\n    ? ownercodeValue\r\n    : ownernameValue\r\n      ? legacyOwnerOptionValue\r\n      : \"\";\r\n  const prefixOptions = [\r\n    \"คุณ\",\r\n    \"นาย\",\r\n    \"นาง\",\r\n    \"นส.\",\r\n    \"นพ.\",\r\n    \"พญ.\",\r\n    \"ดช.\",\r\n    \"ดญ.\",\r\n  ];\r\n\r\n  return (\r\n    <div className=\"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 p-4 backdrop-blur-sm\">\r\n      <div className=\"max-h-[95vh] w-full max-w-5xl overflow-y-auto rounded-3xl bg-gradient-to-br from-white via-blue-50 to-indigo-100 shadow-2xl\">\r\n        <div className=\"flex items-start justify-between gap-4 border-b border-white/40 bg-gradient-to-r from-blue-600 to-indigo-600 p-6 text-white\">\r\n          <div>\r\n            <h2 className=\"text-2xl font-bold\">\r\n              {exists ? \"แก้ไขข้อมูลลูกค้า\" : \"ลงทะเบียนลูกค้า\"}\r\n            </h2>\r\n            {lead && (\r\n              <p className=\"mt-1 text-sm text-blue-100\">\r\n                #{lead.id} · {lead.name} · {lead.phone} · {lead.status} · {lead.interestedProduct}\r\n              </p>\r\n            )}\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"rounded-full bg-white/20 p-2 transition hover:bg-white/30\"\r\n            aria-label=\"ปิดกล่องลงทะเบียน\"\r\n          >\r\n            <svg className=\"h-6 w-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n            </svg>\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"sticky top-0 z-10 border-b border-white/60 bg-white/70 px-6 py-3 backdrop-blur\">\r\n          <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\r\n            <nav className=\"flex flex-wrap gap-2\">\r\n              {sectionNavItems.map((item) => (\r\n                <button\r\n                  key={item.id}\r\n                  type=\"button\"\r\n                  onClick={() => handleSectionNavClick(item)}\r\n                  className=\"inline-flex items-center gap-2 rounded-full border border-white/70 bg-white/80 px-4 py-2 text-sm font-medium text-gray-700 shadow-sm transition hover:border-indigo-400 hover:text-indigo-600\"\r\n                >\r\n                  <span>{item.label}</span>\r\n                  <span className={`${statusBadgeBaseClass} ${item.status.className}`}>\r\n                    {item.status.label}\r\n                  </span>\r\n                </button>\r\n              ))}\r\n            </nav>\r\n            <div className=\"flex flex-wrap gap-2\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleAutoFillFromLead}\r\n                disabled={autoFillDisabled}\r\n                className=\"inline-flex items-center gap-2 rounded-full bg-indigo-600 px-4 py-2 text-sm font-semibold text-white shadow transition hover:bg-indigo-700 disabled:cursor-not-allowed disabled:bg-gray-300 disabled:text-gray-500\"\r\n                title={lead ? \"เติมข้อมูลจากข้อมูลลูกค้า\" : \"ไม่มีข้อมูลลูกค้าให้เติม\"}\r\n              >\r\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" strokeWidth={1.5} viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 6v12m6-6H6\" />\r\n                </svg>\r\n                เติมข้อมูลอัตโนมัติ\r\n              </button>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleResetToDefault}\r\n                disabled={resetDisabled}\r\n                className=\"inline-flex items-center gap-2 rounded-full border border-gray-300 bg-white/80 px-4 py-2 text-sm font-semibold text-gray-700 shadow-sm transition hover:border-indigo-400 hover:text-indigo-600 disabled:cursor-not-allowed disabled:text-gray-400\"\r\n                title=\"คืนค่าตามฐานข้อมูล\"\r\n              >\r\n                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" strokeWidth={1.5} viewBox=\"0 0 24 24\">\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    d=\"M4.5 12a7.5 7.5 0 0112.618-5.303L18 7.5m0-3v3h-3M19.5 12a7.5 7.5 0 01-12.618 5.303L6 16.5m0 3v-3h3\"\r\n                  />\r\n                </svg>\r\n                คืนค่าจากฐานข้อมูล\r\n              </button>\r\n            </div>\r\n            <div className=\"mt-3 flex flex-wrap items-center gap-3\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleOpenServiceDrawer}\r\n                className=\"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-emerald-500 to-teal-500 px-5 py-2.5 text-sm font-semibold text-white shadow-lg transition hover:from-emerald-600 hover:to-teal-600\"\r\n              >\r\n                <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" strokeWidth={2} viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M12 6v6m0 0v6m0-6h6m-6 0H6\" />\r\n                </svg>\r\n                บริการ/ขาย\r\n                {selectedServices.length > 0 && (\r\n                  <span className=\"ml-1 inline-flex h-5 w-5 items-center justify-center rounded-full bg-white/30 text-xs font-bold\">\r\n                    {selectedServices.length}\r\n                  </span>\r\n                )}\r\n              </button>\r\n              {groupsLoading && (\r\n                <span className=\"text-xs text-gray-500\">กำลังโหลดกลุ่ม...</span>\r\n              )}\r\n              {groupsError && (\r\n                <span className=\"text-xs text-red-500\">{groupsError}</span>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"space-y-6 px-6 py-5\">\r\n          {loading && (\r\n            <div className=\"rounded-xl bg-white/80 p-4 text-sm text-blue-700 shadow\">\r\n              กำลังโหลดข้อมูลลูกค้าจากฐานข้อมูล...\r\n            </div>\r\n          )}\r\n\r\n          {error && (\r\n            <div className=\"rounded-xl bg-red-100 p-4 text-sm text-red-700 shadow\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          <form\r\n            onSubmit={(event) => {\r\n              event.preventDefault();\r\n              onSubmit();\r\n            }}\r\n            className=\"space-y-6\"\r\n          >\r\n            <div className=\"space-y-4 rounded-2xl border border-white/60 bg-white/70 p-5 shadow-sm\">\r\n              <h3 className=\"text-lg font-semibold text-gray-800\">ข้อมูลลูกค้า</h3>\r\n\r\n              <section className=\"grid grid-cols-1 gap-4 md:grid-cols-3\">\r\n                <div>\r\n                  <label className={labelClass}>CN (รหัสลูกค้า)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={`${inputClass} bg-gray-100`}\r\n                    value={form.cn}\r\n                    readOnly\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>วันที่ลงทะเบียน</label>\r\n                  <input\r\n                    type=\"date\"\r\n                    className={inputClass}\r\n                    value={form.registerdate}\r\n                    onChange={(event) => onChange(\"registerdate\", event.target.value)}\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className={labelClass}>คำนำหน้า</label>\r\n                  <select\r\n                    className={inputClass}\r\n                    value={form.prefix || \"\"}\r\n                    onChange={(event) => onChange(\"prefix\", event.target.value)}\r\n                  >\r\n                    <option value=\"\" disabled>\r\n                      เลือกคำนำหน้า\r\n                    </option>\r\n\r\n                    {prefixOptions.map((p) => (\r\n                      <option key={p} value={p}>\r\n                        {p}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n\r\n                <div>\r\n                  <label className={labelClass}>ชื่อ</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.name}\r\n                    onChange={(event) => onChange(\"name\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>นามสกุล</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.surname}\r\n                    onChange={(event) => onChange(\"surname\", event.target.value)}\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className={labelClass}>ชื่อเล่น</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.nickname}\r\n                    onChange={(event) => onChange(\"nickname\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>เพศ</label>\r\n                  <select\r\n                    className={inputClass}\r\n                    value={form.gender}\r\n                    onChange={(event) => onChange(\"gender\", event.target.value)}\r\n                  >\r\n                    {genderOptions.map((option) => (\r\n                      <option key={option.value} value={option.value}>\r\n                        {option.label}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>วันเกิด</label>\r\n                  <input\r\n                    type=\"date\"\r\n                    className={inputClass}\r\n                    value={form.birthdate}\r\n                    onChange={(event) => onChange(\"birthdate\", event.target.value)}\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className={labelClass}>เบอร์โทรหลัก</label>\r\n                  <input\r\n                    type=\"tel\"\r\n                    className={inputClass}\r\n                    value={form.mobilephone}\r\n                    onChange={(event) => onChange(\"mobilephone\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>อีเมล</label>\r\n                  <input\r\n                    type=\"email\"\r\n                    className={inputClass}\r\n                    value={form.email}\r\n                    onChange={(event) => onChange(\"email\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>LINE ID</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.lineid}\r\n                    onChange={(event) => onChange(\"lineid\", event.target.value)}\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label className={labelClass}>Facebook</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.facebook}\r\n                    onChange={(event) => onChange(\"facebook\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>ช่องทางสื่อ</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.medianame}\r\n                    onChange={(event) => onChange(\"medianame\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>ชื่อลูกค้า (ใช้แสดง)</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.displayname}\r\n                    onChange={(event) => onChange(\"displayname\", event.target.value)}\r\n                  />\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>ชื่อผู้ดูแล</label>\r\n                  <select\r\n                    className={inputClass}\r\n                    value={ownerSelectValue}\r\n                    onChange={(event) => {\r\n                      const selectedCode = event.target.value;\r\n                      if (selectedCode === legacyOwnerOptionValue) {\r\n                        return;\r\n                      }\r\n                      if (!selectedCode) {\r\n                        onChange(\"ownercode\", \"\");\r\n                        onChange(\"ownername\", \"\");\r\n                        return;\r\n                      }\r\n\r\n                      const selectedStaff = staffOptions.find((option) => option.code === selectedCode);\r\n                      onChange(\"ownercode\", selectedCode);\r\n                      onChange(\"ownername\", selectedStaff?.nickname || \"\");\r\n                    }}\r\n                    disabled={staffLoading && staffOptions.length === 0}\r\n                  >\r\n                    <option value=\"\">เลือกชื่อผู้ดูแล</option>\r\n                    {!hasMatchingOwnercode && ownernameValue && (\r\n                      <option value={legacyOwnerOptionValue} disabled>\r\n                        {`ข้อมูลเดิม: ${ownernameValue}`}\r\n                      </option>\r\n                    )}\r\n                    {staffOptions.map((option) => (\r\n                      <option key={option.code} value={option.code}>\r\n                        {option.nickname}\r\n                      </option>\r\n                    ))}\r\n                  </select>\r\n                  {staffLoading && staffOptions.length === 0 && (\r\n                    <p className=\"mt-1 text-xs text-blue-600\">กำลังโหลดรายชื่อผู้ดูแล...</p>\r\n                  )}\r\n                  {!staffLoading && staffError && (\r\n                    <p className=\"mt-1 text-xs text-red-600\">{staffError}</p>\r\n                  )}\r\n                  {!staffLoading && !staffError && !ownercodeValue && ownernameValue && (\r\n                    <p className=\"mt-1 text-xs text-amber-600\">\r\n                      ข้อมูลเดิม: {ownernameValue} (ไม่พบในรายชื่อพนักงาน)\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n              </section>\r\n              <div>\r\n                <label className={labelClass}>ประเทศ</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className={inputClass}\r\n                  value={form.country}\r\n                  onChange={(event) => onChange(\"country\", event.target.value)}\r\n                  placeholder=\"เช่น Thailand\"\r\n                />\r\n              </div>\r\n              <section className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\r\n                <div>\r\n                  <label className={labelClass}>จังหวัด</label>\r\n                  {shouldUseThaiDropdowns ? (\r\n                    <select\r\n                      className={inputClass}\r\n                      value={\r\n                        selectedProvinceId\r\n                          ? String(selectedProvinceId)\r\n                          : form.province\r\n                            ? provinceLegacyOptionValue\r\n                            : \"\"\r\n                      }\r\n                      onChange={(event) => handleProvinceSelect(event.target.value)}\r\n                      disabled={addressDataLoading}\r\n                    >\r\n                      <option value=\"\">เลือกจังหวัด</option>\r\n                      {!selectedProvinceId && form.province && (\r\n                        <option value={provinceLegacyOptionValue} disabled>\r\n                          {`ข้อมูลเดิม: ${form.province}`}\r\n                        </option>\r\n                      )}\r\n                      {provinceOptions.map((option) => (\r\n                        <option key={option.id} value={option.id}>\r\n                          {option.label}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  ) : (\r\n                    <input\r\n                      type=\"text\"\r\n                      className={inputClass}\r\n                      value={form.province}\r\n                      onChange={(event) => onChange(\"province\", event.target.value)}\r\n                    />\r\n                  )}\r\n                  {addressDataLoading && treatAsThailand && (\r\n                    <p className=\"mt-1 text-xs text-blue-600\">กำลังโหลดจังหวัด...</p>\r\n                  )}\r\n                  {addressDataError && treatAsThailand && (\r\n                    <p className=\"mt-1 text-xs text-red-600\">{addressDataError}</p>\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>อำเภอ/เขต</label>\r\n                  {shouldUseThaiDropdowns ? (\r\n                    <select\r\n                      className={inputClass}\r\n                      value={\r\n                        selectedDistrictId\r\n                          ? String(selectedDistrictId)\r\n                          : form.amphur\r\n                            ? districtLegacyOptionValue\r\n                            : \"\"\r\n                      }\r\n                      onChange={(event) => handleDistrictSelect(event.target.value)}\r\n                      disabled={!selectedProvinceId || addressDataLoading}\r\n                    >\r\n                      <option value=\"\">เลือกอำเภอ/เขต</option>\r\n                      {!selectedDistrictId && form.amphur && (\r\n                        <option value={districtLegacyOptionValue} disabled>\r\n                          {`ข้อมูลเดิม: ${form.amphur}`}\r\n                        </option>\r\n                      )}\r\n                      {districtOptions.map((option) => (\r\n                        <option key={option.id} value={option.id}>\r\n                          {option.label}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  ) : (\r\n                    <input\r\n                      type=\"text\"\r\n                      className={inputClass}\r\n                      value={form.amphur}\r\n                      onChange={(event) => onChange(\"amphur\", event.target.value)}\r\n                    />\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>ตำบล/แขวง</label>\r\n                  {shouldUseThaiDropdowns ? (\r\n                    <select\r\n                      className={inputClass}\r\n                      value={\r\n                        selectedSubdistrictId\r\n                          ? String(selectedSubdistrictId)\r\n                          : form.tumbon\r\n                            ? subdistrictLegacyOptionValue\r\n                            : \"\"\r\n                      }\r\n                      onChange={(event) => handleSubdistrictSelect(event.target.value)}\r\n                      disabled={!selectedDistrictId || addressDataLoading}\r\n                    >\r\n                      <option value=\"\">เลือกตำบล/แขวง</option>\r\n                      {!selectedSubdistrictId && form.tumbon && (\r\n                        <option value={subdistrictLegacyOptionValue} disabled>\r\n                          {`ข้อมูลเดิม: ${form.tumbon}`}\r\n                        </option>\r\n                      )}\r\n                      {subdistrictOptions.map((option) => (\r\n                        <option key={option.id} value={option.id}>\r\n                          {option.label}\r\n                        </option>\r\n                      ))}\r\n                    </select>\r\n                  ) : (\r\n                    <input\r\n                      type=\"text\"\r\n                      className={inputClass}\r\n                      value={form.tumbon}\r\n                      onChange={(event) => onChange(\"tumbon\", event.target.value)}\r\n                    />\r\n                  )}\r\n                </div>\r\n                <div>\r\n                  <label className={labelClass}>รหัสไปรษณีย์</label>\r\n                  <input\r\n                    type=\"text\"\r\n                    className={inputClass}\r\n                    value={form.zipcode}\r\n                    onChange={(event) => onChange(\"zipcode\", event.target.value)}\r\n                  />\r\n                </div>\r\n              </section>\r\n            </div>\r\n\r\n            <div className=\"space-y-4 rounded-2xl border border-white/60 bg-white/70 p-5 shadow-sm\">\r\n              <h3 className=\"text-lg font-semibold text-gray-800\">เอกสารและข้อมูลทั่วไป</h3>\r\n\r\n              <section className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\r\n                <div className=\"rounded-xl border border-dashed border-indigo-300 bg-white/80 p-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <label className={`${labelClass} text-indigo-700`}>\r\n                      ภาพหน้าบัตรประชาชน\r\n                    </label>\r\n                    {frontPreview && (\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => handleIdCardImageChange(\"front\")}\r\n                        className=\"text-xs font-semibold text-indigo-600 underline-offset-2 hover:underline\"\r\n                      >\r\n                        ลบภาพ\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"mt-3 flex flex-col items-center gap-3\">\r\n                    <div className=\"h-32 w-full overflow-hidden rounded-lg border border-indigo-200 bg-indigo-50\">\r\n                      {frontPreview ? (\r\n                        <img\r\n                          src={frontPreview}\r\n                          alt=\"Thai ID front\"\r\n                          className=\"h-full w-full object-cover\"\r\n                        />\r\n                      ) : (\r\n                        <div className=\"flex h-full w-full items-center justify-center text-xs text-indigo-400\">\r\n                          ยังไม่มีภาพหน้าบัตร\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <label className=\"w-full cursor-pointer rounded-lg bg-gradient-to-r from-indigo-500 to-purple-500 px-4 py-2 text-center text-sm font-semibold text-white shadow hover:from-indigo-600 hover:to-purple-600\">\r\n                      อัปโหลดภาพหน้าบัตร\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                        onChange={(event) =>\r\n                          handleIdCardImageChange(\"front\", event.target.files?.[0])\r\n                        }\r\n                      />\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n                <div className=\"rounded-xl border border-dashed border-indigo-300 bg-white/80 p-4\">\r\n                  <div className=\"flex items-center justify-between\">\r\n                    <label className={`${labelClass} text-indigo-700`}>\r\n                      ภาพหลังบัตรประชาชน\r\n                    </label>\r\n                    {backPreview && (\r\n                      <button\r\n                        type=\"button\"\r\n                        onClick={() => handleIdCardImageChange(\"back\")}\r\n                        className=\"text-xs font-semibold text-indigo-600 underline-offset-2 hover:underline\"\r\n                      >\r\n                        ลบภาพ\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                  <div className=\"mt-3 flex flex-col items-center gap-3\">\r\n                    <div className=\"h-32 w-full overflow-hidden rounded-lg border border-indigo-200 bg-indigo-50\">\r\n                      {backPreview ? (\r\n                        <img\r\n                          src={backPreview}\r\n                          alt=\"Thai ID back\"\r\n                          className=\"h-full w-full object-cover\"\r\n                        />\r\n                      ) : (\r\n                        <div className=\"flex h-full w-full items-center justify-center text-xs text-indigo-400\">\r\n                          ยังไม่มีภาพหลังบัตร\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                    <label className=\"w-full cursor-pointer rounded-lg bg-gradient-to-r from-indigo-500 to-purple-500 px-4 py-2 text-center text-sm font-semibold text-white shadow hover:from-indigo-600 hover:to-purple-600\">\r\n                      อัปโหลดภาพหลังบัตร\r\n                      <input\r\n                        type=\"file\"\r\n                        accept=\"image/*\"\r\n                        className=\"hidden\"\r\n                        onChange={(event) =>\r\n                          handleIdCardImageChange(\"back\", event.target.files?.[0])\r\n                        }\r\n                      />\r\n                    </label>\r\n                  </div>\r\n                </div>\r\n              </section>\r\n            </div>\r\n\r\n\r\n\r\n            <div className=\"rounded-2xl border border-white/60 bg-white/70 p-5 shadow-inner\">\r\n              <button\r\n                type=\"button\"\r\n                onClick={() => setShowAdvanced((state) => !state)}\r\n                className=\"flex w-full items-center justify-between gap-3 rounded-xl bg-gradient-to-r from-indigo-500 to-purple-500 px-4 py-3 text-left text-white shadow\"\r\n              >\r\n                <div>\r\n                  <p className=\"text-sm font-semibold\">\r\n                    {showAdvanced ? \"ซ่อน\" : \"แสดง\"} รายละเอียดเพิ่มเติม\r\n                  </p>\r\n                  <p className=\"text-xs text-purple-100\">\r\n                    ข้อมูลสมาชิก, เอกสาร, โรคประจำตัว และที่อยู่แบบละเอียด\r\n                  </p>\r\n                </div>\r\n                <svg\r\n                  className={`h-5 w-5 transition-transform duration-200 ${showAdvanced ? \"rotate-180\" : \"rotate-0\"\r\n                    }`}\r\n                  fill=\"none\"\r\n                  stroke=\"currentColor\"\r\n                  viewBox=\"0 0 24 24\"\r\n                >\r\n                  <path\r\n                    strokeLinecap=\"round\"\r\n                    strokeLinejoin=\"round\"\r\n                    strokeWidth={2}\r\n                    d=\"M19 9l-7 7-7-7\"\r\n                  />\r\n                </svg>\r\n              </button>\r\n\r\n              {showAdvanced && (\r\n                <div className=\"mt-4 space-y-6\">\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-base font-semibold text-gray-800\">ข้อมูลสมาชิก</h4>\r\n\r\n                    <section className=\"grid grid-cols-1 gap-4 md:grid-cols-3\">\r\n                      <div>\r\n                        <label className={labelClass}>เลขที่ภายใน (recordno)</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.recordno || \"\"}\r\n                          onChange={(event) => onChange(\"recordno\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>เลขบัตรประชาชน / Passport</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.idcard}\r\n                          onChange={(event) => onChange(\"idcard\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>วันที่ bind/sync</label>\r\n                        <input\r\n                          type=\"date\"\r\n                          className={inputClass}\r\n                          value={form.binddate}\r\n                          onChange={(event) => onChange(\"binddate\", event.target.value)}\r\n                        />\r\n                      </div>\r\n\r\n                      <div>\r\n                        <label className={labelClass}>กลุ่มลูกค้า</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.cusgroup}\r\n                          onChange={(event) => onChange(\"cusgroup\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>รหัสสมาชิก</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.member}\r\n                          onChange={(event) => onChange(\"member\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                    </section>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-base font-semibold text-gray-800\">ข้อมูลสุขภาพ</h4>\r\n\r\n                    <section className=\"grid grid-cols-1 gap-4 md:grid-cols-2\">\r\n                      <div>\r\n                        <label className={labelClass}>โรคประจำตัว</label>\r\n                        <textarea\r\n                          className={`${inputClass} min-h-[80px]`}\r\n                          value={form.disease}\r\n                          onChange={(event) => onChange(\"disease\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>ประวัติแพ้ยา/อาหาร/อื่น ๆ</label>\r\n                        <textarea\r\n                          className={`${inputClass} min-h-[80px]`}\r\n                          value={form.allergic}\r\n                          onChange={(event) => onChange(\"allergic\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                    </section>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-base font-semibold text-gray-800\">ที่อยู่ตามทะเบียนบ้าน</h4>\r\n\r\n                    <section className=\"grid grid-cols-1 gap-4 md:grid-cols-4\">\r\n                      <div>\r\n                        <label className={labelClass}>เลขที่</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.locno}\r\n                          onChange={(event) => onChange(\"locno\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>หมู่</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.moo}\r\n                          onChange={(event) => onChange(\"moo\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>ซอย</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.soi}\r\n                          onChange={(event) => onChange(\"soi\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>ถนน</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.road}\r\n                          onChange={(event) => onChange(\"road\", event.target.value)}\r\n                        />\r\n                      </div>\r\n                    </section>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-base font-semibold text-gray-800\">ข้อมูลบัตรประชาชน</h4>\r\n\r\n                    <section className=\"grid grid-cols-1 gap-4 md:grid-cols-3\">\r\n                      <div>\r\n                        <label className={labelClass}>Laser Code (หลังบัตร)</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.idcardLaserCode || \"\"}\r\n                          onChange={(event) =>\r\n                            onChange(\"idcardLaserCode\", event.target.value)\r\n                          }\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>วันที่ออกบัตร</label>\r\n                        <input\r\n                          type=\"date\"\r\n                          className={inputClass}\r\n                          value={form.idcardIssueDate || \"\"}\r\n                          onChange={(event) =>\r\n                            onChange(\"idcardIssueDate\", event.target.value)\r\n                          }\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>วันที่หมดอายุ</label>\r\n                        <input\r\n                          type=\"date\"\r\n                          className={inputClass}\r\n                          value={form.idcardExpireDate || \"\"}\r\n                          onChange={(event) =>\r\n                            onChange(\"idcardExpireDate\", event.target.value)\r\n                          }\r\n                        />\r\n                      </div>\r\n                    </section>\r\n                  </div>\r\n\r\n                  <div className=\"space-y-3\">\r\n                    <h4 className=\"text-base font-semibold text-gray-800\">ภูมิลำเนาตามบัตร</h4>\r\n\r\n                    <section className=\"grid grid-cols-1 gap-4 md:grid-cols-3\">\r\n                      <div>\r\n                        <label className={labelClass}>จังหวัด (ตามบัตร)</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.idcardProvinceNative || \"\"}\r\n                          onChange={(event) =>\r\n                            onChange(\"idcardProvinceNative\", event.target.value)\r\n                          }\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>อำเภอ/เขต (ตามบัตร)</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.idcardDistrictNative || \"\"}\r\n                          onChange={(event) =>\r\n                            onChange(\"idcardDistrictNative\", event.target.value)\r\n                          }\r\n                        />\r\n                      </div>\r\n                      <div>\r\n                        <label className={labelClass}>ตำบล/แขวง (ตามบัตร)</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className={inputClass}\r\n                          value={form.idcardSubdistrictNative || \"\"}\r\n                          onChange={(event) =>\r\n                            onChange(\"idcardSubdistrictNative\", event.target.value)\r\n                          }\r\n                        />\r\n                      </div>\r\n                    </section>\r\n                  </div>\r\n                </div>\r\n\r\n              )}\r\n            </div>\r\n\r\n            <div className=\"flex flex-col gap-3 md:flex-row md:items-center md:justify-between\">\r\n              {message && (\r\n                <span className=\"text-sm font-semibold text-emerald-700\">\r\n                  {message}\r\n                </span>\r\n              )}\r\n              <div className=\"flex gap-3\">\r\n                <button\r\n                  type=\"button\"\r\n                  onClick={onClose}\r\n                  className=\"rounded-lg bg-white px-5 py-2 font-semibold text-gray-700 shadow hover:bg-gray-50\"\r\n                >\r\n                  ยกเลิก\r\n                </button>\r\n                <button\r\n                  type=\"submit\"\r\n                  className=\"rounded-lg bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-2 font-semibold text-white shadow-lg transition hover:from-blue-700 hover:to-indigo-700 disabled:cursor-not-allowed disabled:opacity-70\"\r\n                  disabled={saving}\r\n                >\r\n                  {saving ? \"กำลังบันทึก...\" : exists ? \"อัปเดตข้อมูล\" : \"บันทึกข้อมูล\"}\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </form>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      {/* OPD Service Popup Modal */}\r\n      {serviceDrawerVisible && (\r\n        <div className=\"fixed inset-0 z-[80] flex items-center justify-center bg-black/70 p-4 backdrop-blur-sm\">\r\n          <div\r\n            className=\"relative w-full max-w-6xl overflow-hidden rounded-3xl bg-white shadow-2xl\"\r\n            onClick={(e) => e.stopPropagation()}\r\n          >\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between bg-gradient-to-r from-blue-600 via-indigo-600 to-purple-600 px-8 py-5 text-white\">\r\n              <div>\r\n                <h2 className=\"text-2xl font-bold\">บริการ OPD</h2>\r\n                <p className=\"mt-1 text-sm text-white/80\">\r\n                  เลือกบริการและกำหนด Charge / Discount\r\n                </p>\r\n              </div>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleCloseServiceDrawer}\r\n                className=\"rounded-full bg-white/20 p-2 transition hover:bg-white/30\"\r\n              >\r\n                <svg className=\"h-6 w-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                </svg>\r\n              </button>\r\n            </div>\r\n\r\n            {/* Group selector */}\r\n            <div className=\"border-b bg-gray-50 px-8 py-4\">\r\n              <div className=\"flex flex-wrap items-center gap-4\">\r\n                <label className=\"text-sm font-semibold text-gray-700\">กลุ่มบริการ:</label>\r\n                <select\r\n                  className=\"rounded-xl border border-gray-300 bg-white px-4 py-2 text-sm font-medium text-gray-800 shadow-sm focus:border-indigo-500 focus:outline-none focus:ring-2 focus:ring-indigo-200\"\r\n                  value={selectedOpdGroupCode}\r\n                  onChange={(e) => handleGroupSelect(e.target.value)}\r\n                >\r\n                  <option value=\"\">เลือกกลุ่มบริการ</option>\r\n                  {opdGroups.map((group) => (\r\n                    <option key={group.groupcode} value={group.groupcode}>\r\n                      {group.groupname}\r\n                    </option>\r\n                  ))}\r\n                </select>\r\n                {selectedServices.length > 0 && (\r\n                  <span className=\"rounded-full bg-emerald-100 px-3 py-1 text-sm font-semibold text-emerald-700\">\r\n                    เลือกแล้ว {selectedServices.length} รายการ\r\n                  </span>\r\n                )}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Two-column content */}\r\n            <div className=\"grid max-h-[65vh] grid-cols-1 gap-0 md:grid-cols-2\">\r\n              {/* Left: Selected services */}\r\n              <div className=\"flex flex-col border-r border-gray-200 bg-gradient-to-br from-blue-50 to-indigo-50 max-h-[65vh]\">\r\n                <div className=\"border-b bg-white/80 px-6 py-4\">\r\n                  <h3 className=\"text-lg font-bold text-gray-800\">\r\n                    📝 บริการที่เลือก\r\n                  </h3>\r\n                  <p className=\"text-xs text-gray-500\">\r\n                    {selectedServices.length} รายการ\r\n                    {selectedOpdGroup && ` · ${selectedOpdGroup.groupname}`}\r\n                  </p>\r\n                </div>\r\n                <div className=\"flex-1 overflow-y-auto p-4\">\r\n                  {selectedServices.length === 0 ? (\r\n                    <div className=\"flex h-full flex-col items-center justify-center text-center\">\r\n                      <div className=\"mb-3 text-5xl\">📂</div>\r\n                      <p className=\"text-sm text-gray-500\">\r\n                        ยังไม่มีบริการที่เลือก\r\n                      </p>\r\n                      <p className=\"text-xs text-gray-400\">\r\n                        เลือกจากรายการทางขวามือ\r\n                      </p>\r\n                    </div>\r\n                  ) : (\r\n                    <>\r\n                      <div className=\"space-y-3\">\r\n                        {selectedServices.map((entry) => (\r\n                          <div\r\n                            key={entry.id}\r\n                            className=\"rounded-2xl border border-white bg-white p-4 shadow-md transition hover:shadow-lg\"\r\n                          >\r\n                            <div className=\"flex items-start justify-between\">\r\n                              <div className=\"flex-1\">\r\n                                <p className=\"font-semibold text-gray-800\">\r\n                                  {entry.itemname}\r\n                                </p>\r\n                                <p className=\"text-xs text-gray-500\">\r\n                                  รหัส {entry.itemcode} · ราคา {formatCurrencyDisplay(entry.salesprice)}\r\n                                </p>\r\n                              </div>\r\n                              <button\r\n                                type=\"button\"\r\n                                onClick={() => handleRemoveServiceEntry(entry.id)}\r\n                                className=\"ml-2 rounded-full bg-red-100 p-1.5 text-red-600 transition hover:bg-red-200\"\r\n                              >\r\n                                <svg className=\"h-4 w-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n                                  <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\r\n                                </svg>\r\n                              </button>\r\n                            </div>\r\n\r\n                            <div className=\"mt-3 grid grid-cols-2 gap-3\">\r\n                              <div className=\"rounded-xl bg-emerald-50 p-3\">\r\n                                <p className=\"mb-1 text-xs font-semibold uppercase tracking-wide text-emerald-700\">\r\n                                  Charge\r\n                                </p>\r\n                                <div className=\"flex gap-2\">\r\n                                  <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"บาท\"\r\n                                    value={entry.chargePrice}\r\n                                    onChange={(e) => handleChargePriceChange(entry.id, e.target.value)}\r\n                                    className=\"w-full rounded-lg border border-emerald-200 bg-white px-2 py-1.5 text-sm focus:border-emerald-400 focus:outline-none\"\r\n                                  />\r\n                                  <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"%\"\r\n                                    value={entry.chargePercent}\r\n                                    onChange={(e) => handleChargePercentChange(entry.id, e.target.value)}\r\n                                    className=\"w-16 rounded-lg border border-emerald-200 bg-white px-2 py-1.5 text-center text-sm focus:border-emerald-400 focus:outline-none\"\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                              <div className=\"rounded-xl bg-rose-50 p-3\">\r\n                                <p className=\"mb-1 text-xs font-semibold uppercase tracking-wide text-rose-700\">\r\n                                  Discount\r\n                                </p>\r\n                                <div className=\"flex gap-2\">\r\n                                  <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"บาท\"\r\n                                    value={entry.discountPrice}\r\n                                    onChange={(e) => handleDiscountPriceChange(entry.id, e.target.value)}\r\n                                    className=\"w-full rounded-lg border border-rose-200 bg-white px-2 py-1.5 text-sm focus:border-rose-400 focus:outline-none\"\r\n                                  />\r\n                                  <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"%\"\r\n                                    value={entry.discountPercent}\r\n                                    onChange={(e) => handleDiscountPercentChange(entry.id, e.target.value)}\r\n                                    className=\"w-16 rounded-lg border border-rose-200 bg-white px-2 py-1.5 text-center text-sm focus:border-rose-400 focus:outline-none\"\r\n                                  />\r\n                                </div>\r\n                              </div>\r\n                            </div>\r\n                            <div className=\"mt-3 flex items-center justify-between rounded-2xl border border-indigo-100 bg-indigo-50/40 px-3 py-2 text-sm font-semibold text-indigo-600\">\r\n                              <span>ยอดสุทธิ</span>\r\n                              <span>{formatCurrencyDisplay(calculateServiceEntryTotal(entry))}</span>\r\n                            </div>\r\n                          </div>\r\n                        ))}\r\n                      </div>\r\n                      <div className=\"mt-4 rounded-2xl border border-dashed border-indigo-200 bg-white/80 px-4 py-3 text-sm text-gray-600 shadow-inner\">\r\n                        <div className=\"flex items-center justify-between text-xs font-semibold uppercase tracking-wide text-gray-500\">\r\n                          <span>สรุปยอด</span>\r\n                          <span>{selectedServices.length} รายการ</span>\r\n                        </div>\r\n                        <div className=\"mt-2 space-y-1\">\r\n                          <div className=\"flex justify-between\">\r\n                            <span>รวมราคาพื้นฐาน</span>\r\n                            <span className=\"font-semibold text-gray-700\">\r\n                              {formatCurrencyDisplay(selectedServicesTotals.baseTotal)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span>รวมค่า Charge</span>\r\n                            <span className=\"font-semibold text-gray-700\">\r\n                              {formatCurrencyDisplay(selectedServicesTotals.chargeTotal)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex justify-between\">\r\n                            <span>รวมส่วนลด</span>\r\n                            <span className=\"font-semibold text-gray-700\">\r\n                              {formatCurrencyDisplay(selectedServicesTotals.discountTotal)}\r\n                            </span>\r\n                          </div>\r\n                          <div className=\"flex justify-between text-base font-semibold text-indigo-600\">\r\n                            <span>ยอดสุทธิทั้งหมด</span>\r\n                            <span>{formatCurrencyDisplay(selectedServicesTotals.netTotal)}</span>\r\n                          </div>\r\n                        </div>\r\n                      </div>\r\n                    </>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Right: Available services */}\r\n              <div className=\"flex flex-col bg-white max-h-[65vh]\">\r\n                <div className=\"border-b px-6 py-4\">\r\n                  <h3 className=\"text-lg font-bold text-gray-800\">\r\n                    📜 รายการบริการ\r\n                  </h3>\r\n                  {selectedOpdGroup && (\r\n                    <p className=\"text-xs text-gray-500\">{selectedOpdGroup.groupname}</p>\r\n                  )}\r\n                </div>\r\n                <div className=\"px-6 py-3\">\r\n                  <div className=\"relative\">\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder=\"🔍 ค้นหาบริการ...\"\r\n                      value={serviceSearchTerm}\r\n                      onChange={(e) => setServiceSearchTerm(e.target.value)}\r\n                      className=\"w-full rounded-xl border border-gray-200 bg-gray-50 px-4 py-2.5 text-sm focus:border-indigo-400 focus:bg-white focus:outline-none focus:ring-2 focus:ring-indigo-100\"\r\n                    />\r\n                  </div>\r\n                </div>\r\n                <div className=\"flex-1 overflow-y-auto px-6 pb-4\">\r\n                  {servicesLoading && (\r\n                    <div className=\"flex items-center justify-center py-8\">\r\n                      <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-indigo-200 border-t-indigo-600\"></div>\r\n                    </div>\r\n                  )}\r\n                  {serviceError && (\r\n                    <p className=\"py-4 text-center text-sm text-red-600\">{serviceError}</p>\r\n                  )}\r\n                  {!servicesLoading && !serviceError && filteredServiceItems.length === 0 && (\r\n                    <div className=\"flex flex-col items-center justify-center py-8 text-center\">\r\n                      <div className=\"mb-2 text-4xl\">💭</div>\r\n                      <p className=\"text-sm text-gray-500\">ไม่พบรายการบริการ</p>\r\n                    </div>\r\n                  )}\r\n                  <div className=\"space-y-2\">\r\n                    {filteredServiceItems.map((item) => {\r\n                      const alreadyAdded = selectedServices.some(\r\n                        (entry) => entry.itemcode === item.itemcode\r\n                      );\r\n                      return (\r\n                        <div\r\n                          key={item.itemcode}\r\n                          className={`flex items-center justify-between rounded-xl border px-4 py-3 transition ${alreadyAdded\r\n                            ? \"border-emerald-200 bg-emerald-50\"\r\n                            : \"border-gray-100 bg-gray-50 hover:border-indigo-200 hover:bg-indigo-50\"\r\n                            }`}\r\n                        >\r\n                          <div>\r\n                            <p className=\"font-medium text-gray-800\">{item.itemname}</p>\r\n                            <p className=\"text-xs text-gray-500\">ราคา\r\n                            </p>\r\n                            <p className=\"text-xs text-gray-500\">\r\n                              {formatCurrencyDisplay(item.saleprice)}\r\n                            </p>\r\n                          </div>\r\n                          <button\r\n                            type=\"button\"\r\n                            onClick={() => handleAddService(item)}\r\n                            disabled={alreadyAdded}\r\n                            className={`rounded-full px-4 py-1.5 text-xs font-semibold transition ${alreadyAdded\r\n                              ? \"bg-emerald-200 text-emerald-700\"\r\n                              : \"bg-gradient-to-r from-blue-500 to-indigo-500 text-white shadow hover:shadow-md\"\r\n                              }`}\r\n                          >\r\n                            {alreadyAdded ? \"✓ เลือกแล้ว\" : \"เพิ่ม\"}\r\n                          </button>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"flex items-center justify-between border-t bg-gray-50 px-8 py-4\">\r\n              <p className=\"text-sm text-gray-600\">\r\n                เลือกแล้ว <span className=\"font-bold text-indigo-600\">{selectedServices.length}</span> รายการ\r\n                <span className=\"mx-2 hidden text-xs text-gray-400 md:inline\">·</span>\r\n                <span className=\"mr-1\">ยอดสุทธิ</span>\r\n                <span className=\"font-bold text-indigo-600\">\r\n                  {formatCurrencyDisplay(selectedServicesTotals.netTotal)}\r\n                </span>\r\n              </p>\r\n              <button\r\n                type=\"button\"\r\n                onClick={handleCloseServiceDrawer}\r\n                className=\"rounded-xl bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-2.5 font-semibold text-white shadow-lg transition hover:from-indigo-700 hover:to-purple-700\"\r\n              >\r\n                เสร็จสิ้น\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}