{"version":3,"sources":["../../../../src/app/%28fullscreen%29/performance-surgery-schedule/page.tsx","../../../../src/app/%28fullscreen%29/performance-surgery-schedule/SurgeryDetailsModal.tsx","../../../../src/app/%28fullscreen%29/performance-surgery-schedule/RevenueDetailsModal.tsx","../../../../src/utils/googleSheets.ts","../../../../src/utils/databaseFilmData.ts","../../../../src/utils/databaseActualSurgery.ts","../../../../src/utils/databaseRevenueFuture.ts","../../../../src/utils/databaseNClinic.ts"],"sourcesContent":["\"use client\";\r\nimport React, { useState, useEffect } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport \"./styles.css\";\r\nimport SurgeryDetailsModal from \"./SurgeryDetailsModal\";\r\nimport RevenueDetailsModal from \"./RevenueDetailsModal\";\r\nimport {\r\n  SurgeryScheduleData,\r\n  CONTACT_PERSON_MAPPING,\r\n} from \"@/utils/googleSheets\";\r\n// Import Database API functions (‡πÅ‡∏ó‡∏ô Python API)\r\nimport {\r\n  fetchSurgeryScheduleFromDatabase,\r\n  countDatabaseSurgeriesByDateAndPerson,\r\n  calculateDatabaseRevenueByDateAndPerson,\r\n} from \"@/utils/databaseFilmData\";\r\nimport {\r\n  fetchSurgeryActualFromDatabase,\r\n  countDatabaseActualSurgeriesByDate,\r\n  calculateDatabaseActualRevenue,\r\n} from \"@/utils/databaseActualSurgery\";\r\n// import {\r\n//   fetchSaleIncentiveFromDatabase,\r\n//   calculateDailyRevenueByPerson,\r\n//   SaleIncentiveData,\r\n// } from \"@/utils/databaseSaleIncentive\";\r\nimport {\r\n  fetchRevenueFutureFromDatabase,\r\n  calculateDailyRevenueByPersonFuture,\r\n  RevenueFutureData,\r\n} from \"@/utils/databaseRevenueFuture\";\r\nimport {\r\n  fetchNClinicFromDatabase,\r\n  calculateDailyRevenueByPersonNClinic,\r\n  NClinicData,\r\n} from \"@/utils/databaseNClinic\";\r\nexport default function PerformanceSurgerySchedule() {\r\n  const router = useRouter();\r\n  // State for selected month and year\r\n  const currentDate = new Date();\r\n  const [selectedMonth, setSelectedMonth] = useState(currentDate.getMonth()); // 0-11\r\n  const [selectedYear, setSelectedYear] = useState(currentDate.getFullYear());\r\n  // State for surgery data\r\n  const [surgeryData, setSurgeryData] = useState<SurgeryScheduleData[]>([]);\r\n  const [surgeryActualData, setSurgeryActualData] = useState<\r\n    SurgeryScheduleData[]\r\n  >([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  // Refs for table wrappers to restore scroll position\r\n  const pTableRef = React.useRef<HTMLDivElement>(null);\r\n  const lTableRef = React.useRef<HTMLDivElement>(null);\r\n  const revenueTableRef = React.useRef<HTMLDivElement>(null);\r\n  const [countMap, setCountMap] = useState<\r\n    Map<string, Map<number, SurgeryScheduleData[]>>\r\n  >(new Map());\r\n  const [countMapL, setCountMapL] = useState<\r\n    Map<string, Map<number, SurgeryScheduleData[]>>\r\n  >(new Map());\r\n  // const [revenueMap, setRevenueMap] = useState<\r\n  //   Map<string, Map<number, number>>\r\n  // >(new Map());\r\n  const [filmRevenueMap, setFilmRevenueMap] = useState<\r\n    Map<string, Map<number, number>>\r\n  >(new Map());\r\n  const [filmRevenueMapNClinic, setFilmRevenueMapNClinic] = useState<\r\n    Map<string, Map<number, number>>\r\n  >(new Map());\r\n  // const [saleIncentiveData, setSaleIncentiveData] = useState<\r\n  //   SaleIncentiveData[]\r\n  // >([]);\r\n  const [revenueFutureData, setRevenueFutureData] = useState<\r\n    RevenueFutureData[]\r\n  >([]);\r\n  const [nClinicData, setNClinicData] = useState<NClinicData[]>([]);\r\n  const [lastUpdated, setLastUpdated] = useState<Date | null>(null);\r\n  const [isRefreshing, setIsRefreshing] = useState(false);\r\n  // KPI Data State (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• KPI ‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö Google Sheets)\r\n  // Note: kpiToDate ‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤\r\n  const [kpiData, setKpiData] = useState<{\r\n    [key: string]: {\r\n      kpiMonth: number;\r\n      kpiToDate: number;\r\n      actual: number;\r\n    };\r\n  }>({\r\n    \"105-‡∏à‡∏µ‡∏ô\": { kpiMonth: 40, kpiToDate: 0, actual: 5 },\r\n    \"107-‡πÄ‡∏à\": { kpiMonth: 40, kpiToDate: 0, actual: 0 },\r\n    \"108-‡∏ß‡πà‡∏≤‡∏ô\": { kpiMonth: 40, kpiToDate: 0, actual: 0 },\r\n    \"109-‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\": { kpiMonth: 0, kpiToDate: 0, actual: 0 },\r\n    \"110-‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\": { kpiMonth: 0, kpiToDate: 0, actual: 0 },\r\n  });\r\n  // Modal state\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  const [selectedSurgeries, setSelectedSurgeries] = useState<\r\n    SurgeryScheduleData[]\r\n  >([]);\r\n  const [selectedDate, setSelectedDate] = useState(1);\r\n  const [selectedContactPerson, setSelectedContactPerson] = useState(\"\");\r\n  const [selectedTableType, setSelectedTableType] = useState<\"P\" | \"L\">(\"P\");\r\n  // Revenue Modal state\r\n  const [revenueModalOpen, setRevenueModalOpen] = useState(false);\r\n  const [selectedNClinicData, setSelectedNClinicData] = useState<NClinicData[]>(\r\n    []\r\n  );\r\n  const [selectedFutureData, setSelectedFutureData] = useState<\r\n    RevenueFutureData[]\r\n  >([]);\r\n  // Function to load surgery schedule data from Database\r\n  const loadData = async (isManualRefresh = false) => {\r\n    if (isManualRefresh) {\r\n      setIsRefreshing(true);\r\n    } else {\r\n      setIsLoading(true);\r\n    }\r\n    setError(null);\r\n    try {\r\n      // Fetch surgery schedule data from Database (‡πÅ‡∏ó‡∏ô Python API/Google Sheets)\r\n      const data = await fetchSurgeryScheduleFromDatabase();\r\n      setSurgeryData(data);\r\n      // Fetch surgery actual data (L table)\r\n      const actualData = await fetchSurgeryActualFromDatabase();\r\n      setSurgeryActualData(actualData);\r\n      setLastUpdated(new Date());\r\n    } catch (error: any) {\r\n      setError(error.message || \"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\");\r\n    } finally {\r\n      setIsLoading(false);\r\n      setIsRefreshing(false);\r\n    }\r\n  };\r\n  // Function to load N_SaleIncentive data separately from Database (DISABLED - ‡πÉ‡∏ä‡πâ bjh_all_leads ‡πÅ‡∏ó‡∏ô)\r\n  // const loadSaleIncentiveData = async () => {\r\n  //   try {\r\n  //     const saleData = await fetchSaleIncentiveFromDatabase();\r\n  //     console.log(\"üìä Sale Incentive Data Loaded:\", {\r\n  //       totalRecords: saleData.length,\r\n  //       sampleRecords: saleData.slice(0, 3),\r\n  //       uniquePersons: [...new Set(saleData.map((d) => d.sale_person))],\r\n  //       monthYearCounts: saleData.reduce((acc: any, d) => {\r\n  //         const key = `${d.year}-${d.month}`;\r\n  //         acc[key] = (acc[key] || 0) + 1;\r\n  //         return acc;\r\n  //       }, {}),\r\n  //     });\r\n  //     setSaleIncentiveData(saleData);\r\n  //     console.log(\"‚úÖ Loaded N_SaleIncentive data from Database\");\r\n  //   } catch (error: any) {\r\n  //     console.error(\"‚ùå Error loading N_SaleIncentive data:\", error);\r\n  //     // Don't set error state - let revenue table just be empty\r\n  //     setSaleIncentiveData([]);\r\n  //   }\r\n  // };\r\n  // Function to load N_Clinic Revenue data (sale_date <= today)\r\n  const loadNClinicData = async () => {\r\n    try {\r\n      console.log(\r\n        \"üîÑ Starting to load N_Clinic data (n_income + n_customer + n_staff)...\"\r\n      );\r\n      const clinicData = await fetchNClinicFromDatabase();\r\n      console.log(\"üí∞ N_Clinic Data Loaded:\", {\r\n        totalRecords: clinicData.length,\r\n        sampleRecords: clinicData.slice(0, 5),\r\n        uniqueStaffDisplayName: [\r\n          ...new Set(clinicData.map((d) => d.staff_display_name || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\")),\r\n        ],\r\n        sampleData: clinicData.slice(0, 5).map((d) => ({\r\n          staff_display_name: d.staff_display_name,\r\n          income_date: d.income_date,\r\n          income: d.income,\r\n          income_display_name: d.income_display_name,\r\n        })),\r\n      });\r\n      setNClinicData(clinicData);\r\n      console.log(\"‚úÖ Loaded N_Clinic data from n_income\");\r\n    } catch (error: any) {\r\n      console.error(\"‚ùå Error loading N_Clinic data:\", error);\r\n      console.error(\"Error details:\", {\r\n        message: error.message,\r\n        stack: error.stack,\r\n      });\r\n      // Don't set error state - let revenue table just be empty\r\n      setNClinicData([]);\r\n    }\r\n  };\r\n  // Function to load Future Revenue data (surgery_date >= today)\r\n  const loadRevenueFutureData = async () => {\r\n    try {\r\n      console.log(\r\n        \"üîÑ Starting to load Revenue data (bjh_all_leads - surgery_date >= today)...\"\r\n      );\r\n      const futureData = await fetchRevenueFutureFromDatabase();\r\n      console.log(\"üí∞ Revenue Data Loaded (bjh_all_leads - Future only):\", {\r\n        totalRecords: futureData.length,\r\n        sampleRecords: futureData.slice(0, 5),\r\n        uniqueContactStaff: [\r\n          ...new Set(futureData.map((d) => d.contact_staff || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\")),\r\n        ],\r\n        sampleData: futureData.slice(0, 5).map((d) => ({\r\n          contact_staff: d.contact_staff,\r\n          surgery_date: d.surgery_date,\r\n          doctor: d.doctor,\r\n          customer_name: d.customer_name,\r\n          phone: d.phone,\r\n          proposed_amount: d.proposed_amount,\r\n          appointment_time: d.appointment_time,\r\n        })),\r\n      });\r\n      setRevenueFutureData(futureData);\r\n      console.log(\r\n        \"‚úÖ Loaded Revenue data (bjh_all_leads - surgery_date >= today)\"\r\n      );\r\n    } catch (error: any) {\r\n      console.error(\"‚ùå Error loading Revenue data:\", error);\r\n      console.error(\"Error details:\", {\r\n        message: error.message,\r\n        stack: error.stack,\r\n      });\r\n      // Don't set error state - let revenue table just be empty\r\n      setRevenueFutureData([]);\r\n    }\r\n  };\r\n  // Save scroll positions to sessionStorage\r\n  const saveScrollPositions = () => {\r\n    if (pTableRef.current) {\r\n      sessionStorage.setItem(\r\n        \"pTableScrollLeft\",\r\n        pTableRef.current.scrollLeft.toString()\r\n      );\r\n    }\r\n    if (lTableRef.current) {\r\n      sessionStorage.setItem(\r\n        \"lTableScrollLeft\",\r\n        lTableRef.current.scrollLeft.toString()\r\n      );\r\n    }\r\n    if (revenueTableRef.current) {\r\n      sessionStorage.setItem(\r\n        \"revenueTableScrollLeft\",\r\n        revenueTableRef.current.scrollLeft.toString()\r\n      );\r\n    }\r\n  };\r\n\r\n  // Restore scroll positions from sessionStorage\r\n  const restoreScrollPositions = () => {\r\n    const pScroll = sessionStorage.getItem(\"pTableScrollLeft\");\r\n    const lScroll = sessionStorage.getItem(\"lTableScrollLeft\");\r\n    const revenueScroll = sessionStorage.getItem(\"revenueTableScrollLeft\");\r\n\r\n    if (pScroll && pTableRef.current) {\r\n      pTableRef.current.scrollLeft = parseInt(pScroll);\r\n    }\r\n    if (lScroll && lTableRef.current) {\r\n      lTableRef.current.scrollLeft = parseInt(lScroll);\r\n    }\r\n    if (revenueScroll && revenueTableRef.current) {\r\n      revenueTableRef.current.scrollLeft = parseInt(revenueScroll);\r\n    }\r\n  };\r\n\r\n  // Add scroll event listeners to save positions\r\n  useEffect(() => {\r\n    const pTable = pTableRef.current;\r\n    const lTable = lTableRef.current;\r\n    const revenueTable = revenueTableRef.current;\r\n\r\n    if (pTable) {\r\n      pTable.addEventListener(\"scroll\", saveScrollPositions);\r\n    }\r\n    if (lTable) {\r\n      lTable.addEventListener(\"scroll\", saveScrollPositions);\r\n    }\r\n    if (revenueTable) {\r\n      revenueTable.addEventListener(\"scroll\", saveScrollPositions);\r\n    }\r\n\r\n    return () => {\r\n      if (pTable) {\r\n        pTable.removeEventListener(\"scroll\", saveScrollPositions);\r\n      }\r\n      if (lTable) {\r\n        lTable.removeEventListener(\"scroll\", saveScrollPositions);\r\n      }\r\n      if (revenueTable) {\r\n        revenueTable.removeEventListener(\"scroll\", saveScrollPositions);\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  // Restore scroll positions after data loads\r\n  useEffect(() => {\r\n    if (!isLoading) {\r\n      // Use setTimeout to ensure DOM is fully rendered\r\n      setTimeout(() => {\r\n        restoreScrollPositions();\r\n      }, 100);\r\n    }\r\n  }, [isLoading, selectedMonth, selectedYear]);\r\n\r\n  // Fetch surgery data when component mounts\r\n  useEffect(() => {\r\n    (async () => {\r\n      await loadData();\r\n    })();\r\n  }, []);\r\n  // Fetch N_SaleIncentive data when component mounts or when month/year changes (DISABLED)\r\n  // useEffect(() => {\r\n  //   (async () => {\r\n  //     await loadSaleIncentiveData();\r\n  //   })();\r\n  // }, [selectedMonth, selectedYear]);\r\n  // Fetch N_Clinic data when component mounts or when month/year changes\r\n  useEffect(() => {\r\n    (async () => {\r\n      await loadNClinicData();\r\n    })();\r\n  }, [selectedMonth, selectedYear]);\r\n  // Fetch Future Revenue data when component mounts or when month/year changes\r\n  useEffect(() => {\r\n    (async () => {\r\n      await loadRevenueFutureData();\r\n    })();\r\n  }, [selectedMonth, selectedYear]);\r\n  // Auto-refresh surgery data every 30 seconds\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      await loadData();\r\n    }, 30000); // 30 seconds\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n  // Auto-refresh N_SaleIncentive data every 30 seconds (DISABLED)\r\n  // useEffect(() => {\r\n  //   const interval = setInterval(async () => {\r\n  //     await loadSaleIncentiveData();\r\n  //   }, 30000); // 30 seconds\r\n  //   return () => clearInterval(interval);\r\n  // }, []);\r\n  // Auto-refresh N_Clinic data every 30 seconds\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      await loadNClinicData();\r\n    }, 30000); // 30 seconds\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n  // Auto-refresh Future Revenue data every 30 seconds\r\n  useEffect(() => {\r\n    const interval = setInterval(async () => {\r\n      await loadRevenueFutureData();\r\n    }, 30000); // 30 seconds\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n  // Get number of days in selected month\r\n  const getDaysInMonth = (month: number, year: number) => {\r\n    return new Date(year, month + 1, 0).getDate();\r\n  };\r\n  const daysInMonth = getDaysInMonth(selectedMonth, selectedYear);\r\n  const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);\r\n  // Check if a day is a weekday (Monday-Friday)\r\n  const isWeekday = (day: number): boolean => {\r\n    const date = new Date(selectedYear, selectedMonth, day);\r\n    const dayOfWeek = date.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday\r\n    return dayOfWeek >= 1 && dayOfWeek <= 5; // Monday to Friday\r\n  };\r\n  // Calculate number of weekdays (Mon-Fri) from start of month to current date\r\n  const calculateWeekdaysToDate = (): number => {\r\n    const today = new Date();\r\n    const todayDate = today.getDate();\r\n    const todayMonth = today.getMonth();\r\n    const todayYear = today.getFullYear();\r\n    // If viewing a future month/year, return 0 (haven't reached yet)\r\n    if (\r\n      selectedYear > todayYear ||\r\n      (selectedYear === todayYear && selectedMonth > todayMonth)\r\n    ) {\r\n      return 0;\r\n    }\r\n    // If viewing a past month/year, return total weekdays in that month\r\n    if (\r\n      selectedYear < todayYear ||\r\n      (selectedYear === todayYear && selectedMonth < todayMonth)\r\n    ) {\r\n      let weekdayCount = 0;\r\n      const totalDays = getDaysInMonth(selectedMonth, selectedYear);\r\n      for (let day = 1; day <= totalDays; day++) {\r\n        if (isWeekday(day)) {\r\n          weekdayCount++;\r\n        }\r\n      }\r\n      return weekdayCount;\r\n    }\r\n    // If viewing current month/year, count up to today\r\n    let weekdayCount = 0;\r\n    for (let day = 1; day <= todayDate; day++) {\r\n      if (isWeekday(day)) {\r\n        weekdayCount++;\r\n      }\r\n    }\r\n    return weekdayCount;\r\n  };\r\n  // Update count maps when data or date changes\r\n  useEffect(() => {\r\n    if (surgeryData.length > 0) {\r\n      // P table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î (Database)\r\n      const newCountMap = countDatabaseSurgeriesByDateAndPerson(\r\n        surgeryData,\r\n        selectedMonth,\r\n        selectedYear\r\n      );\r\n      setCountMap(newCountMap);\r\n    }\r\n  }, [surgeryData, selectedMonth, selectedYear]);\r\n  // Update N_Clinic revenue map - ‡πÉ‡∏ä‡πâ income ‡∏à‡∏≤‡∏Å n_income\r\n  useEffect(() => {\r\n    console.log(\"üîÑ Processing N_Clinic RevenueMap (income_date)...\", {\r\n      nClinicDataLength: nClinicData.length,\r\n      selectedMonth,\r\n      selectedYear,\r\n      firstFewRecords: nClinicData.slice(0, 3).map((d) => ({\r\n        income_date: d.income_date,\r\n        staff_display_name: d.staff_display_name,\r\n        income: d.income,\r\n      })),\r\n    });\r\n    if (nClinicData.length > 0) {\r\n      const newNClinicRevenueMap = calculateDailyRevenueByPersonNClinic(\r\n        nClinicData,\r\n        selectedMonth,\r\n        selectedYear\r\n      );\r\n      console.log(\"üîç N_Clinic Revenue Map Debug:\", {\r\n        mapSize: newNClinicRevenueMap.size,\r\n        persons: Array.from(newNClinicRevenueMap.keys()),\r\n        allData: Array.from(newNClinicRevenueMap.entries()).map(\r\n          ([person, dayMap]) => ({\r\n            person,\r\n            totalDays: dayMap.size,\r\n            days: Array.from(dayMap.entries()).slice(0, 10),\r\n            totalRevenue: Array.from(dayMap.values()).reduce(\r\n              (sum, val) => sum + val,\r\n              0\r\n            ),\r\n          })\r\n        ),\r\n      });\r\n      setFilmRevenueMapNClinic(newNClinicRevenueMap);\r\n    } else {\r\n      console.log(\"‚ö†Ô∏è No N_Clinic data to process, clearing map\");\r\n      setFilmRevenueMapNClinic(new Map());\r\n    }\r\n  }, [nClinicData, selectedMonth, selectedYear]);\r\n  // Update film revenue map - ‡πÉ‡∏ä‡πâ proposed_amount ‡∏à‡∏≤‡∏Å bjh_all_leads (surgery_date >= today)\r\n  useEffect(() => {\r\n    console.log(\r\n      \"üîÑ Processing filmRevenueMap (bjh_all_leads - Future surgeries)...\",\r\n      {\r\n        futureDataLength: revenueFutureData.length,\r\n        selectedMonth,\r\n        selectedYear,\r\n        firstFewRecords: revenueFutureData.slice(0, 3).map((d) => ({\r\n          surgery_date: d.surgery_date,\r\n          contact_staff: d.contact_staff,\r\n          proposed_amount: d.proposed_amount,\r\n        })),\r\n      }\r\n    );\r\n    if (revenueFutureData.length > 0) {\r\n      // ‡πÉ‡∏ä‡πâ proposed_amount ‡πÅ‡∏•‡∏∞ contact_staff ‡∏à‡∏≤‡∏Å bjh_all_leads (surgery_date >= today)\r\n      const newFilmRevenueMap = calculateDailyRevenueByPersonFuture(\r\n        revenueFutureData,\r\n        selectedMonth,\r\n        selectedYear\r\n      );\r\n      console.log(\"üîç Film Revenue Map Debug (bjh_all_leads - Future):\", {\r\n        mapSize: newFilmRevenueMap.size,\r\n        persons: Array.from(newFilmRevenueMap.keys()),\r\n        allData: Array.from(newFilmRevenueMap.entries()).map(\r\n          ([person, dayMap]) => ({\r\n            person,\r\n            totalDays: dayMap.size,\r\n            days: Array.from(dayMap.entries()).slice(0, 10),\r\n            totalRevenue: Array.from(dayMap.values()).reduce(\r\n              (sum, val) => sum + val,\r\n              0\r\n            ),\r\n          })\r\n        ),\r\n      });\r\n      setFilmRevenueMap(newFilmRevenueMap);\r\n    } else {\r\n      console.log(\"‚ö†Ô∏è No future revenue data to process, clearing map\");\r\n      setFilmRevenueMap(new Map());\r\n    }\r\n  }, [revenueFutureData, selectedMonth, selectedYear]);\r\n  // Update L table count map when surgery actual data changes\r\n  useEffect(() => {\r\n    if (surgeryActualData.length > 0) {\r\n      // L table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î (Surgery Actual Database)\r\n      const newCountMapL = countDatabaseActualSurgeriesByDate(\r\n        surgeryActualData,\r\n        selectedMonth,\r\n        selectedYear\r\n      );\r\n      setCountMapL(newCountMapL);\r\n    }\r\n  }, [surgeryActualData, selectedMonth, selectedYear]);\r\n  // Update revenue map when N_SaleIncentive data changes (DISABLED - ‡πÉ‡∏ä‡πâ filmRevenueMap ‡∏à‡∏≤‡∏Å bjh_all_leads ‡πÅ‡∏ó‡∏ô)\r\n  // useEffect(() => {\r\n  //   if (saleIncentiveData.length > 0) {\r\n  //     // Revenue table - ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á (N_SaleIncentive)\r\n  //     const newRevenueMap = calculateDailyRevenueByPerson(\r\n  //       saleIncentiveData,\r\n  //       selectedMonth,\r\n  //       selectedYear\r\n  //     );\r\n  //     console.log(\"üîç Revenue Map Debug:\", {\r\n  //       mapSize: newRevenueMap.size,\r\n  //       persons: Array.from(newRevenueMap.keys()),\r\n  //       sampleData: Array.from(newRevenueMap.entries())\r\n  //         .slice(0, 2)\r\n  //         .map(([person, dayMap]) => ({\r\n  //           person,\r\n  //           days: Array.from(dayMap.entries()),\r\n  //         })),\r\n  //     });\r\n  //     setRevenueMap(newRevenueMap);\r\n  //   } else {\r\n  //     // Clear revenue map if no data\r\n  //     setRevenueMap(new Map());\r\n  //   }\r\n  // }, [saleIncentiveData, selectedMonth, selectedYear]);\r\n  // Update KPI To Date and Actual based on weekdays passed in current month\r\n  useEffect(() => {\r\n    const weekdaysToDate = calculateWeekdaysToDate();\r\n    const totalWeekdaysInMonth = days.filter((day) => isWeekday(day)).length;\r\n    // Update kpiToDate and actual for all rows\r\n    setKpiData((prevData) => {\r\n      const updatedData = { ...prevData };\r\n      Object.keys(updatedData).forEach((key) => {\r\n        // Calculate actual count - sum of all counts (total performance)\r\n        let actualCount = 0;\r\n        days.forEach((day) => {\r\n          const count = getCellCount(day, key, \"P\");\r\n          actualCount += count; // Sum up all the counts\r\n        });\r\n        if (updatedData[key].kpiMonth > 0) {\r\n          // Calculate proportional KPI based on weekdays passed\r\n          updatedData[key] = {\r\n            ...updatedData[key],\r\n            kpiToDate: Math.round(\r\n              (updatedData[key].kpiMonth / totalWeekdaysInMonth) *\r\n                weekdaysToDate\r\n            ),\r\n            actual: actualCount,\r\n          };\r\n        } else {\r\n          updatedData[key] = {\r\n            ...updatedData[key],\r\n            actual: actualCount,\r\n          };\r\n        }\r\n      });\r\n      return updatedData;\r\n    });\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [selectedMonth, selectedYear, days.length, countMap]);\r\n  // Month names in Thai\r\n  const monthNames = [\r\n    \"‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå\",\r\n    \"‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°\",\r\n  ];\r\n  // Generate year options (current year and +/- 2 years)\r\n  const yearOptions = Array.from(\r\n    { length: 5 },\r\n    (_, i) => currentDate.getFullYear() - 2 + i\r\n  );\r\n  const handleMonthChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setSelectedMonth(parseInt(e.target.value));\r\n  };\r\n  const handleYearChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n    setSelectedYear(parseInt(e.target.value));\r\n  };\r\n  const handlePreviousMonth = () => {\r\n    if (selectedMonth === 0) {\r\n      setSelectedMonth(11);\r\n      setSelectedYear(selectedYear - 1);\r\n    } else {\r\n      setSelectedMonth(selectedMonth - 1);\r\n    }\r\n  };\r\n  const handleNextMonth = () => {\r\n    if (selectedMonth === 11) {\r\n      setSelectedMonth(0);\r\n      setSelectedYear(selectedYear + 1);\r\n    } else {\r\n      setSelectedMonth(selectedMonth + 1);\r\n    }\r\n  };\r\n  // Handle revenue cell click to open revenue modal\r\n  const handleRevenueCellClick = (day: number, rowId: string) => {\r\n    const contactPerson = CONTACT_PERSON_MAPPING[rowId];\r\n    if (!contactPerson) return;\r\n    // Parse date function\r\n    const parseDateStr = (dateStr: string | undefined): Date | null => {\r\n      if (!dateStr) return null;\r\n      try {\r\n        return new Date(dateStr);\r\n      } catch {\r\n        return null;\r\n      }\r\n    };\r\n    // Filter N_Clinic data for this day and person\r\n    const filteredNClinic = nClinicData.filter((item) => {\r\n      const date = parseDateStr(item.income_date);\r\n      if (!date) return false;\r\n      const itemDay = date.getDate();\r\n      const itemMonth = date.getMonth();\r\n      const itemYear = date.getFullYear();\r\n      if (\r\n        itemMonth !== selectedMonth ||\r\n        itemYear !== selectedYear ||\r\n        itemDay !== day\r\n      ) {\r\n        return false;\r\n      }\r\n      // For ‡∏à‡∏µ‡∏ô row, include both ‡∏à‡∏µ‡∏ô and ‡∏°‡∏∏‡∏Å\r\n      if (rowId === \"105-‡∏à‡∏µ‡∏ô\") {\r\n        return (\r\n          item.staff_display_name === \"‡∏à‡∏µ‡∏ô\" || item.staff_display_name === \"‡∏°‡∏∏‡∏Å\"\r\n        );\r\n      }\r\n      return item.staff_display_name === contactPerson;\r\n    });\r\n    // Filter Future Revenue data for this day and person\r\n    const filteredFuture = revenueFutureData.filter((item) => {\r\n      const date = parseDateStr(item.surgery_date);\r\n      if (!date) return false;\r\n      const itemDay = date.getDate();\r\n      const itemMonth = date.getMonth();\r\n      const itemYear = date.getFullYear();\r\n      if (\r\n        itemMonth !== selectedMonth ||\r\n        itemYear !== selectedYear ||\r\n        itemDay !== day\r\n      ) {\r\n        return false;\r\n      }\r\n      // For ‡∏à‡∏µ‡∏ô row, include both ‡∏à‡∏µ‡∏ô and ‡∏°‡∏∏‡∏Å\r\n      if (rowId === \"105-‡∏à‡∏µ‡∏ô\") {\r\n        return item.contact_staff === \"‡∏à‡∏µ‡∏ô\" || item.contact_staff === \"‡∏°‡∏∏‡∏Å\";\r\n      }\r\n      return item.contact_staff === contactPerson;\r\n    });\r\n    if (filteredNClinic.length === 0 && filteredFuture.length === 0) return;\r\n    // Find the display name from pScheduleRows\r\n    const rowInfo = pScheduleRows.find((r) => r.id === rowId);\r\n    const displayName = rowInfo ? rowInfo.name : contactPerson;\r\n    setSelectedNClinicData(filteredNClinic);\r\n    setSelectedFutureData(filteredFuture);\r\n    setSelectedDate(day);\r\n    setSelectedContactPerson(displayName);\r\n    setRevenueModalOpen(true);\r\n  };\r\n  // Handle cell click to open modal\r\n  const handleCellClick = (\r\n    day: number,\r\n    rowId: string,\r\n    tableType: \"P\" | \"L\"\r\n  ) => {\r\n    const contactPerson = CONTACT_PERSON_MAPPING[rowId];\r\n    if (!contactPerson) return;\r\n    const personMap = tableType === \"P\" ? countMap : countMapL;\r\n    let surgeries: SurgeryScheduleData[] = [];\r\n    // For ‡∏à‡∏µ‡∏ô row, combine ‡∏à‡∏µ‡∏ô and ‡∏°‡∏∏‡∏Å data\r\n    if (rowId === \"105-‡∏à‡∏µ‡∏ô\") {\r\n      const jinMap = personMap.get(\"‡∏à‡∏µ‡∏ô\");\r\n      const mukMap = personMap.get(\"‡∏°‡∏∏‡∏Å\");\r\n      const jinSurgeries = jinMap?.get(day) || [];\r\n      const mukSurgeries = mukMap?.get(day) || [];\r\n      surgeries = [...jinSurgeries, ...mukSurgeries];\r\n    } else {\r\n      const surgeryMap = personMap.get(contactPerson);\r\n      if (!surgeryMap) return;\r\n      surgeries = surgeryMap.get(day) || [];\r\n    }\r\n    if (surgeries.length === 0) return;\r\n    // Find the display name from pScheduleRows\r\n    const rowInfo = pScheduleRows.find((r) => r.id === rowId);\r\n    const displayName = rowInfo ? rowInfo.name : contactPerson;\r\n    setSelectedSurgeries(surgeries);\r\n    setSelectedDate(day);\r\n    setSelectedContactPerson(displayName);\r\n    setSelectedTableType(tableType);\r\n    setModalOpen(true);\r\n  };\r\n  // Get count for a specific cell\r\n  const getCellCount = (\r\n    day: number,\r\n    rowId: string,\r\n    tableType: \"P\" | \"L\"\r\n  ): number => {\r\n    const contactPerson = CONTACT_PERSON_MAPPING[rowId];\r\n    if (!contactPerson) return 0;\r\n    const personMap = tableType === \"P\" ? countMap : countMapL;\r\n    // For ‡∏à‡∏µ‡∏ô row, combine ‡∏à‡∏µ‡∏ô and ‡∏°‡∏∏‡∏Å data\r\n    if (rowId === \"105-‡∏à‡∏µ‡∏ô\") {\r\n      const jinMap = personMap.get(\"‡∏à‡∏µ‡∏ô\");\r\n      const mukMap = personMap.get(\"‡∏°‡∏∏‡∏Å\");\r\n      const jinSurgeries = jinMap?.get(day) || [];\r\n      const mukSurgeries = mukMap?.get(day) || [];\r\n      return jinSurgeries.length + mukSurgeries.length;\r\n    }\r\n    const surgeryMap = personMap.get(contactPerson);\r\n    if (!surgeryMap) return 0;\r\n    const surgeries = surgeryMap.get(day);\r\n    return surgeries ? surgeries.length : 0;\r\n  };\r\n  // Get revenue for a specific cell (‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å 2 API: N_Clinic + Future Revenue)\r\n  const getCellRevenue = (day: number, rowId: string): number => {\r\n    const contactPerson = CONTACT_PERSON_MAPPING[rowId];\r\n    if (!contactPerson) {\r\n      console.warn(`‚ö†Ô∏è No contact person mapping for rowId: ${rowId}`);\r\n      return 0;\r\n    }\r\n    let totalRevenue = 0;\r\n    // Debug: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á 2 maps\r\n    if (day === 1) {\r\n      console.log(`üîç Debug getCellRevenue for day ${day}, rowId ${rowId}:`, {\r\n        rowId,\r\n        contactPerson,\r\n        nClinicMapSize: filmRevenueMapNClinic.size,\r\n        futureMapSize: filmRevenueMap.size,\r\n        nClinicMapKeys: Array.from(filmRevenueMapNClinic.keys()),\r\n        futureMapKeys: Array.from(filmRevenueMap.keys()),\r\n      });\r\n    }\r\n    // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å N_Clinic (sale_date <= today)\r\n    if (filmRevenueMapNClinic.size > 0) {\r\n      if (rowId === \"105-‡∏à‡∏µ‡∏ô\") {\r\n        const jinRevenue = filmRevenueMapNClinic.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0;\r\n        const mukRevenue = filmRevenueMapNClinic.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0;\r\n        totalRevenue += jinRevenue + mukRevenue;\r\n      } else {\r\n        const revenue = filmRevenueMapNClinic.get(contactPerson)?.get(day) || 0;\r\n        totalRevenue += revenue;\r\n      }\r\n    }\r\n    // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Future Revenue (surgery_date >= today)\r\n    if (filmRevenueMap.size > 0) {\r\n      if (rowId === \"105-‡∏à‡∏µ‡∏ô\") {\r\n        const jinRevenue = filmRevenueMap.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0;\r\n        const mukRevenue = filmRevenueMap.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0;\r\n        totalRevenue += jinRevenue + mukRevenue;\r\n      } else {\r\n        const revenue = filmRevenueMap.get(contactPerson)?.get(day) || 0;\r\n        totalRevenue += revenue;\r\n      }\r\n    }\r\n    if (day === 1 && totalRevenue > 0) {\r\n      console.log(\r\n        `üí∞ Total Revenue for ${rowId} (${contactPerson}) day ${day}:`,\r\n        {\r\n          nClinic:\r\n            rowId === \"105-‡∏à‡∏µ‡∏ô\"\r\n              ? (filmRevenueMapNClinic.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0) +\r\n                (filmRevenueMapNClinic.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0)\r\n              : filmRevenueMapNClinic.get(contactPerson)?.get(day) || 0,\r\n          future:\r\n            rowId === \"105-‡∏à‡∏µ‡∏ô\"\r\n              ? (filmRevenueMap.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0) +\r\n                (filmRevenueMap.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0)\r\n              : filmRevenueMap.get(contactPerson)?.get(day) || 0,\r\n          totalRevenue,\r\n        }\r\n      );\r\n    }\r\n    return totalRevenue;\r\n  };\r\n  // Calculate KPI Diff (Actual - KPI To Date)\r\n  const calculateDiff = (rowId: string): number => {\r\n    const data = kpiData[rowId];\r\n    if (!data) return 0;\r\n    // For \"105-‡∏à‡∏µ‡∏ô & ‡∏°‡∏∏‡∏Å\", multiply kpiToDate by 2\r\n    const adjustedKpiToDate =\r\n      rowId === \"105-‡∏à‡∏µ‡∏ô\" ? data.kpiToDate * 2 : data.kpiToDate;\r\n    return data.actual - adjustedKpiToDate;\r\n  };\r\n  // Format number as Thai currency\r\n  const formatCurrency = (amount: number): string => {\r\n    if (amount === 0) return \"\";\r\n    return amount.toLocaleString(\"th-TH\");\r\n  };\r\n  // Data for table (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤ P)\r\n  const pScheduleRows = [\r\n    { id: \"105-‡∏à‡∏µ‡∏ô\", name: \"105-‡∏à‡∏µ‡∏ô & ‡∏°‡∏∏‡∏Å\" },\r\n    { id: \"107-‡πÄ‡∏à\", name: \"107-‡πÄ‡∏à\" },\r\n    { id: \"108-‡∏ß‡πà‡∏≤‡∏ô\", name: \"108-‡∏ß‡πà‡∏≤‡∏ô\" },\r\n  ];\r\n\r\n  // Data for revenue table only (‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö)\r\n  const revenueScheduleRows = [\r\n    { id: \"105-‡∏à‡∏µ‡∏ô\", name: \"105-‡∏à‡∏µ‡∏ô & ‡∏°‡∏∏‡∏Å\" },\r\n    { id: \"107-‡πÄ‡∏à\", name: \"107-‡πÄ‡∏à\" },\r\n    { id: \"108-‡∏ß‡πà‡∏≤‡∏ô\", name: \"108-‡∏ß‡πà‡∏≤‡∏ô\" },\r\n    { id: \"110-‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\", name: \"‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\" },\r\n  ];\r\n  return (\r\n    <div className=\"surgery-schedule-container\">\r\n      <div className=\"schedule-header\">\r\n        <div\r\n          style={{\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            gap: \"16px\",\r\n            marginBottom: \"16px\",\r\n          }}\r\n        >\r\n          <button\r\n            onClick={() => router.push(\"/home\")}\r\n            className=\"back-button\"\r\n            style={{\r\n              padding: \"8px 16px\",\r\n              backgroundColor: \"#4CAF50\",\r\n              color: \"white\",\r\n              border: \"none\",\r\n              borderRadius: \"4px\",\r\n              cursor: \"pointer\",\r\n              fontSize: \"14px\",\r\n              fontWeight: \"500\",\r\n              display: \"flex\",\r\n              alignItems: \"center\",\r\n              gap: \"8px\",\r\n              transition: \"background-color 0.2s\",\r\n            }}\r\n            onMouseEnter={(e) =>\r\n              (e.currentTarget.style.backgroundColor = \"#45a049\")\r\n            }\r\n            onMouseLeave={(e) =>\r\n              (e.currentTarget.style.backgroundColor = \"#4CAF50\")\r\n            }\r\n          >\r\n            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å\r\n          </button>\r\n        </div>\r\n        <h1 style={{ textAlign: \"center\", margin: \"16px 0\" }}>\r\n          Performance - ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\r\n        </h1>\r\n        {/* Calendar Controls */}\r\n        <div className=\"calendar-controls\">\r\n          <button onClick={handlePreviousMonth} className=\"nav-button\">\r\n            ‚óÄ ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Å‡πà‡∏≠‡∏ô\r\n          </button>\r\n          <div className=\"date-selectors\">\r\n            <select\r\n              value={selectedMonth}\r\n              onChange={handleMonthChange}\r\n              className=\"month-select\"\r\n            >\r\n              {monthNames.map((month, index) => (\r\n                <option key={index} value={index}>\r\n                  {month}\r\n                </option>\r\n              ))}\r\n            </select>\r\n            <select\r\n              value={selectedYear}\r\n              onChange={handleYearChange}\r\n              className=\"year-select\"\r\n            >\r\n              {yearOptions.map((year) => (\r\n                <option key={year} value={year}>\r\n                  {year + 543} {/* Convert to Buddhist Era */}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n          <button onClick={handleNextMonth} className=\"nav-button\">\r\n            ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ ‚ñ∂\r\n          </button>\r\n        </div>\r\n        <div className=\"selected-month-display\">\r\n          <strong>\r\n            ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô {monthNames[selectedMonth]} {selectedYear + 543}\r\n          </strong>\r\n          <span className=\"days-count\"> ({daysInMonth} ‡∏ß‡∏±‡∏ô)</span>\r\n          {calculateWeekdaysToDate() > 0 && (\r\n            <span className=\"weekdays-count\">\r\n              {\" \"}\r\n              | üóìÔ∏è ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏≤: {calculateWeekdaysToDate()} ‡∏ß‡∏±‡∏ô\r\n            </span>\r\n          )}\r\n        </div>\r\n        {/* Data Info and Refresh Button */}\r\n      </div>\r\n      {/* Team Summary Dashboard */}\r\n      {!isLoading && !error && (\r\n        <div className=\"team-summary-dashboard\">\r\n          {pScheduleRows.map((row, index) => {\r\n            const pActual = kpiData[row.id]?.actual || 0;\r\n            const pDiff = calculateDiff(row.id);\r\n            const pKpiToDate = kpiData[row.id]?.kpiToDate || 0;\r\n            // Calculate L table actual\r\n            let lActual = 0;\r\n            days.forEach((day) => {\r\n              lActual += getCellCount(day, row.id, \"L\");\r\n            });\r\n            // Calculate revenue actual\r\n            let revenueActual = 0;\r\n            days.forEach((day) => {\r\n              revenueActual += getCellRevenue(day, row.id);\r\n            });\r\n            // Calculate L diff (using same KPI as P table)\r\n            const lDiff = lActual - pKpiToDate;\r\n            const lKpiToDate = pKpiToDate;\r\n            // Calculate revenue diff\r\n            // For \"105-‡∏à‡∏µ‡∏ô & ‡∏°‡∏∏‡∏Å\", multiply KPI by 2\r\n            const revenueKpiToDate =\r\n              row.id === \"105-‡∏à‡∏µ‡∏ô\"\r\n                ? pKpiToDate * 2 * 25000\r\n                : pKpiToDate * 25000;\r\n            const revenueDiff = revenueActual - revenueKpiToDate;\r\n            // Different color for each team\r\n            const teamColors = [\r\n              \"team-color-1\", // 105-‡∏à‡∏µ‡∏ô & ‡∏°‡∏∏‡∏Å\r\n              \"team-color-2\", // 107-‡πÄ‡∏à\r\n              \"team-color-3\", // 108-‡∏ß‡πà‡∏≤‡∏ô\r\n            ];\r\n            return (\r\n              <div\r\n                key={row.id}\r\n                className={`team-summary-card ${teamColors[index]}`}\r\n              >\r\n                <div className=\"team-summary-header\">\r\n                  <h3>{row.name}</h3>\r\n                </div>\r\n                <div className=\"team-summary-body\">\r\n                  <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">\r\n                          {formatCurrency(revenueKpiToDate)}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">\r\n                          {formatCurrency(revenueActual)}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            revenueDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {revenueDiff >= 0 ? \"+\" : \"‚àí\"}\r\n                          {formatCurrency(Math.abs(revenueDiff))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">\r\n                          {row.id === \"105-‡∏à‡∏µ‡∏ô\" ? pKpiToDate * 2 : pKpiToDate}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">{pActual}</div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            pDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {pDiff >= 0 ? \"+\" : \"‚àí\"}\r\n                          {Math.abs(pDiff)}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  {/* <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏ß‡πà‡∏≤‡∏ô</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">{lKpiToDate}</div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">{lActual}</div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            lDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {lDiff >= 0 ? \"+\" : \"\"}\r\n                          {lDiff.toFixed(1)}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div> */}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n          {/* ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á Summary Card */}\r\n          {(() => {\r\n            const row = { id: \"110-‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\", name: \"‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\" };\r\n            const pActual = kpiData[row.id]?.actual || 0;\r\n            const pDiff = calculateDiff(row.id);\r\n            const pKpiToDate = kpiData[row.id]?.kpiToDate || 0;\r\n\r\n            // Calculate revenue actual\r\n            let revenueActual = 0;\r\n            days.forEach((day) => {\r\n              revenueActual += getCellRevenue(day, row.id);\r\n            });\r\n\r\n            // Calculate revenue diff\r\n            const revenueKpiToDate = pKpiToDate * 25000;\r\n            const revenueDiff = revenueActual - revenueKpiToDate;\r\n\r\n            return (\r\n              <div key={row.id} className=\"team-summary-card team-color-4\">\r\n                <div className=\"team-summary-header\">\r\n                  <h3>{row.name}</h3>\r\n                </div>\r\n                <div className=\"team-summary-body\">\r\n                  <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">\r\n                          {formatCurrency(revenueKpiToDate)}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">\r\n                          {formatCurrency(revenueActual)}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            revenueDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {revenueDiff >= 0 ? \"+\" : \"‚àí\"}\r\n                          {formatCurrency(Math.abs(revenueDiff))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">{pKpiToDate}</div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">{pActual}</div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            pDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {pDiff >= 0 ? \"+\" : \"‚àí\"}\r\n                          {Math.abs(pDiff)}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })()}\r\n          {/* ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î Summary Card */}\r\n          {(() => {\r\n            const allRows = [\r\n              ...pScheduleRows,\r\n              { id: \"110-‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\", name: \"‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\" },\r\n            ];\r\n\r\n            // Calculate total revenue actual\r\n            let totalRevenueActual = 0;\r\n            allRows.forEach((row) => {\r\n              days.forEach((day) => {\r\n                totalRevenueActual += getCellRevenue(day, row.id);\r\n              });\r\n            });\r\n\r\n            // Calculate total revenue KPI to date\r\n            let totalRevenueKpiToDate = 0;\r\n            allRows.forEach((row) => {\r\n              const pKpiToDate = kpiData[row.id]?.kpiToDate || 0;\r\n              const multiplier = row.id === \"105-‡∏à‡∏µ‡∏ô\" ? 2 : 1;\r\n              totalRevenueKpiToDate += pKpiToDate * multiplier * 25000;\r\n            });\r\n\r\n            // Calculate total revenue diff\r\n            const totalRevenueDiff = totalRevenueActual - totalRevenueKpiToDate;\r\n\r\n            // Calculate total surgery actual\r\n            let totalSurgeryActual = 0;\r\n            allRows.forEach((row) => {\r\n              totalSurgeryActual += kpiData[row.id]?.actual || 0;\r\n            });\r\n\r\n            // Calculate total surgery KPI to date\r\n            let totalSurgeryKpiToDate = 0;\r\n            allRows.forEach((row) => {\r\n              const pKpiToDate = kpiData[row.id]?.kpiToDate || 0;\r\n              const multiplier = row.id === \"105-‡∏à‡∏µ‡∏ô\" ? 2 : 1;\r\n              totalSurgeryKpiToDate += pKpiToDate * multiplier;\r\n            });\r\n\r\n            // Calculate total surgery diff\r\n            const totalSurgeryDiff = totalSurgeryActual - totalSurgeryKpiToDate;\r\n\r\n            return (\r\n              <div key=\"total\" className=\"team-summary-card team-color-pink\">\r\n                <div className=\"team-summary-header\">\r\n                  <h3>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>\r\n                </div>\r\n                <div className=\"team-summary-body\">\r\n                  <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">\r\n                          {formatCurrency(totalRevenueKpiToDate)}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">\r\n                          {formatCurrency(totalRevenueActual)}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            totalRevenueDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {totalRevenueDiff >= 0 ? \"+\" : \"‚àí\"}\r\n                          {formatCurrency(Math.abs(totalRevenueDiff))}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"summary-metric\">\r\n                    <div className=\"metric-label\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î</div>\r\n                    <div className=\"metric-row\">\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">KPI to date</div>\r\n                        <div className=\"metric-value\">\r\n                          {totalSurgeryKpiToDate}\r\n                        </div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Actual</div>\r\n                        <div className=\"metric-value\">{totalSurgeryActual}</div>\r\n                      </div>\r\n                      <div className=\"metric-item\">\r\n                        <div className=\"metric-title\">Diff</div>\r\n                        <div\r\n                          className={`metric-value ${\r\n                            totalSurgeryDiff >= 0 ? \"positive\" : \"negative\"\r\n                          }`}\r\n                        >\r\n                          {totalSurgeryDiff >= 0 ? \"+\" : \"‚àí\"}\r\n                          {Math.abs(totalSurgeryDiff)}\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            );\r\n          })()}\r\n        </div>\r\n      )}\r\n      {/* Loading Indicator */}\r\n      {isLoading && (\r\n        <div className=\"loading-indicator\">\r\n          <div className=\"spinner\"></div>\r\n          <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>\r\n        </div>\r\n      )}\r\n      {/* Error Display */}\r\n      {error && (\r\n        <div className=\"error-display\">\r\n          <div className=\"error-icon\">‚ö†Ô∏è</div>\r\n          <div className=\"error-content\">\r\n            <h3>‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</h3>\r\n            <p>{error}</p>\r\n            <div className=\"error-help\">\r\n              <strong>‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:</strong>\r\n              <ol>\r\n                <li>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ PostgreSQL Database ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà</li>\r\n                <li>\r\n                  ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Environment Variables (Settings ‚Üí Environment\r\n                  Variables):\r\n                  <br />- <code>DB_HOST</code>\r\n                  <br />- <code>DB_PORT</code>\r\n                  <br />- <code>DB_USER</code>\r\n                  <br />- <code>DB_PASSWORD</code>\r\n                  <br />- <code>DB_NAME</code>\r\n                </li>\r\n                <li>\r\n                  ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á <code>surgery_schedule</code> ‡πÅ‡∏•‡∏∞{\" \"}\r\n                  <code>sale_incentive</code> ‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n                </li>\r\n                <li>\r\n                  ‡∏£‡∏±‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á SQL schema: <code>surgery-schedule-schema.sql</code>\r\n                </li>\r\n                <li>‡∏•‡∏≠‡∏á Redeploy Vercel ‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>\r\n              </ol>\r\n            </div>\r\n            <button\r\n              onClick={async () => {\r\n                await loadData();\r\n                await loadNClinicData();\r\n                await loadRevenueFutureData();\r\n              }}\r\n              className=\"retry-button\"\r\n            >\r\n              ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n      {/* Table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤ P */}\r\n      <div className=\"table-section \">\r\n        <div className=\"table-wrapper\" ref={pTableRef}>\r\n          <table className=\"schedule-table\">\r\n            <thead>\r\n              <tr>\r\n                <th className=\"header-cell name-header\" rowSpan={2}>\r\n                  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\r\n                </th>\r\n                {days.map((day) => (\r\n                  <th\r\n                    key={`p-day-${day}`}\r\n                    className={`header-cell day-header  ${\r\n                      isWeekday(day) ? \"weekday-header\" : \"\"\r\n                    }`}\r\n                    style={{ width: \"62px\" }}\r\n                  >\r\n                    {day}\r\n                  </th>\r\n                ))}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {pScheduleRows.map((row, rowIndex) => (\r\n                <tr\r\n                  key={`p-row-${row.id}`}\r\n                  className={rowIndex % 2 === 0 ? \"even-row\" : \"odd-row\"}\r\n                >\r\n                  <td className=\"name-cell\">{row.name}</td>\r\n                  {days.map((day) => {\r\n                    const count = getCellCount(day, row.id, \"P\");\r\n                    return (\r\n                      <td\r\n                        key={`p-cell-${row.id}-${day}`}\r\n                        className={`data-cell ${count > 0 ? \"has-data\" : \"\"}`}\r\n                        onClick={() =>\r\n                          count > 0 && handleCellClick(day, row.id, \"P\")\r\n                        }\r\n                        title={\r\n                          count > 0\r\n                            ? `‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (${count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)`\r\n                            : \"\"\r\n                        }\r\n                      >\r\n                        {count > 0 && (\r\n                          <span className=\"count-badge\">{count}</span>\r\n                        )}\r\n                      </td>\r\n                    );\r\n                  })}\r\n                </tr>\r\n              ))}\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n      {/* Table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î L */}\r\n      <div className=\"table-section\">\r\n        <div className=\"table-wrapper\" ref={lTableRef}>\r\n          <table className=\"schedule-table\">\r\n            <thead>\r\n              <tr>\r\n                <th className=\"header-cell name-header\" rowSpan={2}>\r\n                  ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î L\r\n                </th>\r\n                {days.map((day) => (\r\n                  <th\r\n                    key={`l-day-${day}`}\r\n                    className={`header-cell day-header ${\r\n                      isWeekday(day) ? \"weekday-header\" : \"\"\r\n                    }`}\r\n                    style={{ width: \"62px\" }}\r\n                  >\r\n                    {day}\r\n                  </th>\r\n                ))}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {revenueScheduleRows.map((row, rowIndex) => (\r\n                <tr\r\n                  key={`l-row-${row.id}`}\r\n                  className={rowIndex % 2 === 0 ? \"even-row\" : \"odd-row\"}\r\n                >\r\n                  <td className=\"name-cell\">{row.name}</td>\r\n                  {days.map((day) => {\r\n                    const contactPerson = CONTACT_PERSON_MAPPING[row.id];\r\n\r\n                    // Parse date function\r\n                    const parseDateStr = (\r\n                      dateStr: string | undefined\r\n                    ): Date | null => {\r\n                      if (!dateStr) return null;\r\n                      try {\r\n                        return new Date(dateStr);\r\n                      } catch {\r\n                        return null;\r\n                      }\r\n                    };\r\n\r\n                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≤‡∏Å N_Clinic (n_income - ‡∏™‡∏µ‡∏ü‡πâ‡∏≤)\r\n                    let nClinicCount = 0;\r\n                    nClinicData.forEach((item) => {\r\n                      const date = parseDateStr(item.income_date);\r\n                      if (!date) return;\r\n                      const itemDay = date.getDate();\r\n                      const itemMonth = date.getMonth();\r\n                      const itemYear = date.getFullYear();\r\n                      if (\r\n                        itemMonth !== selectedMonth ||\r\n                        itemYear !== selectedYear ||\r\n                        itemDay !== day\r\n                      ) {\r\n                        return;\r\n                      }\r\n                      // For ‡∏à‡∏µ‡∏ô row, include both ‡∏à‡∏µ‡∏ô and ‡∏°‡∏∏‡∏Å\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        if (\r\n                          item.staff_display_name === \"‡∏à‡∏µ‡∏ô\" ||\r\n                          item.staff_display_name === \"‡∏°‡∏∏‡∏Å\"\r\n                        ) {\r\n                          nClinicCount++;\r\n                        }\r\n                      } else if (item.staff_display_name === contactPerson) {\r\n                        nClinicCount++;\r\n                      }\r\n                    });\r\n\r\n                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏≤‡∏Å Future (bjh_all_leads - surgery_date >= today - ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)\r\n                    let futureCount = 0;\r\n                    revenueFutureData.forEach((item) => {\r\n                      const date = parseDateStr(item.surgery_date);\r\n                      if (!date) return;\r\n                      const itemDay = date.getDate();\r\n                      const itemMonth = date.getMonth();\r\n                      const itemYear = date.getFullYear();\r\n                      if (\r\n                        itemMonth !== selectedMonth ||\r\n                        itemYear !== selectedYear ||\r\n                        itemDay !== day\r\n                      ) {\r\n                        return;\r\n                      }\r\n                      // For ‡∏à‡∏µ‡∏ô row, include both ‡∏à‡∏µ‡∏ô and ‡∏°‡∏∏‡∏Å\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        if (\r\n                          item.contact_staff === \"‡∏à‡∏µ‡∏ô\" ||\r\n                          item.contact_staff === \"‡∏°‡∏∏‡∏Å\"\r\n                        ) {\r\n                          futureCount++;\r\n                        }\r\n                      } else if (item.contact_staff === contactPerson) {\r\n                        futureCount++;\r\n                      }\r\n                    });\r\n\r\n                    const totalCount = nClinicCount + futureCount;\r\n\r\n                    return (\r\n                      <td\r\n                        key={`l-cell-${row.id}-${day}`}\r\n                        className={`data-cell ${\r\n                          totalCount > 0 ? \"has-data revenue-cell\" : \"\"\r\n                        }`}\r\n                        onClick={() =>\r\n                          totalCount > 0 && handleCellClick(day, row.id, \"L\")\r\n                        }\r\n                        title={\r\n                          totalCount > 0\r\n                            ? `‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î\\nN_Clinic: ${nClinicCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\\nFuture: ${futureCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${totalCount} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`\r\n                            : \"\"\r\n                        }\r\n                      >\r\n                        <div\r\n                          style={{\r\n                            display: \"flex\",\r\n                            flexDirection: \"column\",\r\n                            gap: \"4px\",\r\n                            alignItems: \"center\",\r\n                          }}\r\n                        >\r\n                          {nClinicCount > 0 && (\r\n                            <span className=\"count-badge revenue-badge-blue\">\r\n                              {nClinicCount}\r\n                            </span>\r\n                          )}\r\n                          {futureCount > 0 && (\r\n                            <span className=\"count-badge revenue-badge-green\">\r\n                              {futureCount}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </td>\r\n                    );\r\n                  })}\r\n                </tr>\r\n              ))}\r\n              {/* ‡πÅ‡∏ñ‡∏ß‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° */}\r\n              <tr className=\"total-row\">\r\n                <td className=\"name-cell\" style={{ fontWeight: \"bold\" }}>\r\n                  ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°\r\n                </td>\r\n                {days.map((day) => {\r\n                  // Parse date function\r\n                  const parseDateStr = (\r\n                    dateStr: string | undefined\r\n                  ): Date | null => {\r\n                    if (!dateStr) return null;\r\n                    try {\r\n                      return new Date(dateStr);\r\n                    } catch {\r\n                      return null;\r\n                    }\r\n                  };\r\n\r\n                  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß\r\n                  let dailyTotal = 0;\r\n                  revenueScheduleRows.forEach((row) => {\r\n                    const contactPerson = CONTACT_PERSON_MAPPING[row.id];\r\n\r\n                    // ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å N_Clinic\r\n                    nClinicData.forEach((item) => {\r\n                      const date = parseDateStr(item.income_date);\r\n                      if (!date) return;\r\n                      const itemDay = date.getDate();\r\n                      const itemMonth = date.getMonth();\r\n                      const itemYear = date.getFullYear();\r\n                      if (\r\n                        itemMonth !== selectedMonth ||\r\n                        itemYear !== selectedYear ||\r\n                        itemDay !== day\r\n                      ) {\r\n                        return;\r\n                      }\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        if (\r\n                          item.staff_display_name === \"‡∏à‡∏µ‡∏ô\" ||\r\n                          item.staff_display_name === \"‡∏°‡∏∏‡∏Å\"\r\n                        ) {\r\n                          dailyTotal++;\r\n                        }\r\n                      } else if (item.staff_display_name === contactPerson) {\r\n                        dailyTotal++;\r\n                      }\r\n                    });\r\n\r\n                    // ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å Future\r\n                    revenueFutureData.forEach((item) => {\r\n                      const date = parseDateStr(item.surgery_date);\r\n                      if (!date) return;\r\n                      const itemDay = date.getDate();\r\n                      const itemMonth = date.getMonth();\r\n                      const itemYear = date.getFullYear();\r\n                      if (\r\n                        itemMonth !== selectedMonth ||\r\n                        itemYear !== selectedYear ||\r\n                        itemDay !== day\r\n                      ) {\r\n                        return;\r\n                      }\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        if (\r\n                          item.contact_staff === \"‡∏à‡∏µ‡∏ô\" ||\r\n                          item.contact_staff === \"‡∏°‡∏∏‡∏Å\"\r\n                        ) {\r\n                          dailyTotal++;\r\n                        }\r\n                      } else if (item.contact_staff === contactPerson) {\r\n                        dailyTotal++;\r\n                      }\r\n                    });\r\n                  });\r\n\r\n                  return (\r\n                    <td\r\n                      key={`total-l-cell-${day}`}\r\n                      className={`data-cell ${\r\n                        dailyTotal > 0 ? \"has-data\" : \"\"\r\n                      }`}\r\n                      style={{ fontWeight: \"bold\" }}\r\n                      title={\r\n                        dailyTotal > 0\r\n                          ? `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${dailyTotal} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`\r\n                          : \"\"\r\n                      }\r\n                    >\r\n                      {dailyTotal > 0 && (\r\n                        <span className=\"count-badge\">{dailyTotal}</span>\r\n                      )}\r\n                    </td>\r\n                  );\r\n                })}\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n      {/* Table - ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö */}\r\n      <div className=\"table-section\">\r\n        <div className=\"table-wrapper\" ref={revenueTableRef}>\r\n          <table className=\"schedule-table\">\r\n            <thead>\r\n              <tr>\r\n                <th className=\"header-cell name-header\" rowSpan={2}>\r\n                  ‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö\r\n                </th>\r\n                {days.map((day) => (\r\n                  <th\r\n                    key={`revenue-day-${day}`}\r\n                    className={`header-cell day-header ${\r\n                      isWeekday(day) ? \"weekday-header\" : \"\"\r\n                    }`}\r\n                    style={{ width: \"62px\" }}\r\n                  >\r\n                    {day}\r\n                  </th>\r\n                ))}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {revenueScheduleRows.map((row, rowIndex) => (\r\n                <tr\r\n                  key={`revenue-row-${row.id}`}\r\n                  className={rowIndex % 2 === 0 ? \"even-row\" : \"odd-row\"}\r\n                >\r\n                  <td className=\"name-cell\">{row.name}</td>\r\n                  {days.map((day) => {\r\n                    const contactPerson = CONTACT_PERSON_MAPPING[row.id];\r\n\r\n                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì N_Clinic revenue (‡∏™‡∏µ‡∏ü‡πâ‡∏≤)\r\n                    let nClinicRevenue = 0;\r\n                    if (filmRevenueMapNClinic.size > 0) {\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        nClinicRevenue =\r\n                          (filmRevenueMapNClinic.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0) +\r\n                          (filmRevenueMapNClinic.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0);\r\n                      } else {\r\n                        nClinicRevenue =\r\n                          filmRevenueMapNClinic.get(contactPerson)?.get(day) ||\r\n                          0;\r\n                      }\r\n                    }\r\n\r\n                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Future revenue (‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß)\r\n                    let futureRevenue = 0;\r\n                    if (filmRevenueMap.size > 0) {\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        futureRevenue =\r\n                          (filmRevenueMap.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0) +\r\n                          (filmRevenueMap.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0);\r\n                      } else {\r\n                        futureRevenue =\r\n                          filmRevenueMap.get(contactPerson)?.get(day) || 0;\r\n                      }\r\n                    }\r\n\r\n                    const totalRevenue = nClinicRevenue + futureRevenue;\r\n\r\n                    return (\r\n                      <td\r\n                        key={`revenue-cell-${row.id}-${day}`}\r\n                        className={`data-cell ${\r\n                          totalRevenue > 0 ? \"has-data revenue-cell\" : \"\"\r\n                        }`}\r\n                        onClick={() =>\r\n                          totalRevenue > 0 &&\r\n                          handleRevenueCellClick(day, row.id)\r\n                        }\r\n                        title={\r\n                          totalRevenue > 0\r\n                            ? `‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î\\nN_Clinic: ${formatCurrency(\r\n                                nClinicRevenue\r\n                              )} ‡∏ö‡∏≤‡∏ó\\nFuture: ${formatCurrency(\r\n                                futureRevenue\r\n                              )} ‡∏ö‡∏≤‡∏ó\\n‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${formatCurrency(\r\n                                totalRevenue\r\n                              )} ‡∏ö‡∏≤‡∏ó`\r\n                            : \"\"\r\n                        }\r\n                      >\r\n                        <div\r\n                          style={{\r\n                            display: \"flex\",\r\n                            flexDirection: \"column\",\r\n                            gap: \"4px\",\r\n                            alignItems: \"center\",\r\n                          }}\r\n                        >\r\n                          {nClinicRevenue > 0 && (\r\n                            <span className=\"revenue-badge revenue-badge-blue\">\r\n                              {formatCurrency(nClinicRevenue)}\r\n                            </span>\r\n                          )}\r\n                          {futureRevenue > 0 && (\r\n                            <span className=\"revenue-badge revenue-badge-green\">\r\n                              {formatCurrency(futureRevenue)}\r\n                            </span>\r\n                          )}\r\n                        </div>\r\n                      </td>\r\n                    );\r\n                  })}\r\n                </tr>\r\n              ))}\r\n              {/* ‡πÅ‡∏ñ‡∏ß‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° */}\r\n              <tr className=\"total-row\">\r\n                <td className=\"name-cell\" style={{ fontWeight: \"bold\" }}>\r\n                  ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°\r\n                </td>\r\n                {days.map((day) => {\r\n                  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏ß‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß\r\n                  let dailyTotal = 0;\r\n                  revenueScheduleRows.forEach((row) => {\r\n                    const contactPerson = CONTACT_PERSON_MAPPING[row.id];\r\n\r\n                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì N_Clinic revenue\r\n                    let nClinicRevenue = 0;\r\n                    if (filmRevenueMapNClinic.size > 0) {\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        nClinicRevenue =\r\n                          (filmRevenueMapNClinic.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0) +\r\n                          (filmRevenueMapNClinic.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0);\r\n                      } else {\r\n                        nClinicRevenue =\r\n                          filmRevenueMapNClinic.get(contactPerson)?.get(day) ||\r\n                          0;\r\n                      }\r\n                    }\r\n\r\n                    // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì Future revenue\r\n                    let futureRevenue = 0;\r\n                    if (filmRevenueMap.size > 0) {\r\n                      if (row.id === \"105-‡∏à‡∏µ‡∏ô\") {\r\n                        futureRevenue =\r\n                          (filmRevenueMap.get(\"‡∏à‡∏µ‡∏ô\")?.get(day) || 0) +\r\n                          (filmRevenueMap.get(\"‡∏°‡∏∏‡∏Å\")?.get(day) || 0);\r\n                      } else {\r\n                        futureRevenue =\r\n                          filmRevenueMap.get(contactPerson)?.get(day) || 0;\r\n                      }\r\n                    }\r\n\r\n                    dailyTotal += nClinicRevenue + futureRevenue;\r\n                  });\r\n\r\n                  return (\r\n                    <td\r\n                      key={`total-cell-${day}`}\r\n                      className={`data-cell ${\r\n                        dailyTotal > 0 ? \"has-data revenue-cell\" : \"\"\r\n                      }`}\r\n                      style={{ fontWeight: \"bold\" }}\r\n                      title={\r\n                        dailyTotal > 0\r\n                          ? `‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${formatCurrency(dailyTotal)} ‡∏ö‡∏≤‡∏ó`\r\n                          : \"\"\r\n                      }\r\n                    >\r\n                      {dailyTotal > 0 && (\r\n                        <span className=\"revenue-badge\">\r\n                          {formatCurrency(dailyTotal)}\r\n                        </span>\r\n                      )}\r\n                    </td>\r\n                  );\r\n                })}\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n      {/* Surgery Details Modal */}\r\n      <SurgeryDetailsModal\r\n        isOpen={modalOpen}\r\n        onClose={() => setModalOpen(false)}\r\n        surgeries={selectedSurgeries}\r\n        date={selectedDate}\r\n        month={selectedMonth}\r\n        year={selectedYear}\r\n        contactPerson={selectedContactPerson}\r\n        tableType={selectedTableType}\r\n      />\r\n      {/* Revenue Details Modal */}\r\n      <RevenueDetailsModal\r\n        isOpen={revenueModalOpen}\r\n        onClose={() => setRevenueModalOpen(false)}\r\n        nClinicData={selectedNClinicData}\r\n        futureData={selectedFutureData}\r\n        date={selectedDate}\r\n        month={selectedMonth}\r\n        year={selectedYear}\r\n        contactPerson={selectedContactPerson}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { SurgeryScheduleData } from \"@/utils/googleSheets\";\r\nimport \"./SurgeryDetailsModal.css\";\r\ninterface SurgeryDetailsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  surgeries: SurgeryScheduleData[];\r\n  date: number;\r\n  month: number;\r\n  year: number;\r\n  contactPerson: string;\r\n  tableType?: \"P\" | \"L\"; // P = ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î, L = ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\r\n}\r\nexport default function SurgeryDetailsModal({\r\n  isOpen,\r\n  onClose,\r\n  surgeries,\r\n  date,\r\n  month,\r\n  year,\r\n  contactPerson,\r\n  tableType = \"P\",\r\n}: SurgeryDetailsModalProps) {\r\n  if (!isOpen) return null;\r\n  const monthNames = [\r\n    \"‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå\",\r\n    \"‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°\",\r\n  ];\r\n  const tableTitle =\r\n    tableType === \"P\" ? \"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\" : \"‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á\";\r\n  const formatCurrency = (amount: string) => {\r\n    if (!amount) return \"-\";\r\n    const num = parseFloat(amount.replace(/,/g, \"\"));\r\n    if (isNaN(num)) return amount;\r\n    return num.toLocaleString(\"th-TH\", {\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    });\r\n  };\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h2>{tableTitle}</h2>\r\n          <button className=\"close-button\" onClick={onClose}>\r\n            ‚úï\r\n          </button>\r\n        </div>\r\n        <div className=\"modal-info\">\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>\r\n            <span className=\"info-value\">\r\n              {date} {monthNames[month]} {year + 543}\r\n            </span>\r\n          </div>\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</span>\r\n            <span className=\"info-value\">{contactPerson}</span>\r\n          </div>\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏î:</span>\r\n            <span className=\"info-value highlight\">\r\n              {surgeries.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"surgeries-list\">\r\n          {surgeries.map((surgery, index) => (\r\n            <div key={index} className=\"surgery-card\">\r\n              <div className=\"card-header\">\r\n                <span className=\"card-number\">#{index + 1}</span>\r\n                <span className=\"card-name\">{surgery.‡∏ä‡∏∑‡πà‡∏≠}</span>\r\n              </div>\r\n              <div className=\"card-body\">\r\n                <div className=\"detail-row\">\r\n                  <span className=\"detail-icon\">üë®‚Äç‚öïÔ∏è</span>\r\n                  <span className=\"detail-label\">‡∏´‡∏°‡∏≠:</span>\r\n                  <span className=\"detail-value\">{surgery.‡∏´‡∏°‡∏≠ || \"-\"}</span>\r\n                </div>\r\n                <div className=\"detail-row\">\r\n                  <span className=\"detail-icon\">üë§</span>\r\n                  <span className=\"detail-label\">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</span>\r\n                  <span className=\"detail-value\">\r\n                    {surgery.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ || \"-\"}\r\n                  </span>\r\n                </div>\r\n                <div className=\"detail-row\">\r\n                  <span className=\"detail-icon\">üìû</span>\r\n                  <span className=\"detail-label\">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span>\r\n                  <span className=\"detail-value\">\r\n                    {surgery.‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ || \"-\"}\r\n                  </span>\r\n                </div>\r\n                <div className=\"detail-row\">\r\n                  <span className=\"detail-icon\">üìÖ</span>\r\n                  <span className=\"detail-label\">\r\n                    {tableType === \"P\" ? \"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î:\" : \"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î:\"}\r\n                  </span>\r\n                  <span className=\"detail-value\">\r\n                    {tableType === \"P\"\r\n                      ? surgery.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"-\"\r\n                      : surgery.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"-\"}\r\n                  </span>\r\n                </div>\r\n                <div className=\"detail-row\">\r\n                  <span className=\"detail-icon\">üïê</span>\r\n                  <span className=\"detail-label\">‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î:</span>\r\n                  <span className=\"detail-value\">\r\n                    {surgery.‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î || \"-\"}\r\n                  </span>\r\n                </div>\r\n                <div className=\"detail-row highlight-row\">\r\n                  <span className=\"detail-icon\">üí∞</span>\r\n                  <span className=\"detail-label\">‡∏¢‡∏≠‡∏î‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠:</span>\r\n                  <span className=\"detail-value amount\">\r\n                    {surgery.‡∏¢‡∏≠‡∏î‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠\r\n                      ? `${formatCurrency(surgery.‡∏¢‡∏≠‡∏î‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠)} ‡∏ö‡∏≤‡∏ó`\r\n                      : \"-\"}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n        <div className=\"modal-footer\">\r\n          <button className=\"close-footer-button\" onClick={onClose}>\r\n            ‡∏õ‡∏¥‡∏î\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r","import React from \"react\";\r\nimport { NClinicData } from \"@/utils/databaseNClinic\";\r\nimport { RevenueFutureData } from \"@/utils/databaseRevenueFuture\";\r\nimport \"./SurgeryDetailsModal.css\";\r\ninterface RevenueDetailsModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  nClinicData: NClinicData[];\r\n  futureData: RevenueFutureData[];\r\n  date: number;\r\n  month: number;\r\n  year: number;\r\n  contactPerson: string;\r\n}\r\nexport default function RevenueDetailsModal({\r\n  isOpen,\r\n  onClose,\r\n  nClinicData,\r\n  futureData,\r\n  date,\r\n  month,\r\n  year,\r\n  contactPerson,\r\n}: RevenueDetailsModalProps) {\r\n  if (!isOpen) return null;\r\n  const monthNames = [\r\n    \"‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå\",\r\n    \"‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°\",\r\n    \"‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô\",\r\n    \"‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°\",\r\n  ];\r\n  const formatCurrency = (amount: number | undefined) => {\r\n    if (!amount) return \"-\";\r\n    return amount.toLocaleString(\"th-TH\", {\r\n      minimumFractionDigits: 0,\r\n      maximumFractionDigits: 0,\r\n    });\r\n  };\r\n  const formatDate = (dateStr: string | undefined) => {\r\n    if (!dateStr) return \"-\";\r\n    try {\r\n      const date = new Date(dateStr);\r\n      const day = date.getDate();\r\n      const month = date.getMonth();\r\n      const year = date.getFullYear();\r\n      return `${day} ${monthNames[month]} ${year + 543}`;\r\n    } catch {\r\n      return dateStr;\r\n    }\r\n  };\r\n  // Calculate total revenue\r\n  const totalRevenue =\r\n    nClinicData.reduce((sum, item) => sum + (item.income || 0), 0) +\r\n    futureData.reduce((sum, item) => sum + (item.proposed_amount || 0), 0);\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal-content\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h2>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö</h2>\r\n          <button className=\"close-button\" onClick={onClose}>\r\n            ‚úï\r\n          </button>\r\n        </div>\r\n        <div className=\"modal-info\">\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>\r\n            <span className=\"info-value\">\r\n              {date} {monthNames[month]} {year + 543}\r\n            </span>\r\n          </div>\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</span>\r\n            <span className=\"info-value\">{contactPerson}</span>\r\n          </div>\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</span>\r\n            <span className=\"info-value highlight\">\r\n              {nClinicData.length + futureData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\r\n            </span>\r\n          </div>\r\n          <div className=\"info-row\">\r\n            <span className=\"info-label\">‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</span>\r\n            <span className=\"info-value highlight amount\">\r\n              {formatCurrency(totalRevenue)} ‡∏ö‡∏≤‡∏ó\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"surgeries-list\">\r\n          {/* N_Clinic Data (sale_date <= today) */}\r\n          {nClinicData.length > 0 && (\r\n            <div className=\"data-section\">\r\n              <h3 className=\"section-title\">\r\n                üìä ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß (N_Clinic) - {nClinicData.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\r\n              </h3>\r\n              {nClinicData.map((item, index) => (\r\n                <div key={`clinic-${index}`} className=\"surgery-card\">\r\n                  <div className=\"card-header\">\r\n                    <span className=\"card-number\">#{index + 1}</span>\r\n                    <span className=\"card-name\">\r\n                      {item.income_display_name || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\"}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"card-body\">\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üë§</span>\r\n                      <span className=\"detail-label\">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span>\r\n                      <span className=\"detail-value\">\r\n                        {item.income_display_name || \"-\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üë•</span>\r\n                      <span className=\"detail-label\">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</span>\r\n                      <span className=\"detail-value\">\r\n                        {item.staff_display_name || \"-\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üìÖ</span>\r\n                      <span className=\"detail-label\">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î:</span>\r\n                      <span className=\"detail-value\">\r\n                        {formatDate(item.income_date)}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row highlight-row\">\r\n                      <span className=\"detail-icon\">üí∞</span>\r\n                      <span className=\"detail-label\">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠:</span>\r\n                      <span className=\"detail-value amount\">\r\n                        {formatCurrency(item.income)} ‡∏ö‡∏≤‡∏ó\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          {/* Future Revenue Data (surgery_date >= today) */}\r\n          {futureData.length > 0 && (\r\n            <div className=\"data-section\">\r\n              <h3 className=\"section-title\">\r\n                üìÖ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏î‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (Future Revenue) - {futureData.length}{\" \"}\r\n                ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£\r\n              </h3>\r\n              {futureData.map((item, index) => (\r\n                <div key={`future-${index}`} className=\"surgery-card\">\r\n                  <div className=\"card-header\">\r\n                    <span className=\"card-number\">\r\n                      #{nClinicData.length + index + 1}\r\n                    </span>\r\n                    <span className=\"card-name\">\r\n                      {item.customer_name || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\"}\r\n                    </span>\r\n                  </div>\r\n                  <div className=\"card-body\">\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üë§</span>\r\n                      <span className=\"detail-label\">‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span>\r\n                      <span className=\"detail-value\">\r\n                        {item.customer_name || \"-\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üë®‚Äç‚öïÔ∏è</span>\r\n                      <span className=\"detail-label\">‡∏´‡∏°‡∏≠:</span>\r\n                      <span className=\"detail-value\">{item.doctor || \"-\"}</span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üë•</span>\r\n                      <span className=\"detail-label\">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠:</span>\r\n                      <span className=\"detail-value\">\r\n                        {item.contact_staff || \"-\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üìû</span>\r\n                      <span className=\"detail-label\">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£:</span>\r\n                      <span className=\"detail-value\">{item.phone || \"-\"}</span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üìÖ</span>\r\n                      <span className=\"detail-label\">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î:</span>\r\n                      <span className=\"detail-value\">\r\n                        {formatDate(item.surgery_date)}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row\">\r\n                      <span className=\"detail-icon\">üïê</span>\r\n                      <span className=\"detail-label\">‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î:</span>\r\n                      <span className=\"detail-value\">\r\n                        {item.appointment_time || \"-\"}\r\n                      </span>\r\n                    </div>\r\n                    <div className=\"detail-row highlight-row\">\r\n                      <span className=\"detail-icon\">üí∞</span>\r\n                      <span className=\"detail-label\">‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏™‡∏ô‡∏≠:</span>\r\n                      <span className=\"detail-value amount\">\r\n                        {formatCurrency(item.proposed_amount)} ‡∏ö‡∏≤‡∏ó\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n          {nClinicData.length === 0 && futureData.length === 0 && (\r\n            <div className=\"empty-state\">\r\n              <p>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n        <div className=\"modal-footer\">\r\n          <button className=\"close-footer-button\" onClick={onClose}>\r\n            ‡∏õ‡∏¥‡∏î\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","// Google Sheets API Integration\r\nexport interface SurgeryScheduleData {\r\n  ‡∏´‡∏°‡∏≠: string;\r\n  ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠: string;\r\n  ‡∏ä‡∏∑‡πà‡∏≠: string;\r\n  ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: string;\r\n  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î: string;\r\n  ‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏±‡∏î: string;\r\n  ‡∏¢‡∏≠‡∏î‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠: string;\r\n  ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î?: string; // Optional field for L table\r\n  date_consult_scheduled?: string; // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î consult (Supabase)\r\n  contact_person?: string; // ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ (Supabase)\r\n  date_surgery_scheduled?: string; // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î (Supabase)\r\n  surgery_date?: string; // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î (Supabase)\r\n}\r\n// Configure your Google Sheets API key and Sheet ID\r\nconst GOOGLE_SHEETS_API_KEY =\r\n  process.env.NEXT_PUBLIC_GOOGLE_SHEETS_API_KEY || \"\";\r\nconst SPREADSHEET_ID = process.env.NEXT_PUBLIC_SPREADSHEET_ID || \"\";\r\nconst SHEET_NAME = \"Film data\";\r\n// Mapping between row IDs and contact person names\r\nexport const CONTACT_PERSON_MAPPING: { [key: string]: string } = {\r\n  \"101-‡∏™‡∏≤\": \"‡∏™‡∏≤\",\r\n  \"102-‡∏û‡∏¥‡∏ä‡∏ä‡∏≤\": \"‡∏û‡∏¥‡∏ä‡∏ä‡∏≤\",\r\n  \"103-‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã\": \"‡∏ï‡∏±‡πâ‡∏á‡πÇ‡∏≠‡πã\",\r\n  \"104-Test\": \"Test\",\r\n  \"105-‡∏à‡∏µ‡∏ô\": \"‡∏à‡∏µ‡∏ô\",\r\n  \"106-‡∏°‡∏∏‡∏Å\": \"‡∏°‡∏∏‡∏Å\",\r\n  \"107-‡πÄ‡∏à\": \"‡πÄ‡∏à\",\r\n  \"108-‡∏ß‡πà‡∏≤‡∏ô\": \"‡∏ß‡πà‡∏≤‡∏ô\",\r\n  \"109-‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\": \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\", // For empty contact person\r\n  \"110-‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\": \"‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á\",\r\n};\r\n// Fetch data from Google Sheets via API Route (using Service Account)\r\nexport async function fetchSurgeryScheduleData(): Promise<\r\n  SurgeryScheduleData[]\r\n> {\r\n  try {\r\n    // Add timestamp to prevent caching\r\n    const timestamp = new Date().getTime();\r\n    const response = await fetch(`/api/surgery-schedule?t=${timestamp}`, {\r\n      cache: \"no-store\", // Disable cache\r\n      headers: {\r\n        \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\r\n        Pragma: \"no-cache\",\r\n      },\r\n    });\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => null);\r\n      if (errorData?.error) {\r\n        throw new Error(errorData.error);\r\n      }\r\n      throw new Error(\r\n        `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${response.statusText}\\n\\n` +\r\n          \"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\\n\" +\r\n          \"1. ‡πÑ‡∏ü‡∏•‡πå .env.local ‡∏°‡∏µ Service Account credentials ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô\\n\" +\r\n          \"2. Service Account ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á Google Sheet\\n\" +\r\n          \"3. Sheet name ‡πÄ‡∏õ‡πá‡∏ô 'Film data'\"\r\n      );\r\n    }\r\n    const result = await response.json();\r\n    return result.data || [];\r\n  } catch (error: any) {\r\n    throw error;\r\n  }\r\n}\r\n// Parse date string from Google Sheets (supports various formats)\r\nexport function parseSheetDate(dateStr: string): Date | null {\r\n  if (!dateStr || dateStr.trim() === \"\") return null;\r\n  // Clean up the string\r\n  const cleanStr = dateStr.trim();\r\n  try {\r\n    // Try ISO format first (YYYY-MM-DD)\r\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(cleanStr)) {\r\n      const date = new Date(cleanStr);\r\n      if (!isNaN(date.getTime())) {\r\n        return date;\r\n      }\r\n    }\r\n    // Try D/M/YYYY or DD/MM/YYYY format (Thai format - assume DD/MM/YYYY)\r\n    if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"/\").map(Number);\r\n      const [first, second, year] = parts;\r\n      // Assume DD/MM/YYYY format (Thai standard)\r\n      // first = day, second = month\r\n      const day = first;\r\n      const month = second;\r\n      // Validate the date\r\n      if (month >= 1 && month <= 12 && day >= 1 && day <= 31) {\r\n        // Use UTC to avoid timezone issues that can shift the date by +1 day\r\n        const date = new Date(Date.UTC(year, month - 1, day, 0, 0, 0, 0));\r\n        // Double check that the date is valid (e.g., not Feb 31)\r\n        if (\r\n          date.getUTCFullYear() === year &&\r\n          date.getUTCMonth() === month - 1 &&\r\n          date.getUTCDate() === day\r\n        ) {\r\n          return date;\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n    // Try parsing with built-in Date parser as fallback\r\n    const date = new Date(cleanStr);\r\n    if (!isNaN(date.getTime())) {\r\n      return date;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n// Count surgeries by date and contact person (for P table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)\r\nexport function countSurgeriesByDateAndPerson(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, SurgeryScheduleData[]>> {\r\n  const countMap = new Map<string, Map<number, SurgeryScheduleData[]>>();\r\n  // Initialize map for each contact person\r\n  Object.values(CONTACT_PERSON_MAPPING).forEach((person) => {\r\n    countMap.set(person, new Map<number, SurgeryScheduleData[]>());\r\n  });\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  data.forEach((item) => {\r\n    if (item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î) {\r\n      processedCount++;\r\n      const date = parseSheetDate(item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î);\r\n      if (date) {\r\n        if (date.getUTCMonth() === month && date.getUTCFullYear() === year) {\r\n          matchedCount++;\r\n          const day = date.getUTCDate();\r\n          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\"\r\n          const person =\r\n            item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ && item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠.trim() !== \"\"\r\n              ? item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠.trim()\r\n              : \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n          if (countMap.has(person)) {\r\n            const personMap = countMap.get(person)!;\r\n            if (!personMap.has(day)) {\r\n              personMap.set(day, []);\r\n            }\r\n            personMap.get(day)!.push(item);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n  return countMap;\r\n}\r\n// Count surgeries by actual surgery date (for L table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)\r\nexport function countSurgeriesByActualDateAndPerson(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, SurgeryScheduleData[]>> {\r\n  const countMap = new Map<string, Map<number, SurgeryScheduleData[]>>();\r\n  // Initialize map for each contact person\r\n  Object.values(CONTACT_PERSON_MAPPING).forEach((person) => {\r\n    countMap.set(person, new Map<number, SurgeryScheduleData[]>());\r\n  });\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  data.forEach((item) => {\r\n    if (item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î) {\r\n      processedCount++;\r\n      const date = parseSheetDate(item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î);\r\n      if (date) {\r\n        if (date.getUTCMonth() === month && date.getUTCFullYear() === year) {\r\n          matchedCount++;\r\n          const day = date.getUTCDate();\r\n          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤ ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\"\r\n          const person =\r\n            item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ && item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠.trim() !== \"\"\r\n              ? item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠.trim()\r\n              : \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n          if (countMap.has(person)) {\r\n            const personMap = countMap.get(person)!;\r\n            if (!personMap.has(day)) {\r\n              personMap.set(day, []);\r\n            }\r\n            personMap.get(day)!.push(item);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n  return countMap;\r\n}\r\n// Get row ID from contact person name\r\nexport function getRowIdFromContactPerson(contactPerson: string): string {\r\n  for (const [rowId, person] of Object.entries(CONTACT_PERSON_MAPPING)) {\r\n    if (person === contactPerson) {\r\n      return rowId;\r\n    }\r\n  }\r\n  return contactPerson;\r\n}\r\n","// Database API Integration for Surgery Schedule Data\r\nimport { SurgeryScheduleData, CONTACT_PERSON_MAPPING } from \"./googleSheets\";\r\n/**\r\n * Fetch surgery schedule data from Database (via Next.js API route)\r\n * ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà Python API ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å Google Sheets\r\n */\r\nexport async function fetchSurgeryScheduleFromDatabase(): Promise<\r\n  SurgeryScheduleData[]\r\n> {\r\n  try {\r\n    // Check if running on client side\r\n    if (typeof window === \"undefined\") {\r\n      console.error(\"fetchSurgeryScheduleFromDatabase called on server side\");\r\n      return [];\r\n    }\r\n    // Add timestamp to prevent caching\r\n    const timestamp = new Date().getTime();\r\n    const response = await fetch(`/api/surgery-schedule-db?t=${timestamp}`, {\r\n      cache: \"no-store\", // Disable cache\r\n      headers: {\r\n        \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\r\n        Pragma: \"no-cache\",\r\n      },\r\n    });\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => null);\r\n      if (errorData?.error) {\r\n        throw new Error(errorData.error);\r\n      }\r\n      throw new Error(\r\n        `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${response.statusText}\\n\\n` +\r\n          \"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\\n\" +\r\n          \"1. Database connection ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥\\n\" +\r\n          \"2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á surgery_schedule ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\\n\" +\r\n          \"3. Environment variables (DB_HOST, DB_PORT, DB_USER, DB_PASSWORD, DB_NAME) ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"\r\n      );\r\n    }\r\n    const result = await response.json();\r\n    if (!result.success) {\r\n      throw new Error(\r\n        result.error || \"Database API returned unsuccessful response\"\r\n      );\r\n    }\r\n    console.log(\r\n      `‚úÖ Successfully fetched ${result.total || 0} records from Database`\r\n    );\r\n    return result.data || [];\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching from Database:\", error);\r\n    throw error;\r\n  }\r\n}\r\n// Parse date string from Database API (supports various formats)\r\nexport function parseDatabaseDate(dateStr: string): Date | null {\r\n  if (!dateStr || dateStr.trim() === \"\") return null;\r\n  // Clean up the string\r\n  const cleanStr = dateStr.trim();\r\n  try {\r\n    // Try ISO format first (YYYY-MM-DD)\r\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"-\").map(Number);\r\n      const [year, month, day] = parts;\r\n      // Create date at noon local time to avoid timezone issues\r\n      const date = new Date(year, month - 1, day, 12, 0, 0, 0);\r\n      if (!isNaN(date.getTime())) {\r\n        return date;\r\n      }\r\n    }\r\n    // Try D/M/YYYY or DD/MM/YYYY format (Thai format - assume DD/MM/YYYY)\r\n    if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"/\").map(Number);\r\n      const [first, second, year] = parts;\r\n      // Assume DD/MM/YYYY format (Thai standard)\r\n      const day = first;\r\n      const month = second;\r\n      // Validate the date\r\n      if (month >= 1 && month <= 12 && day >= 1 && day <= 31) {\r\n        // Create date at noon local time to avoid timezone issues\r\n        const date = new Date(year, month - 1, day, 12, 0, 0, 0);\r\n        // Double check that the date is valid\r\n        if (\r\n          date.getFullYear() === year &&\r\n          date.getMonth() === month - 1 &&\r\n          date.getDate() === day\r\n        ) {\r\n          return date;\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n    // Try parsing with built-in Date parser as fallback\r\n    const date = new Date(cleanStr);\r\n    if (!isNaN(date.getTime())) {\r\n      return date;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"Error parsing date:\", dateStr, error);\r\n    return null;\r\n  }\r\n}\r\n// Count surgeries by date and contact person (for P table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)\r\nexport function countDatabaseSurgeriesByDateAndPerson(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, SurgeryScheduleData[]>> {\r\n  const countMap = new Map<string, Map<number, SurgeryScheduleData[]>>();\r\n  // Initialize map for each contact person\r\n  Object.values(CONTACT_PERSON_MAPPING).forEach((person) => {\r\n    countMap.set(person, new Map<number, SurgeryScheduleData[]>());\r\n  });\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  data.forEach((item) => {\r\n    // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå P \"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á P\r\n    const surgeryScheduledDate =\r\n      item.date_surgery_scheduled || item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"\";\r\n    if (surgeryScheduledDate) {\r\n      processedCount++;\r\n      const date = parseDatabaseDate(surgeryScheduledDate);\r\n      if (date) {\r\n        if (date.getMonth() === month && date.getFullYear() === year) {\r\n          matchedCount++;\r\n          const day = date.getDate();\r\n          // ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå E \"‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠\" ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n          const person =\r\n            (item.contact_person || item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ || \"\").trim() || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n          if (countMap.has(person)) {\r\n            const personMap = countMap.get(person)!;\r\n            if (!personMap.has(day)) {\r\n              personMap.set(day, []);\r\n            }\r\n            personMap.get(day)!.push(item);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n  console.log(\r\n    `üìä Count P table (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î): Processed ${processedCount} records, matched ${matchedCount} for ${year}-${\r\n      month + 1\r\n    }`\r\n  );\r\n  return countMap;\r\n}\r\n// Count surgeries by actual surgery date (for L table - ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)\r\nexport function countDatabaseSurgeriesByActualDateAndPerson(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, SurgeryScheduleData[]>> {\r\n  const countMap = new Map<string, Map<number, SurgeryScheduleData[]>>();\r\n  // Initialize map for each contact person\r\n  Object.values(CONTACT_PERSON_MAPPING).forEach((person) => {\r\n    countMap.set(person, new Map<number, SurgeryScheduleData[]>());\r\n  });\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  data.forEach((item) => {\r\n    // ‡πÉ‡∏ä‡πâ surgery_date ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á L (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á)\r\n    const surgeryDate = item.surgery_date || item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"\";\r\n    if (surgeryDate) {\r\n      processedCount++;\r\n      const date = parseDatabaseDate(surgeryDate);\r\n      if (date) {\r\n        if (date.getMonth() === month && date.getFullYear() === year) {\r\n          matchedCount++;\r\n          const day = date.getDate();\r\n          // ‡πÉ‡∏ä‡πâ contact_person ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n          const person =\r\n            (item.contact_person || item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ || \"\").trim() || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n          if (countMap.has(person)) {\r\n            const personMap = countMap.get(person)!;\r\n            if (!personMap.has(day)) {\r\n              personMap.set(day, []);\r\n            }\r\n            personMap.get(day)!.push(item);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n  console.log(\r\n    `üìä Count L table: Processed ${processedCount} records, matched ${matchedCount} for ${year}-${\r\n      month + 1\r\n    }`\r\n  );\r\n  return countMap;\r\n}\r\n// Get statistics from Database data\r\nexport function getDatabaseStatistics(data: SurgeryScheduleData[]) {\r\n  const totalCount = data.length;\r\n  // Count records with surgery scheduled date\r\n  const surgeryCount = data.filter(\r\n    (item) =>\r\n      (item.date_surgery_scheduled || item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"\").trim() !==\r\n      \"\"\r\n  ).length;\r\n  // Count records with consult scheduled date\r\n  const consultCount = data.filter(\r\n    (item) =>\r\n      (item.date_consult_scheduled || item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏ô‡∏±‡∏î‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"\").trim() !==\r\n      \"\"\r\n  ).length;\r\n  // Count records with actual surgery date\r\n  const actualSurgeryCount = data.filter(\r\n    (item) => (item.surgery_date || item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"\").trim() !== \"\"\r\n  ).length;\r\n  return {\r\n    totalCount,\r\n    surgeryCount,\r\n    consultCount,\r\n    actualSurgeryCount,\r\n  };\r\n}\r\n// Parse amount from string (supports Thai number format)\r\nexport function parseAmount(amountStr: string): number {\r\n  if (!amountStr || amountStr.trim() === \"\") return 0;\r\n  // Remove all non-numeric characters except decimal point\r\n  const cleanStr = amountStr.replace(/[^\\d.]/g, \"\").trim();\r\n  const amount = parseFloat(cleanStr);\r\n  return isNaN(amount) ? 0 : amount;\r\n}\r\n// Calculate total revenue by date and contact person (for Revenue table)\r\n// ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å bjh_all_leads ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á (surgery_date ‡πÅ‡∏•‡∏∞ proposed_amount)\r\nexport function calculateDatabaseRevenueByDateAndPerson(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, number>> {\r\n  const revenueMap = new Map<string, Map<number, number>>();\r\n  // Initialize map for each contact person\r\n  Object.values(CONTACT_PERSON_MAPPING).forEach((person) => {\r\n    revenueMap.set(person, new Map<number, number>());\r\n  });\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  let totalRevenue = 0;\r\n  data.forEach((item) => {\r\n    // ‡πÉ‡∏ä‡πâ surgery_date (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö\r\n    const surgeryDate = item.surgery_date || item.‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î || \"\";\r\n    if (surgeryDate) {\r\n      processedCount++;\r\n      const date = parseDatabaseDate(surgeryDate);\r\n      if (date) {\r\n        if (date.getMonth() === month && date.getFullYear() === year) {\r\n          matchedCount++;\r\n          const day = date.getDate();\r\n          // ‡πÉ‡∏ä‡πâ contact_staff ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\r\n          const person =\r\n            (item.contact_person || item.‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ || \"\").trim() || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n          // ‡πÉ‡∏ä‡πâ proposed_amount ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏ï‡∏±‡∏î‡∏ó‡∏®‡∏ô‡∏¥‡∏¢‡∏°‡∏≠‡∏≠‡∏Å)\r\n          const amountStr = item.‡∏¢‡∏≠‡∏î‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠ || \"0\";\r\n          const amount = Math.floor(parseAmount(amountStr));\r\n          if (amount > 0 && revenueMap.has(person)) {\r\n            const personMap = revenueMap.get(person)!;\r\n            const currentAmount = personMap.get(day) || 0;\r\n            personMap.set(day, currentAmount + amount);\r\n            totalRevenue += amount;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n  console.log(\r\n    `üí∞ Calculate Revenue from bjh_all_leads (surgery_date): Processed ${processedCount} records, matched ${matchedCount} for ${year}-${\r\n      month + 1\r\n    }, total revenue: ${totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó`\r\n  );\r\n  return revenueMap;\r\n}\r\n","/**\r\n * Utility functions for Surgery Actual Data (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á - ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 2: L)\r\n * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å PostgreSQL Database ‡∏ú‡πà‡∏≤‡∏ô /api/surgery-actual-db\r\n */\r\nimport { SurgeryScheduleData } from \"./googleSheets\";\r\n/**\r\n * Fetch surgery actual data from database API\r\n */\r\nexport async function fetchSurgeryActualFromDatabase(): Promise<\r\n  SurgeryScheduleData[]\r\n> {\r\n  try {\r\n    const response = await fetch(\"/api/surgery-actual-db\", {\r\n      method: \"GET\",\r\n      headers: {\r\n        \"Content-Type\": \"application/json\",\r\n      },\r\n      cache: \"no-store\",\r\n    });\r\n    if (!response.ok) {\r\n      throw new Error(\r\n        `Failed to fetch surgery actual data: ${response.statusText}`\r\n      );\r\n    }\r\n    const result = await response.json();\r\n    if (!result.success) {\r\n      throw new Error(result.error || \"Failed to fetch surgery actual data\");\r\n    }\r\n    return result.data as SurgeryScheduleData[];\r\n  } catch (error: any) {\r\n    throw new Error(\r\n      error.message || \"Failed to fetch surgery actual data from database\"\r\n    );\r\n  }\r\n}\r\n/**\r\n * Parse date from database (supports YYYY-MM-DD format)\r\n */\r\nexport function parseDatabaseActualDate(dateStr: string | null): Date | null {\r\n  if (!dateStr) return null;\r\n  try {\r\n    // YYYY-MM-DD format from database\r\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(dateStr)) {\r\n      const [year, month, day] = dateStr.split(\"-\").map(Number);\r\n      return new Date(year, month - 1, day);\r\n    }\r\n    // DD/MM/YYYY format\r\n    if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}$/.test(dateStr)) {\r\n      const [day, month, year] = dateStr.split(\"/\").map(Number);\r\n      return new Date(year, month - 1, day);\r\n    }\r\n    // Try ISO format\r\n    const date = new Date(dateStr);\r\n    if (!isNaN(date.getTime())) {\r\n      return date;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n/**\r\n * Count surgeries by actual surgery date (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á) and contact person\r\n * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 2: ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î L\r\n */\r\nexport function countDatabaseActualSurgeriesByDate(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, SurgeryScheduleData[]>> {\r\n  const countMap = new Map<string, Map<number, SurgeryScheduleData[]>>();\r\n  data.forEach((row) => {\r\n    const contactPerson = row.contact_person || row[\"‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠\"] || \"\";\r\n    const surgeryDateStr = row.surgery_date || row[\"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\"];\r\n    if (!contactPerson || !surgeryDateStr) return;\r\n    const surgeryDate = parseDatabaseActualDate(surgeryDateStr);\r\n    if (!surgeryDate) return;\r\n    // Check if date matches selected month/year\r\n    if (\r\n      surgeryDate.getMonth() === month &&\r\n      surgeryDate.getFullYear() === year\r\n    ) {\r\n      const day = surgeryDate.getDate();\r\n      if (!countMap.has(contactPerson)) {\r\n        countMap.set(contactPerson, new Map());\r\n      }\r\n      const personMap = countMap.get(contactPerson)!;\r\n      if (!personMap.has(day)) {\r\n        personMap.set(day, []);\r\n      }\r\n      personMap.get(day)!.push(row);\r\n    }\r\n  });\r\n  return countMap;\r\n}\r\n/**\r\n * Calculate revenue by actual surgery date and contact person\r\n * ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà 2: ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏à‡∏£‡∏¥‡∏á\r\n */\r\nexport function calculateDatabaseActualRevenue(\r\n  data: SurgeryScheduleData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, number>> {\r\n  const revenueMap = new Map<string, Map<number, number>>();\r\n  data.forEach((row) => {\r\n    const contactPerson = row.contact_person || row[\"‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠\"] || \"\";\r\n    const surgeryDateStr = row.surgery_date || row[\"‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î\"];\r\n    const proposedAmountStr = row[\"‡∏¢‡∏≠‡∏î‡∏ô‡∏≥‡πÄ‡∏™‡∏ô‡∏≠\"] || \"\";\r\n    const proposedAmount = proposedAmountStr\r\n      ? parseFloat(proposedAmountStr.replace(/,/g, \"\"))\r\n      : 0;\r\n    if (!contactPerson || !surgeryDateStr) return;\r\n    const surgeryDate = parseDatabaseActualDate(surgeryDateStr);\r\n    if (!surgeryDate) return;\r\n    // Check if date matches selected month/year\r\n    if (\r\n      surgeryDate.getMonth() === month &&\r\n      surgeryDate.getFullYear() === year\r\n    ) {\r\n      const day = surgeryDate.getDate();\r\n      if (!revenueMap.has(contactPerson)) {\r\n        revenueMap.set(contactPerson, new Map());\r\n      }\r\n      const personMap = revenueMap.get(contactPerson)!;\r\n      const currentRevenue = personMap.get(day) || 0;\r\n      personMap.set(day, currentRevenue + Number(proposedAmount));\r\n    }\r\n  });\r\n  return revenueMap;\r\n}\r\n","// Database API Integration for Future Revenue Data (surgery_date >= today)\r\nimport { SurgeryScheduleData } from \"./googleSheets\";\r\nexport interface RevenueFutureData {\r\n  contact_staff?: string;\r\n  surgery_date?: string;\r\n  doctor?: string;\r\n  customer_name?: string;\r\n  phone?: string;\r\n  proposed_amount?: number;\r\n  appointment_time?: string;\r\n}\r\n/**\r\n * Fetch future revenue data from bjh_all_leads (surgery_date >= ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)\r\n */\r\nexport async function fetchRevenueFutureFromDatabase(): Promise<\r\n  RevenueFutureData[]\r\n> {\r\n  try {\r\n    // Check if running on client side\r\n    if (typeof window === \"undefined\") {\r\n      console.error(\"fetchRevenueFutureFromDatabase called on server side\");\r\n      return [];\r\n    }\r\n    // Add timestamp to prevent caching\r\n    const timestamp = new Date().getTime();\r\n    const response = await fetch(`/api/revenue-future-db?t=${timestamp}`, {\r\n      cache: \"no-store\",\r\n      headers: {\r\n        \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\r\n        Pragma: \"no-cache\",\r\n      },\r\n    });\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => null);\r\n      if (errorData?.error) {\r\n        throw new Error(errorData.error);\r\n      }\r\n      throw new Error(\r\n        `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${response.statusText}\\n\\n` +\r\n          \"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\\n\" +\r\n          \"1. Database connection ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥\\n\" +\r\n          \"2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á bjh_all_leads ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\\n\" +\r\n          \"3. Environment variables ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"\r\n      );\r\n    }\r\n    const result = await response.json();\r\n    if (!result.success) {\r\n      throw new Error(\r\n        result.error || \"Database API returned unsuccessful response\"\r\n      );\r\n    }\r\n    console.log(\r\n      `‚úÖ Successfully fetched ${\r\n        result.total || 0\r\n      } future revenue records from Database`\r\n    );\r\n    return result.data || [];\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching future revenue from Database:\", error);\r\n    throw error;\r\n  }\r\n}\r\n// Parse date string from Database API\r\nexport function parseDatabaseDate(dateStr: string): Date | null {\r\n  if (!dateStr || dateStr.trim() === \"\") return null;\r\n  const cleanStr = dateStr.trim();\r\n  try {\r\n    // Try ISO format first (YYYY-MM-DD)\r\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"-\").map(Number);\r\n      const [year, month, day] = parts;\r\n      // Create date at noon local time to avoid timezone issues\r\n      const date = new Date(year, month - 1, day, 12, 0, 0, 0);\r\n      if (!isNaN(date.getTime())) {\r\n        return date;\r\n      }\r\n    }\r\n    // Try D/M/YYYY or DD/MM/YYYY format\r\n    if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"/\").map(Number);\r\n      const [first, second, year] = parts;\r\n      const day = first;\r\n      const month = second;\r\n      if (month >= 1 && month <= 12 && day >= 1 && day <= 31) {\r\n        // Create date at noon local time to avoid timezone issues\r\n        const date = new Date(year, month - 1, day, 12, 0, 0, 0);\r\n        if (\r\n          date.getFullYear() === year &&\r\n          date.getMonth() === month - 1 &&\r\n          date.getDate() === day\r\n        ) {\r\n          return date;\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n    const date = new Date(cleanStr);\r\n    if (!isNaN(date.getTime())) {\r\n      return date;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"Error parsing date:\", dateStr, error);\r\n    return null;\r\n  }\r\n}\r\n/**\r\n * Calculate daily revenue by person from bjh_all_leads (future surgeries)\r\n * ‡πÉ‡∏ä‡πâ proposed_amount ‡∏à‡∏≤‡∏Å surgery_date >= ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô‡πÑ‡∏õ\r\n */\r\nexport function calculateDailyRevenueByPersonFuture(\r\n  data: RevenueFutureData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, number>> {\r\n  const revenueMap = new Map<string, Map<number, number>>();\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  let totalRevenue = 0;\r\n  data.forEach((item) => {\r\n    // ‡πÉ‡∏ä‡πâ surgery_date (‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÑ‡∏ß‡πâ)\r\n    const dateStr = item.surgery_date || \"\";\r\n    if (dateStr) {\r\n      processedCount++;\r\n      const date = parseDatabaseDate(dateStr);\r\n      if (date) {\r\n        if (date.getMonth() === month && date.getFullYear() === year) {\r\n          matchedCount++;\r\n          const day = date.getDate();\r\n          // ‡πÉ‡∏ä‡πâ contact_staff\r\n          const person = (item.contact_staff || \"\").trim() || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n          // ‡πÉ‡∏ä‡πâ proposed_amount\r\n          const amount = item.proposed_amount || 0;\r\n          if (amount > 0) {\r\n            if (!revenueMap.has(person)) {\r\n              revenueMap.set(person, new Map<number, number>());\r\n            }\r\n            const personMap = revenueMap.get(person)!;\r\n            const currentAmount = personMap.get(day) || 0;\r\n            personMap.set(day, currentAmount + amount);\r\n            totalRevenue += amount;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  });\r\n  console.log(\r\n    `üí∞ Calculate Future Revenue (bjh_all_leads >= today): Processed ${processedCount} records, matched ${matchedCount} for ${year}-${\r\n      month + 1\r\n    }, total revenue: ${totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó`\r\n  );\r\n  return revenueMap;\r\n}\r\n","// Database API Integration for N_Clinic Revenue Data (sale_date <= today)\r\nimport { SurgeryScheduleData } from \"./googleSheets\";\r\nexport interface NClinicData {\r\n  income_date?: string; // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (was sale_date)\r\n  income?: number; // ‡πÄ‡∏á‡∏¥‡∏ô (was proposed_amount)\r\n  payment_type?: string; // ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (was payment)\r\n  income_display_name?: string; // ‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (was display_name)\r\n  staff_display_name?: string; // ‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (was contact_staff/nickname)\r\n}\r\n/**\r\n * Fetch n_clinic revenue data from n_income + n_customer + n_staff\r\n */\r\nexport async function fetchNClinicFromDatabase(): Promise<NClinicData[]> {\r\n  try {\r\n    // Check if running on client side\r\n    if (typeof window === \"undefined\") {\r\n      console.error(\"fetchNClinicFromDatabase called on server side\");\r\n      return [];\r\n    }\r\n    // Add timestamp to prevent caching\r\n    const timestamp = new Date().getTime();\r\n    const response = await fetch(`/api/n-clinic-db?t=${timestamp}`, {\r\n      cache: \"no-store\",\r\n      headers: {\r\n        \"Cache-Control\": \"no-cache, no-store, must-revalidate\",\r\n        Pragma: \"no-cache\",\r\n      },\r\n    });\r\n    if (!response.ok) {\r\n      const errorData = await response.json().catch(() => null);\r\n      if (errorData?.error) {\r\n        throw new Error(errorData.error);\r\n      }\r\n      throw new Error(\r\n        `‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${response.statusText}\\n\\n` +\r\n          \"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö:\\n\" +\r\n          \"1. Database connection ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥\\n\" +\r\n          \"2. ‡∏ï‡∏≤‡∏£‡∏≤‡∏á n_income, n_customer ‡πÅ‡∏•‡∏∞ n_staff ‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•\\n\" +\r\n          \"3. Environment variables ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á\"\r\n      );\r\n    }\r\n    const result = await response.json();\r\n    if (!result.success) {\r\n      throw new Error(\r\n        result.error || \"Database API returned unsuccessful response\"\r\n      );\r\n    }\r\n    console.log(\r\n      `‚úÖ Successfully fetched ${\r\n        result.total || 0\r\n      } n_clinic records from Database (n_income)`\r\n    );\r\n    // Transform data to ensure income is a number\r\n    const transformedData = (result.data || []).map((item: any) => ({\r\n      ...item,\r\n      income: item.income\r\n        ? parseFloat(item.income.toString().replace(/,/g, \"\"))\r\n        : 0,\r\n    }));\r\n    console.log(\"üîç Transformed n_clinic data sample:\", {\r\n      raw: result.data?.[0],\r\n      transformed: transformedData[0],\r\n    });\r\n    return transformedData;\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching n_clinic from Database:\", error);\r\n    throw error;\r\n  }\r\n}\r\n// Parse date string from Database API\r\nexport function parseDatabaseDate(dateStr: string): Date | null {\r\n  if (!dateStr || dateStr.trim() === \"\") return null;\r\n  const cleanStr = dateStr.trim();\r\n  try {\r\n    // Try ISO format first (YYYY-MM-DD)\r\n    if (/^\\d{4}-\\d{2}-\\d{2}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"-\").map(Number);\r\n      const [year, month, day] = parts;\r\n      // Create date at noon local time to avoid timezone issues\r\n      const date = new Date(year, month - 1, day, 12, 0, 0, 0);\r\n      if (!isNaN(date.getTime())) {\r\n        return date;\r\n      }\r\n    }\r\n    // Try D/M/YYYY or DD/MM/YYYY format\r\n    if (/^\\d{1,2}\\/\\d{1,2}\\/\\d{4}$/.test(cleanStr)) {\r\n      const parts = cleanStr.split(\"/\").map(Number);\r\n      const [first, second, year] = parts;\r\n      const day = first;\r\n      const month = second;\r\n      if (month >= 1 && month <= 12 && day >= 1 && day <= 31) {\r\n        // Create date at noon local time to avoid timezone issues\r\n        const date = new Date(year, month - 1, day, 12, 0, 0, 0);\r\n        if (\r\n          date.getFullYear() === year &&\r\n          date.getMonth() === month - 1 &&\r\n          date.getDate() === day\r\n        ) {\r\n          return date;\r\n        }\r\n      }\r\n      return null;\r\n    }\r\n    const date = new Date(cleanStr);\r\n    if (!isNaN(date.getTime())) {\r\n      return date;\r\n    }\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"Error parsing date:\", dateStr, error);\r\n    return null;\r\n  }\r\n}\r\n/**\r\n * Calculate daily revenue by person from n_clinic data\r\n * ‡πÉ‡∏ä‡πâ income ‡∏à‡∏≤‡∏Å n_income ‡πÅ‡∏•‡∏∞ staff_display_name ‡∏à‡∏≤‡∏Å n_staff\r\n */\r\nexport function calculateDailyRevenueByPersonNClinic(\r\n  data: NClinicData[],\r\n  month: number,\r\n  year: number\r\n): Map<string, Map<number, number>> {\r\n  const revenueMap = new Map<string, Map<number, number>>();\r\n  let processedCount = 0;\r\n  let matchedCount = 0;\r\n  let totalRevenue = 0;\r\n  let skippedNoDate = 0;\r\n  let skippedInvalidDate = 0;\r\n  let skippedWrongMonth = 0;\r\n  let skippedNoAmount = 0;\r\n  console.log(`üîç Starting n_clinic calculation for ${year}-${month + 1}:`, {\r\n    totalDataRecords: data.length,\r\n    targetMonth: month + 1,\r\n    targetYear: year,\r\n  });\r\n  data.forEach((item, index) => {\r\n    // ‡πÉ‡∏ä‡πâ income_date\r\n    const dateStr = item.income_date || \"\";\r\n    if (!dateStr) {\r\n      skippedNoDate++;\r\n      if (index < 3) {\r\n        console.log(`‚ö†Ô∏è Record ${index} has no income_date:`, item);\r\n      }\r\n      return;\r\n    }\r\n    processedCount++;\r\n    const date = parseDatabaseDate(dateStr);\r\n    if (!date) {\r\n      skippedInvalidDate++;\r\n      if (index < 3) {\r\n        console.log(`‚ö†Ô∏è Record ${index} has invalid date format:`, {\r\n          income_date: dateStr,\r\n          item,\r\n        });\r\n      }\r\n      return;\r\n    }\r\n    if (date.getMonth() === month && date.getFullYear() === year) {\r\n      matchedCount++;\r\n      const day = date.getDate();\r\n      // ‡πÉ‡∏ä‡πâ staff_display_name (nickname ‡∏à‡∏≤‡∏Å n_staff)\r\n      const person = (item.staff_display_name || \"\").trim() || \"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏\";\r\n      // ‡πÉ‡∏ä‡πâ income ‡∏à‡∏≤‡∏Å n_income\r\n      const amount =\r\n        typeof item.income === \"number\"\r\n          ? item.income\r\n          : item.income\r\n          ? parseFloat(String(item.income).replace(/,/g, \"\"))\r\n          : 0;\r\n      if (matchedCount <= 3) {\r\n        console.log(`üî¢ N_Clinic amount parsing for record ${index}:`, {\r\n          raw: item.income,\r\n          type: typeof item.income,\r\n          parsed: amount,\r\n          person,\r\n          day,\r\n          income_date: item.income_date,\r\n        });\r\n      }\r\n      if (amount > 0) {\r\n        if (!revenueMap.has(person)) {\r\n          revenueMap.set(person, new Map<number, number>());\r\n        }\r\n        const personMap = revenueMap.get(person)!;\r\n        const currentAmount = personMap.get(day) || 0;\r\n        personMap.set(day, currentAmount + amount);\r\n        totalRevenue += amount;\r\n        if (matchedCount <= 5) {\r\n          console.log(\r\n            `‚úÖ Added n_clinic revenue: ${person} on day ${day}: ${amount}`,\r\n            {\r\n              staff_display_name: item.staff_display_name,\r\n              income_date: item.income_date,\r\n              income: item.income,\r\n              parsedDate: date.toISOString(),\r\n            }\r\n          );\r\n        }\r\n      } else {\r\n        skippedNoAmount++;\r\n      }\r\n    } else {\r\n      skippedWrongMonth++;\r\n      if (skippedWrongMonth <= 3) {\r\n        console.log(`‚è≠Ô∏è Skipped (wrong month): ${dateStr}`, {\r\n          parsedMonth: date.getMonth() + 1,\r\n          parsedYear: date.getFullYear(),\r\n          targetMonth: month + 1,\r\n          targetYear: year,\r\n        });\r\n      }\r\n    }\r\n  });\r\n  console.log(\r\n    `üí∞ Calculate N_Clinic Revenue: Processed ${processedCount} records, matched ${matchedCount} for ${year}-${\r\n      month + 1\r\n    }, total revenue: ${totalRevenue.toLocaleString()} ‡∏ö‡∏≤‡∏ó`,\r\n    {\r\n      skippedNoDate,\r\n      skippedInvalidDate,\r\n      skippedWrongMonth,\r\n      skippedNoAmount,\r\n      finalMapSize: revenueMap.size,\r\n      persons: Array.from(revenueMap.keys()),\r\n    }\r\n  );\r\n  return revenueMap;\r\n}\r\n"],"names":[],"mappings":"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"}