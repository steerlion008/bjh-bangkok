module.exports=[801504,a=>{"use strict";var b=a.i(187924),c=a.i(572131);let d=[{vendorId:1423,productId:38208},{classCode:11}],e=[{usagePage:11}],f=a=>null!=a?`0x${a.toString(16).padStart(4,"0").toUpperCase()}`:"n/a",g=a=>({id:`${a.vendorId??0}-${a.productId??0}-${a.serialNumber??"0"}`,label:a.productName??"เครื่องอ่าน USB",kind:"USB",info:`VID ${f(a.vendorId)} \xb7 PID ${f(a.productId)}${a.manufacturerName?` \xb7 ${a.manufacturerName}`:""}`}),h=a=>{let b=a.collections?.[0]?.usagePage;return{id:`${a.vendorId??0}-${a.productId??0}-${b??0}-${a.productName??"HID"}`,label:a.productName??"HID เครื่องอ่าน",kind:"HID",info:`VID ${f(a.vendorId)} \xb7 PID ${f(a.productId)}${b?` \xb7 usage ${b}`:""}`}},i=a=>Array.from(a).map(a=>a.toString(16).padStart(2,"0")).join(" "),j=a=>{if("ok"!==a.status||!a.data)throw Error(`การอ่านข้อมูลล้มเหลว (status: ${a.status})`);let b=a.data,c=b.getUint32(3,!0),d=b.byteOffset+10,e=Math.max(0,b.byteLength-10),f=new Uint8Array(b.buffer,d,Math.min(c,e));return{messageType:b.getUint8(0),slot:b.getUint8(1),sequence:b.getUint8(2),payload:f}};function k(){let[a,f]=(0,c.useState)([]),[k,l]=(0,c.useState)("รอการตรวจสอบอุปกรณ์"),[m,n]=(0,c.useState)([]),[o,p]=(0,c.useState)({usb:!1,hid:!1}),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),[u,v]=(0,c.useState)(null),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(null),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)("00A4040007A000000054480001"),[I,J]=(0,c.useState)({idNumber:"",fullName:"",fullNameEn:"",sex:"",birthDate:"",age:"",issueDate:"",expiryDate:"",address:"",cardStatus:"",statusCode:"",readerName:""}),K=(0,c.useRef)(0),L=(0,c.useCallback)(a=>{n(b=>[a,...b].slice(0,6))},[]),M=(0,c.useCallback)(a=>{F(b=>[a,...b].slice(0,6)),L(a)},[L]),N=(0,c.useCallback)(async()=>{if("undefined"==typeof navigator)return;let a=navigator.usb,b=navigator.hid,c=[];if(a)try{let b=await a.getDevices();c.push(...b.map(g))}catch(a){L(`ไม่สามารถอ่านอุปกรณ์ USB: ${a instanceof Error?a.message:"ไม่รู้จัก"}`)}if(b)try{let a=await b.getDevices();c.push(...a.map(h))}catch(a){L(`ไม่สามารถอ่านอุปกรณ์ HID: ${a instanceof Error?a.message:"ไม่รู้จัก"}`)}f(c);let d=new Date().toLocaleTimeString("th-TH",{hour:"2-digit",minute:"2-digit",second:"2-digit"});l(c.length?`พบ ${c.length} อุปกรณ์ \xb7 อัปเดตล่าสุด ${d}`:"ยังไม่พบเครื่องอ่านบัตรที่เชื่อมต่อ")},[L]),O=(0,c.useCallback)(async()=>{if(s){try{null!==u&&await s.releaseInterface(u)}catch{}try{await s.close()}catch{}t(null),v(null),x(null),z(null),K.current=0,D(null)}},[u,s]);(0,c.useEffect)(()=>()=>{O()},[O]);let P=(0,c.useCallback)(async a=>{if(await O(),a.opened||await a.open(),!a.configuration){let b=a.configurations?.[0]?.configurationValue??1;await a.selectConfiguration(b)}let b=a.configuration;if(!b)throw Error("ไม่พบ configuration ของเครื่องอ่าน");let c=b.interfaces.find(a=>a.alternates.some(a=>11===a.interfaceClass)),d=c?.alternates.find(a=>11===a.interfaceClass),e=d?.endpoints?.find(a=>"out"===a.direction&&"bulk"===a.type),f=d?.endpoints?.find(a=>"in"===a.direction&&"bulk"===a.type);if(!c||!e||!f)throw console.error("CCID interfaces:",b.interfaces),Error("ไม่พบ interface/endpoint ที่รองรับ CCID");await a.claimInterface(c.interfaceNumber),t(a),v(c.interfaceNumber),x(e.endpointNumber),z(f.endpointNumber),l("อุปกรณ์พร้อมอ่านบัตร"),K.current=0,D(null),F([]),L(`เตรียมอุปกรณ์เรียบร้อย (iface=${c.interfaceNumber}, OUT=${e.endpointNumber}, IN=${f.endpointNumber})`)},[O,L]);(0,c.useEffect)(()=>{if("undefined"==typeof navigator)return;let a=navigator;p({usb:!!a.usb,hid:!!a.hid}),N();let b=()=>N();return a.usb?.addEventListener("connect",b),a.usb?.addEventListener("disconnect",b),a.hid?.addEventListener("connect",b),a.hid?.addEventListener("disconnect",b),()=>{a.usb?.removeEventListener("connect",b),a.usb?.removeEventListener("disconnect",b),a.hid?.removeEventListener("connect",b),a.hid?.removeEventListener("disconnect",b)}},[N]),(0,c.useEffect)(()=>{"undefined"==typeof navigator||r(/Mobi|Android|iPhone|iPad|Tablet/i.test(navigator.userAgent))},[]);let Q=(0,c.useCallback)(async()=>{if(!s||null===w||null===y)return void M("ยังไม่มีเครื่องอ่าน USB ที่พร้อมอ่านบัตร");B(!0);try{let a,b=K.current,c=((a=new Uint8Array(10))[0]=98,a[6]=255&b,a);K.current=b+1&255;let d=await s.transferOut(w,c);if("ok"!==d.status)throw Error(`ส่งคำสั่ง Power On ล้มเหลว (status=${d.status})`);let e=await s.transferIn(y,512),f=j(e);if(128!==f.messageType)throw Error(`ไม่พบ ATR (messageType=${f.messageType})`);let g=i(f.payload);D(g),M(`ATR: ${g}`)}catch(a){M(`อ่าน ATR ไม่สำเร็จ: ${a instanceof Error?a.message:"ไม่รู้จัก"}`)}finally{B(!1)}},[y,M,w,s]),R=(0,c.useCallback)(async()=>{if(!s||null===w||null===y)return void M("เลือกเครื่องอ่านแล้ว Power On ก่อนส่งคำสั่ง APDU");B(!0);try{let a,b,c=(a=>{let b=a.replace(/[^0-9a-f]/gi,"");if(!b)return new Uint8Array;if(b.length%2)throw Error("ค่าที่ได้รับต้องมีจำนวนคู่ของตัวอักษร HEX");let c=new Uint8Array(b.length/2);for(let a=0;a<b.length;a+=2)c[a/2]=parseInt(b.slice(a,a+2),16);return c})(G),d=K.current,e=((a=new Uint8Array(10+c.length))[0]=111,b=2,a[b++]=255&c.length,a[b++]=c.length>>8&255,a[b++]=c.length>>16&255,a[b++]=c.length>>24&255,a[6]=255&d,a[7]=0,a[8]=0,a[9]=0,a.set(c,10),a);K.current=d+1&255;let f=await s.transferOut(w,e);if("ok"!==f.status)throw Error(`ส่งคำสั่ง APDU ล้มเหลว (status=${f.status})`);let g=await s.transferIn(y,512),h=j(g),k=i(h.payload);M(`APDU → ${k}`)}catch(a){M(`APDU ผิดพลาด: ${a instanceof Error?a.message:"ไม่รู้จัก"}`)}finally{B(!1)}},[G,y,M,w,s]),S=(0,c.useCallback)(async()=>{if("undefined"==typeof navigator||!o.usb){let a="เบราว์เซอร์นี้ไม่รองรับ WebUSB";l(a),L(a);return}B(!0);try{let a=navigator.usb;if(!a){let a="WebUSB ยังไม่พร้อมใช้งาน";l(a),L(a);return}let b=await a.requestDevice({filters:d});L(`เลือก USB: ${b.productName??"ไม่ระบุชื่อ"}`),l("อุปกรณ์พร้อมอ่านบัตร"),await N(),await P(b)}catch(b){let a=b instanceof Error?b.message:"ยกเลิกการเลือกอุปกรณ์";L(`WebUSB: ${a}`),l(a.includes("cancel")?"การสแกนถูกยกเลิก":"ไม่พบอุปกรณ์")}finally{B(!1)}},[L,P,o.usb,N]),T=(0,c.useCallback)(async()=>{if("undefined"==typeof navigator||!o.hid){let a="เบราว์เซอร์นี้ไม่รองรับ WebHID";l(a),L(a);return}try{let a=await navigator.hid?.requestDevice({filters:e});a&&a.length&&(L(`เลือก HID: ${a[0].productName??"ไม่ระบุชื่อ"}`),l("อุปกรณ์ HID พร้อมใช้งาน")),await N()}catch(b){let a=b instanceof Error?b.message:"ยกเลิกการเลือกอุปกรณ์";L(`WebHID: ${a}`),l(a.includes("cancel")?"การสแกนถูกยกเลิก":"ไม่พบอุปกรณ์")}},[L,o.hid,N]),U=!s||null===w||null===y||A||!o.usb;return(0,b.jsx)("main",{className:"container py-5",children:(0,b.jsx)("div",{className:"row justify-content-center",children:(0,b.jsx)("div",{className:"col-12 col-xl-10",children:(0,b.jsxs)("div",{className:"rounded-4 border bg-white shadow-sm p-4 p-lg-5",children:[(0,b.jsxs)("div",{className:"text-center mb-5",children:[(0,b.jsx)("p",{className:"text-uppercase fw-semibold text-secondary mb-1",children:"Test"}),(0,b.jsx)("h1",{className:"h2 fw-bold",children:"ทดสอบเครื่องอ่านบัตรประชาชน"}),(0,b.jsx)("p",{className:"text-muted mb-0",children:"หน้าเดียวกันนี้ตรวจสอบ WebUSB/WebHID และส่งคำสั่ง CCID เพื่อให้สามารถต่อยอดการอ่านบัตรได้ทั้งบน PC และอุปกรณ์มือถือ"})]}),(0,b.jsxs)("div",{className:"row g-4",children:[(0,b.jsx)("div",{className:"col-lg-5",children:(0,b.jsx)("div",{className:"card border-0 shadow-sm h-100",children:(0,b.jsxs)("div",{className:"card-body",children:[(0,b.jsx)("h2",{className:"h5",children:"สถานะการเชื่อมต่อ"}),(0,b.jsx)("p",{className:"fs-5 fw-semibold text-primary mb-2",children:k}),(0,b.jsxs)("div",{className:"mb-3",children:[(0,b.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,b.jsx)("span",{className:"fw-semibold",children:"WebUSB (PC)"}),(0,b.jsx)("span",{className:o.usb?"text-success":"text-secondary",children:o.usb?"รองรับ":"ไม่รองรับ"})]}),(0,b.jsxs)("div",{className:"d-flex justify-content-between",children:[(0,b.jsx)("span",{className:"fw-semibold",children:"WebHID (มือถือ/บางเบราว์เซอร์)"}),(0,b.jsx)("span",{className:o.hid?"text-success":"text-secondary",children:o.hid?"รองรับ":"ไม่รองรับ"})]})]}),(0,b.jsxs)("div",{className:"d-grid gap-2 mb-3",children:[(0,b.jsx)("button",{type:"button",className:"btn btn-primary",onClick:S,disabled:!o.usb||A,children:"สแกนเครื่องอ่าน USB (PC)"}),(0,b.jsx)("button",{type:"button",className:"btn btn-outline-primary",onClick:T,disabled:!o.hid,children:"สแกนเครื่องอ่าน HID (Android/เบราว์เซอร์ที่รองรับ)"})]}),(0,b.jsx)("div",{className:"small text-muted mb-3",children:o.usb||o.hid?"หากไม่มีเครื่องอ่านให้เสียบสาย USB แล้วแตะปุ่มสแกนอีกครั้ง":"แนะนำให้เปิดด้วย Chrome/Edge บนพีซี หรือ Chrome บน Android เพื่อใช้งาน"}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("h3",{className:"h6 text-uppercase text-muted",children:"กิจกรรมล่าสุด"}),(0,b.jsx)("ul",{className:"list-unstyled mb-0 small",children:m.length?m.map((a,c)=>(0,b.jsx)("li",{className:"py-1 border-bottom border-secondary border-opacity-25",children:a},a+c)):(0,b.jsx)("li",{className:"text-muted",children:"รอการดำเนินการจากผู้ใช้"})})]})]})})}),(0,b.jsx)("div",{className:"col-lg-7",children:(0,b.jsxs)("div",{className:"border rounded-4 shadow-sm h-100 p-4",children:[(0,b.jsxs)("div",{className:"d-flex justify-content-between align-items-baseline mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h2",{className:"h5 mb-2",children:"อุปกรณ์ที่ระบบสามารถมองเห็น"}),(0,b.jsx)("p",{className:"text-muted small mb-0",children:"รีเฟรชรายการหากต่อเครื่องอ่านใหม่ หรือรู้สึกว่ายังไม่มีอุปกรณ์แสดง"})]}),(0,b.jsx)("button",{type:"button",className:"btn btn-sm btn-outline-secondary",onClick:N,children:"รีเฟรช"})]}),a.length?(0,b.jsx)("div",{className:"list-group list-group-flush",children:a.map(a=>(0,b.jsxs)("div",{className:"list-group-item bg-transparent border-0 px-0 py-3",children:[(0,b.jsxs)("div",{className:"d-flex justify-content-between align-items-start",children:[(0,b.jsx)("span",{className:"fw-semibold",children:a.label}),(0,b.jsx)("span",{className:"badge bg-secondary bg-opacity-10 text-dark",children:a.kind})]}),(0,b.jsx)("p",{className:"mb-0 small text-muted",children:a.info})]},a.id))}):(0,b.jsx)("p",{className:"text-muted mb-0",children:"ยังไม่พบเครื่องอ่านที่เชื่อมต่อ อย่าลืมเสียบสายและแตะปุ่มสแกนด้านซ้าย"})]})})]}),(0,b.jsx)("div",{className:"mt-4",children:(0,b.jsxs)("div",{className:"border rounded-4 shadow-sm p-4",children:[(0,b.jsxs)("div",{className:"row g-4",children:[(0,b.jsxs)("div",{className:"col-lg-8",children:[(0,b.jsxs)("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-uppercase small fw-semibold text-muted mb-1",children:"เลขประจำตัวประชาชน"}),(0,b.jsx)("h1",{className:"h3 mb-0",children:I.idNumber})]}),(0,b.jsx)("span",{className:"badge bg-success bg-opacity-15 text-success",children:I.cardStatus})]}),(0,b.jsxs)("div",{className:"d-flex gap-4 flex-wrap mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"ชื่อ-นามสกุล"}),(0,b.jsx)("p",{className:"fw-semibold mb-0",children:I.fullName}),(0,b.jsx)("p",{className:"text-muted small mb-0",children:I.fullNameEn})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"เพศ"}),(0,b.jsx)("p",{className:"mb-0",children:I.sex})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"วันเกิด"}),(0,b.jsxs)("p",{className:"mb-0",children:[I.birthDate," · ",I.age]})]})]}),(0,b.jsxs)("div",{className:"row row-cols-1 row-cols-md-2 g-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"วันที่ออกบัตร"}),(0,b.jsx)("p",{className:"mb-0 fw-semibold",children:I.issueDate})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"วันหมดอายุ"}),(0,b.jsx)("p",{className:"mb-0 fw-semibold",children:I.expiryDate})]})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"ที่อยู่ตามบัตร"}),(0,b.jsx)("p",{className:"mb-0",children:I.address})]})]}),(0,b.jsx)("div",{className:"col-lg-4",children:(0,b.jsxs)("div",{className:"border rounded-4 p-3 h-100 d-flex flex-column justify-content-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"ratio ratio-1x1 rounded mb-2",style:{backgroundColor:"#f5f5f5"},children:(0,b.jsx)("div",{className:"d-flex justify-content-center align-items-center h-100 text-muted",children:"ภาพถ่าย"})}),(0,b.jsx)("p",{className:"text-uppercase small text-muted mb-1",children:"เลขที่บัตรประชาชน"}),(0,b.jsx)("p",{className:"fs-5 fw-semibold mb-1",children:I.statusCode}),(0,b.jsx)("p",{className:"small text-muted mb-0",children:I.readerName})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("p",{className:"small text-uppercase text-muted mb-1",children:"ระบบบันทึก"}),(0,b.jsx)("div",{className:"bg-dark text-white rounded-3 px-3 py-2 small",children:"FAST ID STATUS"})]})]})})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"small text-uppercase text-muted mb-2",children:"System Logs"}),(0,b.jsx)("div",{className:"bg-light border rounded-3 p-3",style:{minHeight:140},children:E.length?(0,b.jsx)("ul",{className:"list-unstyled mb-0 small",children:E.map((a,c)=>(0,b.jsx)("li",{className:"pb-2 border-bottom border-secondary border-opacity-25",children:a},a+c))}):(0,b.jsx)("p",{className:"small text-muted mb-0",children:"ยังไม่พบข้อมูลบันทึก"})})]})]})}),(0,b.jsx)("div",{className:"mt-5",children:(0,b.jsx)("div",{className:"border rounded-4 shadow-sm p-4",children:(0,b.jsxs)("div",{className:"d-flex flex-column flex-lg-row gap-3 align-items-start",children:[(0,b.jsxs)("div",{className:"flex-fill",children:[(0,b.jsx)("h2",{className:"h5",children:"อ่านบัตรประชาชน"}),(0,b.jsx)("p",{className:"text-muted small mb-2",children:"ส่งคำสั่ง CCID โดยตรงผ่าน WebUSB เพื่อดึง ATR และส่ง APDU (อ่านข้อมูลบัตรต่อจากนี้ได้ง่ายขึ้น)"}),(0,b.jsxs)("div",{className:"d-flex gap-2 flex-wrap mb-3",children:[(0,b.jsx)("button",{className:"btn btn-outline-success",onClick:Q,disabled:U,children:"เปิดบัตร (Power On)"}),(0,b.jsx)("button",{className:"btn btn-success",onClick:R,disabled:U,children:"ส่ง APDU"})]}),(0,b.jsxs)("div",{className:"mb-2",children:[(0,b.jsx)("label",{className:"form-label small text-muted mb-1",children:"คำสั่ง APDU (HEX)"}),(0,b.jsx)("input",{className:"form-control form-control-sm",value:G,onChange:a=>H(a.target.value),placeholder:"ตัวอย่าง: 00A4040007A000000054480001"})]}),(0,b.jsxs)("div",{className:"d-flex gap-2 flex-wrap",children:[(0,b.jsx)("span",{className:"badge bg-info bg-opacity-10 text-info",children:"ATR"}),(0,b.jsx)("p",{className:"mb-0 small",children:C??"ยังไม่อ่าน"})]})]}),(0,b.jsxs)("div",{className:"flex-fill",children:[(0,b.jsx)("h3",{className:"h6 text-uppercase text-muted",children:"ขั้นตอนอัตโนมัติ"}),(0,b.jsx)("div",{className:"bg-dark text-white rounded-3 p-3",style:{minHeight:160},children:(0,b.jsxs)("ul",{className:"list-unstyled mb-0 small",children:[(0,b.jsx)("li",{children:"Card Disconnected."}),(0,b.jsx)("li",{children:"Step 1 Card Connected."}),(0,b.jsx)("li",{children:"Step 2 Read card information."}),(0,b.jsx)("li",{children:"Step 3 Read the picture."})]})})]})]})})}),(0,b.jsxs)("div",{className:"mt-5",children:[(0,b.jsx)("h2",{className:"h4",children:"คำแนะนำเพิ่มเติม"}),(0,b.jsxs)("div",{className:"row row-cols-1 row-cols-md-2 g-3 mt-3",children:[(0,b.jsx)("div",{className:"col",children:(0,b.jsxs)("div",{className:"p-3 border rounded-3 h-100",children:[(0,b.jsx)("h3",{className:"h6",children:"บน PC"}),(0,b.jsxs)("ul",{className:"ps-3 mb-0",children:[(0,b.jsx)("li",{children:"ใช้ Chrome หรือ Edge บน Windows 10/11 เพื่อรับรอง WebUSB"}),(0,b.jsx)("li",{children:'หากไม่เห็นเครื่องอ่านให้ตรวจสอบ Device Manager ว่าไดรเว์อร์ "Alcorlink" ถูกติดตั้ง'}),(0,b.jsx)("li",{children:'เปิดหน้านี้แล้วแตะ "สแกนเครื่องอ่าน USB" เพื่อให้อุปกรณ์ถามสิทธิ์'})]})]})}),(0,b.jsx)("div",{className:"col",children:(0,b.jsxs)("div",{className:"p-3 border rounded-3 h-100",children:[(0,b.jsx)("h3",{className:"h6",children:"บนมือถือ"}),(0,b.jsxs)("ul",{className:"ps-3 mb-0",children:[(0,b.jsx)("li",{children:"Android (Chrome/Edge) รองรับ WebHID; iOS/Safari ยังไม่รองรับ"}),(0,b.jsx)("li",{children:'เปิดหน้าเว็บนี้จากเบราว์เซอร์ที่รองรับ และแตะ "สแกนเครื่องอ่าน HID"'}),(0,b.jsx)("li",{children:"หากยังไม่มีการตอบกลับ ลองสลับสาย USB หรือใช้ฐาน OTG ในกล้อง"})]}),q&&(0,b.jsx)("p",{className:"small text-muted mb-0",children:"อยู่ระหว่างเรียกดูจากอุปกรณ์โมบายล์ เลือกปุ่ม HID หากต้องการใช้งานผ่าน USB-C"})]})})]})]})]})})})})}a.s(["default",()=>k])}];

//# sourceMappingURL=src_app_test-card-reader_page_tsx_6e718721._.js.map