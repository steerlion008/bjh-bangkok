module.exports=[116744,a=>{"use strict";var b=a.i(187924),c=a.i(572131),d=a.i(50944);function e({isOpen:a,onClose:c,surgeries:d,date:e,month:f,year:g,contactPerson:h,tableType:i="P"}){return a?(0,b.jsx)("div",{className:"modal-overlay",onClick:c,children:(0,b.jsxs)("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h2",{children:"P"===i?"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”":"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”à¸ˆà¸£à¸´à¸‡"}),(0,b.jsx)("button",{className:"close-button",onClick:c,children:"âœ•"})]}),(0,b.jsxs)("div",{className:"modal-info",children:[(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆ:"}),(0,b.jsxs)("span",{className:"info-value",children:[e," ",["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸žà¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸žà¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸Žà¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸žà¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"][f]," ",g+543]})]}),(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,b.jsx)("span",{className:"info-value",children:h})]}),(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸™à¸±à¸”:"}),(0,b.jsxs)("span",{className:"info-value highlight",children:[d.length," à¸£à¸²à¸¢à¸à¸²à¸£"]})]})]}),(0,b.jsx)("div",{className:"surgeries-list",children:d.map((a,c)=>(0,b.jsxs)("div",{className:"surgery-card",children:[(0,b.jsxs)("div",{className:"card-header",children:[(0,b.jsxs)("span",{className:"card-number",children:["#",c+1]}),(0,b.jsx)("span",{className:"card-name",children:a.à¸Šà¸·à¹ˆà¸­})]}),(0,b.jsxs)("div",{className:"card-body",children:[(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¨â€âš•ï¸"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸«à¸¡à¸­:"}),(0,b.jsx)("span",{className:"detail-value",children:a.à¸«à¸¡à¸­||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¤"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,b.jsx)("span",{className:"detail-value",children:a.à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ“ž"}),(0,b.jsx)("span",{className:"detail-label",children:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£:"}),(0,b.jsx)("span",{className:"detail-value",children:a.à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ“…"}),(0,b.jsx)("span",{className:"detail-label",children:"P"===i?"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸™à¸±à¸”:":"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸•à¸±à¸”:"}),(0,b.jsx)("span",{className:"detail-value",children:"P"===i?a.à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”||"-":a.à¸§à¸±à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸•à¸±à¸”||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ•"}),(0,b.jsx)("span",{className:"detail-label",children:"à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸™à¸±à¸”:"}),(0,b.jsx)("span",{className:"detail-value",children:a.à¹€à¸§à¸¥à¸²à¸—à¸µà¹ˆà¸™à¸±à¸”||"-"})]}),(0,b.jsxs)("div",{className:"detail-row highlight-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ’°"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸¢à¸­à¸”à¸™à¸³à¹€à¸ªà¸™à¸­:"}),(0,b.jsx)("span",{className:"detail-value amount",children:a.à¸¢à¸­à¸”à¸™à¸³à¹€à¸ªà¸™à¸­?`${(a=>{if(!a)return"-";let b=parseFloat(a.replace(/,/g,""));return isNaN(b)?a:b.toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:0})})(a.à¸¢à¸­à¸”à¸™à¸³à¹€à¸ªà¸™à¸­)} à¸šà¸²à¸—`:"-"})]})]})]},c))}),(0,b.jsx)("div",{className:"modal-footer",children:(0,b.jsx)("button",{className:"close-footer-button",onClick:c,children:"à¸›à¸´à¸”"})})]})}):null}function f({isOpen:a,onClose:c,nClinicData:d,futureData:e,date:f,month:g,year:h,contactPerson:i}){if(!a)return null;let j=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸žà¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸žà¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸Žà¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸žà¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"],k=a=>a?a.toLocaleString("th-TH",{minimumFractionDigits:0,maximumFractionDigits:0}):"-",l=a=>{if(!a)return"-";try{let b=new Date(a),c=b.getDate(),d=b.getMonth(),e=b.getFullYear();return`${c} ${j[d]} ${e+543}`}catch{return a}},m=d.reduce((a,b)=>a+(b.income||0),0)+e.reduce((a,b)=>a+(b.proposed_amount||0),0);return(0,b.jsx)("div",{className:"modal-overlay",onClick:c,children:(0,b.jsxs)("div",{className:"modal-content",onClick:a=>a.stopPropagation(),children:[(0,b.jsxs)("div",{className:"modal-header",children:[(0,b.jsx)("h2",{children:"à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”à¸›à¸£à¸°à¸¡à¸²à¸“à¸à¸²à¸£à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,b.jsx)("button",{className:"close-button",onClick:c,children:"âœ•"})]}),(0,b.jsxs)("div",{className:"modal-info",children:[(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆ:"}),(0,b.jsxs)("span",{className:"info-value",children:[f," ",j[g]," ",h+543]})]}),(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,b.jsx)("span",{className:"info-value",children:i})]}),(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£:"}),(0,b.jsxs)("span",{className:"info-value highlight",children:[d.length+e.length," à¸£à¸²à¸¢à¸à¸²à¸£"]})]}),(0,b.jsxs)("div",{className:"info-row",children:[(0,b.jsx)("span",{className:"info-label",children:"à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”:"}),(0,b.jsxs)("span",{className:"info-value highlight amount",children:[k(m)," à¸šà¸²à¸—"]})]})]}),(0,b.jsxs)("div",{className:"surgeries-list",children:[d.length>0&&(0,b.jsxs)("div",{className:"data-section",children:[(0,b.jsxs)("h3",{className:"section-title",children:["ðŸ“Š à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¹€à¸ªà¸£à¹‡à¸ˆà¹à¸¥à¹‰à¸§ (N_Clinic) - ",d.length," à¸£à¸²à¸¢à¸à¸²à¸£"]}),d.map((a,c)=>(0,b.jsxs)("div",{className:"surgery-card",children:[(0,b.jsxs)("div",{className:"card-header",children:[(0,b.jsxs)("span",{className:"card-number",children:["#",c+1]}),(0,b.jsx)("span",{className:"card-name",children:a.income_display_name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"})]}),(0,b.jsxs)("div",{className:"card-body",children:[(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¤"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²:"}),(0,b.jsx)("span",{className:"detail-value",children:a.income_display_name||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¥"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,b.jsx)("span",{className:"detail-value",children:a.staff_display_name||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ“…"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”:"}),(0,b.jsx)("span",{className:"detail-value",children:l(a.income_date)})]}),(0,b.jsxs)("div",{className:"detail-row highlight-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ’°"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸£à¸²à¸„à¸²à¸—à¸µà¹ˆà¹€à¸ªà¸™à¸­:"}),(0,b.jsxs)("span",{className:"detail-value amount",children:[k(a.income)," à¸šà¸²à¸—"]})]})]})]},`clinic-${c}`))]}),e.length>0&&(0,b.jsxs)("div",{className:"data-section",children:[(0,b.jsxs)("h3",{className:"section-title",children:["ðŸ“… à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸™à¸±à¸”à¹ƒà¸™à¸­à¸™à¸²à¸„à¸• (Future Revenue) - ",e.length," ","à¸£à¸²à¸¢à¸à¸²à¸£"]}),e.map((a,c)=>(0,b.jsxs)("div",{className:"surgery-card",children:[(0,b.jsxs)("div",{className:"card-header",children:[(0,b.jsxs)("span",{className:"card-number",children:["#",d.length+c+1]}),(0,b.jsx)("span",{className:"card-name",children:a.customer_name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"})]}),(0,b.jsxs)("div",{className:"card-body",children:[(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¤"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸Šà¸·à¹ˆà¸­à¸¥à¸¹à¸à¸„à¹‰à¸²:"}),(0,b.jsx)("span",{className:"detail-value",children:a.customer_name||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¨â€âš•ï¸"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸«à¸¡à¸­:"}),(0,b.jsx)("span",{className:"detail-value",children:a.doctor||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ‘¥"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­:"}),(0,b.jsx)("span",{className:"detail-value",children:a.contact_staff||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ“ž"}),(0,b.jsx)("span",{className:"detail-label",children:"à¹€à¸šà¸­à¸£à¹Œà¹‚à¸—à¸£:"}),(0,b.jsx)("span",{className:"detail-value",children:a.phone||"-"})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ“…"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸§à¸±à¸™à¸—à¸µà¹ˆà¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”:"}),(0,b.jsx)("span",{className:"detail-value",children:l(a.surgery_date)})]}),(0,b.jsxs)("div",{className:"detail-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ•"}),(0,b.jsx)("span",{className:"detail-label",children:"à¹€à¸§à¸¥à¸²à¸™à¸±à¸”:"}),(0,b.jsx)("span",{className:"detail-value",children:a.appointment_time||"-"})]}),(0,b.jsxs)("div",{className:"detail-row highlight-row",children:[(0,b.jsx)("span",{className:"detail-icon",children:"ðŸ’°"}),(0,b.jsx)("span",{className:"detail-label",children:"à¸£à¸²à¸„à¸²à¸—à¸µà¹ˆà¹€à¸ªà¸™à¸­:"}),(0,b.jsxs)("span",{className:"detail-value amount",children:[k(a.proposed_amount)," à¸šà¸²à¸—"]})]})]})]},`future-${c}`))]}),0===d.length&&0===e.length&&(0,b.jsx)("div",{className:"empty-state",children:(0,b.jsx)("p",{children:"à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸£à¸²à¸¢à¸£à¸±à¸šà¹ƒà¸™à¸§à¸±à¸™à¸™à¸µà¹‰"})})]}),(0,b.jsx)("div",{className:"modal-footer",children:(0,b.jsx)("button",{className:"close-footer-button",onClick:c,children:"à¸›à¸´à¸”"})})]})})}process.env.NEXT_PUBLIC_GOOGLE_SHEETS_API_KEY,process.env.NEXT_PUBLIC_SPREADSHEET_ID;let g={"101-à¸ªà¸²":"à¸ªà¸²","102-à¸žà¸´à¸Šà¸Šà¸²":"à¸žà¸´à¸Šà¸Šà¸²","103-à¸•à¸±à¹‰à¸‡à¹‚à¸­à¹‹":"à¸•à¸±à¹‰à¸‡à¹‚à¸­à¹‹","104-Test":"Test","105-à¸ˆà¸µà¸™":"à¸ˆà¸µà¸™","106-à¸¡à¸¸à¸":"à¸¡à¸¸à¸","107-à¹€à¸ˆ":"à¹€à¸ˆ","108-à¸§à¹ˆà¸²à¸™":"à¸§à¹ˆà¸²à¸™","109-à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸":"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸","110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡":"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"};async function h(){try{return console.error("fetchSurgeryScheduleFromDatabase called on server side"),[]}catch(a){throw console.error("Error fetching from Database:",a),a}}async function i(){try{let a=await fetch("/api/surgery-actual-db",{method:"GET",headers:{"Content-Type":"application/json"},cache:"no-store"});if(!a.ok)throw Error(`Failed to fetch surgery actual data: ${a.statusText}`);let b=await a.json();if(!b.success)throw Error(b.error||"Failed to fetch surgery actual data");return b.data}catch(a){throw Error(a.message||"Failed to fetch surgery actual data from database")}}async function j(){try{return console.error("fetchRevenueFutureFromDatabase called on server side"),[]}catch(a){throw console.error("Error fetching future revenue from Database:",a),a}}async function k(){try{return console.error("fetchNClinicFromDatabase called on server side"),[]}catch(a){throw console.error("Error fetching n_clinic from Database:",a),a}}function l(){let a,l,m,n,o,p,q,r,s,t,u,v,w,x,y=(0,d.useRouter)(),z=new Date,[A,B]=(0,c.useState)(z.getMonth()),[C,D]=(0,c.useState)(z.getFullYear()),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)([]),[I,J]=(0,c.useState)(!0),[K,L]=(0,c.useState)(null),M=c.default.useRef(null),N=c.default.useRef(null),O=c.default.useRef(null),[P,Q]=(0,c.useState)(new Map),[R,S]=(0,c.useState)(new Map),[T,U]=(0,c.useState)(new Map),[V,W]=(0,c.useState)(new Map),[X,Y]=(0,c.useState)([]),[Z,$]=(0,c.useState)([]),[_,aa]=(0,c.useState)(null),[ab,ac]=(0,c.useState)(!1),[ad,ae]=(0,c.useState)({"105-à¸ˆà¸µà¸™":{kpiMonth:40,kpiToDate:0,actual:5},"107-à¹€à¸ˆ":{kpiMonth:40,kpiToDate:0,actual:0},"108-à¸§à¹ˆà¸²à¸™":{kpiMonth:40,kpiToDate:0,actual:0},"109-à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸":{kpiMonth:0,kpiToDate:0,actual:0},"110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡":{kpiMonth:0,kpiToDate:0,actual:0}}),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)([]),[aj,ak]=(0,c.useState)(1),[al,am]=(0,c.useState)(""),[an,ao]=(0,c.useState)("P"),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)([]),[at,au]=(0,c.useState)([]),av=async(a=!1)=>{a?ac(!0):J(!0),L(null);try{let a=await h();F(a);let b=await i();H(b),aa(new Date)}catch(a){L(a.message||"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥")}finally{J(!1),ac(!1)}},aw=async()=>{try{console.log("ðŸ”„ Starting to load N_Clinic data (n_income + n_customer + n_staff)...");let a=await k();console.log("ðŸ’° N_Clinic Data Loaded:",{totalRecords:a.length,sampleRecords:a.slice(0,5),uniqueStaffDisplayName:[...new Set(a.map(a=>a.staff_display_name||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"))],sampleData:a.slice(0,5).map(a=>({staff_display_name:a.staff_display_name,income_date:a.income_date,income:a.income,income_display_name:a.income_display_name}))}),$(a),console.log("âœ… Loaded N_Clinic data from n_income")}catch(a){console.error("âŒ Error loading N_Clinic data:",a),console.error("Error details:",{message:a.message,stack:a.stack}),$([])}},ax=async()=>{try{console.log("ðŸ”„ Starting to load Revenue data (bjh_all_leads - surgery_date >= today)...");let a=await j();console.log("ðŸ’° Revenue Data Loaded (bjh_all_leads - Future only):",{totalRecords:a.length,sampleRecords:a.slice(0,5),uniqueContactStaff:[...new Set(a.map(a=>a.contact_staff||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸"))],sampleData:a.slice(0,5).map(a=>({contact_staff:a.contact_staff,surgery_date:a.surgery_date,doctor:a.doctor,customer_name:a.customer_name,phone:a.phone,proposed_amount:a.proposed_amount,appointment_time:a.appointment_time}))}),Y(a),console.log("âœ… Loaded Revenue data (bjh_all_leads - surgery_date >= today)")}catch(a){console.error("âŒ Error loading Revenue data:",a),console.error("Error details:",{message:a.message,stack:a.stack}),Y([])}},ay=()=>{M.current&&sessionStorage.setItem("pTableScrollLeft",M.current.scrollLeft.toString()),N.current&&sessionStorage.setItem("lTableScrollLeft",N.current.scrollLeft.toString()),O.current&&sessionStorage.setItem("revenueTableScrollLeft",O.current.scrollLeft.toString())};(0,c.useEffect)(()=>{let a=M.current,b=N.current,c=O.current;return a&&a.addEventListener("scroll",ay),b&&b.addEventListener("scroll",ay),c&&c.addEventListener("scroll",ay),()=>{a&&a.removeEventListener("scroll",ay),b&&b.removeEventListener("scroll",ay),c&&c.removeEventListener("scroll",ay)}},[]),(0,c.useEffect)(()=>{I||setTimeout(()=>{let a,b,c;a=sessionStorage.getItem("pTableScrollLeft"),b=sessionStorage.getItem("lTableScrollLeft"),c=sessionStorage.getItem("revenueTableScrollLeft"),a&&M.current&&(M.current.scrollLeft=parseInt(a)),b&&N.current&&(N.current.scrollLeft=parseInt(b)),c&&O.current&&(O.current.scrollLeft=parseInt(c))},100)},[I,A,C]),(0,c.useEffect)(()=>{(async()=>{await av()})()},[]),(0,c.useEffect)(()=>{(async()=>{await aw()})()},[A,C]),(0,c.useEffect)(()=>{(async()=>{await ax()})()},[A,C]),(0,c.useEffect)(()=>{let a=setInterval(async()=>{await av()},3e4);return()=>clearInterval(a)},[]),(0,c.useEffect)(()=>{let a=setInterval(async()=>{await aw()},3e4);return()=>clearInterval(a)},[]),(0,c.useEffect)(()=>{let a=setInterval(async()=>{await ax()},3e4);return()=>clearInterval(a)},[]);let az=(a,b)=>new Date(b,a+1,0).getDate(),aA=az(A,C),aB=Array.from({length:aA},(a,b)=>b+1),aC=a=>{let b=new Date(C,A,a).getDay();return b>=1&&b<=5},aD=()=>{let a=new Date,b=a.getDate(),c=a.getMonth(),d=a.getFullYear();if(C>d||C===d&&A>c)return 0;if(C<d||C===d&&A<c){let a=0,b=az(A,C);for(let c=1;c<=b;c++)aC(c)&&a++;return a}let e=0;for(let a=1;a<=b;a++)aC(a)&&e++;return e};(0,c.useEffect)(()=>{if(E.length>0){let a,b,c;Q((a=new Map,Object.values(g).forEach(b=>{a.set(b,new Map)}),b=0,c=0,E.forEach(d=>{let e=d.date_surgery_scheduled||d.à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”||"";if(e){b++;let f=function(a){if(!a||""===a.trim())return null;let b=a.trim();try{if(/^\d{4}-\d{2}-\d{2}$/.test(b)){let[a,c,d]=b.split("-").map(Number),e=new Date(a,c-1,d,12,0,0,0);if(!isNaN(e.getTime()))return e}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(b)){let[a,c,d]=b.split("/").map(Number);if(c>=1&&c<=12&&a>=1&&a<=31){let b=new Date(d,c-1,a,12,0,0,0);if(b.getFullYear()===d&&b.getMonth()===c-1&&b.getDate()===a)return b}return null}let a=new Date(b);if(!isNaN(a.getTime()))return a;return null}catch(b){return console.error("Error parsing date:",a,b),null}}(e);if(f&&f.getMonth()===A&&f.getFullYear()===C){c++;let b=f.getDate(),e=(d.contact_person||d.à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­||"").trim()||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸";if(a.has(e)){let c=a.get(e);c.has(b)||c.set(b,[]),c.get(b).push(d)}}}}),console.log(`ðŸ“Š Count P table (à¸§à¸±à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”): Processed ${b} records, matched ${c} for ${C}-${A+1}`),a))}},[E,A,C]),(0,c.useEffect)(()=>{if(console.log("ðŸ”„ Processing N_Clinic RevenueMap (income_date)...",{nClinicDataLength:Z.length,selectedMonth:A,selectedYear:C,firstFewRecords:Z.slice(0,3).map(a=>({income_date:a.income_date,staff_display_name:a.staff_display_name,income:a.income}))}),Z.length>0){let a,b,c,d,e,f,g,h,i=(a=new Map,b=0,c=0,d=0,e=0,f=0,g=0,h=0,console.log(`ðŸ” Starting n_clinic calculation for ${C}-${A+1}:`,{totalDataRecords:Z.length,targetMonth:A+1,targetYear:C}),Z.forEach((i,j)=>{let k=i.income_date||"";if(!k){e++,j<3&&console.log(`âš ï¸ Record ${j} has no income_date:`,i);return}b++;let l=function(a){if(!a||""===a.trim())return null;let b=a.trim();try{if(/^\d{4}-\d{2}-\d{2}$/.test(b)){let[a,c,d]=b.split("-").map(Number),e=new Date(a,c-1,d,12,0,0,0);if(!isNaN(e.getTime()))return e}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(b)){let[a,c,d]=b.split("/").map(Number);if(c>=1&&c<=12&&a>=1&&a<=31){let b=new Date(d,c-1,a,12,0,0,0);if(b.getFullYear()===d&&b.getMonth()===c-1&&b.getDate()===a)return b}return null}let a=new Date(b);if(!isNaN(a.getTime()))return a;return null}catch(b){return console.error("Error parsing date:",a,b),null}}(k);if(!l){f++,j<3&&console.log(`âš ï¸ Record ${j} has invalid date format:`,{income_date:k,item:i});return}if(l.getMonth()===A&&l.getFullYear()===C){c++;let b=l.getDate(),e=(i.staff_display_name||"").trim()||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸",f="number"==typeof i.income?i.income:i.income?parseFloat(String(i.income).replace(/,/g,"")):0;if(c<=3&&console.log(`ðŸ”¢ N_Clinic amount parsing for record ${j}:`,{raw:i.income,type:typeof i.income,parsed:f,person:e,day:b,income_date:i.income_date}),f>0){a.has(e)||a.set(e,new Map);let g=a.get(e),h=g.get(b)||0;g.set(b,h+f),d+=f,c<=5&&console.log(`âœ… Added n_clinic revenue: ${e} on day ${b}: ${f}`,{staff_display_name:i.staff_display_name,income_date:i.income_date,income:i.income,parsedDate:l.toISOString()})}else h++}else++g<=3&&console.log(`â­ï¸ Skipped (wrong month): ${k}`,{parsedMonth:l.getMonth()+1,parsedYear:l.getFullYear(),targetMonth:A+1,targetYear:C})}),console.log(`ðŸ’° Calculate N_Clinic Revenue: Processed ${b} records, matched ${c} for ${C}-${A+1}, total revenue: ${d.toLocaleString()} à¸šà¸²à¸—`,{skippedNoDate:e,skippedInvalidDate:f,skippedWrongMonth:g,skippedNoAmount:h,finalMapSize:a.size,persons:Array.from(a.keys())}),a);console.log("ðŸ” N_Clinic Revenue Map Debug:",{mapSize:i.size,persons:Array.from(i.keys()),allData:Array.from(i.entries()).map(([a,b])=>({person:a,totalDays:b.size,days:Array.from(b.entries()).slice(0,10),totalRevenue:Array.from(b.values()).reduce((a,b)=>a+b,0)}))}),W(i)}else console.log("âš ï¸ No N_Clinic data to process, clearing map"),W(new Map)},[Z,A,C]),(0,c.useEffect)(()=>{if(console.log("ðŸ”„ Processing filmRevenueMap (bjh_all_leads - Future surgeries)...",{futureDataLength:X.length,selectedMonth:A,selectedYear:C,firstFewRecords:X.slice(0,3).map(a=>({surgery_date:a.surgery_date,contact_staff:a.contact_staff,proposed_amount:a.proposed_amount}))}),X.length>0){let a,b,c,d,e=(a=new Map,b=0,c=0,d=0,X.forEach(e=>{let f=e.surgery_date||"";if(f){b++;let g=function(a){if(!a||""===a.trim())return null;let b=a.trim();try{if(/^\d{4}-\d{2}-\d{2}$/.test(b)){let[a,c,d]=b.split("-").map(Number),e=new Date(a,c-1,d,12,0,0,0);if(!isNaN(e.getTime()))return e}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(b)){let[a,c,d]=b.split("/").map(Number);if(c>=1&&c<=12&&a>=1&&a<=31){let b=new Date(d,c-1,a,12,0,0,0);if(b.getFullYear()===d&&b.getMonth()===c-1&&b.getDate()===a)return b}return null}let a=new Date(b);if(!isNaN(a.getTime()))return a;return null}catch(b){return console.error("Error parsing date:",a,b),null}}(f);if(g&&g.getMonth()===A&&g.getFullYear()===C){c++;let b=g.getDate(),f=(e.contact_staff||"").trim()||"à¹„à¸¡à¹ˆà¸£à¸°à¸šà¸¸",h=e.proposed_amount||0;if(h>0){a.has(f)||a.set(f,new Map);let c=a.get(f),e=c.get(b)||0;c.set(b,e+h),d+=h}}}}),console.log(`ðŸ’° Calculate Future Revenue (bjh_all_leads >= today): Processed ${b} records, matched ${c} for ${C}-${A+1}, total revenue: ${d.toLocaleString()} à¸šà¸²à¸—`),a);console.log("ðŸ” Film Revenue Map Debug (bjh_all_leads - Future):",{mapSize:e.size,persons:Array.from(e.keys()),allData:Array.from(e.entries()).map(([a,b])=>({person:a,totalDays:b.size,days:Array.from(b.entries()).slice(0,10),totalRevenue:Array.from(b.values()).reduce((a,b)=>a+b,0)}))}),U(e)}else console.log("âš ï¸ No future revenue data to process, clearing map"),U(new Map)},[X,A,C]),(0,c.useEffect)(()=>{if(G.length>0){let a;S((a=new Map,G.forEach(b=>{let c=b.contact_person||b["à¸œà¸¹à¹‰à¸•à¸´à¸”à¸•à¹ˆà¸­"]||"",d=b.surgery_date||b["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸•à¸±à¸”"];if(!c||!d)return;let e=function(a){if(!a)return null;try{if(/^\d{4}-\d{2}-\d{2}$/.test(a)){let[b,c,d]=a.split("-").map(Number);return new Date(b,c-1,d)}if(/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(a)){let[b,c,d]=a.split("/").map(Number);return new Date(d,c-1,b)}let b=new Date(a);if(!isNaN(b.getTime()))return b;return null}catch(a){return null}}(d);if(e&&e.getMonth()===A&&e.getFullYear()===C){let d=e.getDate();a.has(c)||a.set(c,new Map);let f=a.get(c);f.has(d)||f.set(d,[]),f.get(d).push(b)}}),a))}},[G,A,C]),(0,c.useEffect)(()=>{let a=aD(),b=aB.filter(a=>aC(a)).length;ae(c=>{let d={...c};return Object.keys(d).forEach(c=>{let e=0;aB.forEach(a=>{let b=aH(a,c,"P");e+=b}),d[c].kpiMonth>0?d[c]={...d[c],kpiToDate:Math.round(d[c].kpiMonth/b*a),actual:e}:d[c]={...d[c],actual:e}}),d})},[A,C,aB.length,P]);let aE=["à¸¡à¸à¸£à¸²à¸„à¸¡","à¸à¸¸à¸¡à¸ à¸²à¸žà¸±à¸™à¸˜à¹Œ","à¸¡à¸µà¸™à¸²à¸„à¸¡","à¹€à¸¡à¸©à¸²à¸¢à¸™","à¸žà¸¤à¸©à¸ à¸²à¸„à¸¡","à¸¡à¸´à¸–à¸¸à¸™à¸²à¸¢à¸™","à¸à¸£à¸à¸Žà¸²à¸„à¸¡","à¸ªà¸´à¸‡à¸«à¸²à¸„à¸¡","à¸à¸±à¸™à¸¢à¸²à¸¢à¸™","à¸•à¸¸à¸¥à¸²à¸„à¸¡","à¸žà¸¤à¸¨à¸ˆà¸´à¸à¸²à¸¢à¸™","à¸˜à¸±à¸™à¸§à¸²à¸„à¸¡"],aF=Array.from({length:5},(a,b)=>z.getFullYear()-2+b),aG=(a,b,c)=>{let d=g[b];if(!d)return;let e="P"===c?P:R,f=[];if("105-à¸ˆà¸µà¸™"===b){let b=e.get("à¸ˆà¸µà¸™"),c=e.get("à¸¡à¸¸à¸");f=[...b?.get(a)||[],...c?.get(a)||[]]}else{let b=e.get(d);if(!b)return;f=b.get(a)||[]}if(0===f.length)return;let h=aL.find(a=>a.id===b),i=h?h.name:d;ai(f),ak(a),am(i),ao(c),ag(!0)},aH=(a,b,c)=>{let d=g[b];if(!d)return 0;let e="P"===c?P:R;if("105-à¸ˆà¸µà¸™"===b){let b=e.get("à¸ˆà¸µà¸™"),c=e.get("à¸¡à¸¸à¸"),d=b?.get(a)||[],f=c?.get(a)||[];return d.length+f.length}let f=e.get(d);if(!f)return 0;let h=f.get(a);return h?h.length:0},aI=(a,b)=>{let c=g[b];if(!c)return console.warn(`âš ï¸ No contact person mapping for rowId: ${b}`),0;let d=0;return 1===a&&console.log(`ðŸ” Debug getCellRevenue for day ${a}, rowId ${b}:`,{rowId:b,contactPerson:c,nClinicMapSize:V.size,futureMapSize:T.size,nClinicMapKeys:Array.from(V.keys()),futureMapKeys:Array.from(T.keys())}),V.size>0&&("105-à¸ˆà¸µà¸™"===b?d+=(V.get("à¸ˆà¸µà¸™")?.get(a)||0)+(V.get("à¸¡à¸¸à¸")?.get(a)||0):d+=V.get(c)?.get(a)||0),T.size>0&&("105-à¸ˆà¸µà¸™"===b?d+=(T.get("à¸ˆà¸µà¸™")?.get(a)||0)+(T.get("à¸¡à¸¸à¸")?.get(a)||0):d+=T.get(c)?.get(a)||0),1===a&&d>0&&console.log(`ðŸ’° Total Revenue for ${b} (${c}) day ${a}:`,{nClinic:"105-à¸ˆà¸µà¸™"===b?(V.get("à¸ˆà¸µà¸™")?.get(a)||0)+(V.get("à¸¡à¸¸à¸")?.get(a)||0):V.get(c)?.get(a)||0,future:"105-à¸ˆà¸µà¸™"===b?(T.get("à¸ˆà¸µà¸™")?.get(a)||0)+(T.get("à¸¡à¸¸à¸")?.get(a)||0):T.get(c)?.get(a)||0,totalRevenue:d}),d},aJ=a=>{let b=ad[a];if(!b)return 0;let c="105-à¸ˆà¸µà¸™"===a?2*b.kpiToDate:b.kpiToDate;return b.actual-c},aK=a=>0===a?"":a.toLocaleString("th-TH"),aL=[{id:"105-à¸ˆà¸µà¸™",name:"105-à¸ˆà¸µà¸™ & à¸¡à¸¸à¸"},{id:"107-à¹€à¸ˆ",name:"107-à¹€à¸ˆ"},{id:"108-à¸§à¹ˆà¸²à¸™",name:"108-à¸§à¹ˆà¸²à¸™"}],aM=[{id:"105-à¸ˆà¸µà¸™",name:"105-à¸ˆà¸µà¸™ & à¸¡à¸¸à¸"},{id:"107-à¹€à¸ˆ",name:"107-à¹€à¸ˆ"},{id:"108-à¸§à¹ˆà¸²à¸™",name:"108-à¸§à¹ˆà¸²à¸™"},{id:"110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡",name:"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"}];return(0,b.jsxs)("div",{className:"surgery-schedule-container",children:[(0,b.jsxs)("div",{className:"schedule-header",children:[(0,b.jsx)("div",{style:{display:"flex",alignItems:"center",gap:"16px",marginBottom:"16px"},children:(0,b.jsx)("button",{onClick:()=>y.push("/home"),className:"back-button",style:{padding:"8px 16px",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"14px",fontWeight:"500",display:"flex",alignItems:"center",gap:"8px",transition:"background-color 0.2s"},onMouseEnter:a=>a.currentTarget.style.backgroundColor="#45a049",onMouseLeave:a=>a.currentTarget.style.backgroundColor="#4CAF50",children:"â† à¸à¸¥à¸±à¸šà¹„à¸›à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸"})}),(0,b.jsx)("h1",{style:{textAlign:"center",margin:"16px 0"},children:"Performance - à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,b.jsxs)("div",{className:"calendar-controls",children:[(0,b.jsx)("button",{onClick:()=>{0===A?(B(11),D(C-1)):B(A-1)},className:"nav-button",children:"â—€ à¹€à¸”à¸·à¸­à¸™à¸à¹ˆà¸­à¸™"}),(0,b.jsxs)("div",{className:"date-selectors",children:[(0,b.jsx)("select",{value:A,onChange:a=>{B(parseInt(a.target.value))},className:"month-select",children:aE.map((a,c)=>(0,b.jsx)("option",{value:c,children:a},c))}),(0,b.jsx)("select",{value:C,onChange:a=>{D(parseInt(a.target.value))},className:"year-select",children:aF.map(a=>(0,b.jsxs)("option",{value:a,children:[a+543," "]},a))})]}),(0,b.jsx)("button",{onClick:()=>{11===A?(B(0),D(C+1)):B(A+1)},className:"nav-button",children:"à¹€à¸”à¸·à¸­à¸™à¸–à¸±à¸”à¹„à¸› â–¶"})]}),(0,b.jsxs)("div",{className:"selected-month-display",children:[(0,b.jsxs)("strong",{children:["à¹€à¸”à¸·à¸­à¸™ ",aE[A]," ",C+543]}),(0,b.jsxs)("span",{className:"days-count",children:[" (",aA," à¸§à¸±à¸™)"]}),aD()>0&&(0,b.jsxs)("span",{className:"weekdays-count",children:[" ","| ðŸ—“ï¸ à¸§à¸±à¸™à¸—à¸³à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸œà¹ˆà¸²à¸™à¸¡à¸²: ",aD()," à¸§à¸±à¸™"]})]})]}),!I&&!K&&(0,b.jsxs)("div",{className:"team-summary-dashboard",children:[aL.map((a,c)=>{let d=ad[a.id]?.actual||0,e=aJ(a.id),f=ad[a.id]?.kpiToDate||0,g=0;aB.forEach(b=>{g+=aH(b,a.id,"L")});let h=0;aB.forEach(b=>{h+=aI(b,a.id)});let i="105-à¸ˆà¸µà¸™"===a.id?2*f*25e3:25e3*f,j=h-i;return(0,b.jsxs)("div",{className:`team-summary-card ${["team-color-1","team-color-2","team-color-3"][c]}`,children:[(0,b.jsx)("div",{className:"team-summary-header",children:(0,b.jsx)("h3",{children:a.name})}),(0,b.jsxs)("div",{className:"team-summary-body",children:[(0,b.jsxs)("div",{className:"summary-metric",children:[(0,b.jsx)("div",{className:"metric-label",children:"à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,b.jsxs)("div",{className:"metric-row",children:[(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,b.jsx)("div",{className:"metric-value",children:aK(i)})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Actual"}),(0,b.jsx)("div",{className:"metric-value",children:aK(h)})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Diff"}),(0,b.jsxs)("div",{className:`metric-value ${j>=0?"positive":"negative"}`,children:[j>=0?"+":"âˆ’",aK(Math.abs(j))]})]})]})]}),(0,b.jsxs)("div",{className:"summary-metric",children:[(0,b.jsx)("div",{className:"metric-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,b.jsxs)("div",{className:"metric-row",children:[(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,b.jsx)("div",{className:"metric-value",children:"105-à¸ˆà¸µà¸™"===a.id?2*f:f})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Actual"}),(0,b.jsx)("div",{className:"metric-value",children:d})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Diff"}),(0,b.jsxs)("div",{className:`metric-value ${e>=0?"positive":"negative"}`,children:[e>=0?"+":"âˆ’",Math.abs(e)]})]})]})]})]})]},a.id)}),(a="110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡",l=ad[a]?.actual||0,m=aJ(a),n=ad[a]?.kpiToDate||0,o=0,aB.forEach(b=>{o+=aI(b,a)}),q=o-(p=25e3*n),(0,b.jsxs)("div",{className:"team-summary-card team-color-4",children:[(0,b.jsx)("div",{className:"team-summary-header",children:(0,b.jsx)("h3",{children:"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"})}),(0,b.jsxs)("div",{className:"team-summary-body",children:[(0,b.jsxs)("div",{className:"summary-metric",children:[(0,b.jsx)("div",{className:"metric-label",children:"à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,b.jsxs)("div",{className:"metric-row",children:[(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,b.jsx)("div",{className:"metric-value",children:aK(p)})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Actual"}),(0,b.jsx)("div",{className:"metric-value",children:aK(o)})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Diff"}),(0,b.jsxs)("div",{className:`metric-value ${q>=0?"positive":"negative"}`,children:[q>=0?"+":"âˆ’",aK(Math.abs(q))]})]})]})]}),(0,b.jsxs)("div",{className:"summary-metric",children:[(0,b.jsx)("div",{className:"metric-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,b.jsxs)("div",{className:"metric-row",children:[(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,b.jsx)("div",{className:"metric-value",children:n})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Actual"}),(0,b.jsx)("div",{className:"metric-value",children:l})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Diff"}),(0,b.jsxs)("div",{className:`metric-value ${m>=0?"positive":"negative"}`,children:[m>=0?"+":"âˆ’",Math.abs(m)]})]})]})]})]})]},a)),(r=[...aL,{id:"110-à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡",name:"à¸ªà¹ˆà¸§à¸™à¸à¸¥à¸²à¸‡"}],s=0,r.forEach(a=>{aB.forEach(b=>{s+=aI(b,a.id)})}),t=0,r.forEach(a=>{let b=ad[a.id]?.kpiToDate||0,c="105-à¸ˆà¸µà¸™"===a.id?2:1;t+=b*c*25e3}),u=s-t,v=0,r.forEach(a=>{v+=ad[a.id]?.actual||0}),w=0,r.forEach(a=>{let b=ad[a.id]?.kpiToDate||0,c="105-à¸ˆà¸µà¸™"===a.id?2:1;w+=b*c}),x=v-w,(0,b.jsxs)("div",{className:"team-summary-card team-color-pink",children:[(0,b.jsx)("div",{className:"team-summary-header",children:(0,b.jsx)("h3",{children:"à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”"})}),(0,b.jsxs)("div",{className:"team-summary-body",children:[(0,b.jsxs)("div",{className:"summary-metric",children:[(0,b.jsx)("div",{className:"metric-label",children:"à¸£à¸²à¸¢à¸£à¸±à¸š"}),(0,b.jsxs)("div",{className:"metric-row",children:[(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,b.jsx)("div",{className:"metric-value",children:aK(t)})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Actual"}),(0,b.jsx)("div",{className:"metric-value",children:aK(s)})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Diff"}),(0,b.jsxs)("div",{className:`metric-value ${u>=0?"positive":"negative"}`,children:[u>=0?"+":"âˆ’",aK(Math.abs(u))]})]})]})]}),(0,b.jsxs)("div",{className:"summary-metric",children:[(0,b.jsx)("div",{className:"metric-label",children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸”"}),(0,b.jsxs)("div",{className:"metric-row",children:[(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"KPI to date"}),(0,b.jsx)("div",{className:"metric-value",children:w})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Actual"}),(0,b.jsx)("div",{className:"metric-value",children:v})]}),(0,b.jsxs)("div",{className:"metric-item",children:[(0,b.jsx)("div",{className:"metric-title",children:"Diff"}),(0,b.jsxs)("div",{className:`metric-value ${x>=0?"positive":"negative"}`,children:[x>=0?"+":"âˆ’",Math.abs(x)]})]})]})]})]})]},"total"))]}),I&&(0,b.jsxs)("div",{className:"loading-indicator",children:[(0,b.jsx)("div",{className:"spinner"}),(0,b.jsx)("p",{children:"à¸à¸³à¸¥à¸±à¸‡à¹‚à¸«à¸¥à¸”à¸‚à¹‰à¸­à¸¡à¸¹à¸¥..."})]}),K&&(0,b.jsxs)("div",{className:"error-display",children:[(0,b.jsx)("div",{className:"error-icon",children:"âš ï¸"}),(0,b.jsxs)("div",{className:"error-content",children:[(0,b.jsx)("h3",{children:"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸žà¸¥à¸²à¸”"}),(0,b.jsx)("p",{children:K}),(0,b.jsxs)("div",{className:"error-help",children:[(0,b.jsx)("strong",{children:"à¹à¸™à¸°à¸™à¸³à¸à¸²à¸£à¹à¸à¹‰à¹„à¸‚:"}),(0,b.jsxs)("ol",{children:[(0,b.jsx)("li",{children:"à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸² PostgreSQL Database à¸à¸³à¸¥à¸±à¸‡à¸—à¸³à¸‡à¸²à¸™à¸­à¸¢à¸¹à¹ˆ"}),(0,b.jsxs)("li",{children:["à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸š Environment Variables (Settings â†’ Environment Variables):",(0,b.jsx)("br",{}),"- ",(0,b.jsx)("code",{children:"DB_HOST"}),(0,b.jsx)("br",{}),"- ",(0,b.jsx)("code",{children:"DB_PORT"}),(0,b.jsx)("br",{}),"- ",(0,b.jsx)("code",{children:"DB_USER"}),(0,b.jsx)("br",{}),"- ",(0,b.jsx)("code",{children:"DB_PASSWORD"}),(0,b.jsx)("br",{}),"- ",(0,b.jsx)("code",{children:"DB_NAME"})]}),(0,b.jsxs)("li",{children:["à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸§à¹ˆà¸²à¸¡à¸µà¸•à¸²à¸£à¸²à¸‡ ",(0,b.jsx)("code",{children:"surgery_schedule"})," à¹à¸¥à¸°"," ",(0,b.jsx)("code",{children:"sale_incentive"})," à¹ƒà¸™à¸à¸²à¸™à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"]}),(0,b.jsxs)("li",{children:["à¸£à¸±à¸™à¸„à¸³à¸ªà¸±à¹ˆà¸‡ SQL schema: ",(0,b.jsx)("code",{children:"surgery-schedule-schema.sql"})]}),(0,b.jsx)("li",{children:"à¸¥à¸­à¸‡ Redeploy Vercel à¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"})]})]}),(0,b.jsx)("button",{onClick:async()=>{await av(),await aw(),await ax()},className:"retry-button",children:"à¸¥à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸­à¸µà¸à¸„à¸£à¸±à¹‰à¸‡"})]})]}),(0,b.jsx)("div",{className:"table-section ",children:(0,b.jsx)("div",{className:"table-wrapper",ref:M,children:(0,b.jsxs)("table",{className:"schedule-table",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"header-cell name-header",rowSpan:2,children:"à¸ˆà¸³à¸™à¸§à¸™à¸—à¸µà¹ˆà¹„à¸”à¹‰à¸™à¸±à¸”à¸œà¹ˆà¸²à¸•à¸±à¸”"}),aB.map(a=>(0,b.jsx)("th",{className:`header-cell day-header  ${aC(a)?"weekday-header":""}`,style:{width:"62px"},children:a},`p-day-${a}`))]})}),(0,b.jsx)("tbody",{children:aL.map((a,c)=>(0,b.jsxs)("tr",{className:c%2==0?"even-row":"odd-row",children:[(0,b.jsx)("td",{className:"name-cell",children:a.name}),aB.map(c=>{let d=aH(c,a.id,"P");return(0,b.jsx)("td",{className:`data-cell ${d>0?"has-data":""}`,onClick:()=>d>0&&aG(c,a.id,"P"),title:d>0?`à¸„à¸¥à¸´à¸à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸” (${d} à¸£à¸²à¸¢à¸à¸²à¸£)`:"",children:d>0&&(0,b.jsx)("span",{className:"count-badge",children:d})},`p-cell-${a.id}-${c}`)})]},`p-row-${a.id}`))})]})})}),(0,b.jsx)("div",{className:"table-section",children:(0,b.jsx)("div",{className:"table-wrapper",ref:N,children:(0,b.jsxs)("table",{className:"schedule-table",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"header-cell name-header",rowSpan:2,children:"à¸ˆà¸³à¸™à¸§à¸™à¸œà¹ˆà¸²à¸•à¸±à¸” L"}),aB.map(a=>(0,b.jsx)("th",{className:`header-cell day-header ${aC(a)?"weekday-header":""}`,style:{width:"62px"},children:a},`l-day-${a}`))]})}),(0,b.jsxs)("tbody",{children:[aM.map((a,c)=>(0,b.jsxs)("tr",{className:c%2==0?"even-row":"odd-row",children:[(0,b.jsx)("td",{className:"name-cell",children:a.name}),aB.map(c=>{let d=g[a.id],e=a=>{if(!a)return null;try{return new Date(a)}catch{return null}},f=0;Z.forEach(b=>{let g=e(b.income_date);if(!g)return;let h=g.getDate(),i=g.getMonth(),j=g.getFullYear();i===A&&j===C&&h===c&&("105-à¸ˆà¸µà¸™"===a.id?("à¸ˆà¸µà¸™"===b.staff_display_name||"à¸¡à¸¸à¸"===b.staff_display_name)&&f++:b.staff_display_name===d&&f++)});let h=0;X.forEach(b=>{let f=e(b.surgery_date);if(!f)return;let g=f.getDate(),i=f.getMonth(),j=f.getFullYear();i===A&&j===C&&g===c&&("105-à¸ˆà¸µà¸™"===a.id?("à¸ˆà¸µà¸™"===b.contact_staff||"à¸¡à¸¸à¸"===b.contact_staff)&&h++:b.contact_staff===d&&h++)});let i=f+h;return(0,b.jsx)("td",{className:`data-cell ${i>0?"has-data revenue-cell":""}`,onClick:()=>i>0&&aG(c,a.id,"L"),title:i>0?`à¸„à¸¥à¸´à¸à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
N_Clinic: ${f} à¸£à¸²à¸¢à¸à¸²à¸£
Future: ${h} à¸£à¸²à¸¢à¸à¸²à¸£
à¸¢à¸­à¸”à¸£à¸§à¸¡: ${i} à¸£à¸²à¸¢à¸à¸²à¸£`:"",children:(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:[f>0&&(0,b.jsx)("span",{className:"count-badge revenue-badge-blue",children:f}),h>0&&(0,b.jsx)("span",{className:"count-badge revenue-badge-green",children:h})]})},`l-cell-${a.id}-${c}`)})]},`l-row-${a.id}`)),(0,b.jsxs)("tr",{className:"total-row",children:[(0,b.jsx)("td",{className:"name-cell",style:{fontWeight:"bold"},children:"à¸¢à¸­à¸”à¸£à¸§à¸¡"}),aB.map(a=>{let c=a=>{if(!a)return null;try{return new Date(a)}catch{return null}},d=0;return aM.forEach(b=>{let e=g[b.id];Z.forEach(f=>{let g=c(f.income_date);if(!g)return;let h=g.getDate(),i=g.getMonth(),j=g.getFullYear();i===A&&j===C&&h===a&&("105-à¸ˆà¸µà¸™"===b.id?("à¸ˆà¸µà¸™"===f.staff_display_name||"à¸¡à¸¸à¸"===f.staff_display_name)&&d++:f.staff_display_name===e&&d++)}),X.forEach(f=>{let g=c(f.surgery_date);if(!g)return;let h=g.getDate(),i=g.getMonth(),j=g.getFullYear();i===A&&j===C&&h===a&&("105-à¸ˆà¸µà¸™"===b.id?("à¸ˆà¸µà¸™"===f.contact_staff||"à¸¡à¸¸à¸"===f.contact_staff)&&d++:f.contact_staff===e&&d++)})}),(0,b.jsx)("td",{className:`data-cell ${d>0?"has-data":""}`,style:{fontWeight:"bold"},title:d>0?`à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${d} à¸£à¸²à¸¢à¸à¸²à¸£`:"",children:d>0&&(0,b.jsx)("span",{className:"count-badge",children:d})},`total-l-cell-${a}`)})]})]})]})})}),(0,b.jsx)("div",{className:"table-section",children:(0,b.jsx)("div",{className:"table-wrapper",ref:O,children:(0,b.jsxs)("table",{className:"schedule-table",children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"header-cell name-header",rowSpan:2,children:"à¸›à¸£à¸°à¸¡à¸²à¸“à¸à¸²à¸£à¸£à¸²à¸¢à¸£à¸±à¸š"}),aB.map(a=>(0,b.jsx)("th",{className:`header-cell day-header ${aC(a)?"weekday-header":""}`,style:{width:"62px"},children:a},`revenue-day-${a}`))]})}),(0,b.jsxs)("tbody",{children:[aM.map((a,c)=>(0,b.jsxs)("tr",{className:c%2==0?"even-row":"odd-row",children:[(0,b.jsx)("td",{className:"name-cell",children:a.name}),aB.map(c=>{let d=g[a.id],e=0;V.size>0&&(e="105-à¸ˆà¸µà¸™"===a.id?(V.get("à¸ˆà¸µà¸™")?.get(c)||0)+(V.get("à¸¡à¸¸à¸")?.get(c)||0):V.get(d)?.get(c)||0);let f=0;T.size>0&&(f="105-à¸ˆà¸µà¸™"===a.id?(T.get("à¸ˆà¸µà¸™")?.get(c)||0)+(T.get("à¸¡à¸¸à¸")?.get(c)||0):T.get(d)?.get(c)||0);let h=e+f;return(0,b.jsx)("td",{className:`data-cell ${h>0?"has-data revenue-cell":""}`,onClick:()=>h>0&&((a,b)=>{let c=g[b];if(!c)return;let d=a=>{if(!a)return null;try{return new Date(a)}catch{return null}},e=Z.filter(e=>{let f=d(e.income_date);if(!f)return!1;let g=f.getDate(),h=f.getMonth(),i=f.getFullYear();return h===A&&i===C&&g===a&&("105-à¸ˆà¸µà¸™"===b?"à¸ˆà¸µà¸™"===e.staff_display_name||"à¸¡à¸¸à¸"===e.staff_display_name:e.staff_display_name===c)}),f=X.filter(e=>{let f=d(e.surgery_date);if(!f)return!1;let g=f.getDate(),h=f.getMonth(),i=f.getFullYear();return h===A&&i===C&&g===a&&("105-à¸ˆà¸µà¸™"===b?"à¸ˆà¸µà¸™"===e.contact_staff||"à¸¡à¸¸à¸"===e.contact_staff:e.contact_staff===c)});if(0===e.length&&0===f.length)return;let h=aL.find(a=>a.id===b),i=h?h.name:c;as(e),au(f),ak(a),am(i),aq(!0)})(c,a.id),title:h>0?`à¸„à¸¥à¸´à¸à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”
N_Clinic: ${aK(e)} à¸šà¸²à¸—
Future: ${aK(f)} à¸šà¸²à¸—
à¸¢à¸­à¸”à¸£à¸§à¸¡: ${aK(h)} à¸šà¸²à¸—`:"",children:(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px",alignItems:"center"},children:[e>0&&(0,b.jsx)("span",{className:"revenue-badge revenue-badge-blue",children:aK(e)}),f>0&&(0,b.jsx)("span",{className:"revenue-badge revenue-badge-green",children:aK(f)})]})},`revenue-cell-${a.id}-${c}`)})]},`revenue-row-${a.id}`)),(0,b.jsxs)("tr",{className:"total-row",children:[(0,b.jsx)("td",{className:"name-cell",style:{fontWeight:"bold"},children:"à¸¢à¸­à¸”à¸£à¸§à¸¡"}),aB.map(a=>{let c=0;return aM.forEach(b=>{let d=g[b.id],e=0;V.size>0&&(e="105-à¸ˆà¸µà¸™"===b.id?(V.get("à¸ˆà¸µà¸™")?.get(a)||0)+(V.get("à¸¡à¸¸à¸")?.get(a)||0):V.get(d)?.get(a)||0);let f=0;T.size>0&&(f="105-à¸ˆà¸µà¸™"===b.id?(T.get("à¸ˆà¸µà¸™")?.get(a)||0)+(T.get("à¸¡à¸¸à¸")?.get(a)||0):T.get(d)?.get(a)||0),c+=e+f}),(0,b.jsx)("td",{className:`data-cell ${c>0?"has-data revenue-cell":""}`,style:{fontWeight:"bold"},title:c>0?`à¸¢à¸­à¸”à¸£à¸§à¸¡à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: ${aK(c)} à¸šà¸²à¸—`:"",children:c>0&&(0,b.jsx)("span",{className:"revenue-badge",children:aK(c)})},`total-cell-${a}`)})]})]})]})})}),(0,b.jsx)(e,{isOpen:af,onClose:()=>ag(!1),surgeries:ah,date:aj,month:A,year:C,contactPerson:al,tableType:an}),(0,b.jsx)(f,{isOpen:ap,onClose:()=>aq(!1),nClinicData:ar,futureData:at,date:aj,month:A,year:C,contactPerson:al})]})}a.s(["default",()=>l],116744)}];

//# sourceMappingURL=src_app_%28fullscreen%29_performance-surgery-schedule_page_tsx_f3943720._.js.map