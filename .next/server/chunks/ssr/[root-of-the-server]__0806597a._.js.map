{"version":3,"sources":["../../../../src/app/share/video/%5Bid%5D/CopyButton.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/share/video/%5Bid%5D/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/app/share/video/[id]/CopyButton.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/app/share/video/[id]/CopyButton.tsx\",\n    \"default\",\n);\n","import { Metadata, ResolvingMetadata } from \"next\";\r\nimport { notFound, redirect } from \"next/navigation\";\r\nimport fs from \"fs\";\r\nimport path from \"path\";\r\nimport CopyButton from \"./CopyButton\";\r\n\r\n// Base URL for the application\r\nconst BASE_URL = process.env.NEXT_PUBLIC_BASE_URL || \"https://app.bjhbangkok.com\";\r\n\r\ninterface VideoInfo {\r\n    id: string;\r\n    name: string;\r\n    url: string;\r\n    thumbnail: string;\r\n    width: number;\r\n    height: number;\r\n    duration?: number;\r\n    mimeType: string;\r\n}\r\n\r\n// Function to get video info from file system or database\r\nasync function getVideoInfo(id: string): Promise<VideoInfo | null> {\r\n    try {\r\n        // Decode the ID (it's base64 encoded path)\r\n        const decodedPath = Buffer.from(id, \"base64url\").toString(\"utf-8\");\r\n\r\n        // Security check - ensure path is within allowed folders\r\n        const allowedFolders = [\"/images/video/\", \"/marketing/\", \"images/video/\", \"marketing/\"];\r\n        const isAllowed = allowedFolders.some(folder => decodedPath.includes(folder));\r\n\r\n        if (!isAllowed) {\r\n            return null;\r\n        }\r\n\r\n        const normalizedPath = decodedPath.startsWith(\"/\") ? decodedPath : `/${decodedPath}`;\r\n        const fullPath = path.join(process.cwd(), \"public\", normalizedPath);\r\n\r\n        // Check if file exists\r\n        if (!fs.existsSync(fullPath)) {\r\n            return null;\r\n        }\r\n\r\n        const stats = fs.statSync(fullPath);\r\n        const fileName = path.basename(fullPath);\r\n        const ext = path.extname(fullPath).toLowerCase();\r\n\r\n        // Determine MIME type\r\n        const mimeTypes: Record<string, string> = {\r\n            \".mp4\": \"video/mp4\",\r\n            \".webm\": \"video/webm\",\r\n            \".mov\": \"video/quicktime\",\r\n            \".m4v\": \"video/x-m4v\",\r\n        };\r\n\r\n        const mimeType = mimeTypes[ext] || \"video/mp4\";\r\n\r\n        // Use LINE-specific video endpoint for OG tags (supports transcoded versions)\r\n        // This endpoint serves cached transcoded H.264 version if available\r\n        const lineVideoUrl = `${BASE_URL}/api/line-video/${id}`;\r\n\r\n        // Direct URL for fallback/player\r\n        const directUrl = `${BASE_URL}${normalizedPath}`;\r\n\r\n        // Generate thumbnail path (check for existing thumbnail)\r\n        const thumbnailName = `${path.basename(fileName, ext)}_thumb.jpg`;\r\n        const folderPath = path.dirname(normalizedPath);\r\n        const thumbnailPath = `${folderPath}/${thumbnailName}`;\r\n        const thumbnailFullPath = path.join(process.cwd(), \"public\", thumbnailPath);\r\n\r\n        // Also check for a thumbnail in the same folder\r\n        const thumbnail = fs.existsSync(thumbnailFullPath)\r\n            ? `${BASE_URL}${thumbnailPath}`\r\n            : `${BASE_URL}/images/video-placeholder.svg`;\r\n\r\n        return {\r\n            id,\r\n            name: fileName,\r\n            url: lineVideoUrl, // Use LINE-optimized endpoint for OG tags\r\n            thumbnail,\r\n            width: 1280,\r\n            height: 720,\r\n            mimeType: \"video/mp4\", // Always report as MP4 for LINE\r\n        };\r\n    } catch (error) {\r\n        console.error(\"Error getting video info:\", error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Generate metadata for LINE and social sharing\r\nexport async function generateMetadata(\r\n    { params }: { params: Promise<{ id: string }> },\r\n    parent: ResolvingMetadata\r\n): Promise<Metadata> {\r\n    const { id } = await params;\r\n    const video = await getVideoInfo(id);\r\n\r\n    if (!video) {\r\n        return {\r\n            title: \"Video Not Found\",\r\n        };\r\n    }\r\n\r\n    const pageUrl = `${BASE_URL}/share/video/${id}`;\r\n\r\n    return {\r\n        title: `${video.name} - BJH Bangkok`,\r\n        description: `Watch ${video.name} from BJH Bangkok Medical Center`,\r\n\r\n        // Open Graph for video - Critical for LINE inline playback\r\n        openGraph: {\r\n            title: video.name,\r\n            description: `Watch ${video.name} from BJH Bangkok Medical Center`,\r\n            url: pageUrl,\r\n            siteName: \"BJH Bangkok\",\r\n            type: \"video.other\",\r\n            images: [\r\n                {\r\n                    url: video.thumbnail,\r\n                    width: video.width,\r\n                    height: video.height,\r\n                    alt: video.name,\r\n                },\r\n            ],\r\n            videos: [\r\n                {\r\n                    url: video.url,\r\n                    secureUrl: video.url,\r\n                    type: video.mimeType,\r\n                    width: video.width,\r\n                    height: video.height,\r\n                },\r\n            ],\r\n        },\r\n\r\n        // Twitter Card for video\r\n        twitter: {\r\n            card: \"player\",\r\n            title: video.name,\r\n            description: `Watch ${video.name} from BJH Bangkok Medical Center`,\r\n            images: [video.thumbnail],\r\n        },\r\n\r\n        // Additional meta tags via 'other' - these will be rendered as <meta name=\"key\" content=\"value\">\r\n        other: {\r\n            // LINE specific\r\n            \"line:title\": video.name,\r\n            \"line:description\": `Watch ${video.name}`,\r\n\r\n            // Video meta tags (for broader compatibility)\r\n            \"video:duration\": video.duration?.toString() || \"\",\r\n            \"video:release_date\": new Date().toISOString(),\r\n\r\n            // Apple specific for inline video\r\n            \"apple-mobile-web-app-capable\": \"yes\",\r\n\r\n            // Additional OG video tags as fallback\r\n            \"og:video\": video.url,\r\n            \"og:video:secure_url\": video.url,\r\n            \"og:video:type\": video.mimeType,\r\n            \"og:video:width\": String(video.width),\r\n            \"og:video:height\": String(video.height),\r\n        },\r\n    };\r\n}\r\n\r\n// Video share page component - Optimized for LINE in-app browser\r\nexport default async function VideoSharePage({\r\n    params,\r\n}: {\r\n    params: Promise<{ id: string }>;\r\n}) {\r\n    const { id } = await params;\r\n    const video = await getVideoInfo(id);\r\n\r\n    if (!video) {\r\n        notFound();\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex flex-col\">\r\n            {/* Full-screen Video Player for LINE */}\r\n            <div className=\"flex-1 flex items-center justify-center p-2 sm:p-4\">\r\n                <div className=\"w-full max-w-4xl\">\r\n                    {/* Video Container - Large and prominent */}\r\n                    <div className=\"bg-black rounded-xl sm:rounded-2xl overflow-hidden shadow-2xl\">\r\n                        <video\r\n                            controls\r\n                            autoPlay\r\n                            muted\r\n                            playsInline\r\n                            preload=\"auto\"\r\n                            poster={video.thumbnail}\r\n                            className=\"w-full aspect-video\"\r\n                            controlsList=\"nodownload\"\r\n                            webkit-playsinline=\"true\"\r\n                            x-webkit-airplay=\"allow\"\r\n                        >\r\n                            <source src={video.url} type={video.mimeType} />\r\n                            Your browser does not support the video tag.\r\n                        </video>\r\n                    </div>\r\n\r\n                    {/* Tap to unmute hint */}\r\n                    <div className=\"mt-3 text-center\">\r\n                        <p className=\"text-white/40 text-sm\">üîä ‡πÅ‡∏ï‡∏∞‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á</p>\r\n                    </div>\r\n\r\n                    {/* Video Info - Compact */}\r\n                    <div className=\"mt-4 text-center px-4\">\r\n                        <h1 className=\"text-lg sm:text-2xl font-bold text-white mb-1 line-clamp-2\">{video.name}</h1>\r\n                        <p className=\"text-white/60 text-sm\">BJH Bangkok Medical Center</p>\r\n                    </div>\r\n\r\n                    {/* Action buttons - Mobile optimized */}\r\n                    <div className=\"mt-6 px-4 flex flex-col sm:flex-row justify-center gap-3\">\r\n                        <a\r\n                            href={`https://social-plugins.line.me/lineit/share?url=${encodeURIComponent(`${BASE_URL}/share/video/${id}`)}`}\r\n                            target=\"_blank\"\r\n                            rel=\"noopener noreferrer\"\r\n                            className=\"px-6 py-3 bg-[#00B900] hover:bg-[#00A000] active:bg-[#009000] text-white rounded-xl font-medium transition-colors flex items-center justify-center gap-2 text-sm sm:text-base\"\r\n                        >\r\n                            <svg className=\"w-5 h-5\" viewBox=\"0 0 24 24\" fill=\"currentColor\">\r\n                                <path d=\"M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.349 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.281.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314\" />\r\n                            </svg>\r\n                            ‡πÅ‡∏ä‡∏£‡πå‡∏ï‡πà‡∏≠‡πÉ‡∏ô LINE\r\n                        </a>\r\n\r\n                        <CopyButton url={`${BASE_URL}/share/video/${id}`} />\r\n                    </div>\r\n\r\n                    {/* Back to gallery link */}\r\n                    <div className=\"mt-6 pb-6 text-center\">\r\n                        <a\r\n                            href=\"/all-files-gallery\"\r\n                            className=\"text-purple-400 hover:text-purple-300 underline text-sm\"\r\n                        >\r\n                            ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà\r\n                        </a>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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","ignoreList":[0]}