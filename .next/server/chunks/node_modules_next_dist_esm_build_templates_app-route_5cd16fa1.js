module.exports=[182631,e=>{"use strict";var t=e.i(747909),o=e.i(174017),n=e.i(996250),a=e.i(759756),r=e.i(561916),s=e.i(114444),l=e.i(837092),i=e.i(869741),u=e.i(316795),c=e.i(487718),d=e.i(995169),p=e.i(47587),g=e.i(666012),h=e.i(570101),m=e.i(626937),f=e.i(10372),E=e.i(193695);e.i(52474);var R=e.i(600220),v=e.i(89171),C=e.i(800314);let w=new Map;async function S(e){try{let{searchParams:t}=new URL(e.url),o=t.get("date")||new Date().toISOString().split("T")[0],n=`film-${o}`,a=w.get(n),r=Date.now();if(a&&r-a.timestamp<12e4)return console.log(`✅ Returning cached film-data for ${o}`),v.NextResponse.json(a.data,{status:200,headers:{"Cache-Control":"public, s-maxage=20, stale-while-revalidate=30","X-Cache-Status":"HIT"}});if(!process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL||!process.env.GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY||!process.env.GOOGLE_SPREADSHEET_ID)return v.NextResponse.json({success:!1,error:"Missing Google Sheets credentials in environment variables"},{status:500});let s=new C.google.auth.GoogleAuth({credentials:{client_email:process.env.GOOGLE_SERVICE_ACCOUNT_EMAIL,private_key:process.env.GOOGLE_SERVICE_ACCOUNT_PRIVATE_KEY.replace(/\\n/g,"\n")},scopes:["https://www.googleapis.com/auth/spreadsheets.readonly"]}),l=C.google.sheets({version:"v4",auth:s}),i=(await l.spreadsheets.values.get({spreadsheetId:process.env.GOOGLE_SPREADSHEET_ID,range:"Film data!A:Z"})).data.values,u=(await l.spreadsheets.values.get({spreadsheetId:process.env.GOOGLE_SPREADSHEET_ID,range:"Film_dev!A:Z"})).data.values||[];if(!i||0===i.length)return v.NextResponse.json({success:!0,date:o,agentCounts:{},total:0});let c=i[0],d=i.slice(1);console.log("=== GOOGLE SHEETS - Film data ==="),console.log("Target date:",o),console.log("Total columns:",c.length),console.log("Headers:",c),console.log("Total data rows:",d.length);let p=c.findIndex(e=>e.toLowerCase().includes("ผู้ติดต่อ")||"ผู้ติดต่อ"===e),g=c.findIndex(e=>e.toLowerCase().includes("วันที่ได้นัด consult")||"วันที่ได้นัด consult"===e),h=c.findIndex(e=>e.toLowerCase().includes("วันที่ได้นัดผ่าตัด")||"วันที่ได้นัดผ่าตัด"===e);if(-1===p||-1===g)return console.error("❌ Required columns not found"),console.error("contactPersonIndex:",p),console.error("consultDateIndex:",g),console.error("surgeryDateIndex:",h),v.NextResponse.json({success:!1,error:"Required columns not found in Film data sheet",availableHeaders:c},{status:500});let m={สา:"101",พัดชา:"102",ตั้งโอ๋:"103",Test:"104",จีน:"105",มุก:"106",เจ:"107",ว่าน:"108"},f={},E={};Object.values(m).forEach(e=>{f[e]=0,E[e]=0});let R=e=>{if(!e||""===e.trim())return null;try{let t=e.trim(),o=t.match(/^(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})$/);if(o){let[,e,t,n]=o;return`${n}-${t.padStart(2,"0")}-${e.padStart(2,"0")}`}let n=t.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(n){let[,e,t,o]=n;return`${e}-${t.padStart(2,"0")}-${o.padStart(2,"0")}`}let a=new Date(t);if(!isNaN(a.getTime()))return a.toISOString().split("T")[0];return null}catch(t){return console.error("Error parsing date:",e,t),null}},S=0,_=0;d.forEach((e,t)=>{if(!e||0===e.length)return;let n=e[p]?.toString().trim()||"",a=e[g]?.toString().trim()||"",r=-1!==h&&e[h]?.toString().trim()||"";if(!n)return;let s=null;for(let[e,t]of Object.entries(m))if(n.includes(e)){s=t;break}if(s){if(a){let e=R(a);e===o&&(f[s]++,S++,console.log(`✅ Consult Row ${t+2}: ${n} (${s}) on ${e}`))}if(r&&-1!==h){let e=R(r);e===o&&(E[s]++,_++,console.log(`✅ Surgery Row ${t+2}: ${n} (${s}) on ${e}`))}}});let O=Object.values(f).reduce((e,t)=>e+t,0),T=Object.values(E).reduce((e,t)=>e+t,0),x={};if(Object.values(m).forEach(e=>{x[e]=0}),u.length>0){let e=u[0],t=u.slice(1);console.log("=== GOOGLE SHEETS - Film_dev ==="),console.log("Total Film_dev columns:",e.length),console.log("Film_dev Headers:",e),console.log("Total Film_dev data rows:",t.length);let n=e.findIndex(e=>e.toLowerCase().includes("ผู้ติดต่อ")||"ผู้ติดต่อ"===e),a=e.findIndex(e=>e.toLowerCase().includes("วันที่ได้นัด consult")||"วันที่ได้นัด consult"===e);if(console.log("Film_dev contactPersonIndex:",n),console.log("Film_dev consultDateIndex:",a),-1!==n&&-1!==a){let e=0;t.forEach((t,r)=>{if(!t||0===t.length)return;let s=t[n]?.toString().trim()||"",l=t[a]?.toString().trim()||"";if(l&&s){let t=R(l);if(t===o){let o=null;for(let[e,t]of Object.entries(m))if(s.includes(e)){o=t;break}o&&(x[o]++,e++,console.log(`✅ Film_dev Row ${r+2}: ${s} (${o}) on ${t}`))}}}),console.log("Film_dev matched rows:",e),console.log("Film_dev consult counts:",x)}else console.warn("⚠️ Film_dev: Required columns not found")}let A={};Object.keys(f).forEach(e=>{A[e]=(f[e]||0)+(x[e]||0)});let I=Object.values(A).reduce((e,t)=>e+t,0);console.log("=== RESULTS ==="),console.log("Matched consult rows (Film data):",S),console.log("Matched surgery rows:",_),console.log("Film data consult counts:",f),console.log("Film_dev consult counts:",x),console.log("Combined consult counts:",A),console.log("Agent surgery counts:",E),console.log("Total consults (Film data only):",O),console.log("Total consults (Combined):",I),console.log("Total surgeries:",T);let y={success:!0,date:o,agentCounts:f,surgeryCounts:E,totalConsults:O,totalSurgeries:T,debug:{filmDataRows:d.length,filmDevRows:u.length-1,matchedConsultRows:S,matchedSurgeryRows:_,filmDataConsultCounts:f,filmDevConsultCounts:x,combinedConsultCounts:A,contactPersonColumn:c[p],consultDateColumn:c[g],surgeryDateColumn:-1!==h?c[h]:"Not found"}};return w.set(n,{data:y,timestamp:Date.now()}),v.NextResponse.json(y,{status:200,headers:{"Cache-Control":"public, s-maxage=20, stale-while-revalidate=30","X-Cache-Status":"MISS"}})}catch(e){return console.error("Error fetching Google Sheets (Film data):",e),v.NextResponse.json({success:!1,error:e.message||'Failed to fetch data from Google Sheets "Film data"',details:e},{status:500})}}e.s(["GET",()=>S],525855);var _=e.i(525855);let O=new t.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/google-sheets-film-data/route",pathname:"/api/google-sheets-film-data",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/google-sheets-film-data/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:T,workUnitAsyncStorage:x,serverHooks:A}=O;function I(){return(0,n.patchFetch)({workAsyncStorage:T,workUnitAsyncStorage:x})}async function y(e,t,n){O.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let v="/api/google-sheets-film-data/route";v=v.replace(/\/index$/,"")||"/";let C=await O.prepare(e,t,{srcPage:v,multiZoneDraftMode:!1});if(!C)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:w,params:S,nextConfig:_,parsedUrl:T,isDraftMode:x,prerenderManifest:A,routerServerContext:I,isOnDemandRevalidate:y,revalidateOnlyGenerated:b,resolvedPathname:N,clientReferenceManifest:D,serverActionsManifest:P}=C,$=(0,i.normalizeAppPath)(v),F=!!(A.dynamicRoutes[$]||A.routes[N]),G=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,T,!1):t.end("This page could not be found"),null);if(F&&!x){let e=!!A.routes[N],t=A.dynamicRoutes[$];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await G();throw new E.NoFallbackError}}let H=null;!F||O.isDev||x||(H="/index"===(H=N)?"/":H);let L=!0===O.isDev||!F,M=F&&!L;P&&D&&(0,s.setReferenceManifestsSingleton)({page:v,clientReferenceManifest:D,serverActionsManifest:P,serverModuleMap:(0,l.createServerModuleMap)({serverActionsManifest:P})});let U=e.method||"GET",j=(0,r.getTracer)(),k=j.getActiveScopeSpan(),q={params:S,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:L,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,o,n)=>O.onRequestError(e,t,n,I)},sharedContext:{buildId:w}},K=new u.NodeNextRequest(e),V=new u.NodeNextResponse(t),B=c.NextRequestAdapter.fromNodeNextRequest(K,(0,c.signalFromNodeResponse)(t));try{let s=async e=>O.handle(B,q).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let o=j.getRootSpanAttributes();if(!o)return;if(o.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${o.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=o.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${v}`)}),l=!!(0,a.getRequestMeta)(e,"minimalMode"),i=async a=>{var r,i;let u=async({previousCacheEntry:o})=>{try{if(!l&&y&&b&&!o)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let r=await s(a);e.fetchMetrics=q.renderOpts.fetchMetrics;let i=q.renderOpts.pendingWaitUntil;i&&n.waitUntil&&(n.waitUntil(i),i=void 0);let u=q.renderOpts.collectedTags;if(!F)return await (0,g.sendResponse)(K,V,r,q.renderOpts.pendingWaitUntil),null;{let e=await r.blob(),t=(0,h.toNodeOutgoingHttpHeaders)(r.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let o=void 0!==q.renderOpts.collectedRevalidate&&!(q.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&q.renderOpts.collectedRevalidate,n=void 0===q.renderOpts.collectedExpire||q.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:q.renderOpts.collectedExpire;return{value:{kind:R.CachedRouteKind.APP_ROUTE,status:r.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:o,expire:n}}}}catch(t){throw(null==o?void 0:o.isStale)&&await O.onRequestError(e,t,{routerKind:"App Router",routePath:v,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:y})},I),t}},c=await O.handleResponse({req:e,nextConfig:_,cacheKey:H,routeKind:o.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:y,revalidateOnlyGenerated:b,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:l});if(!F)return null;if((null==c||null==(r=c.value)?void 0:r.kind)!==R.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(i=c.value)?void 0:i.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",y?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,h.fromNodeOutgoingHttpHeaders)(c.value.headers);return l&&F||d.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,g.sendResponse)(K,V,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};k?await i(k):await j.withPropagatedContext(e.headers,()=>j.trace(d.BaseServerSpan.handleRequest,{spanName:`${U} ${v}`,kind:r.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},i))}catch(t){if(t instanceof E.NoFallbackError||await O.onRequestError(e,t,{routerKind:"App Router",routePath:$,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:y})}),F)throw t;return await (0,g.sendResponse)(K,V,new Response(null,{status:500})),null}}e.s(["handler",()=>y,"patchFetch",()=>I,"routeModule",()=>O,"serverHooks",()=>A,"workAsyncStorage",()=>T,"workUnitAsyncStorage",()=>x],182631)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_5cd16fa1.js.map