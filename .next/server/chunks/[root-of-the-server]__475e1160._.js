module.exports=[193695,(e,t,r)=>{t.exports=e.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},270406,(e,t,r)=>{t.exports=e.x("next/dist/compiled/@opentelemetry/api",()=>require("next/dist/compiled/@opentelemetry/api"))},918622,(e,t,r)=>{t.exports=e.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},556704,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},832319,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},324725,(e,t,r)=>{t.exports=e.x("next/dist/server/app-render/after-task-async-storage.external.js",()=>require("next/dist/server/app-render/after-task-async-storage.external.js"))},230056,e=>e.a(async(t,r)=>{try{let t=await e.y("pg");e.n(t),r()}catch(e){r(e)}},!0),843793,e=>e.a(async(t,r)=>{try{var a=e.i(230056),n=t([a]);[a]=n.then?(await n)():n,a.types.setTypeParser(a.types.builtins.DATE,e=>e),a.types.setTypeParser(a.types.builtins.TIMESTAMP,e=>e),a.types.setTypeParser(a.types.builtins.TIMESTAMPTZ,e=>e);let s=new a.Pool({host:process.env.DB_HOST||"n8n.bjhbangkok.com",port:parseInt(process.env.DB_PORT||"5432"),user:process.env.DB_USER||"postgres",password:process.env.DB_PASSWORD||"Bjh12345!!",database:process.env.DB_NAME||"postgres",max:20,idleTimeoutMillis:3e4,connectionTimeoutMillis:3e4,statement_timeout:6e4,query_timeout:6e4,ssl:!1});s.on("connect",()=>{}),s.on("error",e=>{}),e.s(["default",0,s]),r()}catch(e){r(e)}},!1),254799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},211615,e=>e.a(async(t,r)=>{try{var a=e.i(89171),n=e.i(843793),s=e.i(449632),o=t([n]);async function i(e){let t=await n.default.connect();try{let{email:r,password:n,rememberMe:o}=await e.json();if(!r||!n)return a.NextResponse.json({success:!1,message:"‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏≠‡∏µ‡πÄ‡∏°‡∏•/‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡∏∞‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"},{status:400});if(n.length<6)return a.NextResponse.json({success:!1,message:"‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£"},{status:400});let i=`
      SELECT 
        u.*,
        u.name AS fname,
        r.name AS role_name,
        r.tag AS role_tag,
        r.back_end,
        d.name AS department_name_fix,
        d.name_full_th AS department_name,
        p.name_full_th AS position_name
      FROM "BJH-Server"."user" u
      LEFT JOIN "BJH-Server".roles r ON u.id_role = r.id_role
      LEFT JOIN "BJH-Server".department d ON u.id_dep = d.id
      LEFT JOIN "BJH-Server"."position" p ON u.position = p.id
      WHERE (u.email = $1 OR u.username = $1)
        AND u.delete_date IS NULL
      LIMIT 1
    `;console.log("üîç Searching for user with:",r);let l=await t.query(i,[r]);if(console.log("üìä Query result:",l.rows.length,"rows found"),0===l.rows.length)return console.log("‚ùå User not found for:",r),a.NextResponse.json({success:!1,message:`‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö: ${r}`},{status:401});let u=l.rows[0],d=!1;try{let e=u.password.startsWith("$2y$")?u.password.replace("$2y$","$2b$"):u.password;console.log("üîê Password input:",n),console.log("üîë Hash from DB:",u.password.substring(0,20)+"..."),console.log("üîÑ Hash to compare:",e.substring(0,20)+"..."),d=await s.default.compare(n,e),console.log("‚úÖ Password match result:",d)}catch(e){console.error("‚ùå Password verification error:",e)}if(!d)return a.NextResponse.json({success:!1,message:"‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á"},{status:401});let p=`
      SELECT path, name_file
      FROM "BJH-Server".parth_file
      WHERE id_ref = $1 
        AND prefix = 'user_img' 
        AND delete_date IS NULL
      LIMIT 1
    `,c=await t.query(p,[u.id]),m="/images/user.png";if(c.rows.length>0){let e=c.rows[0];m=`${e.path}${e.name_file}`}let h=Buffer.from(`${u.id}:${Date.now()}:${Math.random()}`).toString("base64");await t.query(`UPDATE "BJH-Server"."user" 
       SET last_login = CURRENT_TIMESTAMP, token = $1 
       WHERE id = $2`,[h,u.id]);let g={id:u.id,name:u.name,lname:u.lname,username:u.username,email:u.email,status_rank:u.status_rank,admin:u.admin,role_name:u.role_name||"",role_tag:u.role_tag||"",back_end:u.back_end||!1,department_name:u.department_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",department_name_fix:u.department_name_fix||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",position_name:u.position_name||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏",avatar:m};return a.NextResponse.json({success:!0,message:`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${u.name}`,token:h,user:g})}catch(e){return console.error("Login error:",e),a.NextResponse.json({success:!1,message:"‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á"},{status:500})}finally{t.release()}}[n]=o.then?(await o)():o,e.s(["POST",()=>i]),r()}catch(e){r(e)}},!1),630450,e=>e.a(async(t,r)=>{try{var a=e.i(747909),n=e.i(174017),s=e.i(996250),o=e.i(759756),i=e.i(561916),l=e.i(114444),u=e.i(837092),d=e.i(869741),p=e.i(316795),c=e.i(487718),m=e.i(995169),h=e.i(47587),g=e.i(666012),x=e.i(570101),f=e.i(626937),R=e.i(10372),v=e.i(193695);e.i(52474);var w=e.i(600220),_=e.i(211615),y=t([_]);[_]=y.then?(await y)():y;let S=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/src/app/api/auth/login/route.ts",nextConfigOutput:"",userland:_}),{workAsyncStorage:A,workUnitAsyncStorage:N,serverHooks:b}=S;function E(){return(0,s.patchFetch)({workAsyncStorage:A,workUnitAsyncStorage:N})}async function T(e,t,r){S.isDev&&(0,o.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let a="/api/auth/login/route";a=a.replace(/\/index$/,"")||"/";let s=await S.prepare(e,t,{srcPage:a,multiZoneDraftMode:!1});if(!s)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:_,params:y,nextConfig:E,parsedUrl:T,isDraftMode:A,prerenderManifest:N,routerServerContext:b,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,resolvedPathname:O,clientReferenceManifest:M,serverActionsManifest:k}=s,H=(0,d.normalizeAppPath)(a),I=!!(N.dynamicRoutes[H]||N.routes[O]),$=async()=>((null==b?void 0:b.render404)?await b.render404(e,t,T,!1):t.end("This page could not be found"),null);if(I&&!A){let e=!!N.routes[O],t=N.dynamicRoutes[H];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await $();throw new v.NoFallbackError}}let j=null;!I||S.isDev||A||(j=O,j="/index"===j?"/":j);let D=!0===S.isDev||!I,q=I&&!D;k&&M&&(0,l.setReferenceManifestsSingleton)({page:a,clientReferenceManifest:M,serverActionsManifest:k,serverModuleMap:(0,u.createServerModuleMap)({serverActionsManifest:k})});let U=e.method||"GET",B=(0,i.getTracer)(),L=B.getActiveScopeSpan(),F={params:y,prerenderManifest:N,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:D,incrementalCache:(0,o.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,a)=>S.onRequestError(e,t,a,b)},sharedContext:{buildId:_}},J=new p.NodeNextRequest(e),K=new p.NodeNextResponse(t),W=c.NextRequestAdapter.fromNodeNextRequest(J,(0,c.signalFromNodeResponse)(t));try{let s=async e=>S.handle(W,F).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=B.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==m.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${U} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${U} ${a}`)}),l=!!(0,o.getRequestMeta)(e,"minimalMode"),u=async o=>{var i,u;let d=async({previousCacheEntry:n})=>{try{if(!l&&C&&P&&!n)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let a=await s(o);e.fetchMetrics=F.renderOpts.fetchMetrics;let i=F.renderOpts.pendingWaitUntil;i&&r.waitUntil&&(r.waitUntil(i),i=void 0);let u=F.renderOpts.collectedTags;if(!I)return await (0,g.sendResponse)(J,K,a,F.renderOpts.pendingWaitUntil),null;{let e=await a.blob(),t=(0,x.toNodeOutgoingHttpHeaders)(a.headers);u&&(t[R.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==F.renderOpts.collectedRevalidate&&!(F.renderOpts.collectedRevalidate>=R.INFINITE_CACHE)&&F.renderOpts.collectedRevalidate,n=void 0===F.renderOpts.collectedExpire||F.renderOpts.collectedExpire>=R.INFINITE_CACHE?void 0:F.renderOpts.collectedExpire;return{value:{kind:w.CachedRouteKind.APP_ROUTE,status:a.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==n?void 0:n.isStale)&&await S.onRequestError(e,t,{routerKind:"App Router",routePath:a,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})},b),t}},p=await S.handleResponse({req:e,nextConfig:E,cacheKey:j,routeKind:n.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:N,isRoutePPREnabled:!1,isOnDemandRevalidate:C,revalidateOnlyGenerated:P,responseGenerator:d,waitUntil:r.waitUntil,isMinimalMode:l});if(!I)return null;if((null==p||null==(i=p.value)?void 0:i.kind)!==w.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==p||null==(u=p.value)?void 0:u.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});l||t.setHeader("x-nextjs-cache",C?"REVALIDATED":p.isMiss?"MISS":p.isStale?"STALE":"HIT"),A&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let c=(0,x.fromNodeOutgoingHttpHeaders)(p.value.headers);return l&&I||c.delete(R.NEXT_CACHE_TAGS_HEADER),!p.cacheControl||t.getHeader("Cache-Control")||c.get("Cache-Control")||c.set("Cache-Control",(0,f.getCacheControlHeader)(p.cacheControl)),await (0,g.sendResponse)(J,K,new Response(p.value.body,{headers:c,status:p.value.status||200})),null};L?await u(L):await B.withPropagatedContext(e.headers,()=>B.trace(m.BaseServerSpan.handleRequest,{spanName:`${U} ${a}`,kind:i.SpanKind.SERVER,attributes:{"http.method":U,"http.target":e.url}},u))}catch(t){if(t instanceof v.NoFallbackError||await S.onRequestError(e,t,{routerKind:"App Router",routePath:H,routeType:"route",revalidateReason:(0,h.getRevalidateReason)({isStaticGeneration:q,isOnDemandRevalidate:C})}),I)throw t;return await (0,g.sendResponse)(J,K,new Response(null,{status:500})),null}}e.s(["handler",()=>T,"patchFetch",()=>E,"routeModule",()=>S,"serverHooks",()=>b,"workAsyncStorage",()=>A,"workUnitAsyncStorage",()=>N]),r()}catch(e){r(e)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__475e1160._.js.map