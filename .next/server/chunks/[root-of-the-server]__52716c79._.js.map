{"version":3,"sources":["../../../src/lib/db.ts","../../../src/app/api/crm-advanced/route.ts","../../../node_modules/next/src/build/templates/app-route.ts"],"sourcesContent":["import { Pool, types } from \"pg\";\r\n\r\n// ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÉ‡∏´‡πâ pg ‡πÑ‡∏°‡πà‡πÅ‡∏õ‡∏•‡∏á DATE ‡πÄ‡∏õ‡πá‡∏ô JavaScript Date object\r\n// ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ timezone shift\r\ntypes.setTypeParser(types.builtins.DATE, (val) => val); // DATE - return as string\r\ntypes.setTypeParser(types.builtins.TIMESTAMP, (val) => val); // TIMESTAMP - return as string\r\ntypes.setTypeParser(types.builtins.TIMESTAMPTZ, (val) => val); // TIMESTAMPTZ - return as string\r\n\r\n// ‡∏™‡∏£‡πâ‡∏≤‡∏á connection pool ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö PostgreSQL (n8n.bjhbangkok.com)\r\nconst pool = new Pool({\r\n  host: process.env.DB_HOST || \"n8n.bjhbangkok.com\",\r\n  port: parseInt(process.env.DB_PORT || \"5432\"),\r\n  user: process.env.DB_USER || \"postgres\",\r\n  password: process.env.DB_PASSWORD || \"Bjh12345!!\",\r\n  database: process.env.DB_NAME || \"postgres\",\r\n  max: 20, // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô connection ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î\r\n  idleTimeoutMillis: 30000,\r\n  connectionTimeoutMillis: 30000, // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏õ‡πá‡∏ô 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\r\n  statement_timeout: 60000, // Query timeout 60 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ\r\n  query_timeout: 60000,\r\n  // n8n ‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö SSL\r\n  ssl: false,\r\n});\r\n// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠\r\npool.on(\"connect\", () => {\r\n  // Connected to database\r\n});\r\npool.on(\"error\", (err) => {\r\n  // Database error\r\n  // ‡πÑ‡∏°‡πà exit ‡πÉ‡∏ô production ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ retry ‡πÑ‡∏î‡πâ\r\n  if (process.env.NODE_ENV !== \"production\") {\r\n    process.exit(-1);\r\n  }\r\n});\r\nexport default pool;\r\n","import { NextRequest, NextResponse } from \"next/server\";\r\nimport pool from \"@/lib/db\";\r\n\r\n// In-memory cache\r\nconst cache = new Map<\r\n  string,\r\n  { data: any; timestamp: number; expiresAt: number }\r\n>();\r\nconst CACHE_DURATION = 30000; // 30 seconds\r\n\r\n/**\r\n * GET /api/crm-advanced\r\n * ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CRM Advanced ‡∏à‡∏≤‡∏Å PostgreSQL Database\r\n * ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏°‡∏µ consult_date ‡∏´‡∏£‡∏∑‡∏≠ surgery_date\r\n */\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    const { searchParams } = new URL(request.url);\r\n    const startDate = searchParams.get(\"startDate\");\r\n    const endDate = searchParams.get(\"endDate\");\r\n    const month = searchParams.get(\"month\");\r\n    const year = searchParams.get(\"year\");\r\n\r\n    // Check cache first\r\n    const cacheKey = `crm-advanced-${startDate || \"all\"}-${endDate || \"all\"}-${\r\n      month || \"all\"\r\n    }-${year || \"all\"}`;\r\n    const cached = cache.get(cacheKey);\r\n    const now = Date.now();\r\n\r\n    if (cached && now < cached.expiresAt) {\r\n      console.log(`‚úÖ Returning cached CRM advanced data`);\r\n      return NextResponse.json(cached.data, {\r\n        status: 200,\r\n        headers: {\r\n          \"Cache-Control\": \"public, s-maxage=30, stale-while-revalidate=60\",\r\n          \"X-Cache-Status\": \"HIT\",\r\n          \"X-Data-Source\": \"PostgreSQL Database (Cached)\",\r\n        },\r\n      });\r\n    }\r\n\r\n    console.log(`üì° Fetching CRM advanced data from database...`);\r\n\r\n    // ‡∏™‡∏£‡πâ‡∏≤‡∏á SQL query ‡πÅ‡∏•‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏Å‡∏±‡∏ö n_customer ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤ n_customer.id_all ‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á\r\n    let query = `\r\n      SELECT \r\n        bl.id,\r\n        bl.appointment_time,\r\n        bl.status,\r\n        bl.customer_name,\r\n        bl.phone,\r\n        bl.interested_product,\r\n        bl.doctor,\r\n        bl.contact_staff,\r\n        bl.proposed_amount,\r\n        bl.star_flag,\r\n        bl.country,\r\n        bl.note,\r\n        bl.surgery_date,\r\n        bl.consult_date,\r\n        nc.id_all AS customer_id_all\r\n      FROM \"BJH-Server\".\"bjh_all_leads\" bl\r\n      LEFT JOIN LATERAL (\r\n        SELECT nc_sub.id_all\r\n        FROM \"BJH-Server\".n_customer nc_sub\r\n        WHERE nc_sub.id_all = bl.id::text\r\n        LIMIT 1\r\n      ) nc ON true\r\n      WHERE \r\n        1=1\r\n    `;\r\n\r\n    const params: any[] = [];\r\n    let paramIndex = 1;\r\n\r\n    // Filter by month and year if provided (for calendar view)\r\n    if (month && year) {\r\n      query += ` AND (\r\n        (bl.status = '‡∏ô‡∏±‡∏î Consult' AND bl.consult_date IS NOT NULL AND EXTRACT(MONTH FROM bl.consult_date::date) = $${paramIndex} AND EXTRACT(YEAR FROM bl.consult_date::date) = $${\r\n        paramIndex + 1\r\n      })\r\n        OR \r\n        (bl.status = '‡∏ô‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥' AND bl.surgery_date IS NOT NULL AND EXTRACT(MONTH FROM bl.surgery_date::date) = $${paramIndex} AND EXTRACT(YEAR FROM bl.surgery_date::date) = $${\r\n        paramIndex + 1\r\n      })\r\n      )`;\r\n      params.push(parseInt(month), parseInt(year));\r\n      paramIndex += 2;\r\n    }\r\n    // Filter by specific date (when clicking on calendar day)\r\n    else if (startDate && startDate === endDate) {\r\n      query += ` AND (\r\n        (bl.status = '‡∏ô‡∏±‡∏î Consult' AND bl.consult_date::date = $${paramIndex}::date)\r\n        OR \r\n        (bl.status = '‡∏ô‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥' AND bl.surgery_date::date = $${paramIndex}::date)\r\n      )`;\r\n      params.push(startDate);\r\n      paramIndex += 1;\r\n    }\r\n    // Filter by date range if provided (for table view)\r\n    else if (startDate && endDate) {\r\n      query += ` AND (\r\n        (bl.status = '‡∏ô‡∏±‡∏î Consult' AND bl.consult_date::date BETWEEN $${paramIndex}::date AND $${\r\n        paramIndex + 1\r\n      }::date)\r\n        OR \r\n        (bl.status = '‡∏ô‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥' AND bl.surgery_date::date BETWEEN $${paramIndex}::date AND $${\r\n        paramIndex + 1\r\n      }::date)\r\n      )`;\r\n      params.push(startDate, endDate);\r\n      paramIndex += 2;\r\n    }\r\n    // No date filter - get all records with consult_date or surgery_date\r\n    else {\r\n      query += ` AND (\r\n        (bl.status = '‡∏ô‡∏±‡∏î Consult' AND bl.consult_date IS NOT NULL)\r\n        OR \r\n        (bl.status = '‡∏ô‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥' AND bl.surgery_date IS NOT NULL)\r\n      )`;\r\n    }\r\n\r\n    // Order by date according to status\r\n    query += ` ORDER BY \r\n      CASE \r\n        WHEN bl.status = '‡∏ô‡∏±‡∏î Consult' THEN bl.consult_date::date\r\n        WHEN bl.status = '‡∏ô‡∏±‡∏î‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ó‡∏≥' THEN bl.surgery_date::date\r\n      END ASC,\r\n      bl.appointment_time ASC\r\n    `;\r\n\r\n    // Execute query\r\n    const client = await pool.connect();\r\n    try {\r\n      const result = await client.query(query, params);\r\n\r\n      console.log(\r\n        `‚úÖ Successfully fetched ${result.rows.length} CRM records from database`\r\n      );\r\n\r\n      // Transform data\r\n      const transformedData = {\r\n        success: true,\r\n        data: result.rows.map((row) => {\r\n          // ‡πÅ‡∏õ‡∏•‡∏á date ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD format\r\n          // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ pg ‡πÉ‡∏´‡πâ return date ‡πÄ‡∏õ‡πá‡∏ô string ‡πÅ‡∏•‡πâ‡∏ß ‡∏à‡∏∂‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ timezone\r\n          const formatDate = (dateValue: any): string => {\r\n            if (!dateValue) return \"\";\r\n            const dateStr = String(dateValue);\r\n            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ T ‡∏≠‡∏¢‡∏π‡πà (ISO format) ‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏î‡πÄ‡∏≠‡∏≤‡∏™‡πà‡∏ß‡∏ô date\r\n            if (dateStr.includes(\"T\")) {\r\n              return dateStr.split(\"T\")[0];\r\n            }\r\n            // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ space (timestamp format ‡πÄ‡∏ä‡πà‡∏ô \"2025-11-25 10:00:00\")\r\n            if (dateStr.includes(\" \")) {\r\n              return dateStr.split(\" \")[0];\r\n            }\r\n            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô YYYY-MM-DD ‡∏≠‡∏¢‡∏π‡πà‡πÅ‡∏•‡πâ‡∏ß\r\n            return dateStr;\r\n          };\r\n\r\n          // ‡πÅ‡∏õ‡∏•‡∏á time ‡πÉ‡∏´‡πâ‡πÄ‡∏õ‡πá‡∏ô HH:MM:SS format\r\n          const formatTime = (timeValue: any): string => {\r\n            if (!timeValue) return \"\";\r\n            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô string ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á\r\n            if (typeof timeValue === \"string\") {\r\n              return timeValue;\r\n            }\r\n            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô object ‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÉ‡∏´‡πâ‡πÅ‡∏õ‡∏•‡∏á‡πÄ‡∏õ‡πá‡∏ô string\r\n            return String(timeValue);\r\n          };\r\n\r\n          return {\r\n            id: row.id,\r\n            appointmentTime: formatTime(row.appointment_time),\r\n            status: row.status || \"\",\r\n            customer_name: row.customer_name || \"\",\r\n            phone: row.phone || \"\",\r\n            interested_product: row.interested_product || \"\",\r\n            doctor: row.doctor || \"\",\r\n            contact_staff: row.contact_staff || \"\",\r\n            proposed_amount: parseFloat(row.proposed_amount || 0),\r\n            proposedAmount: parseFloat(row.proposed_amount || 0),\r\n            star_flag: row.star_flag || \"\",\r\n            country: row.country || \"\",\r\n            note: row.note || \"\",\r\n            surgery_date: formatDate(row.surgery_date),\r\n            consult_date: formatDate(row.consult_date),\r\n            hasCustomerProfile: Boolean(row.customer_id_all),\r\n            customerIdAll: row.customer_id_all || \"\",\r\n            // ‡πÄ‡∏û‡∏¥‡πà‡∏° field ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô\r\n            displayDate:\r\n              formatDate(row.surgery_date) ||\r\n              formatDate(row.consult_date) ||\r\n              row.appointment_time ||\r\n              \"\",\r\n          };\r\n        }),\r\n        total: result.rows.length,\r\n        timestamp: new Date().toISOString(),\r\n        source: \"PostgreSQL Database\",\r\n        debug: {\r\n          filters: {\r\n            startDate: startDate || \"all\",\r\n            endDate: endDate || \"all\",\r\n            month: month || \"all\",\r\n            year: year || \"all\",\r\n          },\r\n        },\r\n      };\r\n\r\n      // Update cache\r\n      cache.set(cacheKey, {\r\n        data: transformedData,\r\n        timestamp: now,\r\n        expiresAt: now + CACHE_DURATION,\r\n      });\r\n\r\n      // Clean old cache entries\r\n      for (const [key, value] of cache.entries()) {\r\n        if (now > value.expiresAt + 60000) {\r\n          cache.delete(key);\r\n        }\r\n      }\r\n\r\n      return NextResponse.json(transformedData, {\r\n        status: 200,\r\n        headers: {\r\n          \"Cache-Control\": \"public, s-maxage=30, stale-while-revalidate=60\",\r\n          \"X-Cache-Status\": \"MISS\",\r\n          \"X-Data-Source\": \"PostgreSQL Database (Fresh)\",\r\n        },\r\n      });\r\n    } finally {\r\n      client.release();\r\n    }\r\n  } catch (error: any) {\r\n    console.error(\"Error fetching CRM advanced data:\", error);\r\n\r\n    // Return cached data if available\r\n    const cached = cache.get(\"crm-advanced\");\r\n    if (cached) {\r\n      console.log(\"‚ö†Ô∏è Using expired cache due to database error\");\r\n      return NextResponse.json(cached.data, {\r\n        status: 200,\r\n        headers: {\r\n          \"X-Cache-Status\": \"STALE\",\r\n          \"X-Data-Source\": \"Database (Error Fallback)\",\r\n        },\r\n      });\r\n    }\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: false,\r\n        error: error.message || \"Failed to fetch CRM data\",\r\n        details: {\r\n          type: error.name,\r\n          message: error.message,\r\n          hint: \"‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ database connection ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥\",\r\n        },\r\n        data: [],\r\n      },\r\n      { status: 500 }\r\n    );\r\n  }\r\n}\r\n\r\n// Handle OPTIONS request for CORS\r\nexport async function OPTIONS(request: NextRequest) {\r\n  return new NextResponse(null, {\r\n    status: 200,\r\n    headers: {\r\n      \"Access-Control-Allow-Origin\": \"*\",\r\n      \"Access-Control-Allow-Methods\": \"GET, OPTIONS\",\r\n      \"Access-Control-Allow-Headers\": \"Content-Type\",\r\n    },\r\n  });\r\n}\r\n","import {\n  AppRouteRouteModule,\n  type AppRouteRouteHandlerContext,\n  type AppRouteRouteModuleOptions,\n} from '../../server/route-modules/app-route/module.compiled'\nimport { RouteKind } from '../../server/route-kind'\nimport { patchFetch as _patchFetch } from '../../server/lib/patch-fetch'\nimport type { IncomingMessage, ServerResponse } from 'node:http'\nimport { addRequestMeta, getRequestMeta } from '../../server/request-meta'\nimport { getTracer, type Span, SpanKind } from '../../server/lib/trace/tracer'\nimport { setReferenceManifestsSingleton } from '../../server/app-render/encryption-utils'\nimport { createServerModuleMap } from '../../server/app-render/action-utils'\nimport { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\nimport { NodeNextRequest, NodeNextResponse } from '../../server/base-http/node'\nimport {\n  NextRequestAdapter,\n  signalFromNodeResponse,\n} from '../../server/web/spec-extension/adapters/next-request'\nimport { BaseServerSpan } from '../../server/lib/trace/constants'\nimport { getRevalidateReason } from '../../server/instrumentation/utils'\nimport { sendResponse } from '../../server/send-response'\nimport {\n  fromNodeOutgoingHttpHeaders,\n  toNodeOutgoingHttpHeaders,\n} from '../../server/web/utils'\nimport { getCacheControlHeader } from '../../server/lib/cache-control'\nimport { INFINITE_CACHE, NEXT_CACHE_TAGS_HEADER } from '../../lib/constants'\nimport { NoFallbackError } from '../../shared/lib/no-fallback-error.external'\nimport {\n  CachedRouteKind,\n  type ResponseCacheEntry,\n  type ResponseGenerator,\n} from '../../server/response-cache'\n\nimport * as userland from 'VAR_USERLAND'\n\n// These are injected by the loader afterwards. This is injected as a variable\n// instead of a replacement because this could also be `undefined` instead of\n// an empty string.\ndeclare const nextConfigOutput: AppRouteRouteModuleOptions['nextConfigOutput']\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\n// INJECT:nextConfigOutput\n\nconst routeModule = new AppRouteRouteModule({\n  definition: {\n    kind: RouteKind.APP_ROUTE,\n    page: 'VAR_DEFINITION_PAGE',\n    pathname: 'VAR_DEFINITION_PATHNAME',\n    filename: 'VAR_DEFINITION_FILENAME',\n    bundlePath: 'VAR_DEFINITION_BUNDLE_PATH',\n  },\n  distDir: process.env.__NEXT_RELATIVE_DIST_DIR || '',\n  relativeProjectDir: process.env.__NEXT_RELATIVE_PROJECT_DIR || '',\n  resolvedPagePath: 'VAR_RESOLVED_PAGE_PATH',\n  nextConfigOutput,\n  userland,\n})\n\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule\n\nfunction patchFetch() {\n  return _patchFetch({\n    workAsyncStorage,\n    workUnitAsyncStorage,\n  })\n}\n\nexport {\n  routeModule,\n  workAsyncStorage,\n  workUnitAsyncStorage,\n  serverHooks,\n  patchFetch,\n}\n\nexport async function handler(\n  req: IncomingMessage,\n  res: ServerResponse,\n  ctx: {\n    waitUntil: (prom: Promise<void>) => void\n  }\n) {\n  if (routeModule.isDev) {\n    addRequestMeta(req, 'devRequestTimingInternalsEnd', process.hrtime.bigint())\n  }\n  let srcPage = 'VAR_DEFINITION_PAGE'\n\n  // turbopack doesn't normalize `/index` in the page name\n  // so we need to to process dynamic routes properly\n  // TODO: fix turbopack providing differing value from webpack\n  if (process.env.TURBOPACK) {\n    srcPage = srcPage.replace(/\\/index$/, '') || '/'\n  } else if (srcPage === '/index') {\n    // we always normalize /index specifically\n    srcPage = '/'\n  }\n  const multiZoneDraftMode = process.env\n    .__NEXT_MULTI_ZONE_DRAFT_MODE as any as boolean\n\n  const prepareResult = await routeModule.prepare(req, res, {\n    srcPage,\n    multiZoneDraftMode,\n  })\n\n  if (!prepareResult) {\n    res.statusCode = 400\n    res.end('Bad Request')\n    ctx.waitUntil?.(Promise.resolve())\n    return null\n  }\n\n  const {\n    buildId,\n    params,\n    nextConfig,\n    parsedUrl,\n    isDraftMode,\n    prerenderManifest,\n    routerServerContext,\n    isOnDemandRevalidate,\n    revalidateOnlyGenerated,\n    resolvedPathname,\n    clientReferenceManifest,\n    serverActionsManifest,\n  } = prepareResult\n\n  const normalizedSrcPage = normalizeAppPath(srcPage)\n\n  let isIsr = Boolean(\n    prerenderManifest.dynamicRoutes[normalizedSrcPage] ||\n      prerenderManifest.routes[resolvedPathname]\n  )\n\n  const render404 = async () => {\n    // TODO: should route-module itself handle rendering the 404\n    if (routerServerContext?.render404) {\n      await routerServerContext.render404(req, res, parsedUrl, false)\n    } else {\n      res.end('This page could not be found')\n    }\n    return null\n  }\n\n  if (isIsr && !isDraftMode) {\n    const isPrerendered = Boolean(prerenderManifest.routes[resolvedPathname])\n    const prerenderInfo = prerenderManifest.dynamicRoutes[normalizedSrcPage]\n\n    if (prerenderInfo) {\n      if (prerenderInfo.fallback === false && !isPrerendered) {\n        if (nextConfig.experimental.adapterPath) {\n          return await render404()\n        }\n        throw new NoFallbackError()\n      }\n    }\n  }\n\n  let cacheKey: string | null = null\n\n  if (isIsr && !routeModule.isDev && !isDraftMode) {\n    cacheKey = resolvedPathname\n    // ensure /index and / is normalized to one key\n    cacheKey = cacheKey === '/index' ? '/' : cacheKey\n  }\n\n  const supportsDynamicResponse: boolean =\n    // If we're in development, we always support dynamic HTML\n    routeModule.isDev === true ||\n    // If this is not SSG or does not have static paths, then it supports\n    // dynamic HTML.\n    !isIsr\n\n  // This is a revalidation request if the request is for a static\n  // page and it is not being resumed from a postponed render and\n  // it is not a dynamic RSC request then it is a revalidation\n  // request.\n  const isStaticGeneration = isIsr && !supportsDynamicResponse\n\n  // Before rendering (which initializes component tree modules), we have to\n  // set the reference manifests to our global store so Server Action's\n  // encryption util can access to them at the top level of the page module.\n  if (serverActionsManifest && clientReferenceManifest) {\n    setReferenceManifestsSingleton({\n      page: srcPage,\n      clientReferenceManifest,\n      serverActionsManifest,\n      serverModuleMap: createServerModuleMap({\n        serverActionsManifest,\n      }),\n    })\n  }\n\n  const method = req.method || 'GET'\n  const tracer = getTracer()\n  const activeSpan = tracer.getActiveScopeSpan()\n\n  const context: AppRouteRouteHandlerContext = {\n    params,\n    prerenderManifest,\n    renderOpts: {\n      experimental: {\n        authInterrupts: Boolean(nextConfig.experimental.authInterrupts),\n      },\n      cacheComponents: Boolean(nextConfig.cacheComponents),\n      supportsDynamicResponse,\n      incrementalCache: getRequestMeta(req, 'incrementalCache'),\n      cacheLifeProfiles: nextConfig.cacheLife,\n      waitUntil: ctx.waitUntil,\n      onClose: (cb) => {\n        res.on('close', cb)\n      },\n      onAfterTaskError: undefined,\n      onInstrumentationRequestError: (error, _request, errorContext) =>\n        routeModule.onRequestError(\n          req,\n          error,\n          errorContext,\n          routerServerContext\n        ),\n    },\n    sharedContext: {\n      buildId,\n    },\n  }\n  const nodeNextReq = new NodeNextRequest(req)\n  const nodeNextRes = new NodeNextResponse(res)\n\n  const nextReq = NextRequestAdapter.fromNodeNextRequest(\n    nodeNextReq,\n    signalFromNodeResponse(res)\n  )\n\n  try {\n    const invokeRouteModule = async (span?: Span) => {\n      return routeModule.handle(nextReq, context).finally(() => {\n        if (!span) return\n\n        span.setAttributes({\n          'http.status_code': res.statusCode,\n          'next.rsc': false,\n        })\n\n        const rootSpanAttributes = tracer.getRootSpanAttributes()\n        // We were unable to get attributes, probably OTEL is not enabled\n        if (!rootSpanAttributes) {\n          return\n        }\n\n        if (\n          rootSpanAttributes.get('next.span_type') !==\n          BaseServerSpan.handleRequest\n        ) {\n          console.warn(\n            `Unexpected root span type '${rootSpanAttributes.get(\n              'next.span_type'\n            )}'. Please report this Next.js issue https://github.com/vercel/next.js`\n          )\n          return\n        }\n\n        const route = rootSpanAttributes.get('next.route')\n        if (route) {\n          const name = `${method} ${route}`\n\n          span.setAttributes({\n            'next.route': route,\n            'http.route': route,\n            'next.span_name': name,\n          })\n          span.updateName(name)\n        } else {\n          span.updateName(`${method} ${srcPage}`)\n        }\n      })\n    }\n    const isMinimalMode = Boolean(\n      process.env.MINIMAL_MODE || getRequestMeta(req, 'minimalMode')\n    )\n\n    const handleResponse = async (currentSpan?: Span) => {\n      const responseGenerator: ResponseGenerator = async ({\n        previousCacheEntry,\n      }) => {\n        try {\n          if (\n            !isMinimalMode &&\n            isOnDemandRevalidate &&\n            revalidateOnlyGenerated &&\n            !previousCacheEntry\n          ) {\n            res.statusCode = 404\n            // on-demand revalidate always sets this header\n            res.setHeader('x-nextjs-cache', 'REVALIDATED')\n            res.end('This page could not be found')\n            return null\n          }\n\n          const response = await invokeRouteModule(currentSpan)\n\n          ;(req as any).fetchMetrics = (context.renderOpts as any).fetchMetrics\n          let pendingWaitUntil = context.renderOpts.pendingWaitUntil\n\n          // Attempt using provided waitUntil if available\n          // if it's not we fallback to sendResponse's handling\n          if (pendingWaitUntil) {\n            if (ctx.waitUntil) {\n              ctx.waitUntil(pendingWaitUntil)\n              pendingWaitUntil = undefined\n            }\n          }\n          const cacheTags = context.renderOpts.collectedTags\n\n          // If the request is for a static response, we can cache it so long\n          // as it's not edge.\n          if (isIsr) {\n            const blob = await response.blob()\n\n            // Copy the headers from the response.\n            const headers = toNodeOutgoingHttpHeaders(response.headers)\n\n            if (cacheTags) {\n              headers[NEXT_CACHE_TAGS_HEADER] = cacheTags\n            }\n\n            if (!headers['content-type'] && blob.type) {\n              headers['content-type'] = blob.type\n            }\n\n            const revalidate =\n              typeof context.renderOpts.collectedRevalidate === 'undefined' ||\n              context.renderOpts.collectedRevalidate >= INFINITE_CACHE\n                ? false\n                : context.renderOpts.collectedRevalidate\n\n            const expire =\n              typeof context.renderOpts.collectedExpire === 'undefined' ||\n              context.renderOpts.collectedExpire >= INFINITE_CACHE\n                ? undefined\n                : context.renderOpts.collectedExpire\n\n            // Create the cache entry for the response.\n            const cacheEntry: ResponseCacheEntry = {\n              value: {\n                kind: CachedRouteKind.APP_ROUTE,\n                status: response.status,\n                body: Buffer.from(await blob.arrayBuffer()),\n                headers,\n              },\n              cacheControl: { revalidate, expire },\n            }\n\n            return cacheEntry\n          } else {\n            // send response without caching if not ISR\n            await sendResponse(\n              nodeNextReq,\n              nodeNextRes,\n              response,\n              context.renderOpts.pendingWaitUntil\n            )\n            return null\n          }\n        } catch (err) {\n          // if this is a background revalidate we need to report\n          // the request error here as it won't be bubbled\n          if (previousCacheEntry?.isStale) {\n            await routeModule.onRequestError(\n              req,\n              err,\n              {\n                routerKind: 'App Router',\n                routePath: srcPage,\n                routeType: 'route',\n                revalidateReason: getRevalidateReason({\n                  isStaticGeneration,\n                  isOnDemandRevalidate,\n                }),\n              },\n              routerServerContext\n            )\n          }\n          throw err\n        }\n      }\n\n      const cacheEntry = await routeModule.handleResponse({\n        req,\n        nextConfig,\n        cacheKey,\n        routeKind: RouteKind.APP_ROUTE,\n        isFallback: false,\n        prerenderManifest,\n        isRoutePPREnabled: false,\n        isOnDemandRevalidate,\n        revalidateOnlyGenerated,\n        responseGenerator,\n        waitUntil: ctx.waitUntil,\n        isMinimalMode,\n      })\n\n      // we don't create a cacheEntry for ISR\n      if (!isIsr) {\n        return null\n      }\n\n      if (cacheEntry?.value?.kind !== CachedRouteKind.APP_ROUTE) {\n        throw new Error(\n          `Invariant: app-route received invalid cache entry ${cacheEntry?.value?.kind}`\n        )\n      }\n\n      if (!isMinimalMode) {\n        res.setHeader(\n          'x-nextjs-cache',\n          isOnDemandRevalidate\n            ? 'REVALIDATED'\n            : cacheEntry.isMiss\n              ? 'MISS'\n              : cacheEntry.isStale\n                ? 'STALE'\n                : 'HIT'\n        )\n      }\n\n      // Draft mode should never be cached\n      if (isDraftMode) {\n        res.setHeader(\n          'Cache-Control',\n          'private, no-cache, no-store, max-age=0, must-revalidate'\n        )\n      }\n\n      const headers = fromNodeOutgoingHttpHeaders(cacheEntry.value.headers)\n\n      if (!(isMinimalMode && isIsr)) {\n        headers.delete(NEXT_CACHE_TAGS_HEADER)\n      }\n\n      // If cache control is already set on the response we don't\n      // override it to allow users to customize it via next.config\n      if (\n        cacheEntry.cacheControl &&\n        !res.getHeader('Cache-Control') &&\n        !headers.get('Cache-Control')\n      ) {\n        headers.set(\n          'Cache-Control',\n          getCacheControlHeader(cacheEntry.cacheControl)\n        )\n      }\n\n      await sendResponse(\n        nodeNextReq,\n        nodeNextRes,\n        // @ts-expect-error - Argument of type 'Buffer<ArrayBufferLike>' is not assignable to parameter of type 'BodyInit | null | undefined'.\n        new Response(cacheEntry.value.body, {\n          headers,\n          status: cacheEntry.value.status || 200,\n        })\n      )\n      return null\n    }\n\n    // TODO: activeSpan code path is for when wrapped by\n    // next-server can be removed when this is no longer used\n    if (activeSpan) {\n      await handleResponse(activeSpan)\n    } else {\n      await tracer.withPropagatedContext(req.headers, () =>\n        tracer.trace(\n          BaseServerSpan.handleRequest,\n          {\n            spanName: `${method} ${srcPage}`,\n            kind: SpanKind.SERVER,\n            attributes: {\n              'http.method': method,\n              'http.target': req.url,\n            },\n          },\n          handleResponse\n        )\n      )\n    }\n  } catch (err) {\n    if (!(err instanceof NoFallbackError)) {\n      await routeModule.onRequestError(req, err, {\n        routerKind: 'App Router',\n        routePath: normalizedSrcPage,\n        routeType: 'route',\n        revalidateReason: getRevalidateReason({\n          isStaticGeneration,\n          isOnDemandRevalidate,\n        }),\n      })\n    }\n\n    // rethrow so that we can handle serving error page\n\n    // If this is during static generation, throw the error again.\n    if (isIsr) throw err\n\n    // Otherwise, send a 500 response.\n    await sendResponse(\n      nodeNextReq,\n      nodeNextRes,\n      new Response(null, { status: 500 })\n    )\n    return null\n  }\n}\n"],"names":["AppRouteRouteModule","RouteKind","patchFetch","_patchFetch","addRequestMeta","getRequestMeta","getTracer","SpanKind","setReferenceManifestsSingleton","createServerModuleMap","normalizeAppPath","NodeNextRequest","NodeNextResponse","NextRequestAdapter","signalFromNodeResponse","BaseServerSpan","getRevalidateReason","sendResponse","fromNodeOutgoingHttpHeaders","toNodeOutgoingHttpHeaders","getCacheControlHeader","INFINITE_CACHE","NEXT_CACHE_TAGS_HEADER","NoFallbackError","CachedRouteKind","userland","routeModule","definition","kind","APP_ROUTE","page","pathname","filename","bundlePath","distDir","process","env","__NEXT_RELATIVE_DIST_DIR","relativeProjectDir","__NEXT_RELATIVE_PROJECT_DIR","resolvedPagePath","nextConfigOutput","workAsyncStorage","workUnitAsyncStorage","serverHooks","handler","req","res","ctx","isDev","hrtime","bigint","srcPage","TURBOPACK","replace","multiZoneDraftMode","__NEXT_MULTI_ZONE_DRAFT_MODE","prepareResult","prepare","statusCode","end","waitUntil","Promise","resolve","buildId","params","nextConfig","parsedUrl","isDraftMode","prerenderManifest","routerServerContext","isOnDemandRevalidate","revalidateOnlyGenerated","resolvedPathname","clientReferenceManifest","serverActionsManifest","normalizedSrcPage","isIsr","Boolean","dynamicRoutes","routes","render404","isPrerendered","prerenderInfo","fallback","experimental","adapterPath","cacheKey","supportsDynamicResponse","isStaticGeneration","serverModuleMap","method","tracer","activeSpan","getActiveScopeSpan","context","renderOpts","authInterrupts","cacheComponents","incrementalCache","cacheLifeProfiles","cacheLife","onClose","cb","on","onAfterTaskError","undefined","onInstrumentationRequestError","error","_request","errorContext","onRequestError","sharedContext","nodeNextReq","nodeNextRes","nextReq","fromNodeNextRequest","invokeRouteModule","span","handle","finally","setAttributes","rootSpanAttributes","getRootSpanAttributes","get","handleRequest","console","warn","route","name","updateName","isMinimalMode","MINIMAL_MODE","handleResponse","currentSpan","cacheEntry","responseGenerator","previousCacheEntry","setHeader","response","fetchMetrics","pendingWaitUntil","cacheTags","collectedTags","blob","headers","type","revalidate","collectedRevalidate","expire","collectedExpire","value","status","body","Buffer","from","arrayBuffer","cacheControl","err","isStale","routerKind","routePath","routeType","revalidateReason","routeKind","isFallback","isRoutePPREnabled","Error","isMiss","delete","getHeader","set","Response","withPropagatedContext","trace","spanName","SERVER","attributes","url"],"mappings":"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","ignoreList":[2]}